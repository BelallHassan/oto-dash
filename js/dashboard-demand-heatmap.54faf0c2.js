(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dashboard-demand-heatmap","chunk-2d22cfc9","chunk-76a85986","chunk-5ee7a1fe","chunk-9bcd3210","chunk-135b8aca","chunk-2d0e1f16"],{"009c":function(t,e,i){"use strict";i("b6f0")},"00ca":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA7AAAAOwBeShxvQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGGSURBVFiF7de7ThtREAbgz3ZSBQknRUQRai4tDaaKkigFHQUFD0CFkOAZ6EDwIOYBkCKFpCIpEoUmUNOgpEMICgwIih2LZbW+AMbbeKTRnDOX8/9ndXbOLonU8B1nuHlmPQusWmCbwVUfgLN6iWnBpt/gTd0rxSN5pRhplIJJYVIuEnxAYEAAXnSI/8c+RjGZiR2ghIkc/9+ctar4FDX3pFWT2MDLVN4sTlPx4Vg0W/emzYZ2c/Jzwb8G0wo+420ssJQubLGBTcy76/XvYr6Ik24JLEfxWswPYj7SBYGm1iM+3ybnptUh/Bd2LOxExt8z6XQIf/Ya8KEEtoomUJMcItjOxCq4Dq08lkCnRrQqOUz1nNh42C+PBafzE2gni1jBHD5gKPxVrD+VwHDY1ylf1f0utoxjyXu/k6lfiHwpmyutPkhO8AfvU6CHMR7P5B5J2nUjRfpjjL9hyt2GuibQNyn8NhwQGBAo47xA/EYZvwok8JvkwrlU4M+pGPzARR+AL7DXBL8FYqr0ic6V2doAAAAASUVORK5CYII="},"01a4":function(t,e,i){"use strict";i("aafd")},"0413":function(t,e,i){"use strict";t.exports={eudist:function(t,e,i){for(var r=t.length,n=0,o=0;o<r;o++){var a=(t[o]||0)-(e[o]||0);n+=a*a}return i?Math.sqrt(n):n},mandist:function(t,e,i){for(var r=t.length,n=0,o=0;o<r;o++)n+=Math.abs((t[o]||0)-(e[o]||0));return i?Math.sqrt(n):n},dist:function(t,e,i){var r=Math.abs(t-e);return i?r:r*r}}},"0481":function(t,e,i){"use strict";var r=i("23e7"),n=i("a2bf"),o=i("7b0b"),a=i("50c4"),s=i("a691"),l=i("65f0");r({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=o(this),i=a(e.length),r=l(e,0);return r.length=n(r,e,e,i,0,void 0===t?1:s(t)),r}})},"04c6":function(t,e){(function(){t.exports=function(){class t{constructor(t){this.nodes=t}clone(){return this.nodes=null}item(t){return this.nodes[t]||null}}return Object.defineProperty(t.prototype,"length",{get:function(){return this.nodes.length||0}}),t}.call(this)}).call(this)},"05c0":function(t,e,i){"use strict";i.r(e),i.d(e,"VERSION",(function(){return r["a"]})),i.d(e,"self",(function(){return n["e"]})),i.d(e,"window",(function(){return n["f"]})),i.d(e,"global",(function(){return n["c"]})),i.d(e,"document",(function(){return n["b"]})),i.d(e,"process",(function(){return n["d"]})),i.d(e,"console",(function(){return n["a"]})),i.d(e,"isBrowser",(function(){return o["a"]})),i.d(e,"isBrowserMainThread",(function(){return o["b"]})),i.d(e,"getBrowser",(function(){return a["a"]})),i.d(e,"isMobile",(function(){return a["b"]})),i.d(e,"isElectron",(function(){return s["a"]})),i.d(e,"assert",(function(){return l}));var r=i("460f"),n=i("74be"),o=i("0ce1"),a=i("791f"),s=i("bdda");function l(t,e){if(!t)throw new Error(e||"Assertion failed")}},"065e":function(t,e){(function(){t.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},"0985":function(t,e){(function(){t.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},"0a55":function(t,e,i){"use strict";i("4cc1")},"0a6d":function(t,e){(function(){t.exports=class{hasFeature(t,e){return!0}createDocumentType(t,e,i){throw new Error("This DOM method is not implemented.")}createDocument(t,e,i){throw new Error("This DOM method is not implemented.")}createHTMLDocument(t){throw new Error("This DOM method is not implemented.")}getFeature(t,e){throw new Error("This DOM method is not implemented.")}}}).call(this)},"0bbb":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAdgAAAHYBTnsmCAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAACESURBVDiNxZPBCYAwFEOfolPoKOJRh/DYi4s5hB6dorqKYj20hyL+UhQxEAg0hOb/FmSUwAosQBHwiVCAcVSSKQ0E5IKODojC/wEZdtqN0z6qiz4u5zswgV2TeUj9ukKCfSTtTYUa6JwegPmmwhgK772r9pLp/zV+GrAJOholoB3F73wCi+8iy7hQQ6kAAAAASUVORK5CYII="},"0bd3":function(t,e,i){"use strict";(function(t){function r(){var e;if("undefined"!==typeof t&&"undefined"!==typeof t.cwd)return t.cwd();const i=null===(e=window.location)||void 0===e?void 0:e.pathname;return(null===i||void 0===i?void 0:i.slice(0,i.lastIndexOf("/")+1))||""}i.d(e,"a",(function(){return r}))}).call(this,i("4362"))},"0ce1":function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return o}));var r=i("bdda");function n(){const e="object"===typeof t&&"[object process]"===String(t)&&!t.browser;return!e||Object(r["a"])()}function o(){return n()&&"undefined"!==typeof document}}).call(this,i("4362"))},"0e1e":function(t,e,i){(function(){var e,r;r=i("92e7"),e=i("065e"),t.exports=class extends r{constructor(t){super(t),this.type=e.Dummy}clone(){return Object.create(this)}toString(t){return""}}}).call(this)},1566:function(t,e,i){"use strict";i("b4c6")},1585:function(t,e,i){(function(){var e,r,n;({isObject:n}=i("45f3")),r=i("92e7"),e=i("065e"),t.exports=function(){class t extends r{constructor(t,i,r,o){if(super(t),null==r)throw new Error("Missing DTD entity name. "+this.debugInfo(r));if(null==o)throw new Error("Missing DTD entity value. "+this.debugInfo(r));if(this.pe=!!i,this.name=this.stringify.name(r),this.type=e.EntityDeclaration,n(o)){if(!o.pubID&&!o.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(r));if(o.pubID&&!o.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(r));if(this.internal=!1,null!=o.pubID&&(this.pubID=this.stringify.dtdPubID(o.pubID)),null!=o.sysID&&(this.sysID=this.stringify.dtdSysID(o.sysID)),null!=o.nData&&(this.nData=this.stringify.dtdNData(o.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(r))}else this.value=this.stringify.dtdEntityValue(o),this.internal=!0}toString(t){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(t))}}return Object.defineProperty(t.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(t.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(t.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(t.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(t.prototype,"xmlVersion",{get:function(){return null}}),t}.call(this)}).call(this)},"188f":function(t,e,i){(function(){var e,r;r=i("92e7"),e=i("065e"),t.exports=class extends r{constructor(t,i,r,n,o,a){if(super(t),null==i)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==r)throw new Error("Missing DTD attribute name. "+this.debugInfo(i));if(!n)throw new Error("Missing DTD attribute type. "+this.debugInfo(i));if(!o)throw new Error("Missing DTD attribute default. "+this.debugInfo(i));if(0!==o.indexOf("#")&&(o="#"+o),!o.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(i));if(a&&!o.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(i));this.elementName=this.stringify.name(i),this.type=e.AttributeDeclaration,this.attributeName=this.stringify.name(r),this.attributeType=this.stringify.dtdAttType(n),a&&(this.defaultValue=this.stringify.dtdAttDefault(a)),this.defaultValueType=o}toString(t){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(t))}}}).call(this)},"195b":function(t,e,i){},"19ac":function(t,e,i){"use strict";(function(t){function r(){let e;if("undefined"!==typeof window&&window.performance)e=window.performance.now();else if("undefined"!==typeof t&&t.hrtime){const i=t.hrtime();e=1e3*i[0]+i[1]/1e6}else e=Date.now();return e}i.d(e,"a",(function(){return r}))}).call(this,i("4362"))},"1bf9":function(t,e){(function(){t.exports=function(){class t{constructor(t){this.arr=t||[]}item(t){return this.arr[t]||null}contains(t){return-1!==this.arr.indexOf(t)}}return Object.defineProperty(t.prototype,"length",{get:function(){return this.arr.length}}),t}.call(this)}).call(this)},"1ccc":function(t,e,i){},"1f08":function(t,e,i){(function(){var e;e=i("a4b6"),t.exports=class extends e{constructor(t){super(t)}document(t,e){var i,r,n,o,a;for(e=this.filterOptions(e),o="",a=t.children,r=0,n=a.length;r<n;r++)i=a[r],o+=this.writeChildNode(i,e,0);return e.pretty&&o.slice(-e.newline.length)===e.newline&&(o=o.slice(0,-e.newline.length)),o}}}).call(this)},"21a6":function(t,e,i){(function(i){var r,n,o;(function(i,a){n=[],r=a,o="function"===typeof r?r.apply(e,n):r,void 0===o||(t.exports=o)})(0,(function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function r(t,e,i){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){l(r.response,e,i)},r.onerror=function(){console.error("could not download file")},r.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(r){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i&&i.global===i?i:void 0,s=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(t,e,i){var s=a.URL||a.webkitURL,l=document.createElement("a");e=e||t.name||"download",l.download=e,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?o(l):n(l.href)?r(t,e,i):o(l,l.target="_blank")):(l.href=s.createObjectURL(t),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){o(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,i,a){if(i=i||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,a),i);else if(n(t))r(t,i,a);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout((function(){o(s)}))}}:function(t,e,i,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof t)return r(t,e,i);var o="application/octet-stream"===t.type,l=/constructor/i.test(a.HTMLElement)||a.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||o&&l||s)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=t:location=t,n=null},c.readAsDataURL(t)}else{var h=a.URL||a.webkitURL,p=h.createObjectURL(t);n?n.location=p:location.href=p,n=null,setTimeout((function(){h.revokeObjectURL(p)}),4e4)}});a.saveAs=l.saveAs=l,t.exports=l}))}).call(this,i("c8ba"))},2280:function(t,e,i){(function(){var e;e=i("065e"),i("92e7"),t.exports=function(){class t{constructor(t,i,r){if(this.parent=t,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==i)throw new Error("Missing attribute name. "+this.debugInfo(i));this.name=this.stringify.name(i),this.value=this.stringify.attValue(r),this.type=e.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(t){return this.options.writer.attribute(this,this.options.writer.filterOptions(t))}debugInfo(t){return t=t||this.name,null==t?"parent: <"+this.parent.name+">":"attribute: {"+t+"}, parent: <"+this.parent.name+">"}isEqualNode(t){return t.namespaceURI===this.namespaceURI&&(t.prefix===this.prefix&&(t.localName===this.localName&&t.value===this.value))}}return Object.defineProperty(t.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(t.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(t.prototype,"textContent",{get:function(){return this.value},set:function(t){return this.value=t||""}}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(t.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(t.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"specified",{get:function(){return!0}}),t}.call(this)}).call(this)},"22dc":function(t,e,i){"use strict";(function(t,r){i.d(e,"a",(function(){return o}));const n={self:"undefined"!==typeof self&&self,window:"undefined"!==typeof window&&window,global:"undefined"!==typeof t&&t,document:"undefined"!==typeof document&&document},o=(n.self||n.window||n.global,n.window||n.self||n.global,n.global||n.self||n.window,n.document,Boolean("object"!==typeof r||"[object process]"!==String(r)||r.browser)),a="undefined"!==typeof r&&r.version&&/v([0-9]*)/.exec(r.version);a&&parseFloat(a[1])}).call(this,i("c8ba"),i("4362"))},"25eb":function(t,e,i){var r=i("23e7"),n=i("c20d");r({target:"Number",stat:!0,forced:Number.parseInt!=n},{parseInt:n})},2869:function(t,e,i){},"2d2d":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var r=i("2909");i("a630"),i("3ca3"),i("a15b"),i("d81d"),i("ac1f"),i("1276"),i("fb6a");function n(t,e){return Array.from({length:e-t+1},(function(e,i){return i+t}))}function o(t,e){for(var i=Object(r["a"])(t),n=0;n<e;n++)i.push(i.shift());return i}function a(t){return t.split("_").map((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})).join(" ")}},"2d62":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA3QAAAN0BcFOiBwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAT6SURBVFiFvVddaFNnGH6+75ykJ6dJy8DRYJBZZrY6aTS1m6OutWjSOoXdDsfwQlZkeCF0VJ0XQmBM9ELwaiBeyTaZrFhH7fyJojPNnE0dtoLWttgfKulaG1iTnJPknO/dxdrStEvS2doH3ouP85znfc573vf7+BgRYT589fW1JMR+LkkVEufvMsbexDJARBOmEH3CNJ8yzi8E79y5N/85mzXwSXW1GrfZziiK8oWiKBJjbDl5/8sIdF03dV0/b9e05l8ikSQAcAAIBAI8oaohh8NxUFEUafaFlQwAUBRFcjgcBxOqGgoEAnzOwO1g8IRNVb2c8xVPvDA457Cpqvd2MHgCAFhdXd06C2PPiouLlRWteQEkEgk9Q/SObKTTu1SHQ1nYjK8bFqtV0aand8mcyCsxBhJiVQ1IjIETeWXivAIAClVAlmUIISAKGOWcg3MOwzAKmiDOK2RGZBd5klssFny+fz/8jY1Ip9O41tGBny5eXGSYMYZP9+3D7j17YLVacfP6dXx/4QIymUxObUZkl4UQeb++rr4elR4PWpqbYbPZcOz4cTx98gR/PnyYxdvi9cLn9+ObQACapuGrlhbU1dcjeONGTm0hBDgh/8zv9Plwpa0NoyMjeNbXh472dvgbGhbx/A0N6Ghvx7O+PoyOjOBKWxt2+nz5xxIABxFIiJzxuKcHHo9nbj01NYWS0tJFvJLSUkxNTc2tPR4PHvf05NUGEdgH1dWdJXZ7Ta4yrVmzBidPn0Y6k8HQ8+coKytDmdOJnkePsniezZsxHo1ifHwc68vLYbVY8PWRI5icnMz5C/6Ox8MyCvTAxMQEmg4cQNXWrVhfXg4GwFFSgsGBgSzeBrcbf42PY3BgALdu3sTD7u6CkwUhIAOFR5CIEOnqQqSrCzt9PjhKSvDzpUtZHG9VFR48eIDbwWD+pAsgzz8slgKa2QsWviNm/+3/0SJ6BQNEuQ28gpYsZgSXAovVCjZzYkqyvEiMcQ5JlpFJp5ekJ4jAvJWVnfY8UyBJEj7euxeNu3djrcu1JOEXY2O4fu0afr16FaZp5uTF4/GwPLsR5cL727bB39iI8+fOYWhoCDXbt+Oj2lqcPnkyi9dy7Bg6QyGEQyGsLy/HgaYmTE5O4vfOzpzaBBSeAp/fj8utrXNbr5ZMQtd1xGKxLF4qlYKWTCIWiyEWi+Fyayt8fj/CoVBObQDgJhFEnhgeHobL5Zpbb6mqQncksojXHYlgS1XV3NrlcmF4eDivtkkEVrlpU2exqubsAafTiW9PncJAfz9sNhvKnE40Hz6MeDyexbPb7Thz9izGo1FomoYNbjeOHz2KaDSa8+sTyWSYVW7c+JuqqrX5ylRUVITaHTug6zruh8M5z3pZlvFhTQ0URcG9u3eRSqXylj+ZTN5j77ndP9gdjs/yMl8T4tPTP8oGUa9hmuCcr2pyIQQMol6ZTLPbMAxYLJZVNWAYBsg0uxkAXuF2h20227aVvg3lAhFB07Q/nvb318hEJN5et65J4vy+1WpVV8NAOp1OpjWtiYgEB4DB0dHeRCp1SNP1l6YQeWd3OWEKAU3XXyZSqUODo6O9wLzLKWOMOZ3Ot2xFRd/JsryLMWaROAdbZnOSEDD/PSkzhmHc0lKpL6PR6DDNJGYLt2HGmPwGUKy6XNWMaCtnbC2IXq05GCNB9IIY606OjUViQIKIsjaRfwDMneyL4M79AAAAAABJRU5ErkJggg=="},"2dd8":function(t,e,i){"use strict";i("619d")},3034:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"d",(function(){return l})),i.d(e,"n",(function(){return u})),i.d(e,"p",(function(){return c})),i.d(e,"q",(function(){return h})),i.d(e,"f",(function(){return p})),i.d(e,"g",(function(){return d})),i.d(e,"r",(function(){return f})),i.d(e,"j",(function(){return m})),i.d(e,"k",(function(){return g})),i.d(e,"o",(function(){return y})),i.d(e,"e",(function(){return v})),i.d(e,"i",(function(){return _})),i.d(e,"h",(function(){return b})),i.d(e,"l",(function(){return x})),i.d(e,"m",(function(){return w}));var r=i("5530"),n=(i("99af"),i("4de4"),i("c820")),o=[{id:"gs1",type:"vehicle:",subText:"qr code",example:"vehicle:AF25F2"},{id:"gs2",type:"vehicle:",subText:"IMEI",example:"vehicle:860919123453422"},{id:"gs3",type:"trip:",subText:"last five digit of the associated trip id",example:"trip:0d72f"},{id:"gs4",type:"trip:",subText:"Rider phone number",example:"trip:0167749"},{id:"gs5",type:"trip:",subText:"Rider first name",example:"trip:Masum"},{id:"gs6",type:"trip:",subText:"Rider last name",example:"trip:Khandaker"},{id:"gs7",type:"trip:",subText:"Source Location Name",example:"trip:Narsingdi"},{id:"gs8",type:"trip:",subText:"Destination Location Name",example:"trip:Dhaka"},{id:"gs9",type:"rental:",subText:"last five digit of the associated rental id",example:"rental:554be"},{id:"gs10",type:"revenue:",subText:"last five digit of the associated invoice id",example:"revenue:3fb4f"},{id:"gs11",type:"payment:",subText:"last five digit of the associated invoice id",example:"payment:81ed8"},{id:"gs12",type:"rider:",subText:"First Name",example:"rider:Masum"},{id:"gs13",type:"rider:",subText:"Last Name",example:"rider:Khandaker"},{id:"gs14",type:"rider:",subText:"Phone Number",example:"rider:01677"},{id:"gs15",type:"rider:",subText:"email",example:"rider:masum@gmail.com"}],a={trip:n["c"].trip.index(),vehicle:n["c"].vehicle.index()+"?bike_category=P",rental:n["c"].vehicleRental.index(),revenue:n["c"].invoice.indexOfRevenue(),payment:n["c"].invoice.indexOfPayment(),rider:n["c"].rider.index()},s={trip:"ViewTrip",vehicle:"ViewVehicleProfile",rental:"VehicleRentalDetail"},l={trip:[{text:"Id",width:"5%",sort:null},{text:"Rider Phone Number",width:"15%",sort:null},{text:"Pickup Time",width:"15%",sort:null},{text:"Charge",width:"10%",sort:null},{text:"Status",width:"10%",sort:null}],vehicle:[{text:"QR Code",width:"20%",sort:null},{text:"IMEI",width:"30%",sort:null},{text:"Last Connected",width:"20%",sort:null},{text:"Flag",width:"30%",sort:null},{text:"Status",width:"10%",sort:null}],rental:[{text:"Id",width:"5%",sort:null},{text:"Rider Phone Number",width:"15%",sort:null},{text:"Pickup Time",width:"15%",sort:null},{text:"Charge",width:"10%",sort:null},{text:"Status",width:"10%",sort:null}],revenue:[{text:"Invoice ID",width:"5%",sort:null},{text:"Transaction Time",width:"15%",sort:null},{text:"Payment For",width:"15%",sort:null},{text:"Amount",width:"10%",sort:null},{text:"Status",width:"10%",sort:null}],payment:[{text:"Invoice ID",width:"5%",sort:null},{text:"Transaction Time",width:"15%",sort:null},{text:"Payment For",width:"15%",sort:null},{text:"Amount",width:"10%",sort:null},{text:"Status",width:"10%",sort:null}],rider:[{text:"Name",width:"15%",sort:null},{text:"Phone Number",width:"15%",sort:null},{text:"Default Card",width:"15%",sort:null},{text:"Balance",width:"10%",sort:null},{text:"Last Trip Status",width:"10%",sort:null}]},u=function(t,e,i){return e?i?"Force Completed by system":"Force Completed by Admin":"A"===t?"'Reservation Cancelled by Rider'":"T"===t?"Reservation time out":"UF"===t?"Unlocking Failed":void 0},c=function(t,e,i){if(e&&i)return"Completed";if(e&&!i)return"Force End";var r={R:"Reserved",A:"Cancelled",U:"Starting",O:"On Rent",V:"Forced",C:"Completed",T:"Time Out",UF:"Failed"};return t in r?r[t]:"-"},h=function(t,e,i){if(e&&i)return"ultra-green";if(e&&!i)return"red";var r={R:"blue",A:"red",U:"yellow",O:"purple",V:"red",C:"green",T:"red",UF:"black"},n=t in r?r[t]:"light-blue";return n},p=function(t){var e=Object(r["a"])(Object(r["a"])(Object(r["a"])({},t.general_flags),t.operational_flags),t.status_flags),i=[];for(var n in e)console.log("v-flag",n,e[n]),"is_idle"!==n&&!0===e[n]&&i.push(n);return console.log("enabled",i),i},d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={charging_pick:"Charging Pick",maintainance:"On Maintainance",rebalance:"Rebalance",swap_battery:"Swap Battery",hibernate_mode:"Sleep Mode",restricted_alert:"Restricted Alert",slowzone_alert:"Slowzone Alert",geo_fence_alert:"Geofence Alert",iot_fault:e.general_flags.fault_status_reason,low_battery:"low Battery",missing:"Missing",is_charging:"On Charging",is_parking:"On Parking",is_reserved:"On Reservation",is_on_ride:"On Ride",is_idle:"Idle",none:"None"};return t in i?i[t]:"--"},f=function(t){return"CANCELLED"===t||"REJECTED"===t},m=function(t){var e={REQUESTED:"Pending",ACCEPTED:"Accepted",CANCELLED:"Cancelled",REJECTED:"Rejected",TRIP_COMPLETED:"Completed",DELIVERED:"Rent Started"};return"TRIP_COMPLETED"===t.status?t.trip.status_forced?"Force End":"Completed":e[t.status]||"--"},g=function(t){var e={REQUESTED:"orange",ACCEPTED:"blue",CANCELLED:"red",REJECTED:"blush",TRIP_COMPLETED:"green",DELIVERED:"purple"};return"TRIP_COMPLETED"===t.status?t.trip.status_forced?"red":"green":e[t.status]||"blue"},y=function(t){var e=t.status,i=t.cancel_reason,r=t.reject_reason,n={CANCELLED:"Reason: ".concat(i||"N/A"),REJECTED:"Reason: ".concat(r||"N/A")};return n[e]||"--"},v=function(t){return t.invoice&&"string"!==typeof t.invoice?"".concat(t.invoice.currency.symbol," ").concat(t.invoice.amount):"--"},_=function(t,e){if("revenue"===t){if(e.isArray)return e;var i=[{text:"Subscription Credit/Pass",value:"Pass"},{text:"Card Trip",value:"Trip With Card"},{text:"Balance deduct by admin",value:"Rider Balance Adjust"}],r=i.filter((function(t){return t.value===e}));return r.length>0?r[0].text:e}if("payment"===t){if(e.isArray)return e;var n=[{text:"Card Topup",value:"Topup"},{text:"Agent Topup",value:"Agent Topup"},{text:"Signup Bonus",value:"Initial Balance"},{text:"Referral Bonus by Invitee",value:"Invitee Invitation Amount"},{text:"Referral Bonus by Inviter",value:"Inviter Invitation Amount"},{text:"Balance Transfer by Admin",value:"Rider Balance Adjust"}],o=n.filter((function(t){return t.value===e}));return o.length>0?o[0].text:e}},b=function(t){var e;console.log("card-details",t);var i=(null===t||void 0===t||null===(e=t.brand)||void 0===e?void 0:e.toLowerCase())||"",r="fab ";switch(null===i||void 0===i?void 0:i.toLowerCase()){case"visa":r+="fa-cc-visa";break;case"mastercard":r+="fa-cc-mastercard";break;case"americanexpress":r+="fa-cc-amex";break;case"discover":r+="fa-cc-discover";break;case"jcb":r+="fa-cc-jcb";break;case"dinersclub":r+="fa-cc-diners-club";break;default:r="fas fa-wallet";break}return r},x=function(t){var e={N:"Completed",R:"On Reserved",T:"On Rent",P:"On Pay",F:"On Feedback"};return t in e?e[t]:"--"},w=function(t){var e={N:"green",R:"orange",T:"purple",P:"yellow",F:"blue"};return t in e?e[t]:"gray"}},3200:function(t,e,i){"use strict";i("3c6a")},3215:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA7AAAAOwBeShxvQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKBSURBVFiF7ddLaFVXFMbxn0YU0xhN2qSgRsWID0pLUSEgDoJIpdY6qCCUggMfiJOOAoJYOiihs5YEFVLBkRSk4KOY2mYkghUfAymKDqr11UHVVmsRq1HSwdqh6e09N+fcXEf6hw33rLvP+r6zz97r7F0nH7sxCZdz9s/N+Iz4fHyN+nTdklrNmZARv4ZXcBSrMYjH6b9X8QFWoQ2vpfhT/IaL+BYDeDYWcxPRk0SaxWjswH0cw3H8lWK30IG1+AyXcAErqxGejCWptabYVPFEp/Am1uMelqd+V0pyjMcG3EVXUQNrUsIr+Bx1+B7fiIk4Unwc9pQxMMwC3MTmoiZG0oWzGeK78XsFA7AYDzC3GvHGJLA0Q/wi3h3FAHyB/dUY+BAnKoh3iNEZFK+iLiNPGx76d1nnZh/OZIi/jgP4UgzvBbE8sziPd0qDWYVomDYswvs4iV3oxApRF5ahH1fxI+ZVyPUzZhU10IStGeIDmDmi75AYoSz+EPXkP2RVwpHcQW8SXoG/k/gvoljlpazBPAa6xZOuEwXpiJhQO3GwpG+z7OXWWC6Yx8AiMcv7S+Kn0SC+GdLvj7AlI0+9mIiFOKdyPf9YTMC94h23V+jbh+2lwTwjUIle3MAbYpmOVpD+x1gNwOHUqmK0ZfjceWnghTMwVNTAAxkVrAqaxH6ykIFfMbtGBuakfIXYhB9qIN6KR5hW9MYW/ImFYzTwiTgrVEW3+PxmbbdGo128+7erNVAvPko9Km84ytEqtmqfVis+zAz8hEOYnvOeTlwXe8iixsvSgK/EnOjDe+Lg0ZRaK94Sh5ABcU7cWAvhUhaKeXEWt0VxGcITcQr6DtswJU+yfwAlgIRgLG8XPQAAAABJRU5ErkJggg=="},"3b32":function(t,e,i){(function(){var e,r;r=i("92e7"),e=i("065e"),t.exports=class extends r{constructor(t,i,r){if(super(t),null==i)throw new Error("Missing DTD element name. "+this.debugInfo());r||(r="(#PCDATA)"),Array.isArray(r)&&(r="("+r.join(",")+")"),this.name=this.stringify.name(i),this.type=e.ElementDeclaration,this.value=this.stringify.dtdElementValue(r)}toString(t){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(t))}}}).call(this)},"3c6a":function(t,e,i){},"45e4":function(t,e,i){"use strict";i("f864")},"45f3":function(t,e){(function(){var e,i,r,n,o,a,s,l={}.hasOwnProperty;e=function(t,...e){var i,r,n,a;if(o(Object.assign))Object.assign.apply(null,arguments);else for(i=0,n=e.length;i<n;i++)if(a=e[i],null!=a)for(r in a)l.call(a,r)&&(t[r]=a[r]);return t},o=function(t){return!!t&&"[object Function]"===Object.prototype.toString.call(t)},a=function(t){var e;return!!t&&("function"===(e=typeof t)||"object"===e)},r=function(t){return o(Array.isArray)?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},n=function(t){var e;if(r(t))return!t.length;for(e in t)if(l.call(t,e))return!1;return!0},s=function(t){var e,i;return a(t)&&(i=Object.getPrototypeOf(t))&&(e=i.constructor)&&"function"===typeof e&&e instanceof e&&Function.prototype.toString.call(e)===Function.prototype.toString.call(Object)},i=function(t){return o(t.valueOf)?t.valueOf():t},t.exports.assign=e,t.exports.isFunction=o,t.exports.isObject=a,t.exports.isArray=r,t.exports.isEmpty=n,t.exports.isPlainObject=s,t.exports.getValue=i}).call(this)},"460f":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var r=i("0ce1");const n="undefined"!==typeof __VERSION__?__VERSION__:"untranspiled source";Object(r["a"])()},"4cc1":function(t,e,i){},"4f5b":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("t-dropdown",{attrs:{variant:"calendar"},scopedSlots:t._u([{key:"trigger",fn:function(e){var r=e.mousedownHandler,n=e.focusHandler,o=e.blurHandler,a=e.keydownHandler;return i("div",{staticClass:"md:mr-2"},[i("button",{staticClass:"flex justify-between items-center px-6 mx-2 w-full h-12 text-sm text-gray-700 bg-white rounded-full border shadow-md transition duration-150 ease-in-out dropdown-button-size focus:outline-none focus:shadow-solid",attrs:{"aria-label":"Calendar","aria-haspopup":"true"},on:{mousedown:r,focus:n,blur:o,keydown:a}},[i("div",{staticClass:"flex items-center text-center"},[i("svg",{staticClass:"hidden w-6 h-6 md:block",attrs:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"}})]),t.selectedRange.start&&t.selectedRange.end?i("div",{staticClass:"md:ml-5"},[i("div",{staticClass:"font-bold text-15px text-mDark"},[i("span",{staticClass:"hidden md:inline"},[t._v(t._s(t.dateDiff))])]),i("div",{staticClass:"inline font-bold text-15px text-mDark md:hidden"},[t._v(" "+t._s(t.dateDiff)+" report ")])]):i("div",[i("div",{staticClass:"ml-3 font-bold text-15px text-mDark"},[t._v("Custom report")])])]),i("svg",{staticClass:"block mr-4 ml-auto w-6 h-6 md:hidden",attrs:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"}})]),i("i",{staticClass:"fas fa-chevron-down"})])])}},{key:"default",fn:function(e){var r=e.hide;return i("div",{staticClass:"flex justify-between p-1 rounded-md shadow-xs"},[i("v-range-selector",{staticClass:"w-9/12",attrs:{"start-date":t.selectedRange.start,"end-date":t.selectedRange.end},on:{"update:startDate":function(e){return t.$set(t.selectedRange,"start",e)},"update:start-date":function(e){return t.$set(t.selectedRange,"start",e)},"update:endDate":function(e){return t.$set(t.selectedRange,"end",e)},"update:end-date":function(e){return t.$set(t.selectedRange,"end",e)}}}),i("div",{staticClass:"flex flex-col justify-between ml-1 w-3/12 bg-gray-100"},[i("div",[i("button",{staticClass:"block py-2 px-2 mt-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.setEasyDatePickRange("today")}}},[t._v(" Today ")]),i("button",{staticClass:"block py-2 px-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.setEasyDatePickRange("yesterday")}}},[t._v(" Yesterday ")]),i("button",{staticClass:"block py-2 px-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.setEasyDatePickRange("this-week")}}},[t._v(" This Week ")]),i("button",{staticClass:"block py-2 px-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.setEasyDatePickRange("last-week")}}},[t._v(" Last Week ")]),i("button",{staticClass:"block px-2 py-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",class:"this-month"===t.selectedButtonName&&"selected-button",on:{click:function(e){return t.setEasyDatePickRange("this-month")}}},[t._v(" This Month ")]),i("button",{staticClass:"block px-2 py-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",class:"last-month"===t.selectedButtonName&&"selected-button",on:{click:function(e){return t.setEasyDatePickRange("last-month")}}},[t._v(" Last Month ")]),i("button",{staticClass:"block py-2 px-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.setEasyDatePickRange("last-7days")}}},[t._v(" Last 7 Days ")]),i("button",{staticClass:"block py-2 px-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.setEasyDatePickRange("last-28days")}}},[t._v(" Last 28 Days ")]),i("button",{staticClass:"block py-2 px-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.setEasyDatePickRange("lifetime")}}},[t._v(" Lifetime ")]),i("button",{staticClass:"block py-2 px-2 text-sm rounded-sm cursor-pointer text-calendar hover:text-gray-600",on:{click:function(e){return t.resetDateRange()}}},[t._v(" Custom ")])]),i("div",{staticClass:"flex justify-end items-center"},[i("button",{staticClass:"flex place-items-center px-4 font-semibold leading-normal uppercase bg-gray-300 rounded border border-transparent transition duration-150 ease-in-out cursor-pointer h-36px text-14px focus:outline-none hover:border-gray-900 hover:text-gray-900 focus:bg-gray-300",on:{click:function(e){r(),t.handleClickingCancel()}}},[t._v(" Cancel ")]),i("button",{staticClass:"flex place-items-center px-4 ml-3 font-semibold leading-normal text-gray-100 uppercase rounded border border-transparent transition duration-150 ease-in-out cursor-pointer h-36px text-14px focus:outline-none bg-oGreen hover:border-green-600 hover:text-white hover:opacity-75 focus:border-green-500",on:{click:function(e){r(),t.handleClickingApplyDate()}}},[t._v(" Apply ")])])])],1)}}])})},n=[],o=(i("caad"),i("e8f7")),a=i("5a0c"),s=i.n(a),l=i("83dc");s.a.extend(l);var u=i("c4a1");s.a.extend(u);var c=i("7e21");s.a.extend(c);var h={name:"DashboardDatePicker",components:{VRangeSelector:o["a"]},computed:{dateDiff:function(){if(null!==this.selectedRange.start&&null!==this.selectedRange.end){var t,e=s()(this.selectedRange.start),i=s()(this.selectedRange.end);return t=this.selectedRange.isSelected?i.diff(this.selectedRange.start,"day")+1:i.diff(this.selectedRange.start,"day"),e.isToday()&&i.isToday()?"Today's":e.isYesterday()&&i.isYesterday()?"Yesterday's":"2020-01-01"===this.selectedRange.start&&i.isToday()?"Lifetime":"Last "+t+" days"}return 0},startDate:function(){var t=this.selectedRange.start;return t===this.birthday?s()(this.selectedRange.start).format(this.friendlyFormat):s()(t).format(this.friendlyShortFormat)},endDate:function(){return s()(this.selectedRange.end).format(this.friendlyFormat)},printDate:function(){if(this.selectedRange.start===this.selectedRange.end)return s()(this.selectedRange.start).format(this.friendlyFormat);var t=s()(this.selectedRange.end);return"2020-01-01"===this.selectedRange.start&&t.isToday()?s()(this.selectedRange.start).format(this.friendlyFormat)+" - Today":this.startDate+" - "+this.endDate}},data:function(){return{selectedRange:{start:this.getLast7Day(),end:this.getToday(),isSelected:!1},format:"YYYY-MM-DD",friendlyFormat:"DD MMM YYYY",friendlyShortFormat:"DD MMM",birthday:"2020-01-01"}},watch:{"selectedRange.start":function(t){this.selectedRange.isSelected=!0,console.log("selectedRange.start",t)},"selectedRange.end":function(t){this.selectedRange.isSelected=!0,console.log("selectedRange.end",t)}},methods:{handleClickingApplyDate:function(){this.$emit("apply-date",{start:this.selectedRange.start||null,end:this.selectedRange.end||null}),this.$emit("updateChartByDate",this.selectedRange)},handleClickingCancel:function(){this.selectedRange={},this.$emit("cancel-date",{start:null,end:null})},resetDateRange:function(){this.selectedRange={}},easyDatePick:function(t){var e={},i=this.format,r=s()();if("today"===t)return e.start=r.format(i),e.end=r.format(i),e.isSelected=!0,e;if("yesterday"===t){var n=r.subtract(1,"day");return e.start=n.format(i),e.end=n.format(i),e.isSelected=!0,e}if("this-week"===t)return e.start=r.weekday(0).format(i),e.end=r.format(i),e.isSelected=!0,e;if("last-week"===t)return e.start=r.weekday(-6).format(i),e.end=r.weekday(0).format(i),e.isSelected=!0,e;if("this-month"===t)return e.start=r.startOf("month").format(i),e.end=r.format(i),this.selectedButtonName="this-month",e;if("last-month"===t){var o=r.subtract(1,"month");return e.start=o.startOf("month").format(i),e.end=o.endOf("month").format(i),this.selectedButtonName="last-month",e}return"last-7days"===t?(e.start=r.subtract(6,"day").format(i),e.end=r.format(i),e.isSelected=!0,e):"last-28days"===t?(e.start=r.subtract(27,"day").format(i),e.end=r.format(i),e.isSelected=!0,e):"last-90days"===t?(e.start=r.subtract(89,"day").format(i),e.end=r.format(i),e.isSelected=!0,e):"this-month"===t?(e.start=r.startOf("month").format(i),e.end=r.endOf("month").format(i),e.isSelected=!0,e):"this-year"===t?(e.start=r.startOf("year").format(i),e.end=r.endOf("year").format(i),e.isSelected=!0,e):"lifetime"===t?(e.start=s()("2020-01-01").format(i),e.end=r.format(i),e.isSelected=!0,e):e},setEasyDatePickRange:function(t){var e=["today","yesterday","this-week","last-week","last-7days","this-month","last-month","last-28days","last-90days","last-12months","this-year","lifetime","custom"];e.includes(t)?this.selectedRange=this.easyDatePick(t):this.selectedRange=this.easyDatePick("today")},getToday:function(){var t=s()();return t.format(this.format)},getLast7Day:function(){var t=s()().subtract(7,"day");return t.format(this.format)},getLast28Day:function(){var t=s()().subtract(27,"day");return t.format(this.format)}}},p=h,d=(i("6fef"),i("2877")),f=Object(d["a"])(p,r,n,!1,null,null,null);e["a"]=f.exports},"50d7":function(t,e,i){(function(){var e,r;e=i("065e"),r=i("92e7"),t.exports=class extends r{constructor(t,i){if(super(t),null==i)throw new Error("Missing raw text. "+this.debugInfo());this.type=e.Raw,this.value=this.stringify.raw(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.raw(this,this.options.writer.filterOptions(t))}}}).call(this)},"528d":function(t,e,i){(function(){var e,r,n;({isObject:n}=i("45f3")),r=i("92e7"),e=i("065e"),t.exports=class extends r{constructor(t,i,r,o){super(t),n(i)&&({version:i,encoding:r,standalone:o}=i),i||(i="1.0"),this.type=e.Declaration,this.version=this.stringify.xmlVersion(i),null!=r&&(this.encoding=this.stringify.xmlEncoding(r)),null!=o&&(this.standalone=this.stringify.xmlStandalone(o))}toString(t){return this.options.writer.declaration(this,this.options.writer.filterOptions(t))}}}).call(this)},"52c2":function(t,e,i){"use strict";var r=i("0413"),n=r.eudist,o=r.dist;t.exports={kmrand:function(t,e){var i={},r=[],n=e<<2,o=t.length,a=t[0].length>0;while(r.length<e&&n-- >0){var s=t[Math.floor(Math.random()*o)],l=a?s.join("_"):""+s;i[l]||(i[l]=!0,r.push(s))}if(r.length<e)throw new Error("Error initializating clusters");return r},kmpp:function(t,e){var i=t[0].length?n:o,r=[],a=t.length,s=t[0].length>0,l={},u=t[Math.floor(Math.random()*a)],c=s?u.join("_"):""+u;r.push(u),l[c]=!0;while(r.length<e){for(var h=[],p=r.length,d=0,f=[],m=0;m<a;m++){for(var g=1/0,y=0;y<p;y++){var v=i(t[m],r[y]);v<=g&&(g=v)}h[m]=g}for(var _=0;_<a;_++)d+=h[_];for(var b=0;b<a;b++)f[b]={i:b,v:t[b],pr:h[b]/d,cs:0};f.sort((function(t,e){return t.pr-e.pr})),f[0].cs=f[0].pr;for(var x=1;x<a;x++)f[x].cs=f[x-1].cs+f[x].pr;var w=Math.random(),T=0;while(T<a-1&&f[T++].cs<w);r.push(f[T-1].v)}return r}}},"536e":function(t,e,i){(function(){var e,r;e=i("065e"),r=i("578f"),t.exports=class extends r{constructor(t,i){if(super(t),null==i)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=e.CData,this.value=this.stringify.cdata(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.cdata(this,this.options.writer.filterOptions(t))}}}).call(this)},"54dd":function(t,e,i){(function(){var e,r,n,o,a,s,l,u,c,h,p,d,f,m,g,y,v,_,b,x,w,T,E={}.hasOwnProperty;({isObject:w,isFunction:x,isPlainObject:T,getValue:b}=i("45f3")),e=i("065e"),d=i("ae0a"),f=i("b8ee"),o=i("536e"),a=i("8930"),g=i("50d7"),_=i("9d2f"),m=i("f016"),h=i("528d"),p=i("d7e3"),s=i("188f"),u=i("1585"),l=i("3b32"),c=i("b6e1"),n=i("2280"),v=i("5a61"),y=i("1f08"),r=i("0985"),t.exports=class{constructor(t,i,r){var n;this.name="?xml",this.type=e.Document,t||(t={}),n={},t.writer?T(t.writer)&&(n=t.writer,t.writer=new y):t.writer=new y,this.options=t,this.writer=t.writer,this.writerOptions=this.writer.filterOptions(n),this.stringify=new v(t),this.onDataCallback=i||function(){},this.onEndCallback=r||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(t){var i,r,n,o,a,s,l,u;switch(t.type){case e.CData:this.cdata(t.value);break;case e.Comment:this.comment(t.value);break;case e.Element:for(r in n={},l=t.attribs,l)E.call(l,r)&&(i=l[r],n[r]=i.value);this.node(t.name,n);break;case e.Dummy:this.dummy();break;case e.Raw:this.raw(t.value);break;case e.Text:this.text(t.value);break;case e.ProcessingInstruction:this.instruction(t.target,t.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+t.constructor.name)}for(u=t.children,a=0,s=u.length;a<s;a++)o=u[a],this.createChildNode(o),o.type===e.Element&&this.up();return this}dummy(){return this}node(t,e,i){if(null==t)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(t));return this.openCurrent(),t=b(t),null==e&&(e={}),e=b(e),w(e)||([i,e]=[e,i]),this.currentNode=new f(this,t,e),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=i&&this.text(i),this}element(t,i,r){var n,o,a,s,l,u;if(this.currentNode&&this.currentNode.type===e.DocType)this.dtdElement(...arguments);else if(Array.isArray(t)||w(t)||x(t))for(s=this.options.noValidation,this.options.noValidation=!0,u=new d(this.options).element("TEMP_ROOT"),u.element(t),this.options.noValidation=s,l=u.children,o=0,a=l.length;o<a;o++)n=l[o],this.createChildNode(n),n.type===e.Element&&this.up();else this.node(t,i,r);return this}attribute(t,e){var i,r;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(t));if(null!=t&&(t=b(t)),w(t))for(i in t)E.call(t,i)&&(r=t[i],this.attribute(i,r));else x(e)&&(e=e.apply()),this.options.keepNullAttributes&&null==e?this.currentNode.attribs[t]=new n(this,t,""):null!=e&&(this.currentNode.attribs[t]=new n(this,t,e));return this}text(t){var e;return this.openCurrent(),e=new _(this,t),this.onData(this.writer.text(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(t){var e;return this.openCurrent(),e=new o(this,t),this.onData(this.writer.cdata(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(t){var e;return this.openCurrent(),e=new a(this,t),this.onData(this.writer.comment(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(t){var e;return this.openCurrent(),e=new g(this,t),this.onData(this.writer.raw(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(t,e){var i,r,n,o,a;if(this.openCurrent(),null!=t&&(t=b(t)),null!=e&&(e=b(e)),Array.isArray(t))for(i=0,o=t.length;i<o;i++)r=t[i],this.instruction(r);else if(w(t))for(r in t)E.call(t,r)&&(n=t[r],this.instruction(r,n));else x(e)&&(e=e.apply()),a=new m(this,t,e),this.onData(this.writer.processingInstruction(a,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(t,e,i){var r;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return r=new h(this,t,e,i),this.onData(this.writer.declaration(r,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(t,e,i){if(this.openCurrent(),null==t)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new p(this,e,i),this.currentNode.rootNodeName=t,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(t,e){var i;return this.openCurrent(),i=new l(this,t,e),this.onData(this.writer.dtdElement(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(t,e,i,r,n){var o;return this.openCurrent(),o=new s(this,t,e,i,r,n),this.onData(this.writer.dtdAttList(o,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(t,e){var i;return this.openCurrent(),i=new u(this,!1,t,e),this.onData(this.writer.dtdEntity(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(t,e){var i;return this.openCurrent(),i=new u(this,!0,t,e),this.onData(this.writer.dtdEntity(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(t,e){var i;return this.openCurrent(),i=new c(this,t,e),this.onData(this.writer.dtdNotation(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){while(this.currentLevel>=0)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(t){var i,n,o,a;if(!t.isOpen){if(this.root||0!==this.currentLevel||t.type!==e.Element||(this.root=t),n="",t.type===e.Element){for(o in this.writerOptions.state=r.OpenTag,n=this.writer.indent(t,this.writerOptions,this.currentLevel)+"<"+t.name,a=t.attribs,a)E.call(a,o)&&(i=a[o],n+=this.writer.attribute(i,this.writerOptions,this.currentLevel));n+=(t.children?">":"/>")+this.writer.endline(t,this.writerOptions,this.currentLevel),this.writerOptions.state=r.InsideTag}else this.writerOptions.state=r.OpenTag,n=this.writer.indent(t,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+t.rootNodeName,t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),t.children?(n+=" [",this.writerOptions.state=r.InsideTag):(this.writerOptions.state=r.CloseTag,n+=">"),n+=this.writer.endline(t,this.writerOptions,this.currentLevel);return this.onData(n,this.currentLevel),t.isOpen=!0}}closeNode(t){var i;if(!t.isClosed)return i="",this.writerOptions.state=r.CloseTag,i=t.type===e.Element?this.writer.indent(t,this.writerOptions,this.currentLevel)+"</"+t.name+">"+this.writer.endline(t,this.writerOptions,this.currentLevel):this.writer.indent(t,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(t,this.writerOptions,this.currentLevel),this.writerOptions.state=r.None,this.onData(i,this.currentLevel),t.isClosed=!0}onData(t,e){return this.documentStarted=!0,this.onDataCallback(t,e+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(t){return null==t?"":"node: <"+t+">"}ele(){return this.element(...arguments)}nod(t,e,i){return this.node(t,e,i)}txt(t){return this.text(t)}dat(t){return this.cdata(t)}com(t){return this.comment(t)}ins(t,e){return this.instruction(t,e)}dec(t,e,i){return this.declaration(t,e,i)}dtd(t,e,i){return this.doctype(t,e,i)}e(t,e,i){return this.element(t,e,i)}n(t,e,i){return this.node(t,e,i)}t(t){return this.text(t)}d(t){return this.cdata(t)}c(t){return this.comment(t)}r(t){return this.raw(t)}i(t,e){return this.instruction(t,e)}att(){return this.currentNode&&this.currentNode.type===e.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===e.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(t,e){return this.entity(t,e)}pent(t,e){return this.pEntity(t,e)}not(t,e){return this.notation(t,e)}}}).call(this)},"55a9":function(t,e,i){"use strict";(function(t){i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return o}));const r="undefined"!==typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n="undefined"!==typeof window?window:t;"undefined"!==typeof t||window,"undefined"!==typeof document&&document;let o=!1;try{const t={get passive(){return o=!0,!0}};n.addEventListener("test",null,t),n.removeEventListener("test",null)}catch(a){o=!1}}).call(this,i("c8ba"))},"578f":function(t,e,i){(function(){var e;e=i("92e7"),t.exports=function(){class t extends e{constructor(t){super(t),this.value=""}clone(){return Object.create(this)}substringData(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(t){return!!super.isEqualNode(t)&&t.data===this.data}}return Object.defineProperty(t.prototype,"data",{get:function(){return this.value},set:function(t){return this.value=t||""}}),Object.defineProperty(t.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(t.prototype,"textContent",{get:function(){return this.value},set:function(t){return this.value=t||""}}),t}.call(this)}).call(this)},"5a43":function(t,e,i){"use strict";i.r(e);var r={};i.r(r),i.d(r,"filename",(function(){return Ld})),i.d(r,"dirname",(function(){return Od})),i.d(r,"join",(function(){return Rd})),i.d(r,"resolve",(function(){return zd}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("base-layout",{staticClass:"min-h-screen pb-2 page-gradient"},[i("section",[i("content-section",{staticClass:"mt-2 md:px-12 md:pb-10"},[i("div",[i("div",{staticClass:"flex flex-col items-center justify-between my-5 md:flex-row"},[i("div",{staticClass:"section-title"},[t._v(" Rent Locations "),""!==t.map_load_text?i("span",{staticClass:"section-title-faded"},[t._v(t._s(t.map_load_text))]):t._e()]),i("div",[i("section",{staticClass:"w-full px-6 py-3  text-center"},[i("div",{staticClass:"flex items-center justify-center"},[i("div",{staticClass:"tab-items"},t._l(t.tabs,(function(e){return i("div",{key:"tab-item-"+e.id,class:t.getTabClass(e.id),domProps:{textContent:t._s(e.text)},on:{click:function(i){return t.onClickTab(e.id)}}})})),0)])])])]),i("LiveMapFilterPills",{ref:"heatmap_filter",attrs:{count:t.count,fleetData:t.fleetData},on:{filterHeatmapData:t.filterData}})],1),[i("div",{directives:[{name:"show",rawName:"v-show",value:t.chartLoaded,expression:"chartLoaded"}],staticClass:"grid grid-cols-1 md:gap-0 md:grid-cols-1"},[i("div",{staticStyle:{"min-height":"420px"}},[i("gmap-map",{directives:[{name:"show",rawName:"v-show",value:"google"===t.activeTabId,expression:"activeTabId === 'google'"}],ref:"map",staticStyle:{width:"100%",height:"70vh"},attrs:{zoom:t.map_zoom,center:t.map_center,"map-type-id":"terrain"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:"mapbox"===t.activeTabId,expression:"activeTabId === 'mapbox'"}]},[i("div",{staticClass:" relative ",staticStyle:{width:"100%",height:"70vh"}},[i("DemandHeatmapV2",{attrs:{isDataLoaded:t.isDataFullyLoaded,data:t.getMapDataForMapbox,defaultFleetId:t.defaultFleetId,filteredFleets:t.selectedFilteredFleets,geofencesData:t.allFleetGeoFence,isCurrentView:"mapbox"===t.activeTabId}})],1)])],1),t.showSlider&&t.sliderDates.length>1?i("div",[i("HistogramSlider",{ref:"hist_slider",staticStyle:{margin:"50px auto",width:"90%"},attrs:{"bar-height":0,data:t.sliderDates,prettify:t.prettifySlider,"drag-interval":!0,"force-edges":!1,colors:["#4facfe","#00f2fe"],min:t.minSliderDate,max:t.maxSliderDate},on:{finish:t.onDateSliderChange}})],1):t._e()])],t.chartLoaded?t._e():i("TheSuspense",{staticClass:"p-4 bg-white"},[i("SuspenseImg",{attrs:{height:"646px"}})],1)],2)],1)])},o=[],a=i("b85c"),s=i("ade3"),l=i("5530"),u=i("2909"),c=i("1da1"),h=(i("d81d"),i("4e82"),i("498a"),i("159b"),i("4de4"),i("d3b7"),i("ac1f"),i("1276"),i("caad"),i("99af"),i("25eb"),i("a9e3"),i("96cf"),i("9bf1")),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"filterContainerRef",staticClass:"relative flex flex-col md:flex-row gap-2 p-2 items-center justify-between mb-3 bg-white rounded-t",staticStyle:{"box-shadow":"0 5px 5px 0 rgba(0, 0, 0, 0.07)","z-index":"50"}},[i("div",{staticClass:"flex gap-2 item-center"},[i("button",{staticClass:"filter-base-dropdown-button app-form-reset",class:{"bg-gray-100 text-gray-700 border-gray-200":!t.isShown,"bg-white text-oDark border-gray-200":t.isShown},attrs:{"aria-label":"Filter menu","aria-haspopup":"true"},on:{click:t.onClickFilterMenu}},[i("i",{staticClass:"fas fa-filter text-oCharcoal"}),i("span",{staticClass:"font-semibold"},[t._v("Filters")]),i("span",{class:"filter-pills-count",style:"visibility: "+(t.computeFilterablesAppliedCount>0?"visible":"hidden")},[t._v(" "+t._s(t.computeFilterablesAppliedCount)+" ")])]),t._l(t.computeVisiblePills,(function(e){return i("TDropdown",{key:e.key,attrs:{variant:"filterPill"},scopedSlots:t._u([{key:"trigger",fn:function(r){var n=r.mousedownHandler,o=r.focusHandler,a=r.blurHandler,s=r.keydownHandler,l=r.isShown;return[i("button",{staticClass:"filter-base-dropdown-button app-form-reset",class:{"bg-gray-100 text-gray-700 border-gray-200":!l,"bg-white text-oDark border-gray-200 shadow-md":l,"filter-is-applied":e.isApplied},attrs:{"aria-label":"Filter menu","aria-haspopup":"true"},on:{mousedown:n,focus:o,blur:a,keydown:s}},[i("span",{staticClass:"text-sm font-bold"},[t._v(t._s(e.title))]),i("i",{staticClass:"fas fa-chevron-down"})])]}},{key:"default",fn:function(r){var n=r.hide,o=r.blurHandler;return[i("div",{staticClass:"px-6 py-4 border-b"},[i("TCheckbox",{class:"ml-1",attrs:{model:t.definedFilters()[e.key].all,label:"All",name:"Vehicle Status",variant:"liveMapTitle",wrapped:""},on:{click:function(i){return t.onFilterGroupSelectAllToggle({group:e.key})}}}),i("div",{staticClass:"h-1"}),i("div",{staticClass:"overflow-auto max-h-60 SB-FarhanShares"},t._l(t.definedFilters()[e.key].models,(function(r,n){return i("div",{key:e.key+n,class:"filter-item"},[i("TCheckbox",{attrs:{model:r,label:e.labels[n],name:e.labels[n],variant:"liveMap",wrapped:""},on:{change:function(i){return t.onFilterChange(e.key,n,i)}}}),i("div",{staticClass:"filter-item-count"},[t._v(" "+t._s(t.getFilterCounts[e.key]&&t.getFilterCounts[e.key][n]&&t.getFilterCounts[e.key][n].count?t.getFilterCounts[e.key][n].count:"0")+" ")])],1)})),0)],1),i("div",{staticClass:"flex justify-end gap-4 p-2 mt-4"},[i("AppButton",{attrs:{text:"Clear",variant:"secondary",height:"32px"},on:{click:function(i){n(),t.onFilterGroupClear({group:e.key})},blur:o}}),i("AppButton",{attrs:{text:"Show "+t.getFilterGroupCounts[e.key].count+" "+("filterFleet"==e.key?"trips":"locations"),variant:"green",height:"32px",disabled:t.shouldBeDisabled({group:e.key})},on:{click:function(i){n(),t.onFilterGroupApply({group:e.key})},blur:o}})],1)]}}],null,!0)})})),t.computeConcealedPillsCount>0?i("TDropdown",{staticClass:"hidden sm:block",attrs:{variant:"filterPill"},scopedSlots:t._u([{key:"trigger",fn:function(e){var r=e.mousedownHandler,n=e.focusHandler,o=e.blurHandler,a=e.keydownHandler,s=e.isShown;return[i("button",{staticClass:"\n            flex\n            items-center\n            justify-center\n            px-1\n            py-1\n            text-sm text-black\n            border border-gray-200\n            rounded-full\n            cursor-pointer\n            app-form-reset\n            hover:bg-white\n          ",class:{"bg-gray-100 text-gray-700 border-gray-200":!s,"bg-white text-oDark border-gray-200 shadow-md":s},staticStyle:{height:"35px",width:"35px"},attrs:{"aria-label":"Filter pill menu","aria-haspopup":"true"},on:{mousedown:r,focus:n,blur:o,keydown:a}},[t._v(" "+t._s(t.computeConcealedPillsCount)+"+ ")])]}}],null,!1,4106913022)},[i("div",{staticClass:"flex flex-col gap-2 px-2 py-2"},t._l(t.computeConcealedPills,(function(e){return i("TDropdown",{key:e.key,attrs:{variant:"filterPill"},scopedSlots:t._u([{key:"trigger",fn:function(r){var n=r.mousedownHandler,o=r.focusHandler,a=r.blurHandler,s=r.keydownHandler,l=r.isShown;return[i("button",{staticClass:"filter-base-dropdown-button app-form-reset",class:{"bg-gray-100 text-gray-700 border-gray-200":!l,"bg-white text-oDark border-gray-200 shadow-md":l,"filter-is-applied":e.isApplied},attrs:{"aria-label":"Filter menu","aria-haspopup":"true"},on:{mousedown:n,focus:o,blur:a,keydown:s}},[i("span",{staticClass:"text-sm font-bold"},[t._v(t._s(e.title))]),i("i",{staticClass:"fas fa-chevron-down"})])]}},{key:"default",fn:function(r){var n=r.hide,o=r.blurHandler;return[i("div",{staticClass:"px-6 py-4 border-b"},[i("TCheckbox",{class:"ml-1",attrs:{model:t.definedFilters()[e.key].all,label:"All",name:"Vehicle Status",variant:"liveMapTitle",wrapped:""},on:{click:function(i){return t.onFilterGroupSelectAllToggle({group:e.key})}}}),i("div",{staticClass:"h-1"}),i("div",{staticClass:"overflow-auto max-h-60 SB-FarhanShares"},t._l(t.definedFilters()[e.key].models,(function(r,n){return i("div",{key:e.key+n,class:"filter-item"},[i("TCheckbox",{attrs:{model:r,label:e.labels[n],name:e.labels[n],variant:"liveMap",wrapped:""},on:{change:function(i){return t.$store.commit("liveMap/onFilterChange",{group:e.key,key:n,value:i})}}}),i("div",{staticClass:"filter-item-count"},[t._v(" "+t._s(t.getFilterCounts[e.key][n].count)+" ")])],1)})),0)],1),i("div",{staticClass:"flex justify-end gap-4 p-2 mt-4"},[i("AppButton",{attrs:{text:"Clear",variant:"secondary",height:"32px"},on:{click:function(i){n(),t.onFilterGroupClear({group:e.key})},blur:o}}),i("AppButton",{attrs:{text:"Show "+t.getFilterGroupCounts[e.key].count+" trips",variant:"green",height:"32px",disabled:t.shouldBeDisabled({group:e.key})},on:{click:function(i){n(),t.onFilterGroupApply({group:e.key})},blur:o}})],1)]}}],null,!0)})})),1)]):t._e()],2),i("DashboardDatePicker",{ref:"heatmap_date_picker",staticClass:"prediction",on:{"apply-date":function(e){return t.onChangeDate(e,"maps")},"cancel-date":function(e){return t.handleCancelDate(e,"maps")}}})],1)},d=[],f=(i("b64b"),i("b0c0"),i("07ac"),i("4f5b")),m={name:"LiveMapFilterPills",props:{count:{type:Object,required:!0},fleetData:{type:Array,required:!0}},components:{DashboardDatePicker:f["a"]},data:function(){return{isShown:!1,fleetCounts:{},windowWidth:window.innerWidth,filterContainerWidth:0,isRealtime:!1,filterFleet:{key:"filterFleet",title:"Fleet",isApplied:!1,lastAppliedAt:null,all:!1,models:{},labels:{}},filterLocationPoint:{key:"filterLocationPoint",title:"Location Point",isApplied:!1,lastAppliedAt:null,all:!1,models:{pickup_points:!1,dropoff_points:!1},labels:{pickup_points:"Pick up Points",dropoff_points:"Drop off Points"}},filter_date_range:{start:null,end:null},reqInit:!1,reqBusy:!1,filteredFleetCount:0}},computed:{getFilterFleetSelected:function(){var t=[];for(var e in this.filterFleet.models)!0===this.filterFleet.models[e]&&t.push(e);return t},getFilterSlotMaxWidth:function(){var t=20,e=20;this.windowWidth<=930?(t=50,e=50):(t=140,e=170);var i=this.filterContainerWidth-e-t;return i>0?i:0},computeVisiblePillsMaxCount:function(){var t=this.getFilterSlotMaxWidth-45,e=125;return Math.floor(t/e)},computeVisiblePills:function(){var t=1,e={};for(var i in this.definedFilters()){if(t>this.computeVisiblePillsMaxCount)break;e[i]=this.definedFilters()[i],t++}return e},computeConcealedPills:function(){var t=1,e={};for(var i in this.definedFilters())t<=this.computeVisiblePillsMaxCount?t++:e[i]=this.definedFilters()[i];return e},computeConcealedPillsCount:function(){return Object.keys(this.computeConcealedPills).length},computeFilterablesAppliedCount:function(){var t=0;return this.filterFleet.isApplied&&(t+=1),this.filterLocationPoint.isApplied&&(t+=1),t},getFilterCounts:function(){var t={};for(var e in this.count.fleets)console.log("fleet count key ",e),t[e]={count:this.count.fleets[e]};var i={filterFleet:t,filterLocationPoint:{pickup_points:{count:this.count.pick_up},dropoff_points:{count:this.count.drop_off}}};return i},getFilterLocationPointCount:function(){var t=this.filterLocationPoint.models,e=t.pickup_points,i=t.dropoff_points;return e&&i?this.count.pick_up+this.count.drop_off:e?this.count.pick_up:i?this.count.drop_off:0},getFilterGroupCounts:function(){return{filterFleet:{count:this.filteredFleetCount},filterLocationPoint:{count:this.getFilterLocationPointCount}}}},watch:{fleetData:{deep:!0,handler:function(t){var e=this;console.log("FLEETS LOADED",this.fleetData.length,t.length),this.fleetData.forEach((function(t){e.filterFleet.labels[t.id]=t.name,e.filterFleet.models[t.id]=!1})),console.log("FLEET MDL",this.filterFleet.models,this.filterFleet.labels)}}},created:function(){window.removeEventListener("resize",this.getFilterContainerWidth),window.addEventListener("resize",this.getFilterContainerWidth),this.getFilterContainerWidth()},mounted:function(){var t=this;this.$refs.heatmap_date_picker.setEasyDatePickRange("last-28days"),this.filter_date_range.start=this.$refs.heatmap_date_picker.selectedRange.start,this.filter_date_range.end=this.$refs.heatmap_date_picker.selectedRange.end,this.$nextTick((function(){window.addEventListener("resize",t.onResize)}))},beforeDestroy:function(){window.removeEventListener("resize",this.onResize)},methods:{onResize:function(){this.windowWidth=window.innerWidth},definedFilters:function(){var t=this.filterFleet,e=this.filterLocationPoint;return{filterFleet:t,filterLocationPoint:e}},onChangeDate:function(t,e){var i=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:console.log({event:t,type:e}),i.filter_date_range=t,i.$emit("filterHeatmapData",{});case 3:case"end":return r.stop()}}),r)})))()},handleCancelDate:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:console.log({event:t,type:e});case 1:case"end":return i.stop()}}),i)})))()},onClickFilterMenu:function(){this.isShown=!this.isShown},onFilterChange:function(t,e,i){console.log("".concat(t," ").concat(e," ").concat(i)),"filterLocationPoint"==t?this.filterLocationPoint.models[e]=i:"filterFleet"==t&&(this.filterFleet.models[e]=i),0==i?("filterLocationPoint"==t?(this.filterLocationPoint.all=!1,this.filterLocationPoint.models.pickup_points||this.filterLocationPoint.models.dropoff_points||(this.filterLocationPoint.isApplied=!1)):"filterFleet"==t&&(this.filterFleet.all=!1,Object.values(this.filterFleet.models).every((function(t){return!1===t}))&&(this.filterFleet.isApplied=!1)),this.$emit("filterHeatmapData",{})):"filterLocationPoint"==t?this.filterLocationPoint.models.pickup_points&&this.filterLocationPoint.models.dropoff_points&&(this.filterLocationPoint.all=!0):"filterFleet"==t&&Object.values(this.filterFleet.models).every((function(t){return!0===t}))&&(this.filterFleet.all=!1),"filterFleet"==t&&this.updateFilteredFleetCount()},onFilterGroupApply:function(t){var e=t.group;console.log("Group applied "+e),"filterLocationPoint"==e&&(this.filterLocationPoint.isApplied=!0),"filterFleet"==e&&(this.filterFleet.isApplied=!0),this.$emit("filterHeatmapData",{})},onFilterGroupClear:function(t){var e=t.group;if("filterLocationPoint"==e)this.filterLocationPoint.all=!1,this.filterLocationPoint.models.pickup_points=!1,this.filterLocationPoint.models.dropoff_points=!1,this.filterLocationPoint.isApplied=!1;else if("filterFleet"==e){for(var i in this.filterFleet.all=!1,this.filterFleet.models)this.filterFleet.models[i]=!1;this.filterFleet.isApplied=!1,this.updateFilteredFleetCount()}this.$emit("filterHeatmapData",{})},onFilterGroupSelectAllToggle:function(t){var e=t.group;if(console.log("selectAll"),"filterLocationPoint"==e)this.filterLocationPoint.all=!this.filterLocationPoint.all,this.filterLocationPoint.all?(this.filterLocationPoint.models.pickup_points=!0,this.filterLocationPoint.models.dropoff_points=!0,this.filterLocationPoint.isApplied=!0):(this.filterLocationPoint.models.pickup_points=!1,this.filterLocationPoint.models.dropoff_points=!1,this.filterLocationPoint.isApplied=!1,this.$emit("filterHeatmapData",{}));else if("filterFleet"==e){if(this.filterFleet.all=!this.filterFleet.all,this.filterFleet.all){for(var i in this.filterFleet.models)this.filterFleet.models[i]=!0;this.filterFleet.isApplied=!0}else{for(var r in this.filterFleet.models)this.filterFleet.models[r]=!1;this.filterFleet.isApplied=!1,this.$emit("filterHeatmapData",{})}this.updateFilteredFleetCount()}},updateFilteredFleetCount:function(){var t=0;for(var e in this.filterFleet.models)!0===this.filterFleet.models[e]&&(t+=this.count.fleets[e]);this.filteredFleetCount=t},shouldBeDisabled:function(t){var e,i=t.group,r=(null===(e=this.getFilterGroupCounts[i])||void 0===e?void 0:e.count)||0;return console.log({shouldBeDisabled:r}),!(r>0)},getFilterContainerWidth:function(){var t=this;this.$nextTick((function(){var e,i;t.filterContainerWidth=(null===(e=t.$refs)||void 0===e||null===(i=e.filterContainerRef)||void 0===i?void 0:i.clientWidth)||0,console.log({tlsw:t.filterContainerWidth})}))}}},g=m,y=(i("8500"),i("01a4"),i("a904"),i("2877")),v=Object(y["a"])(g,p,d,!1,null,"e0803328",null),_=v.exports,b=i("f625"),x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("VueDeckgl",{attrs:{width:"100%",height:"100%",layers:t.layers,viewState:t.viewState},on:{click:t.handleClick,"view-state-change":t.updateViewState}},[i("div",{ref:"map",attrs:{id:"map"}}),t.isDataLoaded?t._e():i("div",{staticClass:"absolute  "},[i("div",{staticClass:"relative  "},[i("loading",{class:"outline-none",attrs:{active:!t.isDataLoaded,height:25,opacity:0,color:"#fff",loader:"dots","is-full-page":!0}})],1)]),t.isDataLoaded?i("div",[i("div",{staticClass:"layer-controls"},[i("div",{staticClass:"flex justify-end"},[t.toggleBarForControl?t._e():i("i",{staticClass:"fas fa-sliders cursor-pointer",on:{click:function(e){t.toggleBarForControl=!t.toggleBarForControl}}}),t.toggleBarForControl?i("i",{staticClass:"fas fa-minus cursor-pointer",on:{click:function(e){t.toggleBarForControl=!t.toggleBarForControl}}}):t._e()]),t.toggleBarForControl?i("div",{staticClass:"grid grid-cols-2 text-sm"},[i("div",{staticClass:"map-style-controls"},[i("p",{staticClass:"font-bold mb-1"},[t._v("Style")]),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedMapStyle,expression:"selectedMapStyle"}],attrs:{type:"radio",value:"light-v11",name:"mapstyle"},domProps:{checked:t._q(t.selectedMapStyle,"light-v11")},on:{change:function(e){t.selectedMapStyle="light-v11"}}}),t._v(" Light ")]),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedMapStyle,expression:"selectedMapStyle"}],attrs:{type:"radio",value:"dark-v11",name:"mapstyle"},domProps:{checked:t._q(t.selectedMapStyle,"dark-v11")},on:{change:function(e){t.selectedMapStyle="dark-v11"}}}),t._v(" Dark ")]),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedMapStyle,expression:"selectedMapStyle"}],attrs:{type:"radio",value:"satellite-v9",name:"mapstyle"},domProps:{checked:t._q(t.selectedMapStyle,"satellite-v9")},on:{change:function(e){t.selectedMapStyle="satellite-v9"}}}),t._v(" Satellite ")])]),i("div",{staticClass:"map-style-controls"},[i("p",{staticClass:"font-bold mb-1"},[t._v("Layer")]),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.showHexagonLayer,expression:"showHexagonLayer"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.showHexagonLayer)?t._i(t.showHexagonLayer,null)>-1:t.showHexagonLayer},on:{change:function(e){var i=t.showHexagonLayer,r=e.target,n=!!r.checked;if(Array.isArray(i)){var o=null,a=t._i(i,o);r.checked?a<0&&(t.showHexagonLayer=i.concat([o])):a>-1&&(t.showHexagonLayer=i.slice(0,a).concat(i.slice(a+1)))}else t.showHexagonLayer=n}}}),t._v(" Hexagon ")]),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.showHeatmapLayer,expression:"showHeatmapLayer"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.showHeatmapLayer)?t._i(t.showHeatmapLayer,null)>-1:t.showHeatmapLayer},on:{change:function(e){var i=t.showHeatmapLayer,r=e.target,n=!!r.checked;if(Array.isArray(i)){var o=null,a=t._i(i,o);r.checked?a<0&&(t.showHeatmapLayer=i.concat([o])):a>-1&&(t.showHeatmapLayer=i.slice(0,a).concat(i.slice(a+1)))}else t.showHeatmapLayer=n}}}),t._v(" Heatmap ")])]),i("div",{staticClass:"grid col-span-12"},[i("p",{staticClass:"font-bold mb-1"},[t._v("Intensity")]),i("ColorIntensityBox")],1)]):t._e()]),i("div",{staticClass:"place-search"},[i("div",{staticClass:"relative  "},[i("div",{staticClass:"flex justify-end"},[t.toggleBarForPlaceSearch?t._e():i("i",{staticClass:"fas fa-magnifying-glass cursor-pointer",on:{click:function(e){t.toggleBarForPlaceSearch=!t.toggleBarForPlaceSearch}}}),t.toggleBarForPlaceSearch?i("i",{staticClass:"fas fa-minus cursor-pointer",on:{click:function(e){t.toggleBarForPlaceSearch=!t.toggleBarForPlaceSearch}}}):t._e()]),t.toggleBarForPlaceSearch?i("div",{staticClass:"text-sm w-72 pb-5"},[i("PlacesAutocomplete",{attrs:{label:"Search location",placeholder:"Enter your place name"},on:{"update:place":t.onUpdatingPlace,"clear:place":function(){return t.place=null}}})],1):t._e()])]),i("div",{staticClass:"reset-location flex items-center"},[i("i",{staticClass:"fas fa-location-crosshairs cursor-pointer text-lg",on:{click:t.setCenterInDefaultGeoFence}})]),i("div",{staticClass:"info mt-1"},[i("div",{staticClass:"flex justify-end"},[t.toggleBarForInfo?t._e():i("i",{staticClass:"fas fa-circle-info cursor-pointer",on:{click:function(e){t.toggleBarForInfo=!t.toggleBarForInfo}}}),t.toggleBarForInfo?i("i",{staticClass:"fas fa-minus cursor-pointer",on:{click:function(e){t.toggleBarForInfo=!t.toggleBarForInfo}}}):t._e()]),t.toggleBarForInfo?i("div",{staticClass:"text-sm"},[i("p",{staticClass:"font-bold mb-1"},[t._v("Guideline")]),i("GuidelineBox")],1):t._e()])]):t._e()])},w=[],T=(i("0481"),i("25f0"),i("0ce1")),E=i("460f");function S(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch(e){return null}}class A{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(s["a"])(this,"storage",void 0),Object(s["a"])(this,"id",void 0),Object(s["a"])(this,"config",void 0),this.storage=S(i),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function C(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}function P(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const i=Math.max(e-t.length,0);return"".concat(" ".repeat(i)).concat(t)}function I(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const n=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(i=Math.min(i,r/t.width));const o=t.width*i,a=t.height*i,s=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(n,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let M;function k(t){return"string"===typeof t?M[t.toUpperCase()]||M.WHITE:t}function D(t,e,i){return T["a"]||"string"!==typeof t||(e&&(e=k(e),t="[".concat(e,"m").concat(t,"[39m")),i&&(e=k(i),t="[".concat(i+10,"m").concat(t,"[49m"))),t}function L(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const i=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(i);for(const n of r)"function"===typeof t[n]&&(e.find(t=>n===t)||(t[n]=t[n].bind(t)))}function O(t,e){if(!t)throw new Error(e||"Assertion failed")}(function(t){t[t["BLACK"]=30]="BLACK",t[t["RED"]=31]="RED",t[t["GREEN"]=32]="GREEN",t[t["YELLOW"]=33]="YELLOW",t[t["BLUE"]=34]="BLUE",t[t["MAGENTA"]=35]="MAGENTA",t[t["CYAN"]=36]="CYAN",t[t["WHITE"]=37]="WHITE",t[t["BRIGHT_BLACK"]=90]="BRIGHT_BLACK",t[t["BRIGHT_RED"]=91]="BRIGHT_RED",t[t["BRIGHT_GREEN"]=92]="BRIGHT_GREEN",t[t["BRIGHT_YELLOW"]=93]="BRIGHT_YELLOW",t[t["BRIGHT_BLUE"]=94]="BRIGHT_BLUE",t[t["BRIGHT_MAGENTA"]=95]="BRIGHT_MAGENTA",t[t["BRIGHT_CYAN"]=96]="BRIGHT_CYAN",t[t["BRIGHT_WHITE"]=97]="BRIGHT_WHITE"})(M||(M={}));var R=i("74be");function z(){let t;var e,i;if(T["a"]&&"performance"in R["f"])t=null===R["f"]||void 0===R["f"]||null===(e=R["f"].performance)||void 0===e||null===(i=e.now)||void 0===i?void 0:i.call(e);else if("hrtime"in R["d"]){var r;const e=null===R["d"]||void 0===R["d"]||null===(r=R["d"].hrtime)||void 0===r?void 0:r.call(R["d"]);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}const F={debug:T["a"]&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},B={enabled:!0,level:0};function N(){}const j={},U={once:!0};class V{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};Object(s["a"])(this,"id",void 0),Object(s["a"])(this,"VERSION",E["a"]),Object(s["a"])(this,"_startTs",z()),Object(s["a"])(this,"_deltaTs",z()),Object(s["a"])(this,"_storage",void 0),Object(s["a"])(this,"userData",{}),Object(s["a"])(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new A("__probe-".concat(this.id,"__"),B),this.timeStamp("".concat(this.id," started")),L(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((z()-this._startTs).toPrecision(10))}getDelta(){return Number((z()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){O(t,e)}warn(t){return this._getLogFunction(0,t,F.warn,arguments,U)}error(t){return this._getLogFunction(0,t,F.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,F.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,F.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return this._getLogFunction(t,e,F.debug||F.info,arguments,U)}table(t,e,i){return e?this._getLogFunction(t,e,console.table||N,i&&[i],{tag:X(e)}):N}image(t){let{logLevel:e,priority:i,image:r,message:n="",scale:o=1}=t;return this._shouldLog(e||i)?T["a"]?Z({image:r,message:n,scale:o}):H({image:r,message:n,scale:o}):N}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||N)}group(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const r=q({logLevel:t,message:e,opts:i}),{collapsed:n}=i;return r.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||N)}withGroup(t,e,i){this.group(t,e)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=G(t)}_getLogFunction(t,e,i,r,n){if(this._shouldLog(t)){n=q({logLevel:t,message:e,args:r,opts:n}),i=i||n.method,O(i),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=z();const o=n.tag||n.message;if(n.once){if(j[o])return N;j[o]=z()}return e=W(this.id,n.message,n),i.bind(console,e,...n.args)}return N}}function G(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return O(Number.isFinite(e)&&e>=0),e}function q(t){const{logLevel:e,message:i}=t;t.logLevel=G(e);const r=t.args?Array.from(t.args):[];while(r.length&&r.shift()!==i);switch(typeof e){case"string":case"function":void 0!==i&&r.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break;default:}"function"===typeof t.message&&(t.message=t.message());const n=typeof t.message;return O("string"===n||"object"===n),Object.assign(t,{args:r},t.opts)}function W(t,e,i){if("string"===typeof e){const r=i.time?P(C(i.total)):"";e=i.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=D(e,i.color,i.background)}return e}function H(t){let{image:e,message:i="",scale:r=1}=t;return console.warn("removed"),N}function Z(t){let{image:e,message:i="",scale:r=1}=t;if("string"===typeof e){const t=new Image;return t.onload=()=>{const e=I(t,i,r);console.log(...e)},t.src=e,N}const n=e.nodeName||"";if("img"===n.toLowerCase())return console.log(...I(e,i,r)),N;if("canvas"===n.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...I(t,i,r)),t.src=e.toDataURL(),N}return N}function X(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}Object(s["a"])(V,"VERSION",E["a"]);var Y=new V({id:"deck"});const K={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(K,"IDENTITY",{get:()=>Y.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0});const J={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Q={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},$=new V({id:"luma.gl"});function tt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const et="Invalid WebGLRenderingContext",it="Requires WebGL2";function rt(t){return"undefined"!==typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||("undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&Number.isFinite(t._version)))}function nt(t){return"undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function ot(t){return nt(t)?t:null}function at(t){return tt(rt(t),et),t}function st(t){return tt(nt(t),it),t}const lt={};function ut(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function ct(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function ht(t,e){lt[t]=!0,void 0!==e&&ut(e)}function pt(t){const e=t.getError;t.getError=function(){let i;do{i=e.apply(t),0!==i&&(lt[i]=!0)}while(0!==i);for(i in lt)if(lt[i])return delete lt[i],parseInt(i,10);return 0}}const dt=function t(e){const i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const e=new t.VertexAttrib(i);this.attribs[r]=e}this.maxAttrib=0};dt.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},dt.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const ft=function(t){const e=this;this.gl=t,pt(t);const i=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(t){return t===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:i.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(t){const r=e.currentVertexArrayObject;r.maxAttrib=Math.max(r.maxAttrib,t);const n=r.attribs[t];return n.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(t){const r=e.currentVertexArrayObject;r.maxAttrib=Math.max(r.maxAttrib,t);const n=r.attribs[t];return n.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(t,r){switch(t){case 34962:e.currentArrayBuffer=r;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=r;break;default:}return i.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(t,r){const n=e.currentVertexArrayObject,o=n.attribs[t];switch(r){case 34975:return o.buffer;case 34338:return o.enabled;case 34339:return o.size;case 34340:return o.stride;case 34341:return o.type;case 34922:return o.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(t,r,n,o,a,s){const l=e.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,t);const u=l.attribs[t];return u.buffer=e.currentArrayBuffer,u.size=r,u.type=n,u.normalized=o,u.stride=a,u.offset=s,u.recache(),i.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{ct("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};function mt(t){if("function"===typeof t.createVertexArray)return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};const i=t.getExtension;t.getExtension=function(e){const r=i.call(this,e);return r||("OES_vertex_array_object"!==e?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new ft(this)),this.__OESVertexArrayObject))}}ft.prototype.VERTEX_ARRAY_BINDING_OES=34229,ft.prototype.reset_=function(){const t=void 0!==this.vertexArrayObjects;if(t)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new dt(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},ft.prototype.createVertexArrayOES=function(){const t=new dt(this);return this.vertexArrayObjects.push(t),t},ft.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},ft.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof dt&&t.hasBeenBound&&t.ext===this)},ft.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive)return void ht(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const n=this.currentVertexArrayObject;if(r===n)return;r&&n.elementArrayBuffer===r.elementArrayBuffer||i.bindBuffer.call(e,34963,n.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,n.maxAttrib);for(let s=0;s<=a;s++){const t=n.attribs[s],a=r?r.attribs[s]:null;if(r&&t.enabled===a.enabled||(t.enabled?i.enableVertexAttribArray.call(e,s):i.disableVertexAttribArray.call(e,s)),t.enabled){let n=!1;r&&t.buffer===a.buffer||(o!==t.buffer&&(i.bindBuffer.call(e,34962,t.buffer),o=t.buffer),n=!0),(n||t.cached!==a.cached)&&i.vertexAttribPointer.call(e,s,t.size,t.type,t.normalized,t.stride,t.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(e,34962,this.currentArrayBuffer)};const gt="OES_element_index",yt="WEBGL_draw_buffers",vt="EXT_disjoint_timer_query",_t="EXT_disjoint_timer_query_webgl2",bt="EXT_texture_filter_anisotropic",xt="WEBGL_debug_renderer_info",wt=35723,Tt=4352,Et=36795,St=34047,At=37445,Ct=37446,Pt=t=>nt(t)?void 0:0,It={[3074]:t=>nt(t)?void 0:36064,[wt]:t=>nt(t)?void 0:Tt,[35977]:Pt,[32937]:Pt,[Et]:(t,e)=>{const i=nt(t)?t.getExtension(_t):t.getExtension(vt);return i&&i.GPU_DISJOINT_EXT?e(i.GPU_DISJOINT_EXT):0},[At]:(t,e)=>{const i=t.getExtension(xt);return e(i&&i.UNMASKED_VENDOR_WEBGL||7936)},[Ct]:(t,e)=>{const i=t.getExtension(xt);return e(i&&i.UNMASKED_RENDERER_WEBGL||7937)},[St]:(t,e)=>{const i=t.luma.extensions[bt];return i?e(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:Pt,[35071]:Pt,[37447]:Pt,[36063]:(t,e)=>{if(!nt(t)){const i=t.getExtension(yt);return i?e(i.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:Pt,[35374]:Pt,[35377]:Pt,[34852]:t=>{if(!nt(t)){const e=t.getExtension(yt);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(gt)?2147483647:65535,[33001]:t=>t.getExtension(gt)?16777216:65535,[33e3]:t=>16777216,[37157]:Pt,[35373]:Pt,[35657]:Pt,[36183]:Pt,[37137]:Pt,[34045]:Pt,[35978]:Pt,[35979]:Pt,[35968]:Pt,[35376]:Pt,[35375]:Pt,[35659]:Pt,[37154]:Pt,[35371]:Pt,[35658]:Pt,[35076]:Pt,[35077]:Pt,[35380]:Pt};function Mt(t,e,i){const r=It[i],n="function"===typeof r?r(t,e,i):r,o=void 0!==n?n:e(i);return o}const kt="OES_vertex_array_object",Dt="ANGLE_instanced_arrays",Lt="WEBGL_draw_buffers",Ot="EXT_disjoint_timer_query",Rt="EXT_texture_filter_anisotropic",zt="VertexArray requires WebGL2 or OES_vertex_array_object extension";function Ft(t,e){return{webgl2:nt(t),ext:t.getExtension(e)}}const Bt={[kt]:{meta:{suffix:"OES"},createVertexArray:()=>{tt(!1,zt)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Dt]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){tt(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[Lt]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{tt(!1)}},[Ot]:{meta:{suffix:"EXT"},createQuery:()=>{tt(!1)},deleteQuery:()=>{tt(!1)},beginQuery:()=>{tt(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Nt={readBuffer:(t,e,i)=>{nt(t)&&e(i)},getVertexAttrib:(t,e,i,r)=>{const{webgl2:n,ext:o}=Ft(t,Dt);let a;switch(r){case 35069:a=!!n&&void 0;break;case 35070:a=n||o?void 0:0;break;default:}return void 0!==a?a:e(i,r)},getProgramParameter:(t,e,i,r)=>{if(!nt(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0;default:}return e(i,r)},getInternalformatParameter:(t,e,i,r,n)=>{if(!nt(t))switch(n){case 32937:return new Int32Array([0]);default:}return t.getInternalformatParameter(i,r,n)},getTexParameter(t,e,i,r){switch(r){case 34046:const{extensions:e}=t.luma,i=e[Rt];r=i&&i.TEXTURE_MAX_ANISOTROPY_EXT||34046;break;default:}return e(i,r)},getParameter:Mt,hint(t,e,i,r){return e(i,r)}};function jt(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(mt(t),Ut(t),Gt(t,Bt),Vt(t,{target:e,target2:t}),e.polyfilled=!0),t}function Ut(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const i of e)t.luma[i]=t.getExtension(i)}function Vt(t,e){let{target:i,target2:r}=e;Object.keys(Nt).forEach(e=>{if("function"===typeof Nt[e]){const n=t[e]?t[e].bind(t):()=>{},o=Nt[e].bind(null,t,n);i[e]=o,r[e]=o}})}function Gt(t,e){for(const i of Object.getOwnPropertyNames(e))"overrides"!==i&&qt(t,{extension:i,target:t.luma,target2:t})}function qt(t,e){let{extension:i,target:r,target2:n}=e;const o=Bt[i];tt(o);const{meta:a={}}=o,{suffix:s=""}=a,l=t.getExtension(i);for(const u of Object.keys(o)){const e="".concat(u).concat(s);let i=null;"meta"===u||"function"===typeof t[u]||(l&&"function"===typeof l[e]?i=function(){return l[e](...arguments)}:"function"===typeof o[u]&&(i=o[u].bind(r))),i&&(r[u]=i,n[u]=i)}}globalThis.polyfillContext=jt;const Wt={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Ht=(t,e,i)=>e?t.enable(i):t.disable(i),Zt=(t,e,i)=>t.hint(i,e),Xt=(t,e,i)=>t.pixelStorei(i,e),Yt=(t,e)=>{const i=nt(t)?36009:36160;return t.bindFramebuffer(i,e)},Kt=(t,e)=>t.bindFramebuffer(36008,e);function Jt(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Qt={[3042]:Ht,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Ht,[2885]:(t,e)=>t.cullFace(e),[2929]:Ht,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Ht,[35723]:Zt,[36006]:Yt,[2886]:(t,e)=>t.frontFace(e),[33170]:Zt,[2849]:(t,e)=>t.lineWidth(e),[32823]:Ht,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Ht,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Ht,[3088]:(t,e)=>t.scissor(...e),[2960]:Ht,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Xt,[3317]:Xt,[37440]:Xt,[37441]:Xt,[37443]:Xt,[3330]:Xt,[3332]:Xt,[3331]:Xt,[36010]:Kt,[3314]:Xt,[32878]:Xt,[3316]:Xt,[3315]:Xt,[32877]:Xt,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Jt(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Jt(e)&&2===e.length?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Jt(e)?e:[e,e];const[i,r]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Jt(e)&&3===e.length?[...e,...e]:e;const[i,r,n,o,a,s]=e;t.stencilFuncSeparate(1028,i,r,n),t.stencilFuncSeparate(1029,o,a,s)},stencilOp:(t,e)=>{e=Jt(e)&&3===e.length?[...e,...e]:e;const[i,r,n,o,a,s]=e;t.stencilOpSeparate(1028,i,r,n),t.stencilOpSeparate(1029,o,a,s)},viewport:(t,e)=>t.viewport(...e)};function $t(t,e,i){return void 0!==e[t]?e[t]:i[t]}const te={blendEquation:(t,e,i)=>t.blendEquationSeparate($t(32777,e,i),$t(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate($t(32969,e,i),$t(32968,e,i),$t(32971,e,i),$t(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset($t(32824,e,i),$t(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage($t(32938,e,i),$t(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,$t(2962,e,i),$t(2967,e,i),$t(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,$t(34816,e,i),$t(36003,e,i),$t(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,$t(2964,e,i),$t(2965,e,i),$t(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,$t(34817,e,i),$t(34818,e,i),$t(34819,e,i))},ee={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({[36006]:i,[36010]:i});case 36009:return t({[36006]:i});case 36008:return t({[36010]:i});default:return null}},blendColor:(t,e,i,r,n)=>t({[32773]:new Float32Array([e,i,r,n])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,i)=>t({[32777]:e,[34877]:i}),blendFunc:(t,e,i)=>t({[32969]:e,[32968]:i,[32971]:e,[32970]:i}),blendFuncSeparate:(t,e,i,r,n)=>t({[32969]:e,[32968]:i,[32971]:r,[32970]:n}),clearColor:(t,e,i,r,n)=>t({[3106]:new Float32Array([e,i,r,n])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,i,r,n)=>t({[3107]:[e,i,r,n]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,i)=>t({[2928]:new Float32Array([e,i])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,i)=>t({[32824]:e,[10752]:i}),sampleCoverage:(t,e,i)=>t({[32938]:e,[32939]:i}),scissor:(t,e,i,r,n)=>t({[3088]:new Int32Array([e,i,r,n])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,i)=>t({[1028===e?2968:36005]:i}),stencilFunc:(t,e,i,r)=>t({[2962]:e,[2967]:i,[2963]:r,[34816]:e,[36003]:i,[36004]:r}),stencilFuncSeparate:(t,e,i,r,n)=>t({[1028===e?2962:34816]:i,[1028===e?2967:36003]:r,[1028===e?2963:36004]:n}),stencilOp:(t,e,i,r)=>t({[2964]:e,[2965]:i,[2966]:r,[34817]:e,[34818]:i,[34819]:r}),stencilOpSeparate:(t,e,i,r,n)=>t({[1028===e?2964:34817]:i,[1028===e?2965:34818]:r,[1028===e?2966:34819]:n}),viewport:(t,e,i,r,n)=>t({[2978]:[e,i,r,n]})},ie=(t,e)=>t.isEnabled(e),re={[3042]:ie,[2884]:ie,[2929]:ie,[3024]:ie,[32823]:ie,[32926]:ie,[32928]:ie,[3089]:ie,[2960]:ie,[35977]:ie};function ne(t){for(const e in t)return!1;return!0}function oe(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}function ae(t,e){const i=t[e].bind(t);t[e]=function(){const e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache&&t.state.enable?t.state.cache[e]:i(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function se(t,e,i){const r=t[e].bind(t);t[e]=function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];const{valueChanged:a,oldValue:s}=i(t.state._updateCache,...n);return a&&r(...n),s},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function le(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class ue{constructor(t){let{copyState:e=!1,log:i=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?fe(t):Object.assign({},Wt),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){tt(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];de(this.gl,t),this.stateStack.pop()}_updateCache(t){let e,i=!1;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const n in t){tt(void 0!==n);const o=t[n],a=this.cache[n];oe(o,a)||(i=!0,e=a,r&&!(n in r)&&(r[n]=a),this.cache[n]=o)}return{valueChanged:i,oldValue:e}}}function ce(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{enable:i=!0,copyState:r}=e;if(tt(void 0!==r),!t.state){const{polyfillContext:e}=globalThis;e&&e(t),t.state=new ue(t,{copyState:r}),le(t);for(const i in ee){const e=ee[i];se(t,i,e)}ae(t,"getParameter"),ae(t,"isEnabled")}return t.state.enable=i,t}function he(t){t.state||ce(t,{copyState:!1}),t.state.push()}function pe(t){tt(t.state),t.state.pop()}function de(t,e){if(tt(rt(t),"setParameters requires a WebGL context"),ne(e))return;const i={};for(const n in e){const r=Number(n),o=Qt[n];o&&("string"===typeof o?i[o]=!0:o(t,e[n],r))}const r=t.state&&t.state.cache;if(r)for(const n in i){const i=te[n];i(t,e,r)}}function fe(t,e){if(e=e||Wt,"number"===typeof e){const i=e,r=re[i];return r?r(t,i):t.getParameter(i)}const i=Array.isArray(e)?e:Object.keys(e),r={};for(const n of i){const e=re[n];r[n]=e?e(t,Number(n)):t.getParameter(Number(n))}return r}function me(t){de(t,Wt)}function ge(t,e,i){if(ne(e))return i(t);const{nocatch:r=!0}=e;let n;if(he(t),de(t,e),r)n=i(t),pe(t);else try{n=i(t)}finally{pe(t)}return n}function ye(t){const{luma:e}=t;if(t.canvas&&e){const i=e.canvasSizeInfo,r="clientWidth"in i?i.clientWidth:t.canvas.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function ve(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=ye(t),n=t.drawingBufferWidth,o=t.drawingBufferHeight;return be(e,r,n,o,i)}function _e(t){const e="undefined"===typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function be(t,e,i,r,n){const o=xe(t[0],e,i);let a=we(t[1],e,r,n),s=xe(t[0]+1,e,i);const l=s===i-1?s:s-1;let u;return s=we(t[1]+1,e,r,n),n?(s=0===s?s:s+1,u=a,a=s):u=s===r-1?s:s-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(u-a+1,1)}}function xe(t,e,i){const r=Math.min(Math.round(t*e),i-1);return r}function we(t,e,i,r){return r?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const Te=Object(T["a"])(),Ee=Te&&"undefined"!==typeof document,Se={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Ae(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};tt(Te,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),t=Object.assign({},Se,t);const{width:e,height:i}=t;function r(e){if(t.throwOnError)throw new Error(e);return console.error(e),null}let n;t.onError=r;const{canvas:o}=t,a=ke({canvas:o,width:e,height:i,onError:r});return n=Me(a,t),n?(n=Ce(n,t),De(n),n):null}function Ce(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||Le(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Se,e);const{manageState:i,debug:r}=e;return i&&ce(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return $.log(1,...e)()}}),Te&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),$.level=Math.max($.level,1)):$.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function Pe(t){const e=t.getParameter(7936),i=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),n=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||e,renderer:o||i,vendorMasked:e,rendererMasked:i,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function Ie(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas){const i=_e(e.useDevicePixels);return void Oe(t,i,e)}const i=t.getExtension("STACKGL_resize_drawingbuffer");i&&"width"in e&&"height"in e&&i.resize(e.width,e.height)}function Me(t,e){const{onError:i}=e;let r=null;const n=t=>r=t.statusMessage||r;t.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:o=!0,webgl2:a=!0}=e;let s=null;return a&&(s=s||t.getContext("webgl2",e),s=s||t.getContext("experimental-webgl2",e)),o&&(s=s||t.getContext("webgl",e),s=s||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",n,!1),s?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):i("Failed to create ".concat(a&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function ke(t){let e,{canvas:i,width:r=800,height:n=600,onError:o}=t;if("string"===typeof i){const t=Ee&&"complete"===document.readyState;t||o("createGLContext called on canvas '".concat(i,"' before page was loaded")),e=document.getElementById(i)}else i?e=i:(e=document.createElement("canvas"),e.id="lumagl-canvas",e.style.width=Number.isFinite(r)?"".concat(r,"px"):"100%",e.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",document.body.insertBefore(e,document.body.firstChild));return e}function De(t){const e=nt(t)?"WebGL2":"WebGL1",i=Pe(t),r=i?"(".concat(i.vendor,",").concat(i.renderer,")"):"",n=t.debug?" debug":"";$.info(1,"".concat(e).concat(n," context ").concat(r))()}function Le(t){return"undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?2:1}function Oe(t,e,i){let r="width"in i?i.width:t.canvas.clientWidth,n="height"in i?i.height:t.canvas.clientHeight;r&&n||($.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,n=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const o=t.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==n||o.devicePixelRatio!==e){let i=e;const o=Math.floor(r*i),a=Math.floor(n*i);t.canvas.width=o,t.canvas.height=a,t.drawingBufferWidth===o&&t.drawingBufferHeight===a||($.warn("Device pixel ratio clamped")(),i=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/n),t.canvas.width=Math.floor(r*i),t.canvas.height=Math.floor(n*i)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:n,devicePixelRatio:e})}}var Re=i("19ac");class ze{constructor(t,e){Object(s["a"])(this,"name",void 0),Object(s["a"])(this,"type",void 0),Object(s["a"])(this,"sampleSize",1),Object(s["a"])(this,"time",void 0),Object(s["a"])(this,"count",void 0),Object(s["a"])(this,"samples",void 0),Object(s["a"])(this,"lastTiming",void 0),Object(s["a"])(this,"lastSampleTime",void 0),Object(s["a"])(this,"lastSampleCount",void 0),Object(s["a"])(this,"_count",0),Object(s["a"])(this,"_time",0),Object(s["a"])(this,"_samples",0),Object(s["a"])(this,"_startTime",0),Object(s["a"])(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Object(Re["a"])(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Object(Re["a"])()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Fe{constructor(t){Object(s["a"])(this,"id",void 0),Object(s["a"])(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach(t=>this._getOrCreate(t))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:i}=t;return this.stats[e]||(this.stats[e]=t instanceof ze?t:new ze(e,i)),this.stats[e]}}const Be="8.5.21",Ne="set luma.log.level=1 (or higher) to trace rendering";class je{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new Fe({id:t})),this.stats.get(t)}}const Ue=new je;if(globalThis.luma&&globalThis.luma.VERSION!==Be)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Be));globalThis.luma||(Object(T["a"])()&&$.log(1,"luma.gl ".concat(Be," - ").concat(Ne))(),globalThis.luma=globalThis.luma||{VERSION:Be,version:Be,log:$,stats:Ue,globals:{modules:{},nodeIO:{}}});globalThis.luma;function Ve(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Ge(t,e){if("string"!==typeof e)return e;const i=Number(e);if(!isNaN(i))return i;e=e.replace(/^.*\./,"");const r=t[e];return Ve(void 0!==r,"Accessing undefined constant GL.".concat(e)),r}function qe(t,e){e=Number(e);for(const i in t)if(t[i]===e)return"GL.".concat(i);return String(e)}const We={};function He(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";We[t]=We[t]||1;const e=We[t]++;return"".concat(t,"-").concat(e)}function Ze(t){return Ve("number"===typeof t,"Input must be a number"),t&&0===(t&t-1)}function Xe(t){let e=!0;for(const i in t){e=!1;break}return e}function Ye(t,e,i,r){const n="See luma.gl ".concat(i," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(t);r.forEach(t=>{o.methodName||(o[t]=()=>{throw $.removed("Calling removed method ".concat(e,".").concat(t,": "),n)(),new Error(t)})})}const Ke="Resource subclass must define virtual methods";class Je{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};at(t);const{id:i,userData:r={}}=e;this.gl=t,this.gl2=t,this.id=i||He(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=e.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(t=>t.delete()),this}bind(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!==typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Ge(this.gl,t),Ve(t);const i=this.constructor.PARAMETERS||{},r=i[t];if(r){const t=nt(this.gl),e=(!("webgl2"in r)||t)&&(!("extension"in r)||this.gl.getExtension(r.extension));if(!e){const e=r.webgl1,i="webgl2"in r?r.webgl2:r.webgl1,n=t?i:e;return n}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{parameters:e,keys:i}=t,r=this.constructor.PARAMETERS||{},n=nt(this.gl),o={},a=e||Object.keys(r);for(const s of a){const e=r[s],a=e&&(!("webgl2"in e)||n)&&(!("extension"in e)||this.gl.getExtension(e.extension));if(a){const r=i?qe(this.gl,s):s;o[r]=this.getParameter(s,t),i&&"GLenum"===e.type&&(o[r]=qe(this.gl,o[r]))}}return o}setParameter(t,e){t=Ge(this.gl,t),Ve(t);const i=this.constructor.PARAMETERS||{},r=i[t];if(r){const t=nt(this.gl),i=(!("webgl2"in r)||t)&&(!("extension"in r)||this.gl.getExtension(r.extension));if(!i)throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(e=Ge(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,i){return Ye(this,t,e,i)}initialize(t){}_createHandle(){throw new Error(Ke)}_deleteHandle(){throw new Error(Ke)}_bindHandle(t){throw new Error(Ke)}_getOptsFromHandle(){throw new Error(Ke)}_getParameter(t,e){throw new Error(Ke)}_setParameter(t,e){throw new Error(Ke)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=Ue.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag],e=Ue.get("Resource Counts");e.get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=Ue.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(t),r.get("".concat(e," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const i=Ue.get("Memory Usage".concat(e));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(t," Memory")).subtractCount(this.byteLength)}}const Qe="Failed to deduce GL constant from typed array";function $e(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Qe)}}function ti(t){let{clamped:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function ei(t){let{data:e,width:i,height:r,bytesPerPixel:n=4,temp:o}=t;const a=i*n;o=o||new Uint8Array(a);for(let s=0;s<r/2;++s){const t=s*a,i=(r-s-1)*a;o.set(e.subarray(t,t+a)),e.copyWithin(t,i,i+a),e.set(o,i)}}function ii(t){let{data:e,width:i,height:r}=t;const n=Math.round(i/2),o=Math.round(r/2),a=new Uint8Array(n*o*4);for(let s=0;s<o;s++)for(let t=0;t<n;t++)for(let r=0;r<4;r++)a[4*(s*n+t)+r]=e[4*(2*s*i+2*t)+r];return{data:a,width:n,height:o}}function ri(t,e,i){const{removedProps:r={},deprecatedProps:n={},replacedProps:o={}}=i;for(const s in r)if(s in e){const e=r[s],i=e?"".concat(t,".").concat(r[s]):"N/A";$.removed("".concat(t,".").concat(s),i)()}for(const s in n)if(s in e){const e=n[s];$.deprecated("".concat(t,".").concat(s),"".concat(t,".").concat(e))()}let a=null;for(const s in o)if(s in e){const i=o[s];$.deprecated("".concat(t,".").concat(s),"".concat(t,".").concat(i))(),a=a||Object.assign({},e),a[i]=e[s],delete a[s]}return a||e}const ni={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},oi={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ai{static getBytesPerElement(t){const e=ti(t.type||5126);return e.BYTES_PER_ELEMENT}static getBytesPerVertex(t){Ve(t.size);const e=ti(t.type||5126);return e.BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return new ai(...[ni,...e])}constructor(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(t=>this._assign(t)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ai.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ai.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=ri("Accessor",t,oi),void 0!==t.type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"===typeof t.index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}}const si=10,li={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},ui={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:li},ci={removedProps:li};class hi extends Je{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/ai.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/ai.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=ri("Buffer",t,ui),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return t=ri("Buffer",t,ci),"accessor"in t&&this.setAccessor(t.accessor),this}setAccessor(t){return t=Object.assign({},t),delete t.buffer,this.accessor=new ai(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:i=0,srcOffset:r=0}=t,n=t.byteLength||t.length;Ve(e);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),0!==r||void 0!==n?(st(this.gl),this.gl.bufferSubData(this.target,i,e,r,n)):this.gl.bufferSubData(o,i,e),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:i=0,writeOffset:r=0,size:n}=t;const{gl:o}=this;return st(o),o.bindBuffer(36662,e.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,n),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:i=0,length:r=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};st(this.gl);const n=ti(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(e),a=i;let s,l;t?(l=t.length,s=l-a):(s=Math.min(o,r||o),l=a+s);const u=Math.min(o,s);return r=r||u,Ve(r<=u),t=t||new n(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,i,r),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===t||35982===t?void 0!==r?this.gl.bindBufferRange(t,e,this.handle,i,r):(Ve(0===i),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=35345===t||35982===t;return i?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(si,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength+e;Ve(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,e,t),this.gl.bindBuffer(r,null),this.debugData=t.slice(0,si),this.bytesUsed=i,this._trackAllocatedMemory(i);const n=$e(t);return Ve(n),this.setAccessor(new ai(this.accessor,{type:n})),this}_setByteLength(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Ve(t>=0),this._trackDeallocatedMemory();let i=t;0===t&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,e),this.gl.bindBuffer(r,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=ti(this.accessor.type||5126,{clamped:!1}),i=t/e.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(t){this.accessor.type||this.setAccessor(new ai(this.accessor,{type:$e(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return $.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return $.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return $.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return $.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ai(this.accessor,t),this}}const pi={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},di={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},fi={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function mi(t,e){const i=pi[e];if(!i)return!1;if(void 0===i.gl1&&void 0===i.gl2)return!0;const r=nt(t)&&i.gl2||i.gl1;return"string"===typeof r?t.getExtension(r):r}function gi(t,e){const i=pi[e];switch(i&&i.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const yi=[9729,9728],vi=globalThis.WebGLBuffer||function(){};class _i extends Je{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{format:i,linearFiltering:r}=e;let n=!0;return i&&(n=n&&mi(t,i),n=n&&(!r||gi(t,i))),n}constructor(t,e){const{id:i=He("texture"),handle:r,target:n}=e;super(t,{id:i,handle:r}),this.target=n,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then(e=>this.initialize(Object.assign({},t,{pixels:e,data:e}))),this;const i="undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement;if(i&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:r=null,format:n=6408,border:o=0,recreate:a=!1,parameters:s={},pixelStore:l={},textureUnit:u}=t;e||(e=r);let{width:c,height:h,dataFormat:p,type:d,compressed:f=!1,mipmaps:m=!0}=t;const{depth:g=0}=t;return({width:c,height:h,compressed:f,dataFormat:p,type:d}=this._deduceParameters({format:n,type:d,dataFormat:p,compressed:f,data:e,width:c,height:h})),this.width=c,this.height=h,this.depth=g,this.format=n,this.type=d,this.dataFormat=p,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),m&&this._isNPOT()&&($.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),m=!1,this._updateForNPOT(s)),this.mipmaps=m,this.setImageData({data:e,width:c,height:h,depth:g,format:n,type:d,dataFormat:p,border:o,mipmaps:m,parameters:l,compressed:f}),m&&this.generateMipmap(),this.setParameters(s),a&&(this.data=e),i&&(this._video={video:e,parameters:s,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:i}=this._video;if(i===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:i,mipmaps:r=!1}=t;return i!==this.width||e!==this.height?this.initialize({width:i,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?($.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),ge(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:i=null,level:r=0,format:n=this.format,border:o=this.border,offset:a=0,parameters:s={}}=t;let{data:l=null,type:u=this.type,width:c=this.width,height:h=this.height,dataFormat:p=this.dataFormat,compressed:d=!1}=t;l||(l=i),({type:u,dataFormat:p,compressed:d,width:c,height:h}=this._deduceParameters({format:n,type:u,dataFormat:p,compressed:d,data:l,width:c,height:h}));const{gl:f}=this;f.bindTexture(this.target,this.handle);let m,g=null;({data:l,dataType:g}=this._getDataType({data:l,compressed:d}));let y=0;if(ge(this.gl,s,()=>{switch(g){case"null":f.texImage2D(e,r,n,c,h,o,p,u,l);break;case"typed-array":f.texImage2D(e,r,n,c,h,o,p,u,l,a);break;case"buffer":m=st(f),m.bindBuffer(35052,l.handle||l),m.texImage2D(e,r,n,c,h,o,p,u,a),m.bindBuffer(35052,null);break;case"browser-object":nt(f)?f.texImage2D(e,r,n,c,h,o,p,u,l):f.texImage2D(e,r,n,p,u,l);break;case"compressed":for(const[t,i]of l.entries())f.compressedTexImage2D(e,t,i.format,i.width,i.height,o,i.data),y+=i.levelSize;break;default:Ve(!1,"Unknown image data type")}}),"compressed"===g)this._trackAllocatedMemory(y,"Texture");else if(l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const t=di[this.dataFormat]||4,e=fi[this.type]||1;this._trackAllocatedMemory(this.width*this.height*t*e,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:i=null,data:r=null,x:n=0,y:o=0,width:a=this.width,height:s=this.height,level:l=0,format:u=this.format,type:c=this.type,dataFormat:h=this.dataFormat,compressed:p=!1,offset:d=0,border:f=this.border,parameters:m={}}=t;if(({type:c,dataFormat:h,compressed:p,width:a,height:s}=this._deduceParameters({format:u,type:c,dataFormat:h,compressed:p,data:r,width:a,height:s})),Ve(0===this.depth,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const t=r;r=t.data,a=t.shape[0],s=t.shape[1]}r instanceof hi&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),ge(this.gl,m,()=>{if(p)this.gl.compressedTexSubImage2D(e,l,n,o,a,s,u,r);else if(null===r)this.gl.texSubImage2D(e,l,n,o,a,s,h,c,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(e,l,n,o,a,s,h,c,r,d);else if(r instanceof vi){const t=st(this.gl);t.bindBuffer(35052,r),t.texSubImage2D(e,l,n,o,a,s,h,c,d),t.bindBuffer(35052,null)}else if(nt(this.gl)){const t=st(this.gl);t.texSubImage2D(e,l,n,o,a,s,h,c,r)}else this.gl.texSubImage2D(e,l,n,o,h,c,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return $.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:i=!1}=t;return i?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof hi?{data:e.handle,dataType:"buffer"}:e instanceof vi?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:i}=t;let{width:r,height:n,dataFormat:o,type:a,compressed:s}=t;const l=pi[e];return o=o||l&&l.dataFormat,a=a||l&&l.types[0],s=s||l&&l.compressed,({width:r,height:n}=this._deduceImageSize(i,r,n)),{dataFormat:o,type:a,compressed:s,width:r,height:n,format:e,data:i}}_deduceImageSize(t,e,i){let r;return r="undefined"!==typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!==typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:i}:{width:e>=0?e:1,height:i>=0?i:1},Ve(r,"Could not deduced texture size"),Ve(void 0===e||r.width===e,"Deduced texture width does not match supplied width"),Ve(void 0===i||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Ve(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!nt(this.gl)&&(!(!this.width||!this.height)&&(!Ze(this.width)||!Ze(this.height)))}_updateForNPOT(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:-1===yi.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071);break;default:break}return e}}let bi="";function xi(t,e){return Ve("string"===typeof t),t=bi+t,new Promise((i,r)=>{try{const n=new Image;n.onload=()=>i(n),n.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),n.crossOrigin=e&&e.crossOrigin||"anonymous",n.src=t}catch(n){r(n)}})}class wi extends _i{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return _i.isSupported(t,e)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};at(t),(e instanceof Promise||"string"===typeof e)&&(e={data:e}),"string"===typeof e.data&&(e=Object.assign({},e,{data:xi(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const Ti="EXT_color_buffer_float";var Ei={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Ti,bpp:2},[33327]:{gl2:Ti,bpp:4},[34842]:{gl2:Ti,bpp:8},[33326]:{gl2:Ti,bpp:4},[33328]:{gl2:Ti,bpp:8},[34836]:{gl2:Ti,bpp:16},[35898]:{gl2:Ti,bpp:4}};function Si(t,e,i){const r=i[e];if(!r)return!1;const n=nt(t)&&r.gl2||r.gl1;return"string"===typeof n?t.getExtension(n):n}class Ai extends Je{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:null};return!e||Si(t,e,Ei)}static getSamplesForFormat(t,e){let{format:i}=e;return t.getInternalformatParameter(36161,i,32937)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:i=1,height:r=1,samples:n=0}=t;return Ve(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==n&&nt(this.gl)?this.gl.renderbufferStorageMultisample(36161,n,e,i,r):this.gl.renderbufferStorage(36161,e,i,r),this.format=e,this.width=i,this.height=r,this.samples=n,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Ei[this.format].bpp),this}resize(t){let{width:e,height:i}=t;return e!==this.width||i!==this.height?this.initialize({width:e,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){this.gl.bindRenderbuffer(36161,this.handle);const e=this.gl.getRenderbufferParameter(36161,t);return e}}const Ci=256,Pi=1024,Ii=16384,Mi=6144,ki=6145,Di=6146,Li=34041,Oi="clear: bad arguments";function Ri(t){let{framebuffer:e=null,color:i=null,depth:r=null,stencil:n=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o={};e&&(o.framebuffer=e);let a=0;i&&(a|=Ii,!0!==i&&(o.clearColor=i)),r&&(a|=Ci,!0!==r&&(o.clearDepth=r)),n&&(a|=Pi,!0!==r&&(o.clearStencil=r)),Ve(0!==a,Oi),ge(t,o,()=>{t.clear(a)})}function zi(t){let{framebuffer:e=null,buffer:i=Mi,drawBuffer:r=0,value:n=[0,0,0,0]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};st(t),ge(t,{framebuffer:e},()=>{switch(i){case Mi:switch(n.constructor){case Int32Array:t.clearBufferiv(i,r,n);break;case Uint32Array:t.clearBufferuiv(i,r,n);break;case Float32Array:default:t.clearBufferfv(i,r,n)}break;case ki:t.clearBufferfv(ki,0,[n]);break;case Di:t.clearBufferiv(Di,0,[n]);break;case Li:const[e,o]=n;t.clearBufferfi(Li,0,e,o);break;default:Ve(!1,Oi)}})}function Fi(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Ve(!1),0}}const Bi=[34069,34070,34071,34072,34073,34074];class Ni extends _i{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};at(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mipmaps:e=!0,parameters:i={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(i)}),this}subImage(t){let{face:e,data:i,x:r=0,y:n=0,mipmapLevel:o=0}=t;return this._subImage({target:e,data:i,x:r,y:n,mipmapLevel:o})}async setCubeMapImageData(t){let{width:e,height:i,pixels:r,data:n,border:o=0,format:a=6408,type:s=5121}=t;const{gl:l}=this,u=r||n,c=await Promise.all(Bi.map(t=>{const e=u[t];return Promise.all(Array.isArray(e)?e:[e])}));this.bind(),Bi.forEach((t,r)=>{c[r].length>1&&!1!==this.opts.mipmaps&&$.warn("".concat(this.id," has mipmap and multiple LODs."))(),c[r].forEach((r,n)=>{e&&i?l.texImage2D(t,n,a,e,i,o,a,s,r):l.texImage2D(t,n,a,a,s,r)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:i,height:r,pixels:n,data:o,border:a=0,format:s=6408,type:l=5121}=t,{gl:u}=this,c=n||o;return this.bind(),c instanceof Promise?c.then(i=>this.setImageDataForFace(Object.assign({},t,{face:e,data:i,pixels:i}))):this.width||this.height?u.texImage2D(e,0,s,i,r,a,s,l,c):u.texImage2D(e,0,s,s,l,c),this}}Ni.FACES=Bi;class ji extends _i{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return nt(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};st(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:i=6408,width:r,height:n,depth:o=1,border:a=0,format:s,type:l=5121,offset:u=0,data:c,parameters:h={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),ge(this.gl,h,()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,e,i,r,n,o,a,s,l,c),c instanceof hi&&(this.gl.bindBuffer(35052,c.handle),this.gl.texImage3D(this.target,e,i,r,n,o,a,s,l,u))}),c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const t=di[this.dataFormat]||4,e=fi[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*t*e,"Texture")}return this.loaded=!0,this}}function Ui(t,e){Ve(t instanceof wi||t instanceof Ni||t instanceof ji);const i=t.constructor,{gl:r,width:n,height:o,format:a,type:s,dataFormat:l,border:u,mipmaps:c}=t,h=Object.assign({width:n,height:o,format:a,type:s,dataFormat:l,border:u,mipmaps:c},e);return new i(r,h)}function Vi(t,e){const{gl:i,width:r,height:n,id:o}=t,a=new Xi(i,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:n,attachments:{[36064]:t}}));return a}function Gi(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{sourceX:i=0,sourceY:r=0,sourceFormat:n=6408}=e;let{sourceAttachment:o=36064,target:a=null,sourceWidth:s,sourceHeight:l,sourceType:u}=e;const{framebuffer:c,deleteFramebuffer:h}=Wi(t);Ve(c);const{gl:p,handle:d,attachments:f}=c;s=s||c.width,l=l||c.height,36064===o&&null===d&&(o=1028),Ve(f[o]),u=u||f[o].type,a=Hi(a,u,n,s,l),u=u||$e(a);const m=p.bindFramebuffer(36160,d);return p.readPixels(i,r,s,l,n,u,a),p.bindFramebuffer(36160,m||null),h&&c.delete(),a}function qi(t){let{sourceAttachment:e=36064,targetMaxHeight:i=Number.MAX_SAFE_INTEGER}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Gi(t,{sourceAttachment:e}),{width:n,height:o}=t;while(o>i)({data:r,width:n,height:o}=ii({data:r,width:n,height:o}));ei({data:r,width:n,height:o});const a=document.createElement("canvas");a.width=n,a.height=o;const s=a.getContext("2d"),l=s.createImageData(n,o);return l.data.set(r),s.putImageData(l,0,0),a.toDataURL()}function Wi(t){return t instanceof Xi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Vi(t),deleteFramebuffer:!0}}function Hi(t,e,i,r,n){if(t)return t;e=e||5121;const o=ti(e,{clamped:!1}),a=Fi(i);return new o(r*n*a)}const Zi="Multiple render targets not supported";class Xi extends Je{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=e;let n=!0;return i&&(n=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),r&&(n=n&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),n}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new Xi(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=st(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=st(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:i=1,attachments:r=null,color:n=!0,depth:o=!0,stencil:a=!1,check:s=!0,readBuffer:l,drawBuffers:u}=t;if(Ve(e>=0&&i>=0,"Width and height need to be integers"),this.width=e,this.height=i,r)for(const c in r){const t=r[c],n=Array.isArray(t)?t[0]:t;n.resize({width:e,height:i})}else r=this._createDefaultAttachments(n,o,a,e,i);this.update({clearAttachments:!0,attachments:r,readBuffer:l,drawBuffers:u}),r&&s&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:i,drawBuffers:r,clearAttachments:n=!1,resizeAttachments:o=!0}=t;this.attach(e,{clearAttachments:n,resizeAttachments:o});const{gl:a}=this,s=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,s||null),this}resize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{width:e,height:i}=t;if(null===this.handle)return Ve(void 0===e&&void 0===i),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===i&&(i=this.gl.drawingBufferHeight),e!==this.width&&i!==this.height&&$.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:e,height:i});return this.width=e,this.height=i,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:i=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={};e&&Object.keys(this.attachments).forEach(t=>{r[t]=null}),Object.assign(r,t);const n=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){Ve(void 0!==o,"Misspelled framebuffer binding point?");const t=Number(o),e=r[t];let n=e;if(n)if(n instanceof Ai)this._attachRenderbuffer({attachment:t,renderbuffer:n});else if(Array.isArray(e)){const[i,r=0,o=0]=e;n=i,this._attachTexture({attachment:t,texture:i,layer:r,level:o})}else this._attachTexture({attachment:t,texture:n,layer:0,level:0});else this._unattach(t);i&&n&&n.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,n||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(t=>!this.attachments[t]).forEach(t=>{delete this.attachments[t]})}checkStatus(){const{gl:t}=this,e=this.getStatus();if(36053!==e)throw new Error(Ki(e));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),i=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),i}clear(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:e,depth:i,stencil:r,drawBuffers:n=[]}=t,o=this.gl.bindFramebuffer(36160,this.handle);return(e||i||r)&&Ri(this.gl,{color:e,depth:i,stencil:r}),n.forEach((t,e)=>{zi(this.gl,{drawBuffer:e,value:t})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return $.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return $.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return $.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return $.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return $.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return $.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:i=0,y:r=0,width:n,height:o}=t;const a=st(this.gl),s=a.bindFramebuffer(36008,this.handle),l=0===i&&0===r&&void 0===n&&void 0===o;return l?a.invalidateFramebuffer(36008,e):a.invalidateFramebuffer(36008,e,i,r,n,o),a.bindFramebuffer(36008,s),this}getAttachmentParameter(t,e,i){let r=this._getAttachmentParameterFallback(e);return null===r&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=qe(this.gl,r)),r}getAttachmentParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const n of i){const i=e?qe(this.gl,n):n;r[i]=this.getAttachmentParameter(t,n,e)}return r}getParameters(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=Object.keys(this.attachments),i={};for(const r of e){const e=Number(r),n=t?qe(this.gl,e):e;i[n]=this.getAttachmentParameters(e,t)}return i}show(){return"undefined"!==typeof window&&window.open(qi(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>$.level||"undefined"===typeof window)return this;e=e||"Framebuffer ".concat(this.id);const i=qi(this,{targetMaxHeight:100});return $.image({logLevel:t,message:e,image:i},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,i,r,n){let o=null;return t&&(o=o||{},o[36064]=new wi(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:n,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),e&&i?(o=o||{},o[33306]=new Ai(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):e?(o=o||{},o[36096]=new Ai(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:n}),this.ownResources.push(o[36096])):i&&Ve(!1),o}_unattach(t){const e=this.attachments[t];e&&(e instanceof Ai?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:i}=t;const{gl:r}=this;r.framebufferRenderbuffer(36160,e,36161,i.handle),this.attachments[e]=i}_attachTexture(t){let{attachment:e=36064,texture:i,layer:r,level:n}=t;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:const t=st(o);t.framebufferTextureLayer(36160,e,i.target,n,r);break;case 34067:const a=Yi(r);o.framebufferTexture2D(36160,e,a,i.handle,n);break;case 3553:o.framebufferTexture2D(36160,e,3553,i.handle,n);break;default:Ve(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[e]=i}_setReadBuffer(t){const e=ot(this.gl);e?e.readBuffer(t):Ve(36064===t||1029===t,Zi),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,i=st(e);if(i)i.drawBuffers(t);else{const i=e.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(t):Ve(1===t.length&&(36064===t[0]||1029===t[0]),Zi)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=nr(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return e.WEBGL2||e.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function Yi(t){return t<34069?t+34069:t}function Ki(t){const e=Xi.STATUS||{};return e[t]||"Framebuffer error ".concat(t)}const Ji=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Xi.ATTACHMENT_PARAMETERS=Ji;const Qi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function $i(t){const e=new wi(t,{format:6408,type:5126,dataFormat:6408}),i=new Xi(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),r=i.getStatus();return e.delete(),i.delete(),36053===r}var tr={[Qi.WEBGL2]:[!1,!0],[Qi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Qi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Qi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Qi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Qi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Qi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Qi.FLOAT_BLEND]:["EXT_float_blend"],[Qi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Qi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Qi.TEXTURE_FLOAT]:["OES_texture_float",!0],[Qi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Qi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Qi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Qi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Qi.COLOR_ATTACHMENT_RGBA32F]:[$i,"EXT_color_buffer_float"],[Qi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Qi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Qi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Qi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Qi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Qi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const er=2;function ir(t,e){return rr(t,e)}function rr(t,e){return e=Array.isArray(e)?e:[e],e.every(e=>or(t,e))}function nr(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in tr)void 0===t.luma.caps[e]&&(t.luma.caps[e]=or(t,e));return t.luma.caps}function or(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},void 0===t.luma.caps[e]&&(t.luma.caps[e]=ar(t,e)),t.luma.caps[e]||$.log(er,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function ar(t,e){const i=tr[e];let r;Ve(i,e);const n=nt(t)&&i[1]||i[0];if("function"===typeof n)r=n(t);else if(Array.isArray(n)){r=!0;for(const e of n)r=r&&Boolean(t.getExtension(e))}else"string"===typeof n?r=Boolean(t.getExtension(n)):"boolean"===typeof n?r=n:Ve(!1);return r}class sr{constructor(t,e){this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:i}=this.source,{size:r}=e;let n=i;if(i&&i.length!==r){n=new Float32Array(r);const t=e.elementOffset||0;for(let e=0;e<r;++e)n[e]=i[t+e]}return n}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function lr(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}class ur{constructor(t){this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(t)}setProps(t){Object.assign(this.props,t)}allocate(t,e,{size:i=1,type:r,padding:n=0,copy:o=!1,initialize:a=!1,maxCount:s}){const l=r||t&&t.constructor||Float32Array,u=e*i+n;if(ArrayBuffer.isView(t)){if(u<=t.length)return t;if(u*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new l(t.buffer,0,u)}let c;s&&(c=s*i+n);const h=this._allocate(l,u,a,c);return t&&o?h.set(t):a||h.fill(0,0,4),this._release(t),h}release(t){this._release(t)}_allocate(t,e,i,r){let n=Math.max(Math.ceil(e*this.props.overAlloc),1);n>r&&(n=r);const o=this._pool,a=t.BYTES_PER_ELEMENT*n,s=o.findIndex(t=>t.byteLength>=a);if(s>=0){const e=new t(o.splice(s,1)[0],0,n);return i&&e.fill(0),e}return new t(n)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:i}=t,{byteLength:r}=i,n=e.findIndex(t=>t.byteLength>=r);n<0?e.push(i):(n>0||e.length<this.props.poolSize)&&e.splice(n,0,i),e.length>this.props.poolSize&&e.shift()}}var cr=new ur;function hr(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}Math.PI,Math.PI;const pr={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function dr(t,{precision:e=pr.precision}={}){return t=vr(t),"".concat(parseFloat(t.toPrecision(e)))}function fr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function mr(t,e,i){return br(t,t=>Math.max(e,Math.min(i,t)))}function gr(t,e,i){return fr(t)?t.map((t,r)=>gr(t,e[r],i)):i*e+(1-i)*t}function yr(t,e,i){const r=pr.EPSILON;i&&(pr.EPSILON=i);try{if(t===e)return!0;if(fr(t)&&fr(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!yr(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):"number"===typeof t&&"number"===typeof e&&Math.abs(t-e)<=pr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{pr.EPSILON=r}}function vr(t){return Math.round(t/pr.EPSILON)*pr.EPSILON}function _r(t){return t.clone?t.clone():new Array(t.length)}function br(t,e,i){if(fr(t)){const r=t;i=i||_r(r);for(let n=0;n<i.length&&n<r.length;++n)i[n]=e(t[n],n,i);return i}return e(t)}function xr(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class wr extends(xr(Array)){clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+e];return this.check()}toArray(t=[],e=0){for(let i=0;i<this.ELEMENTS;++i)t[e+i]=this[i];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:fr(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(pr)}formatString(t){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+dr(this[i],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!yr(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,i){if(void 0===i)return this.lerp(this,t,e);for(let r=0;r<this.ELEMENTS;++r){const n=t[r];this[r]=n+i*(e[r]-n)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),e[i]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if("number"===typeof t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(pr.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),e);return this.check()}get elements(){return this}}function Tr(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Er(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Sr(t,e,i=""){if(pr.debug&&!Tr(t,e))throw new Error("math.gl: ".concat(i," some fields set to invalid numbers'"));return t}class Ar extends wr{get x(){return this[0]}set x(t){this[0]=Er(t)}get y(){return this[1]}set y(t){this[1]=Er(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-t[i];e+=r*r}return Er(e)}dot(t){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*t[i];return Er(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return hr(t>=0&&t<this.ELEMENTS,"index is out of range"),Er(this[t])}setComponent(t,e){return hr(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var Cr=1e-6,Pr="undefined"!==typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function Ir(){var t=new Pr(3);return Pr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Mr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function kr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Dr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Lr(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[0],s=i[1],l=i[2];return t[0]=n*l-o*s,t[1]=o*a-r*l,t[2]=r*s-n*a,t}function Or(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[3]*r+i[7]*n+i[11]*o+i[15];return a=a||1,t[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/a,t[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/a,t[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/a,t}function Rr(t,e,i){var r=e[0],n=e[1],o=e[2];return t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8],t}function zr(t,e,i){var r=i[0],n=i[1],o=i[2],a=i[3],s=e[0],l=e[1],u=e[2],c=n*u-o*l,h=o*s-r*u,p=r*l-n*s,d=n*p-o*h,f=o*c-r*p,m=r*h-n*c,g=2*a;return c*=g,h*=g,p*=g,d*=2,f*=2,m*=2,t[0]=s+c+d,t[1]=l+h+f,t[2]=u+p+m,t}function Fr(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}function Br(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}function Nr(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}function jr(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],a=e[1],s=e[2],l=Math.sqrt(i*i+r*r+n*n),u=Math.sqrt(o*o+a*a+s*s),c=l*u,h=c&&Dr(t,e)/c;return Math.acos(Math.min(Math.max(h,-1),1))}Math.hypot||(Math.hypot=function(){var t=0,e=arguments.length;while(e--)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ur=Mr;(function(){var t=Ir()})();function Vr(t,e,i){const r=e[0],n=e[1],o=i[3]*r+i[7]*n||1;return t[0]=(i[0]*r+i[4]*n)/o,t[1]=(i[1]*r+i[5]*n)/o,t}function Gr(t,e,i){const r=e[0],n=e[1],o=e[2],a=i[3]*r+i[7]*n+i[11]*o||1;return t[0]=(i[0]*r+i[4]*n+i[8]*o)/a,t[1]=(i[1]*r+i[5]*n+i[9]*o)/a,t[2]=(i[2]*r+i[6]*n+i[10]*o)/a,t}function qr(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t[2]=e[2],t}const Wr=[0,0,0];let Hr;class Zr extends Ar{static get ZERO(){return Hr||(Hr=new Zr(0,0,0),Object.freeze(Hr)),Hr}constructor(t=0,e=0,i=0){super(-0,-0,-0),1===arguments.length&&fr(t)?this.copy(t):(pr.debug&&(Er(t),Er(e),Er(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return pr.debug&&(Er(t.x),Er(t.y),Er(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Er(t)}angle(t){return jr(this,t)}cross(t){return Lr(this,this,t),this.check()}rotateX({radians:t,origin:e=Wr}){return Fr(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Wr}){return Br(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Wr}){return Nr(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Or(this,this,t),this.check()}transformAsVector(t){return Gr(this,this,t),this.check()}transformByMatrix3(t){return Rr(this,this,t),this.check()}transformByMatrix2(t){return qr(this,this,t),this.check()}transformByQuaternion(t){return zr(this,this,t),this.check()}}class Xr extends wr{toString(){let t="[";if(pr.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let i=0;i<this.RANK;++i)t+=" ".concat(this[i*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,i){return this[e*this.RANK+t]=Er(i),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let r=0;r<this.RANK;++r)e[r]=this[i+r];return e}setColumn(t,e){const i=t*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=e[r];return this}}function Yr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kr(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=n,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Jr(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=i*s-r*a,_=i*l-n*a,b=i*u-o*a,x=r*l-n*s,w=r*u-o*s,T=n*u-o*l,E=c*m-h*f,S=c*g-p*f,A=c*y-d*f,C=h*g-p*m,P=h*y-d*m,I=p*y-d*g,M=v*I-_*P+b*C+x*A-w*S+T*E;return M?(M=1/M,t[0]=(s*I-l*P+u*C)*M,t[1]=(n*P-r*I-o*C)*M,t[2]=(m*T-g*w+y*x)*M,t[3]=(p*w-h*T-d*x)*M,t[4]=(l*A-a*I-u*S)*M,t[5]=(i*I-n*A+o*S)*M,t[6]=(g*b-f*T-y*_)*M,t[7]=(c*T-p*b+d*_)*M,t[8]=(a*P-s*A+u*E)*M,t[9]=(r*A-i*P-o*E)*M,t[10]=(f*w-m*b+y*v)*M,t[11]=(h*b-c*w-d*v)*M,t[12]=(s*S-a*C-l*E)*M,t[13]=(i*C-r*S+n*E)*M,t[14]=(m*_-f*x-g*v)*M,t[15]=(c*x-h*_+p*v)*M,t):null}function Qr(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],p=t[11],d=t[12],f=t[13],m=t[14],g=t[15],y=e*a-i*o,v=e*s-r*o,_=e*l-n*o,b=i*s-r*a,x=i*l-n*a,w=r*l-n*s,T=u*f-c*d,E=u*m-h*d,S=u*g-p*d,A=c*m-h*f,C=c*g-p*f,P=h*g-p*m;return y*P-v*C+_*A+b*S-x*E+w*T}function $r(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=i[0],b=i[1],x=i[2],w=i[3];return t[0]=_*r+b*s+x*h+w*m,t[1]=_*n+b*l+x*p+w*g,t[2]=_*o+b*u+x*d+w*y,t[3]=_*a+b*c+x*f+w*v,_=i[4],b=i[5],x=i[6],w=i[7],t[4]=_*r+b*s+x*h+w*m,t[5]=_*n+b*l+x*p+w*g,t[6]=_*o+b*u+x*d+w*y,t[7]=_*a+b*c+x*f+w*v,_=i[8],b=i[9],x=i[10],w=i[11],t[8]=_*r+b*s+x*h+w*m,t[9]=_*n+b*l+x*p+w*g,t[10]=_*o+b*u+x*d+w*y,t[11]=_*a+b*c+x*f+w*v,_=i[12],b=i[13],x=i[14],w=i[15],t[12]=_*r+b*s+x*h+w*m,t[13]=_*n+b*l+x*p+w*g,t[14]=_*o+b*u+x*d+w*y,t[15]=_*a+b*c+x*f+w*v,t}function tn(t,e,i){var r,n,o,a,s,l,u,c,h,p,d,f,m=i[0],g=i[1],y=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=r,t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=r*m+s*g+h*y+e[12],t[13]=n*m+l*g+p*y+e[13],t[14]=o*m+u*g+d*y+e[14],t[15]=a*m+c*g+f*y+e[15]),t}function en(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function rn(t,e,i,r){var n,o,a,s,l,u,c,h,p,d,f,m,g,y,v,_,b,x,w,T,E,S,A,C,P=r[0],I=r[1],M=r[2],k=Math.hypot(P,I,M);return k<Cr?null:(k=1/k,P*=k,I*=k,M*=k,n=Math.sin(i),o=Math.cos(i),a=1-o,s=e[0],l=e[1],u=e[2],c=e[3],h=e[4],p=e[5],d=e[6],f=e[7],m=e[8],g=e[9],y=e[10],v=e[11],_=P*P*a+o,b=I*P*a+M*n,x=M*P*a-I*n,w=P*I*a-M*n,T=I*I*a+o,E=M*I*a+P*n,S=P*M*a+I*n,A=I*M*a-P*n,C=M*M*a+o,t[0]=s*_+h*b+m*x,t[1]=l*_+p*b+g*x,t[2]=u*_+d*b+y*x,t[3]=c*_+f*b+v*x,t[4]=s*w+h*T+m*E,t[5]=l*w+p*T+g*E,t[6]=u*w+d*T+y*E,t[7]=c*w+f*T+v*E,t[8]=s*S+h*A+m*C,t[9]=l*S+p*A+g*C,t[10]=u*S+d*A+y*C,t[11]=c*S+f*A+v*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function nn(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+u*r,t[5]=a*n+c*r,t[6]=s*n+h*r,t[7]=l*n+p*r,t[8]=u*n-o*r,t[9]=c*n-a*r,t[10]=h*n-s*r,t[11]=p*n-l*r,t}function on(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-u*r,t[1]=a*n-c*r,t[2]=s*n-h*r,t[3]=l*n-p*r,t[8]=o*r+u*n,t[9]=a*r+c*n,t[10]=s*r+h*n,t[11]=l*r+p*n,t}function an(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+u*r,t[1]=a*n+c*r,t[2]=s*n+h*r,t[3]=l*n+p*r,t[4]=u*n-o*r,t[5]=c*n-a*r,t[6]=h*n-s*r,t[7]=p*n-l*r,t}function sn(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=i+i,s=r+r,l=n+n,u=i*a,c=r*a,h=r*s,p=n*a,d=n*s,f=n*l,m=o*a,g=o*s,y=o*l;return t[0]=1-h-f,t[1]=c+y,t[2]=p-g,t[3]=0,t[4]=c-y,t[5]=1-u-f,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ln(t,e,i,r,n,o,a){var s=1/(i-e),l=1/(n-r),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(n+r)*l,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*u,t[15]=0,t}function un(t,e,i,r,n){var o,a=1/Math.tan(e/2);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(o=1/(r-n),t[10]=(n+r)*o,t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}var cn=un;function hn(t,e,i,r,n,o,a){var s=1/(e-i),l=1/(r-n),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*s,t[13]=(n+r)*l,t[14]=(a+o)*u,t[15]=1,t}var pn=hn;function dn(t,e,i,r){var n,o,a,s,l,u,c,h,p,d,f=e[0],m=e[1],g=e[2],y=r[0],v=r[1],_=r[2],b=i[0],x=i[1],w=i[2];return Math.abs(f-b)<Cr&&Math.abs(m-x)<Cr&&Math.abs(g-w)<Cr?Yr(t):(c=f-b,h=m-x,p=g-w,d=1/Math.hypot(c,h,p),c*=d,h*=d,p*=d,n=v*p-_*h,o=_*c-y*p,a=y*h-v*c,d=Math.hypot(n,o,a),d?(d=1/d,n*=d,o*=d,a*=d):(n=0,o=0,a=0),s=h*a-p*o,l=p*n-c*a,u=c*o-h*n,d=Math.hypot(s,l,u),d?(d=1/d,s*=d,l*=d,u*=d):(s=0,l=0,u=0),t[0]=n,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=p,t[11]=0,t[12]=-(n*f+o*m+a*g),t[13]=-(s*f+l*m+u*g),t[14]=-(c*f+h*m+p*g),t[15]=1,t)}function fn(){var t=new Pr(2);return Pr!=Float32Array&&(t[0]=0,t[1]=0),t}function mn(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function gn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function yn(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function vn(t){var e=t[0],i=t[1];return Math.hypot(e,i)}function _n(t,e){return t[0]=-e[0],t[1]=-e[1],t}function bn(t,e,i,r){var n=e[0],o=e[1];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t}function xn(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}var wn=gn;(function(){var t=fn()})();function Tn(){var t=new Pr(4);return Pr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function En(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Sn(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*a,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*a,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*a,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*a,t}var An;(function(){var t=Tn()})();(function(t){t[t["COL0ROW0"]=0]="COL0ROW0",t[t["COL0ROW1"]=1]="COL0ROW1",t[t["COL0ROW2"]=2]="COL0ROW2",t[t["COL0ROW3"]=3]="COL0ROW3",t[t["COL1ROW0"]=4]="COL1ROW0",t[t["COL1ROW1"]=5]="COL1ROW1",t[t["COL1ROW2"]=6]="COL1ROW2",t[t["COL1ROW3"]=7]="COL1ROW3",t[t["COL2ROW0"]=8]="COL2ROW0",t[t["COL2ROW1"]=9]="COL2ROW1",t[t["COL2ROW2"]=10]="COL2ROW2",t[t["COL2ROW3"]=11]="COL2ROW3",t[t["COL3ROW0"]=12]="COL3ROW0",t[t["COL3ROW1"]=13]="COL3ROW1",t[t["COL3ROW2"]=14]="COL3ROW2",t[t["COL3ROW3"]=15]="COL3ROW3"})(An||(An={}));const Cn=45*Math.PI/180,Pn=1,In=.1,Mn=500,kn=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Dn extends Xr{static get IDENTITY(){return zn()}static get ZERO(){return Rn()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return An}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m){return this[0]=t,this[1]=e,this[2]=i,this[3]=r,this[4]=n,this[5]=o,this[6]=a,this[7]=s,this[8]=l,this[9]=u,this[10]=c,this[11]=h,this[12]=p,this[13]=d,this[14]=f,this[15]=m,this.check()}setRowMajor(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m){return this[0]=t,this[1]=n,this[2]=l,this[3]=p,this[4]=e,this[5]=o,this[6]=u,this[7]=d,this[8]=i,this[9]=a,this[10]=c,this[11]=f,this[12]=r,this[13]=s,this[14]=h,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(kn)}fromObject(t){return this.check()}fromQuaternion(t){return sn(this,t),this.check()}frustum(t){const{left:e,right:i,bottom:r,top:n,near:o=In,far:a=Mn}=t;return a===1/0?Bn(this,e,i,r,n,o):ln(this,e,i,r,n,o,a),this.check()}lookAt(t){const{eye:e,center:i=[0,0,0],up:r=[0,1,0]}=t;return dn(this,e,i,r),this.check()}ortho(t){const{left:e,right:i,bottom:r,top:n,near:o=In,far:a=Mn}=t;return pn(this,e,i,r,n,o,a),this.check()}orthographic(t){const{fovy:e=Cn,aspect:i=Pn,focalDistance:r=1,near:n=In,far:o=Mn}=t;Fn(e);const a=e/2,s=r*Math.tan(a),l=s*i;return this.ortho({left:-l,right:l,bottom:-s,top:s,near:n,far:o})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:i=1,near:r=.1,far:n=500}=t;return Fn(e),cn(this,e,i,r,n),this.check()}determinant(){return Qr(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),r=1/i[0],n=1/i[1],o=1/i[2];return t[0]=this[0]*r,t[1]=this[1]*n,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*n,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*n,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),r=1/i[0],n=1/i[1],o=1/i[2];return t[0]=this[0]*r,t[1]=this[1]*n,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*n,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*n,t[8]=this[10]*o,t}transpose(){return Kr(this,this),this.check()}invert(){return Jr(this,this),this.check()}multiplyLeft(t){return $r(this,t,this),this.check()}multiplyRight(t){return $r(this,this,t),this.check()}rotateX(t){return nn(this,this,t),this.check()}rotateY(t){return on(this,this,t),this.check()}rotateZ(t){return an(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return rn(this,this,t,e),this.check()}scale(t){return en(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return tn(this,this,t),this.check()}transform(t,e){return 4===t.length?(e=Sn(e||[-0,-0,-0,-0],t,this),Sr(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:i}=t;let r;switch(i){case 2:r=xn(e||[-0,-0],t,this);break;case 3:r=Or(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Sr(r,t.length),r}transformAsVector(t,e){let i;switch(t.length){case 2:i=Vr(e||[-0,-0],t,this);break;case 3:i=Gr(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Sr(i,t.length),i}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,i){return this.identity().translate([t,e,i])}}let Ln,On;function Rn(){return Ln||(Ln=new Dn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ln)),Ln}function zn(){return On||(On=new Dn,Object.freeze(On)),On}function Fn(t){if(t>2*Math.PI)throw Error("expected radians")}function Bn(t,e,i,r,n,o){const a=2*o/(i-e),s=2*o/(n-r),l=(i+e)/(i-e),u=(n+r)/(n-r),c=-1,h=-1,p=-2*o;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=l,t[9]=u,t[10]=c,t[11]=h,t[12]=0,t[13]=0,t[14]=p,t[15]=0,t}function Nn(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jn(t){return[t[12],t[13],t[14]]}function Un(t){const e={};return e.left=Gn(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),e.right=Gn(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),e.bottom=Gn(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),e.top=Gn(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),e.near=Gn(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),e.far=Gn(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14]),e}const Vn=new Zr;function Gn(t,e,i,r){Vn.set(t,e,i);const n=Vn.len();return{distance:r/n,normal:new Zr(-t/n,-e/n,-i/n)}}function qn(t){return t-Math.fround(t)}let Wn;function Hn(t,{size:e=1,startIndex:i=0,endIndex:r}){Number.isFinite(r)||(r=t.length);const n=(r-i)/e;Wn=cr.allocate(Wn,n,{type:Float32Array,size:2*e});let o=i,a=0;while(o<r){for(let i=0;i<e;i++){const r=t[o++];Wn[a+i]=r,Wn[a+i+e]=qn(r)}a+=2*e}return Wn.subarray(0,n*e*2)}function Zn(t){return t.stride||t.size*t.bytesPerElement}function Xn(t,e){e.offset&&Y.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Zn(t),r="vertexOffset"in e?e.vertexOffset:t.vertexOffset||0,n=e.elementOffset||0,o=r*i+n*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:i}}function Yn(t,e){const i=Xn(t,e);return{high:i,low:{...i,offset:i.offset+4*t.size}}}class Kn{constructor(t,e){this.gl=t,this.id=e.id,this.size=e.size;const i=e.logicalType||e.type,r=5130===i;let{defaultValue:n}=e;n=Number.isFinite(n)?[n]:n||new Array(this.size).fill(0),e.defaultValue=n;let o=i;r?o=5126:!o&&e.isIndexed?o=t&&ir(t,Qi.ELEMENT_INDEX_UINT32)?5125:5123:o||(o=5126),e.logicalType=i,e.type=o;let a=lr(i||o||5126);this.shaderAttributes={},this.doublePrecision=r,r&&!1===e.fp64&&(a=Float32Array),e.bytesPerElement=a.BYTES_PER_ELEMENT,this.defaultType=a,this.value=null,this.settings=e,this.state={externalBuffer:null,bufferAccessor:e,allocatedValue:null,constant:!1},this._buffer=null,this.setData(e)}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new hi(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Zn(t):0}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),cr.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,n=Yn(this.getAccessor(),e||{});return i[t]=new sr(this,n.high),i["".concat(t,"64Low")]=r?new sr(this,n.low):new Float32Array(this.size),i}if(e){const i=Xn(this.getAccessor(),e);return{[t]:new sr(this,i)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}setData(t){const{state:e}=this;ArrayBuffer.isView(t)?t={value:t}:t instanceof hi&&(t={buffer:t});const i={...this.settings,...t};if(e.bufferAccessor=i,t.constant){let i=t.value;i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this._normalizeConstant(i));const r=!e.constant||!this._areValuesEqual(i,this.value);if(!r)return!1;e.externalBuffer=null,e.constant=!0,this.value=i}else if(t.buffer){const r=t.buffer;e.externalBuffer=r,e.constant=!1,this.value=t.value;const n=t.value instanceof Float64Array;i.type=t.type||r.accessor.type,i.bytesPerElement=r.accessor.BYTES_PER_ELEMENT*(n?2:1),i.stride=Zn(i)}else if(t.value){this._checkExternalBuffer(t);let r=t.value;e.externalBuffer=null,e.constant=!1,this.value=r,i.bytesPerElement=r.BYTES_PER_ELEMENT,i.stride=Zn(i);const{buffer:n,byteOffset:o}=this;this.doublePrecision&&r instanceof Float64Array&&(r=Hn(r,i));const a=r.byteLength+o+2*i.stride;n.byteLength<a&&n.reallocate(a),n.setAccessor(null),n.subData({data:r,offset:o}),i.type=t.type||n.accessor.type}return!0}updateSubBuffer(t={}){const{value:e}=this,{startOffset:i=0,endOffset:r}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?Hn(e,{size:this.size,startIndex:i,endIndex:r}):e.subarray(i,r),offset:i*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate({numInstances:t,copy:e=!1}){const{state:i}=this,r=i.allocatedValue,n=cr.allocate(r,t+1,{size:this.size,type:this.defaultType,copy:e});this.value=n;const{buffer:o,byteOffset:a}=this;return o.byteLength<n.byteLength+a&&(o.reallocate(n.byteLength+a),e&&r&&o.subData({data:r instanceof Float64Array?Hn(r,this):r,offset:a})),i.allocatedValue=n,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!t.constant&&e){const i=this.defaultType;let r=!1;if(this.doublePrecision&&(r=e.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof i||!this.settings.normalized||"normalized"in t||Y.warn("Attribute ".concat(this.id," is normalized"))()}}_normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(t).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(t).map(t=>t/255);case 5123:return new Float32Array(t).map(t=>t/65535);default:return t}}_normalizeValue(t,e,i){const{defaultValue:r,size:n}=this.settings;if(Number.isFinite(t))return e[i]=t,e;if(!t)return e[i]=r[0],e;switch(n){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:r[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:r[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:r[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:r[0];break;default:let o=n;while(--o>=0)e[i+o]=Number.isFinite(t[o])?t[o]:r[o]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}}function Jn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}const Qn=[],$n=[];function to(t,e=0,i=1/0){let r=Qn;const n={index:-1,data:t,target:[]};return t?"function"===typeof t[Symbol.iterator]?r=t:t.length>0&&($n.length=t.length,r=$n):r=Qn,(e>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,i),n.index=e-1),{iterable:r,objectInfo:n}}function eo(t){return t&&t[Symbol.asyncIterator]}function io(t,{size:e,stride:i,offset:r,startIndices:n,nested:o}){const a=t.BYTES_PER_ELEMENT,s=i?i/a:e,l=r?r/a:0,u=Math.floor((t.length-l)/s);return(i,{index:r,target:a})=>{if(!n){const i=r*s+l;for(let r=0;r<e;r++)a[r]=t[i+r];return a}const c=n[r],h=n[r+1]||u;let p;if(o){p=new Array(h-c);for(let i=c;i<h;i++){const r=i*s+l;a=new Array(e);for(let i=0;i<e;i++)a[i]=t[r+i];p[i-c]=a}}else if(s===e)p=t.subarray(c*e+l,h*e+l);else{p=new t.constructor((h-c)*e);let i=0;for(let r=c;r<h;r++){const n=r*s+l;for(let r=0;r<e;r++)p[i++]=t[n+r]}}return p}}function ro(t,e=(()=>!0)){return Array.isArray(t)?no(t,e,[]):e(t)?[t]:[]}function no(t,e,i){let r=-1;while(++r<t.length){const n=t[r];Array.isArray(n)?no(n,e,i):e(n)&&i.push(n)}return i}function oo({target:t,source:e,start:i=0,count:r=1}){const n=e.length,o=r*n;let a=0;for(let s=i;a<n;a++)t[s++]=e[a];while(a<o)a<o-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+o-a),a=o);return t}const ao=[],so=[[0,1/0]];function lo(t,e){if(t===so)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;const i=[],r=t.length;let n=0;for(let o=0;o<r;o++){const r=t[o];r[1]<e[0]?(i.push(r),n=o+1):r[0]>e[1]?i.push(r):e=[Math.min(r[0],e[0]),Math.max(r[1],e[1])]}return i.splice(n,0,e),i}function uo({source:t,target:e,start:i=0,end:r,size:n,getData:o}){r=r||e.length;const a=t.length,s=r-i;if(a>s)return void e.set(t.subarray(0,s),i);if(e.set(t,i),!o)return;let l=a;while(l<s){const r=o(l,t);for(let t=0;t<n;t++)e[i+l]=r[t]||0,l++}}function co({source:t,target:e,size:i,getData:r,sourceStartIndices:n,targetStartIndices:o}){if(!Array.isArray(o))return uo({source:t,target:e,size:i,getData:r}),e;let a=0,s=0;const l=r&&((t,e)=>r(t+s,e)),u=Math.min(n.length,o.length);for(let c=1;c<u;c++){const r=n[c]*i,u=o[c]*i;uo({source:t.subarray(a,r),target:e,start:s,end:u,size:i,getData:l}),a=r,s=u}return s<e.length&&uo({source:[],target:e,start:s,size:i,getData:l}),e}const ho={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function po(t,e){return t?(Number.isFinite(t)&&(t={duration:t}),t.type=t.type||"interpolation",{...ho[t.type],...e,...t}):null}function fo(t,e){const i=e.getBuffer();return i?[e.getBuffer(),{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function mo(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function go(t){t.push(t.shift())}function yo(t,e){const{doublePrecision:i,settings:r,value:n,size:o}=t,a=i&&n instanceof Float64Array?2:1;return(r.noAlloc?n.length:e*o)*a}function vo({buffer:t,numInstances:e,attribute:i,fromLength:r,fromStartIndices:n,getData:o=(t=>t)}){const a=i.doublePrecision&&i.value instanceof Float64Array?2:1,s=i.size*a,l=i.byteOffset,u=i.startIndices,c=n&&u,h=yo(i,e),p=i.state.constant;if(!c&&r>=h)return;const d=p?i.value:i.getBuffer().getData({srcByteOffset:l});if(i.settings.normalized&&!p){const t=o;o=(e,r)=>i._normalizeConstant(t(e,r))}const f=p?(t,e)=>o(d,e):(t,e)=>o(d.subarray(t,t+s),e),m=t.getData({length:r}),g=new Float32Array(h);co({source:m,target:g,sourceStartIndices:n,targetStartIndices:u,size:s,getData:f}),t.byteLength<g.byteLength+l&&t.reallocate(g.byteLength+l),t.subData({data:g,offset:l})}class _o extends Kn{constructor(t,e={}){super(t,e);const{transition:i=!1,noAlloc:r=!1,update:n=null,accessor:o=null,transform:a=null,startIndices:s=null}=e;Object.assign(this.settings,{transition:i,noAlloc:r,update:n||o&&this._autoUpdater,accessor:o,transform:a}),Object.assign(this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:so,startIndices:s}),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat("function"!==typeof t&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,i=this.settings.transition,r=Array.isArray(e)?t[e.find(e=>t[e])]:t[e];return po(r,i)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:t=0,endRow:i=1/0}=e;this.state.updateRanges=lo(this.state.updateRanges,[t,i])}else this.state.updateRanges=so}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=ao}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}update(t){this.setData(t)}allocate(t){const{state:e,settings:i}=this;return!i.noAlloc&&(!!i.update&&(super.allocate({numInstances:t,copy:e.updateRanges!==so}),!0))}updateBuffer({numInstances:t,data:e,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:n},settings:{update:o,noAlloc:a}}=this;let s=!0;if(o){for(const[a,s]of n)o.call(r,this,{data:e,startRow:a,endRow:s,props:i,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[e,i]of n){const r=Number.isFinite(e)?this.getVertexOffset(e):0,n=Number.isFinite(i)?this.getVertexOffset(i):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:r,endOffset:n})}else;this._checkAttributeArray()}else s=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),s}setConstantValue(t){if(void 0===t||"function"===typeof t)return!1;const e=this.setData({constant:!0,value:t});return e&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:i,settings:r}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;i.binaryValue=t,this.setNeedsRedraw(),ArrayBuffer.isView(t)&&(t={value:t});const n=r.transform||e!==this.startIndices;if(n){Jn(ArrayBuffer.isView(t.value),"invalid ".concat(r.accessor));const n=t.size&&t.size!==this.size;return i.binaryAccessor=io(t.value,{size:t.size||this.size,stride:t.stride,offset:t.offset,startIndices:e,nested:n}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this,i=e?e[t]:t;return i*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const i in t)Object.assign(e,super.getShaderAttributes(i,t[i]));return e}_autoUpdater(t,{data:e,startRow:i,endRow:r,props:n,numInstances:o}){if(t.constant)return;const{settings:a,state:s,value:l,size:u,startIndices:c}=t,{accessor:h,transform:p}=a,d=s.binaryAccessor||("function"===typeof h?h:n[h]);Jn("function"===typeof d,'accessor "'.concat(h,'" is not a function'));let f=t.getVertexOffset(i);const{iterable:m,objectInfo:g}=to(e,i,r);for(const y of m){g.index++;let e=d(y,g);if(p&&(e=p.call(this,e)),c){const i=(g.index<c.length-1?c[g.index+1]:o)-c[g.index];if(e&&Array.isArray(e[0])){let i=f;for(const r of e)t._normalizeValue(r,l,i),i+=u}else e&&e.length>u?l.set(e,f):(t._normalizeValue(e,g.target,0),oo({target:l,source:g.target,start:f,count:i}));f+=i*u}else t._normalizeValue(e,l,f),f+=u}}_validateAttributeUpdaters(){const{settings:t}=this,e=t.noAlloc||"function"===typeof t.update;if(!e)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let i=!0;switch(e){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}let bo={};function xo(t){bo=t}function wo(t){Y.level>0&&bo[t]&&bo[t].call(...arguments)}function To(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Eo="void main() {gl_FragColor = vec4(0);}",So="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",Ao="#version 300 es\n".concat(So);function Co(t,e){e=Array.isArray(e)?e:[e];const i=t.replace(/^\s+/,"").split(/\s+/),[r,n,o]=i;if(!e.includes(r)||!n||!o)return null;const a=o.split(";")[0];return{qualifier:r,type:n,name:a}}function Po(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{version:e=100,input:i,inputType:r,output:n}=t;if(!i)return 300===e?Ao:e>300?"#version ".concat(e,"\n").concat(So):Eo;const o=ko(i,r);return e>=300?"#version ".concat(e," ").concat(300===e?"es":"","\nin ").concat(r," ").concat(i,";\nout vec4 ").concat(n,";\nvoid main() {\n  ").concat(n," = ").concat(o,";\n}"):"varying ".concat(r," ").concat(i,";\nvoid main() {\n  gl_FragColor = ").concat(o,";\n}")}function Io(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return To(!1),null}}function Mo(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return To(!1),null}}function ko(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return To(!1),null}}class Do extends Je{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return nt(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};st(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Xe(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const i=this._getVaryingIndex(t),{buffer:r,byteSize:n,byteOffset:o}=this._getBufferParams(e);return i<0?(this.unused[t]=r,$.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[i]=e,this.bindOnUse||this._bindBuffer(i,r,o,n),this)}begin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,i,r;return t instanceof hi===!1?(r=t.buffer,i=t.byteSize,e=t.byteOffset):r=t,void 0===e&&void 0===i||(e=e||0,i=i||r.byteLength-e),{buffer:r,byteOffset:e,byteSize:i}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const n=e&&e.handle;return n&&void 0!==r?this.gl.bindBufferRange(35982,t,n,i,r):this.gl.bindBufferBase(35982,t,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}class Lo{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=e,n=Object.assign({},i,t.attributes);return{attributes:n,transformFeedback:r}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],i=t?e[t]:null;return i?i instanceof hi?i:i.buffer:null}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyingName:e}=t,i=this.getBuffer(e);return i?i.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Ve(nt(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const t=this.feedbackMap[r];r in e&&(i[t]=r)}Object.assign(i,t.feedbackBuffers);for(const r in i){const t=i[r];if("string"===typeof t){const n=e[t],{byteLength:o,usage:a,accessor:s}=n;i[r]=this._createNewBuffer(r,{byteLength:o,usage:a,accessor:s})}}return i}_setupBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const i=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:i})}_setupTransformFeedback(t,e){let{model:i}=e;const{program:r}=i;t.transformFeedback=new Do(this.gl,{program:r,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:e}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:t,feedbackBuffers:e})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),i=Object.assign({},t.feedbackBuffers);for(const r in this.feedbackMap){const n=this.feedbackMap[r];e[r]=t.feedbackBuffers[n],i[n]=t.sourceBuffers[r],Ve(i[n]instanceof hi)}return{sourceBuffers:e,feedbackBuffers:i}}_createNewBuffer(t,e){const i=new hi(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}function Oo(t){let e=100;const i=t.match(/[^\s]+/g);if(i.length>=2&&"#version"===i[0]){const t=parseInt(i[1],10);Number.isFinite(t)&&(e=t)}return e}const Ro="#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",zo="#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n",Fo="vs",Bo="fs",No={[Fo]:Ro,[Bo]:zo},jo="__LUMA_INJECT_DECLARATIONS__",Uo=/void\s+main\s*\([^)]*\)\s*\{\n?/,Vo=/}\n?[^{}]*$/,Go=[];function qo(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=e===Fo;for(const o in i){const e=i[o];e.sort((t,e)=>t.order-e.order),Go.length=e.length;for(let t=0,i=e.length;t<i;++t)Go[t]=e[t].injection;const r="".concat(Go.join("\n"),"\n");switch(o){case"vs:#decl":n&&(t=t.replace(jo,r));break;case"vs:#main-start":n&&(t=t.replace(Uo,t=>t+r));break;case"vs:#main-end":n&&(t=t.replace(Vo,t=>r+t));break;case"fs:#decl":n||(t=t.replace(jo,r));break;case"fs:#main-start":n||(t=t.replace(Uo,t=>t+r));break;case"fs:#main-end":n||(t=t.replace(Vo,t=>r+t));break;default:t=t.replace(o,t=>t+r)}}return t=t.replace(jo,""),r&&(t=t.replace(/\}\s*$/,t=>t+No[e])),t}function Wo(t){const e={};return To(Array.isArray(t)&&t.length>1),t.forEach(t=>{for(const i in t)e[i]=e[i]?"".concat(e[i],"\n").concat(t[i]):t[i]}),e}const Ho="attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",Zo={name:"transform",vs:Ho,fs:null},Xo="transform_uSampler_",Yo="transform_uSize_",Ko="transform_position";function Jo(t){let{vs:e,sourceTextureMap:i,targetTextureVarying:r,targetTexture:n}=t;const o=Object.keys(i);let a=o.length,s=null;const l={};let u=e,c={};if(a>0||r){const t=u.split("\n"),e=t.slice();if(t.forEach((t,n,o)=>{if(a>0){const r=ia(t,i);if(r){const{updatedLine:t,inject:i}=r;e[n]=t,c=Wo([c,i]),Object.assign(l,r.samplerTextureMap),a--}}r&&!s&&(s=ea(t,r))}),r){Ve(n);const t="".concat(Yo).concat(r),e="uniform vec2 ".concat(t,";\n"),i="     vec2 ".concat(Ko," = transform_getPos(").concat(t,");\n     gl_Position = vec4(").concat(Ko,", 0, 1.);\n"),o={"vs:#decl":e,"vs:#main-start":i};c=Wo([c,o])}u=e.join("\n")}return{vs:u,targetTextureType:s,inject:c,samplerTextureMap:l}}function Qo(t){let{sourceTextureMap:e,targetTextureVarying:i,targetTexture:r}=t;const n={};let o,a;i&&(({width:o,height:a}=r),n["".concat(Yo).concat(i)]=[o,a]);for(const s in e)({width:o,height:a}=e[s]),n["".concat(Yo).concat(s)]=[o,a];return n}function $o(t){return Co(t,["attribute","in"])}function ta(t){const e="".concat(Xo).concat(t),i="".concat(Yo).concat(t),r="  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(i,";");return{samplerName:e,sizeName:i,uniformDeclerations:r}}function ea(t,e){const i=Co(t,["varying","out"]);return i&&i.name===e?i.type:null}function ia(t,e){const i={},r=$o(t);if(!r)return null;const{type:n,name:o}=r;if(o&&e[o]){const e="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:r,sizeName:a,uniformDeclerations:s}=ta(o),l=Io(n),u="  ".concat(n," ").concat(o," = transform_getInput(").concat(r,", ").concat(a,").").concat(l,";\n");i[r]=o;const c={"vs:#decl":s,"vs:#main-start":u};return{updatedLine:e,inject:c,samplerTextureMap:i}}return null}const ra={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},na="transform_output";class oa{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,sourceTextures:i,framebuffer:r,targetTexture:n}=this.bindings[this.currentIndex],o=Object.assign({},e,t.attributes),a=Object.assign({},t.uniforms),s=Object.assign({},t.parameters);let l=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const e in this.samplerTextureMap){const t=this.samplerTextureMap[e];a[e]=i[t]}this._setSourceTextureParameters();const t=Qo({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:n});Object.assign(a,t)}return this.hasTargetTexture&&(l=!1,s.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:l,parameters:s}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],i=Gi(e);if(!t)return i;const r=i.constructor,n=Mo(this.targetTextureType),o=new r(i.length*n/4);let a=0;for(let s=0;s<i.length;s+=4)for(let t=0;t<n;t++)o[a++]=i[s+t];return o}getFramebuffer(){const t=this.bindings[this.currentIndex];return t.framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:i}=t;this._swapTexture=i,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:i}=t;if(i instanceof wi)return i;const r=e[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:i={},_targetTexture:r}=t,n=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:i,targetTexture:n}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if("number"!==typeof t||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((t,e,i)=>{i[e]=e}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new hi(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:t,targetTexture:e}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:t,targetTexture:e})}}_updateBinding(t,e){const{sourceBuffers:i,sourceTextures:r,targetTexture:n}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,r),Object.assign(t.sourceBuffers,i),n){t.targetTexture=n;const{width:e,height:i}=n,{framebuffer:r}=t;r?(r.update({attachments:{[36064]:n},resizeAttachments:!1}),r.resize({width:e,height:i})):t.framebuffer=new Xi(this.gl,{id:"transform-framebuffer",width:e,height:i,attachments:{[36064]:n}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const i in e)e[i].setParameters(ra)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const i=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:i}}_createNewTexture(t){const e=Ui(t,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceTextures:e,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:n,targetTextureType:o,inject:a,samplerTextureMap:s}=Jo({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),l=Wo([t.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=s;const u=t._fs||Po({version:Oo(r),input:this.targetTextureVarying,inputType:o,output:na}),c=this.hasSourceTextures||this.targetTextureVarying?[Zo].concat(t.modules||[]):t.modules;return{vs:r,fs:u,modules:c,uniforms:n,inject:l}}}const aa={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function sa(t){const e={};for(const i in t){const r=t[i],n=la(r);e[i]=n}return e}function la(t){let e=ua(t);return"object"===e?t?"type"in t?Object.assign({},t,aa[t.type]):"value"in t?(e=ua(t.value),Object.assign({type:e},t,aa[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},aa[e])}function ua(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const ca="vs",ha="fs";class pa{constructor(t){let{name:e,vs:i,fs:r,dependencies:n=[],uniforms:o,getUniforms:a,deprecations:s=[],defines:l={},inject:u={},vertexShader:c,fragmentShader:h}=t;To("string"===typeof e),this.name=e,this.vs=i||c,this.fs=r||h,this.getModuleUniforms=a,this.dependencies=n,this.deprecations=this._parseDeprecationDefinitions(s),this.defines=l,this.injections=da(u),o&&(this.uniforms=sa(o))}getModuleSource(t){let e;switch(t){case ca:e=this.vs||"";break;case ha:e=this.fs||"";break;default:To(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(e,"// END MODULE_").concat(this.name,"\n\n")}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(i=>{i.regex.test(t)&&(i.deprecated?e.deprecated(i.old,i.new)():e.removed(i.old,i.new)())})}_parseDeprecationDefinitions(t){return t.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={},i=this.uniforms;for(const r in i){const n=i[r];r in t&&!n.private?(n.validate&&To(n.validate(t[r],n),"".concat(this.name,": invalid ").concat(r)),e[r]=t[r]):e[r]=n.value}return e}}function da(t){const e={vs:{},fs:{}};for(const i in t){let r=t[i];const n=i.slice(0,2);"string"===typeof r&&(r={order:0,injection:r}),e[n][i]=r}return e}function fa(t){return ma(ya(t))}function ma(t){const e={},i={};return ga({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((t,e)=>i[e]-i[t]).map(t=>e[t])}function ga(t){let{modules:e,level:i,moduleMap:r,moduleDepth:n}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(void 0===n[o.name]||n[o.name]<i)&&(n[o.name]=i);for(const o of e)o.dependencies&&ga({modules:o.dependencies,level:i+1,moduleMap:r,moduleDepth:n})}function ya(t,e){return t.map(t=>(t instanceof pa||(To("string"!==typeof t,"Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),To(t.name,"shader module has no name"),t=new pa(t),t.dependencies=ya(t.dependencies)),t))}function va(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e="undefined"!==typeof window&&window.navigator||{},i=t.userAgent||e.userAgent||"",r=-1!==i.indexOf("MSIE "),n=-1!==i.indexOf("Trident/");return r||n}const _a=7936,ba=7937,xa=7938,wa=35724,Ta={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Ea={};function Sa(t){return"undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function Aa(t){const e=t.getExtension("WEBGL_debug_renderer_info"),i=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||_a),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||ba),n=Ca(i,r),o={gpuVendor:n,vendor:i,renderer:r,version:t.getParameter(xa),shadingLanguageVersion:t.getParameter(wa)};return o}function Ca(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}Object.keys(Ta).forEach(t=>{Ea[t]=t});const Pa={};function Ia(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=Ta[e];if(To(r,e),!va(i))return!0;if(e in Pa)return Pa[e];const n=r[0],o=i.behavior||"enable",a="#extension GL_".concat(n," : ").concat(o,"\nvoid main(void) {}"),s=t.createShader(35633);t.shaderSource(s,a),t.compileShader(s);const l=t.getShaderParameter(s,35713);return t.deleteShader(s),Pa[e]=l,l}function Ma(t,e){const i=Ta[e];To(i,e);const r=Sa(t)&&i[1]||i[0],n="string"===typeof r?Boolean(t.getExtension(r)):r;return To(!1===n||!0===n),n}function ka(t,e){return e=Array.isArray(e)?e:[e],e.every(e=>Ma(t,e))}function Da(t){const e=Aa(t);switch(e.gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}function La(t,e,i){let r="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return ka(t,Ea.GLSL_FRAG_DEPTH)&&(r+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),ka(t,Ea.GLSL_DERIVATIVES)&&Ia(t,Ea.GLSL_DERIVATIVES)&&(r+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),ka(t,Ea.GLSL_FRAG_DATA)&&Ia(t,Ea.GLSL_FRAG_DATA,{behavior:"require"})&&(r+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),ka(t,Ea.GLSL_TEXTURE_LOD)&&(r+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),r}function Oa(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const Ra=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],za=[...Ra,[Oa("attribute"),"in $1"],[Oa("varying"),"out $1"]],Fa=[...Ra,[Oa("varying"),"in $1"]],Ba=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],Na=[...Ba,[Oa("in"),"attribute $1"],[Oa("out"),"varying $1"]],ja=[...Ba,[Oa("in"),"varying $1"]],Ua="gl_FragColor",Va=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,Ga=/void\s+main\s*\([^)]*\)\s*\{\n?/;function qa(t,e,i){switch(e){case 300:return i?Wa(t,za):Ha(t);case 100:return i?Wa(t,Na):Za(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Wa(t,e){for(const[i,r]of e)t=t.replace(i,r);return t}function Ha(t){t=Wa(t,Fa);const e=t.match(Va);if(e){const i=e[1];t=t.replace(new RegExp("\\b".concat(Ua,"\\b"),"g"),i)}else{const e="fragmentColor";t=t.replace(Ga,t=>"out vec4 ".concat(e,";\n").concat(t)).replace(new RegExp("\\b".concat(Ua,"\\b"),"g"),e)}return t}function Za(t){t=Wa(t,ja);const e=t.match(Va);if(e){const i=e[1];t=t.replace(Va,"").replace(new RegExp("\\b".concat(i,"\\b"),"g"),Ua)}return t}const Xa="\n\n".concat(jo,"\n\n"),Ya={[Fo]:"vertex",[Bo]:"fragment"},Ka="precision highp float;\n\n";function Ja(t,e){const{vs:i,fs:r}=e,n=fa(e.modules||[]);return{gl:t,vs:Qa(t,Object.assign({},e,{source:i,type:Fo,modules:n})),fs:Qa(t,Object.assign({},e,{source:r,type:Bo,modules:n})),getUniforms:$a(n)}}function Qa(t,e){let{id:i,source:r,type:n,modules:o,defines:a={},hookFunctions:s=[],inject:l={},transpileToGLSL100:u=!1,prologue:c=!0,log:h}=e;To("string"===typeof r,"shader source must be a string");const p=n===Fo,d=r.split("\n");let f=100,m="",g=r;0===d[0].indexOf("#version ")?(f=300,m=d[0],g=d.slice(1).join("\n")):m="#version ".concat(f);const y={};o.forEach(t=>{Object.assign(y,t.getDefines())}),Object.assign(y,a);let v=c?"".concat(m,"\n").concat(es({id:i,source:r,type:n}),"\n").concat(ts({type:n}),"\n").concat(Da(t),"\n").concat(La(t,f,!p),"\n").concat(is(y),"\n").concat(p?"":Ka,"\n"):"".concat(m,"\n");const _=ns(s),b={},x={},w={};for(const T in l){const t="string"===typeof l[T]?{injection:l[T],order:0}:l[T],e=T.match(/^(v|f)s:(#)?([\w-]+)$/);if(e){const i=e[2],r=e[3];i?"decl"===r?x[T]=[t]:w[T]=[t]:b[T]=[t]}else w[T]=[t]}for(const T of o){h&&T.checkDeprecations(g,h);const t=T.getModuleSource(n,f);v+=t;const e=T.injections[n];for(const i in e){const t=i.match(/^(v|f)s:#([\w-]+)$/);if(t){const r=t[2],n="decl"===r?x:w;n[i]=n[i]||[],n[i].push(e[i])}else b[i]=b[i]||[],b[i].push(e[i])}}return v+=Xa,v=qo(v,n,x),v+=rs(_[n],b),v+=g,v=qo(v,n,w),v=qa(v,u?100:f,p),v}function $a(t){return function(e){const i={};for(const r of t){const t=r.getUniforms(e,i);Object.assign(i,t)}return i}}function ts(t){let{type:e}=t;return"\n#define SHADER_TYPE_".concat(Ya[e].toUpperCase(),"\n")}function es(t){let{id:e,source:i,type:r}=t;const n=e&&"string"===typeof e&&-1===i.indexOf("SHADER_NAME");return n?"\n#define SHADER_NAME ".concat(e,"_").concat(Ya[r],"\n\n"):""}function is(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,i="";for(const r in t){0===e&&(i+="\n// APPLICATION DEFINES\n"),e++;const n=t[r];(n||Number.isFinite(n))&&(i+="#define ".concat(r.toUpperCase()," ").concat(t[r],"\n"))}return 0===e&&(i+="\n"),i}function rs(t,e){let i="";for(const r in t){const n=t[r];if(i+="void ".concat(n.signature," {\n"),n.header&&(i+="  ".concat(n.header)),e[r]){const t=e[r];t.sort((t,e)=>t.order-e.order);for(const e of t)i+="  ".concat(e.injection,"\n")}n.footer&&(i+="  ".concat(n.footer)),i+="}\n"}return i}function ns(t){const e={vs:{},fs:{}};return t.forEach(t=>{let i;"string"!==typeof t?(i=t,t=i.hook):i={},t=t.trim();const[r,n]=t.split(":"),o=t.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:n})}),e}const os={[5126]:xs.bind(null,"uniform1fv",hs,1,ws),[35664]:xs.bind(null,"uniform2fv",hs,2,ws),[35665]:xs.bind(null,"uniform3fv",hs,3,ws),[35666]:xs.bind(null,"uniform4fv",hs,4,ws),[5124]:xs.bind(null,"uniform1iv",ps,1,ws),[35667]:xs.bind(null,"uniform2iv",ps,2,ws),[35668]:xs.bind(null,"uniform3iv",ps,3,ws),[35669]:xs.bind(null,"uniform4iv",ps,4,ws),[35670]:xs.bind(null,"uniform1iv",ps,1,ws),[35671]:xs.bind(null,"uniform2iv",ps,2,ws),[35672]:xs.bind(null,"uniform3iv",ps,3,ws),[35673]:xs.bind(null,"uniform4iv",ps,4,ws),[35674]:xs.bind(null,"uniformMatrix2fv",hs,4,Ts),[35675]:xs.bind(null,"uniformMatrix3fv",hs,9,Ts),[35676]:xs.bind(null,"uniformMatrix4fv",hs,16,Ts),[35678]:bs,[35680]:bs,[5125]:xs.bind(null,"uniform1uiv",ds,1,ws),[36294]:xs.bind(null,"uniform2uiv",ds,2,ws),[36295]:xs.bind(null,"uniform3uiv",ds,3,ws),[36296]:xs.bind(null,"uniform4uiv",ds,4,ws),[35685]:xs.bind(null,"uniformMatrix2x3fv",hs,6,Ts),[35686]:xs.bind(null,"uniformMatrix2x4fv",hs,8,Ts),[35687]:xs.bind(null,"uniformMatrix3x2fv",hs,6,Ts),[35688]:xs.bind(null,"uniformMatrix3x4fv",hs,12,Ts),[35689]:xs.bind(null,"uniformMatrix4x2fv",hs,8,Ts),[35690]:xs.bind(null,"uniformMatrix4x3fv",hs,12,Ts),[35678]:bs,[35680]:bs,[35679]:bs,[35682]:bs,[36289]:bs,[36292]:bs,[36293]:bs,[36298]:bs,[36299]:bs,[36300]:bs,[36303]:bs,[36306]:bs,[36307]:bs,[36308]:bs,[36311]:bs},as={},ss={},ls={},us=[0];function cs(t,e,i,r){1===e&&"boolean"===typeof t&&(t=t?1:0),Number.isFinite(t)&&(us[0]=t,t=us);const n=t.length;if(n%e&&$.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof i)return t;let o=r[n];o||(o=new i(n),r[n]=o);for(let a=0;a<n;a++)o[a]=t[a];return o}function hs(t,e){return cs(t,e,Float32Array,as)}function ps(t,e){return cs(t,e,Int32Array,ss)}function ds(t,e){return cs(t,e,Uint32Array,ls)}function fs(t,e,i){const r=os[i.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(i.type));return r().bind(null,t,e)}function ms(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,i=t.match(e);if(!i||i.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:i[1],length:i[2]||1,isArray:Boolean(i[2])}}function gs(t,e,i){for(const r in t){const n=t[r],o=!i||Boolean(i[r]);if(o&&!ys(n))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),n),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function ys(t){return Array.isArray(t)||ArrayBuffer.isView(t)?_s(t):!!isFinite(t)||(!0===t||!1===t||(t instanceof _i||(t instanceof Ai||t instanceof Xi&&Boolean(t.texture))))}function vs(t,e,i){if(Array.isArray(i)||ArrayBuffer.isView(i))if(t[e]){const r=t[e];for(let t=0,e=i.length;t<e;++t)r[t]=i[t]}else t[e]=i.slice();else t[e]=i}function _s(t){if(0===t.length)return!1;const e=Math.min(t.length,16);for(let i=0;i<e;++i)if(!Number.isFinite(t[i]))return!1;return!0}function bs(){let t=null;return(e,i,r)=>{const n=t!==r;return n&&(e.uniform1i(i,r),t=r),n}}function xs(t,e,i,r){let n=null,o=null;return(a,s,l)=>{const u=e(l,i),c=u.length;let h=!1;if(null===n)n=new Float32Array(c),o=c,h=!0;else{Ve(o===c,"Uniform length cannot change.");for(let t=0;t<c;++t)if(u[t]!==n[t]){h=!0;break}}return h&&(r(a,t,s,u),n.set(u)),h}}function ws(t,e,i,r){t[e](i,r)}function Ts(t,e,i,r){t[e](i,!1,r)}function Es(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(i);return r?r[1]:e}const Ss=35632,As=35633;function Cs(t){switch(t){case Ss:return"fragment";case As:return"vertex";default:return"unknown type"}}function Ps(t,e,i,r){const n=t.split(/\r?\n/),o={},a={},s=r||Es(e)||"(unnamed)",l="".concat(Cs(i)," shader ").concat(s);for(let c=0;c<n.length;c++){const e=n[c];if(e.length<=1)continue;const i=e.split(":"),r=i[0],s=parseInt(i[2],10);if(isNaN(s))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));"WARNING"!==r?o[s]=e:a[s]=e}const u=Ms(e);return{shaderName:l,errors:Is(o,u),warnings:Is(a,u)}}function Is(t,e){let i="";for(let r=0;r<e.length;r++){const n=e[r];if((t[r+3]||t[r+2]||t[r+1])&&(i+="".concat(n,"\n"),t[r+1])){const e=t[r+1],n=e.split(":",3),o=n[0],a=parseInt(n[1],10)||0,s=e.substring(n.join(":").length+1).trim();i+=ks("^^^ ".concat(o,": ").concat(s,"\n\n"),a)}}return i}function Ms(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ";const r=t.split(/\r?\n/),n=String(r.length+e-1).length;return r.map((t,r)=>{const o=String(r+e),a=o.length,s=ks(o,n-a);return s+i+t})}function ks(t,e){let i="";for(let r=0;r<e;++r)i+=" ";return"".concat(i).concat(t)}const Ds="Shader: GLSL source code must be a JavaScript string";class Ls extends Je{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Ve(!1),"unknown"}}constructor(t,e){at(t),Ve("string"===typeof e.source,Ds);const i=Es(e.source,null)||e.id||He("unnamed ".concat(Ls.getTypeName(e.shaderType)));super(t,{id:i}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const i=Es(e,null);i&&(this.id=He(i)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(Ls.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Es(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;t.startsWith("#version ")||(t="#version 100\n".concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);const e=this.getParameter(35713);if(!e){const t=this.gl.getShaderInfoLog(this.handle),{shaderName:e,errors:i,warnings:r}=Ps(t,this.source,this.shaderType,this.id);throw $.error("GLSL compilation errors in ".concat(e,"\n").concat(i))(),$.warn("GLSL compilation warnings in ".concat(e,"\n").concat(r))(),new Error("GLSL compilation errors in ".concat(e))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Os extends Ls{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){"string"===typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Rs extends Ls{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){"string"===typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const zs=5120,Fs=5121,Bs=5122,Ns=5123,js=0,Us=1,Vs=2,Gs=3,qs=4,Ws=5,Hs=6,Zs=5126,Xs=35664,Ys=35665,Ks=35666,Js=5124,Qs=35667,$s=35668,tl=35669,el=5125,il=36294,rl=36295,nl=36296,ol=35670,al=35671,sl=35672,ll=35673,ul=35674,cl=35675,hl=35676,pl=35685,dl=35686,fl=35687,ml=35688,gl=35689,yl=35690,vl={[Zs]:[Zs,1,"float"],[Xs]:[Zs,2,"vec2"],[Ys]:[Zs,3,"vec3"],[Ks]:[Zs,4,"vec4"],[Js]:[Js,1,"int"],[Qs]:[Js,2,"ivec2"],[$s]:[Js,3,"ivec3"],[tl]:[Js,4,"ivec4"],[el]:[el,1,"uint"],[il]:[el,2,"uvec2"],[rl]:[el,3,"uvec3"],[nl]:[el,4,"uvec4"],[ol]:[Zs,1,"bool"],[al]:[Zs,2,"bvec2"],[sl]:[Zs,3,"bvec3"],[ll]:[Zs,4,"bvec4"],[ul]:[Zs,8,"mat2"],[pl]:[Zs,8,"mat2x3"],[dl]:[Zs,8,"mat2x4"],[cl]:[Zs,12,"mat3"],[fl]:[Zs,12,"mat3x2"],[ml]:[Zs,12,"mat3x4"],[hl]:[Zs,16,"mat4"],[gl]:[Zs,16,"mat4x2"],[yl]:[Zs,16,"mat4x3"]};function _l(t){switch(t){case js:return js;case Us:return Us;case Gs:return Us;case Vs:return Us;case qs:return qs;case Ws:return qs;case Hs:return qs;default:return Ve(!1),0}}function bl(t){const e=vl[t];if(!e)return null;const[i,r]=e;return{type:i,components:r}}function xl(t,e){switch(t){case zs:case Fs:case Bs:case Ns:t=Zs;break;default:}for(const i in vl){const[r,n,o]=vl[i];if(r===t&&n===e)return{glType:i,name:o}}return null}class wl{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,i=e.getProgramParameter(t.handle,35721);for(let r=0;r<i;r++){const{name:i,type:n,size:o}=e.getActiveAttrib(t.handle,r),a=e.getAttribLocation(t.handle,i);a>=0&&this._addAttribute(a,i,n,o)}this.attributeInfos.sort((t,e)=>t.location-e.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!nt(e))return;const i=e.getProgramParameter(t.handle,35971);for(let r=0;r<i;r++){const{name:i,type:n,size:o}=e.getTransformFeedbackVarying(t.handle,r);this._addVarying(r,i,n,o)}this.varyingInfos.sort((t,e)=>t.location-e.location)}_addAttribute(t,e,i,r){const{type:n,components:o}=bl(i),a={type:n,size:r*o};this._inferProperties(t,e,a);const s={location:t,name:e,accessor:new ai(a)};this.attributeInfos.push(s),this.attributeInfosByLocation[t]=s,this.attributeInfosByName[s.name]=s}_inferProperties(t,e,i){/instance/i.test(e)&&(i.divisor=1)}_addVarying(t,e,i,r){const{type:n,components:o}=bl(i),a=new ai({type:n,size:r*o}),s={location:t,name:e,accessor:a};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}const Tl=4,El=35981,Sl=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Al extends Je{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",Sl),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{hash:e,vs:i,fs:r,varyings:n,bufferMode:o=El}=t;return this.hash=e||"",this.vs="string"===typeof i?new Os(this.gl,{id:"".concat(t.id,"-vs"),source:i}):i,this.fs="string"===typeof r?new Rs(this.gl,{id:"".concat(t.id,"-fs"),source:r}):r,Ve(this.vs instanceof Os),Ve(this.fs instanceof Rs),this.uniforms={},this._textureUniforms={},n&&n.length>0&&(st(this.gl),this.varyings=n,this.gl2.transformFeedbackVaryings(this.handle,n,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new wl(this),this.setProps(t)}delete(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:i=4,vertexCount:r,offset:n=0,start:o,end:a,isIndexed:s=!1,indexType:l=5123,instanceCount:u=0,isInstanced:c=u>0,vertexArray:h=null,transformFeedback:p,framebuffer:d,parameters:f={},uniforms:m,samplers:g}=t;if((m||g)&&($.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(m||{})),$.priority>=e){const t=d?d.id:"default",n="mode=".concat(qe(this.gl,i)," verts=").concat(r," ")+"instances=".concat(u," indexType=").concat(qe(this.gl,l)," ")+"isInstanced=".concat(c," isIndexed=").concat(s," ")+"Framebuffer=".concat(t);$.log(e,n)()}return Ve(h),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===r||c&&0===u)&&(h.bindForDraw(r,u,()=>{if(void 0!==d&&(f=Object.assign({},f,{framebuffer:d})),p){const t=_l(i);p.begin(t)}this._bindTextures(),ge(this.gl,f,()=>{s&&c?this.gl2.drawElementsInstanced(i,r,l,n,u):s&&nt(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,l,n):s?this.gl.drawElements(i,r,l,n):c?this.gl2.drawArraysInstanced(i,n,r,u):this.gl.drawArrays(i,n,r)}),p&&p.end()}),!0)}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$.priority>=2&&gs(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const i=t[e],r=this._uniformSetters[e];if(r){let t=i,n=!1;if(t instanceof Xi&&(t=t.texture),t instanceof _i)if(n=this.uniforms[e]!==i,n){void 0===r.textureIndex&&(r.textureIndex=this._textureIndexCounter++);const i=t,{textureIndex:n}=r;i.bind(n),t=n,this._textureUniforms[e]=i}else t=r.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(r(t)||n)&&vs(this.uniforms,e,i)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const i=this._textureUniforms[e];i.update(),t=t&&i.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),i={};for(const r of e){const t=this.gl.getShaderParameter(this.handle,35663);switch(t){case 35633:i.vs=new Os({handle:r});break;case 35632:i.fs=new Rs({handle:r});break;default:}}return i}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const t=this._getName();this.id=He(t)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),$.time(Tl,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),$.timeEnd(Tl,"linkProgram for ".concat(this._getName()))(),t.debug||$.level>0){const e=t.getProgramParameter(this.handle,35714);if(!e)throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));t.validateProgram(this.handle);const i=t.getProgramParameter(this.handle,35715);if(!i)throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const i=this.gl.getActiveUniform(this.handle,e),{name:r}=ms(i.name);let n=t.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=fs(t,n,i),i.size>1)for(let e=0;e<i.size;e++)n=t.getUniformLocation(this.handle,"".concat(r,"[").concat(e,"]")),this._uniformSetters["".concat(r,"[").concat(e,"]")]=fs(t,n,i)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}class Cl{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new Cl(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e="string"===typeof t?t:t.name;this._defaultModules=this._defaultModules.filter(t=>t.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{vs:e="",fs:i="",defines:r={},inject:n={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:s=!1}=t,l=this._getModuleList(t.modules),u=this._getHash(e),c=this._getHash(i),h=l.map(t=>this._getHash(t.name)).sort(),p=o.map(t=>this._getHash(t)),d=Object.keys(r).sort(),f=Object.keys(n).sort(),m=[],g=[];for(const v of d)m.push(this._getHash(v)),m.push(this._getHash(r[v]));for(const v of f)g.push(this._getHash(v)),g.push(this._getHash(n[v]));const y="".concat(u,"/").concat(c,"D").concat(m.join("/"),"M").concat(h.join("/"),"I").concat(g.join("/"),"V").concat(p.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(s?"T":"");if(!this._programCache[y]){const t=Ja(this.gl,{vs:e,fs:i,modules:l,inject:n,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:s});this._programCache[y]=new Al(this.gl,{hash:y,vs:t.vs,fs:t.fs,varyings:o,bufferMode:a}),this._getUniforms[y]=t.getUniforms||(t=>{}),this._useCounts[y]=0}return this._useCounts[y]++,this._programCache[y]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return void 0===this._hashes[t]&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),i={};let r=0;for(let n=0,o=this._defaultModules.length;n<o;++n){const t=this._defaultModules[n],o=t.name;e[r++]=t,i[o]=!0}for(let n=0,o=t.length;n<o;++n){const o=t[n],a=o.name;i[a]||(e[r++]=o,i[a]=!0)}return e.length=r,e}}let Pl=null;function Il(t){return(!Pl||Pl.byteLength<t)&&(Pl=new ArrayBuffer(t)),Pl}function Ml(t,e){const i=Il(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function kl(t){let{target:e,source:i,start:r=0,count:n=1}=t;const o=i.length,a=n*o;let s=0;for(let l=r;s<o;s++)e[l++]=i[s];while(s<a)s<a-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+a-s),s=a);return e}var Dl=i("791f");const Ll="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ol extends Je{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!e.constantAttributeZero||(nt(t)||"Chrome"===Object(Dl["a"])())}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new Ol(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return Ol.MAX_ATTRIBUTES=Ol.MAX_ATTRIBUTES||t.getParameter(34921),Ol.MAX_ATTRIBUTES}static setConstant(t,e,i){switch(i.constructor){case Float32Array:Ol._setConstantFloatArray(t,e,i);break;case Int32Array:Ol._setConstantIntArray(t,e,i);break;case Uint32Array:Ol._setConstantUintArray(t,e,i);break;default:Ve(!1)}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ol.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Ve(!t||34963===t.target,Ll),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,i){if(34963===e.target)return this.setElementBuffer(e,i);const{size:r,type:n,stride:o,offset:a,normalized:s,integer:l,divisor:u}=i,{gl:c,gl2:h}=this;return t=Number(t),this.bind(()=>{c.bindBuffer(34962,e.handle),l?(Ve(nt(c)),h.vertexAttribIPointer(t,r,n,o,a)):c.vertexAttribPointer(t,r,n,s,o,a),c.enableVertexAttribArray(t),h.vertexAttribDivisor(t,u||0)}),this}enable(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=!e&&0===t&&!Ol.isSupported(this.gl,{constantAttributeZero:!0});return i||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const i=this._normalizeConstantArrayValue(e),r=i.byteLength*t,n=i.length*t;let o=!this.buffer;if(this.buffer=this.buffer||new hi(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const t=Ml(e.constructor,n);kl({target:t,source:i,start:0,count:n}),this.buffer.subData(t),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}static _setConstantFloatArray(t,e,i){switch(i.length){case 1:t.vertexAttrib1fv(e,i);break;case 2:t.vertexAttrib2fv(e,i);break;case 3:t.vertexAttrib3fv(e,i);break;case 4:t.vertexAttrib4fv(e,i);break;default:Ve(!1)}}static _setConstantIntArray(t,e,i){switch(Ve(nt(t)),i.length){case 1:t.vertexAttribI1iv(e,i);break;case 2:t.vertexAttribI2iv(e,i);break;case 3:t.vertexAttribI3iv(e,i);break;case 4:t.vertexAttribI4iv(e,i);break;default:Ve(!1)}}static _setConstantUintArray(t,e,i){switch(Ve(nt(t)),i.length){case 1:t.vertexAttribI1uiv(e,i);break;case 2:t.vertexAttribI2uiv(e,i);break;case 3:t.vertexAttribI3uiv(e,i);break;case 4:t.vertexAttribI4uiv(e,i);break;default:Ve(!1)}}_createHandle(){const t=this.gl;return t.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:i}=e;return Ve(Number.isFinite(i)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(i,t);default:return this.gl.getVertexAttrib(i,t)}})}}const Rl="VertexArray: attributes must be Buffers or constants (i.e. typed array)",zl=/^(.+)__LOCATION_([0-9]+)$/,Fl=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Bl{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e.id||e.program&&e.program.id;this.id=i,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ol(t),Ye(this,"VertexArray","v6.0",Fl),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const i=t[e];this._setAttribute(e,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,i);const{location:r,accessor:n}=this._resolveLocationAndAccessor(t,e,e.accessor,i);return r>=0&&(this.values[r]=e,this.accessors[r]=n,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,e,n)),this}setConstant(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{location:r,accessor:n}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},i));return r>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[r]=e,this.accessors[r]=n,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new hi(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof hi&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof hi&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),r=i()}),r}_resolveLocationAndAccessor(t,e,i,r){const n={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(t);if(!Number.isFinite(o)||o<0)return this.unused[t]=e,$.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),n;const s=this._getAttributeInfo(a||o);if(!s)return n;const l=this.accessors[o]||{},u=ai.resolve(s.accessor,l,i,r),{size:c,type:h}=u;return Ve(Number.isFinite(c)&&Number.isFinite(h)),{location:o,accessor:u}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const i=zl.exec(t),r=i?i[1]:t,n=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+n,name:r}:{location:-1}}_setAttribute(t,e){if(e instanceof hi)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof hi){const i=e[0],r=e[1];this.setBuffer(t,i,r)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const i=e;this.setConstant(t,i)}else{if(!(e.buffer instanceof hi))throw new Error(Rl);{const i=e;this.setBuffer(t,i.buffer,i)}}}_setConstantAttributes(t,e){const i=Math.max(0|t,0|e);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let n=1;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)r=this.values[n],ArrayBuffer.isView(r)&&this._setConstantAttribute(n,r)}_setConstantAttributeZero(t,e){if(Ol.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,t);const i=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(t,e){Ol.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const i=this.values[e],r=this.accessors[e];if(!i)return;const{divisor:n}=r,o=n>0;if(t.isInstanced=t.isInstanced||o,i instanceof hi){const e=i;if(o){const i=e.getVertexCount(r);t.instanceCount=Math.min(t.instanceCount,i)}else{const i=e.getVertexCount(r);t.vertexCount=Math.min(t.vertexCount,i)}}}setElements(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function Nl(t,e){const{maxElts:i=16,size:r=1}=e;let n="[";for(let a=0;a<t.length&&a<i;++a)a>0&&(n+=",".concat(a%r===0?" ":"")),n+=jl(t[a],e);const o=t.length>i?"...":"]";return"".concat(n).concat(o)}function jl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return Nl(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<i)return r?"0":"0.";if(r)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const n=t.toPrecision(2),o=n.indexOf(".0");return o===n.length-2?n.slice(0,-1):n}function Ul(t){let{vertexArray:e,header:i="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=Vl(e,e.elements,null,i));const n=e.values;for(const o in n){const t=e._getAttributeInfo(o);if(t){let a="".concat(o,": ").concat(t.name);const s=e.accessors[t.location];s&&(a="".concat(o,": ").concat(Gl(t.name,s))),r[a]=Vl(e,n[o],s,i)}}return r}function Vl(t,e,i,r){const{gl:n}=t;if(!e)return{[r]:"null","Format ":"N/A"};let o,a,s,l="NOT PROVIDED",u=1,c=0,h=0;if(i&&(l=i.type,u=i.size,l=String(l).replace("Array",""),o=-1!==l.indexOf("nt")),e instanceof hi){const t=e,{data:p,changed:d}=t.getDebugData();let f;if(a=d?"*":"",s=p,h=t.byteLength,c=h/p.BYTES_PER_ELEMENT/u,i){const t=i.divisor>0;f="".concat(t?"I ":"P "," ").concat(c," (x").concat(u,"=").concat(h," bytes ").concat(qe(n,l),")")}else o=!0,f="".concat(h," bytes");return{[r]:"".concat(a).concat(jl(s,{size:u,isInteger:o})),"Format ":f}}return s=e,u=e.length,l=String(e.constructor.name).replace("Array",""),o=-1!==l.indexOf("nt"),{[r]:"".concat(jl(s,{size:u,isInteger:o})," (constant)"),"Format ":"".concat(u,"x").concat(l," (constant)")}}function Gl(t,e){const{type:i,size:r}=e,n=xl(i,r);return n?"".concat(t," (").concat(n.name,")"):t}function ql(t){let{header:e="Uniforms",program:i,uniforms:r,undefinedOnly:n=!1}=t;Ve(i);const o=".*_.*",a=".*Matrix",s=i._uniformSetters,l={},u=Object.keys(s).sort();let c=0;for(const d of u)d.match(o)||d.match(a)||Wl({table:l,header:e,uniforms:r,uniformName:d,undefinedOnly:n})&&c++;for(const d of u)d.match(a)&&Wl({table:l,header:e,uniforms:r,uniformName:d,undefinedOnly:n})&&c++;for(const d of u)l[d]||Wl({table:l,header:e,uniforms:r,uniformName:d,undefinedOnly:n})&&c++;let h=0;const p={};if(!n)for(const d in r){const t=r[d];l[d]||(h++,p[d]={Type:"NOT USED: ".concat(t),[e]:jl(t)})}return{table:l,count:c,unusedTable:p,unusedCount:h}}function Wl(t){let{table:e,header:i,uniforms:r,uniformName:n,undefinedOnly:o}=t;const a=r[n],s=Hl(a);return(!o||!s)&&(e[n]={[i]:s?jl(a):"N/A","Uniform Type":s?a:"NOT PROVIDED"},!0)}function Hl(t){return void 0!==t&&null!==t}function Zl(t){const e={},i="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const t=Xl(r);e["in ".concat(t)]={[i]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const t=Xl(r);e["out ".concat(t)]={[i]:JSON.stringify(r.accessor)}}return e}function Xl(t){const{type:e,size:i}=t.accessor,r=xl(e,i);return r?"".concat(r.name," ").concat(t.name):t.name}const Yl={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Kl(t,e,i){const r={};let n=e.indices;for(const o in e.attributes){const a=e.attributes[o],s=Jl(o,i);if("indices"===o)n=a;else if(a.constant)r[s]=a.value;else{const e=a.value,i={...a};delete i.value,r[s]=[new hi(t,e),i],Ql(o,i)}}if(n){const e=n.value||n;Ve(e instanceof Uint16Array||e instanceof Uint32Array,'attribute array for "indices" must be of integer type');const i={size:1,isIndexed:void 0===n.isIndexed||n.isIndexed};r.indices=[new hi(t,{data:e,target:34963}),i]}return r}function Jl(t,e){const{attributeMap:i=Yl}=e||{};return i&&i[t]||t}function Ql(t,e){let i;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":i="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":i="vectors";break;default:}switch(i){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break;default:}Ve(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const $l=2,tu=1e4,eu="Model needs drawMode and vertexCount",iu=()=>{},ru={};class nu{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:i=He("model")}=e;Ve(rt(t)),this.id=i,this.gl=t,this.id=e.id||He("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||Cl.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:i,fs:r,modules:n,defines:o,inject:a,varyings:s,bufferMode:l,transpileToGLSL100:u}=t;this.programProps={program:e,vs:i,fs:r,modules:n,defines:o,inject:a,varyings:s,bufferMode:l,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Ve(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),eu)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:i,fs:r,modules:n,defines:o,inject:a,varyings:s,bufferMode:l,transpileToGLSL100:u}=t;this.programProps={program:e,vs:i,fs:r,modules:n,defines:o,inject:a,varyings:s,bufferMode:l,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return Ve(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return Ve(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Kl(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Xe(t))return this;const e={};for(const i in t){const r=t[i];e[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return Ri(this.program.gl,t),this}draw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:i,uniforms:r={},attributes:n={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:s=this.vertexArray}=t;let l;this.setAttributes(n),this.updateModuleSettings(e),this.setUniforms(r),$.priority>=$l&&(l=this._logDrawCallStart($l));const u=this.vertexArray.getDrawParams(),{isIndexed:c=u.isIndexed,indexType:h=u.indexType,indexOffset:p=u.indexOffset,vertexArrayInstanced:d=u.isInstanced}=this.props;d&&!this.isInstanced&&$.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:f,instanceCount:m}=this,{onBeforeRender:g=iu,onAfterRender:y=iu}=this.props;g(),this.program.setUniforms(this.uniforms);const v=this.program.draw(Object.assign(ru,t,{logPriority:l,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:s,transformFeedback:o,isIndexed:c,indexType:h,isInstanced:f,instanceCount:m,offset:c?p:0}));return y(),$.priority>=$l&&this._logDrawCallEnd(l,s,i),v}transform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{discard:e=!0,feedbackBuffers:i,unbindModels:r=[]}=t;let{parameters:n}=t;i&&this._setFeedbackBuffers(i),e&&(n=Object.assign({},n,{[35977]:e})),r.forEach(t=>t.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:n}))}finally{r.forEach(t=>t.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){const t=this._programDirty||this.programManager.stateHash!==this._programManagerState;if(!t)return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:t,fs:i,modules:r,inject:n,defines:o,varyings:a,bufferMode:s,transpileToGLSL100:l}=this.programProps;e=this.programManager.get({vs:t,fs:i,modules:r,inject:n,defines:o,varyings:a,bufferMode:s,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Ve(e instanceof Al,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Bl(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof hi&&e.delete()}}_setAnimationProps(t){this.animated&&Ve(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Xe(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new Do(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:tu;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),$.group($l,">>> DRAWING MODEL ".concat(this.id),{collapsed:$.level<=2})(),t}_logDrawCallEnd(t,e,i,r){if(void 0===t)return;const n=Ul({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:s}=ql({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:l,count:u}=ql({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});u>0&&$.log("MISSING UNIFORMS",Object.keys(l))(),s>0&&$.log("UNUSED UNIFORMS",Object.keys(a))();const c=Zl(this.vertexArray.configuration);$.table(t,n)(),$.table(t,o)(),$.table(t+1,c)(),r&&r.log({logLevel:$l,message:"Rendered to ".concat(r.id)}),$.groupEnd($l)()}}class ou{static isSupported(t){return nt(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:i}=this;t&&t.delete(),e&&e.delete(),i&&i.delete()}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clearRenderTarget:e=!0}=t,i=this._updateDrawOptions(t);e&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of e)t=t||i.swap();Ve(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of e){const e=i.getData(t);if(e)return e}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of e)i.update(t)}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new nu(e,Object.assign({},t,{fs:t.fs||Po({version:Oo(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)e=r.updateModelProps(e);return e}_buildResourceTransforms(t,e){au(e)&&(this.bufferTransform=new Lo(t,e)),su(e)&&(this.textureTransform=new oa(t,e)),Ve(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)e=Object.assign(e,r.getDrawOptions(e));return e}}function au(t){return!(Xe(t.feedbackBuffers)&&Xe(t.feedbackMap)&&!(t.varyings&&t.varyings.length>0))}function su(t){return!(Xe(t._sourceTextures)&&!t._targetTexture&&!t._targetTextureVarying)}function lu(){}const uu={onStart:lu,onUpdate:lu,onInterrupt:lu,onEnd:lu};class cu{constructor(t){this._inProgress=!1,this._handle=null,this.timeline=t,this.settings={}}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings={...uu,...t},this._inProgress=!0,this.settings.onStart(this)}end(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}cancel(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}class hu{constructor({gl:t,attribute:e,timeline:i}){this.gl=t,this.type="interpolation",this.transition=new cu(i),this.attribute=e,this.attributeInTransition=new _o(t,e.settings),this.currentStartIndices=e.startIndices,this.currentLength=0,this.transform=du(t,e);const r={byteLength:0,usage:35050};this.buffers=[new hi(t,r),new hi(t,r)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0)return void this.transition.cancel();const{gl:i,buffers:r,attribute:n}=this;go(r);const o={numInstances:e,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const a of r)vo({buffer:a,...o});this.currentStartIndices=n.startIndices,this.currentLength=yo(n,e),this.attributeInTransition.update({buffer:r[1],value:n.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aFrom:r[0],aTo:fo(i,n)},feedbackBuffers:{vCurrent:r[1]}})}update(){const t=this.transition.update();if(t){const{time:t,settings:{duration:e,easing:i}}=this.transition,r=i(t/e);this.transform.run({uniforms:{time:r}})}return t}cancel(){this.transition.cancel(),this.transform.delete();while(this.buffers.length)this.buffers.pop().delete()}}const pu="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";function du(t,e){const i=mo(e.size);return new ou(t,{vs:pu,defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"]})}class fu{constructor({gl:t,attribute:e,timeline:i}){this.gl=t,this.type="spring",this.transition=new cu(i),this.attribute=e,this.attributeInTransition=new _o(t,{...e.settings,normalized:!1}),this.currentStartIndices=e.startIndices,this.currentLength=0,this.texture=gu(t),this.framebuffer=yu(t,this.texture),this.transform=mu(t,e,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new hi(t,r),new hi(t,r),new hi(t,r)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:i,buffers:r,attribute:n}=this,o={numInstances:e,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const a of r)vo({buffer:a,...o});this.currentStartIndices=n.startIndices,this.currentLength=yo(n,e),this.attributeInTransition.update({buffer:r[1],value:n.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aTo:fo(i,n)}})}update(){const{buffers:t,transform:e,framebuffer:i,transition:r}=this,n=r.update();if(!n)return!1;e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:r.settings.stiffness,damping:r.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),go(t),this.attributeInTransition.update({buffer:t[1],value:this.attribute.value});const o=Gi(i)[0]>0;return o||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();while(this.buffers.length)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}function mu(t,e,i){const r=mo(e.size);return new ou(t,{framebuffer:i,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function gu(t){return new wi(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function yu(t,e){return new Xi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const vu={interpolation:hu,spring:fu};class _u{constructor(t,{id:e,timeline:i}){this.id=e,this.gl=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ou.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:i}){this.numInstances=i||1;for(const r in t){const i=t[r],n=i.getTransitionSetting(e);n&&this._updateAttribute(r,i,n)}for(const r in this.transitions){const i=t[r];i&&i.getTransitionSetting(e)||this._removeTransition(r)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const i=this.transitions[e];i.inProgress&&(t[e]=i.attributeInTransition)}return t}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const e in this.transitions){const t=this.transitions[e].update();t&&(this.needsRedraw=!0)}const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,i){const r=this.transitions[t];let n=!r||r.type!==i.type;if(n){if(!this.isSupported)return void Y.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();r&&this._removeTransition(t);const o=vu[i.type];o?this.transitions[t]=new o({attribute:e,timeline:this.timeline,gl:this.gl}):(Y.error("unsupported transition type '".concat(i.type,"'"))(),n=!1)}(n||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const bu="attributeManager.invalidate",xu="attributeManager.updateStart",wu="attributeManager.updateEnd",Tu="attribute.updateStart",Eu="attribute.allocate",Su="attribute.updateEnd";class Au{constructor(t,{id:e="attribute-manager",stats:i,timeline:r}={}){this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new _u(t,{id:"".concat(e,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(t=!0){return this.needsRedraw=!0,this}add(t,e){this._add(t,e)}addInstanced(t,e){this._add(t,e,{instanced:1})}remove(t){for(let e=0;e<t.length;e++){const i=t[e];void 0!==this.attributes[i]&&(this.attributes[i].delete(),delete this.attributes[i])}}invalidate(t,e){const i=this._invalidateTrigger(t,e);wo(bu,this,t,i)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);wo(bu,this,"all")}update({data:t,numInstances:e,startIndices:i=null,transitions:r,props:n={},buffers:o={},context:a={}}={}){let s=!1;wo(xu,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const r=this.attributes[l],u=r.settings.accessor;r.startIndices=i,n[l]&&Y.removed("props.".concat(l),"data.attributes.".concat(l))(),r.setExternalBuffer(o[l])||r.setBinaryValue(o[u],t.startIndices)||!o[u]&&r.setConstantValue(n[u])||r.needsUpdate()&&(s=!0,this._updateAttribute({attribute:r,numInstances:e,data:t,props:n,context:a})),this.needsRedraw|=r.needsRedraw()}s&&wo(wu,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:r})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const n in e){const o=e[n];o.needsRedraw(t)&&!i.hasAttribute(n)&&(r[n]=o)}return r}getShaderAttributes(t,e={}){t||(t=this.getAttributes());const i={};for(const r in t)e[r]||Object.assign(i,t[r].getShaderAttributes());return i}getAccessors(){return this.updateTriggers}_add(t,e,i={}){e&&Y.warn("AttributeManager.add({updaters}) - updater map no longer supported")();for(const r in t){const e=t[r];this.attributes[r]=this._createAttribute(r,e,i)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,i){const r={...e,id:t,isIndexed:e.isIndexed||e.elements||!1,constant:e.constant||!1,size:(e.elements?1:e.size)||1,value:e.value||null,divisor:e.instanced||i.instanced?1:e.divisor||0};return new _o(this.gl,r)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes){const i=this.attributes[e];i.getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(e)})}this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:i,updateTriggers:r}=this,n=r[t];return n&&n.forEach(t=>{const r=i[t];r&&r.setNeedsUpdate(r.id,e)}),n}_updateAttribute(t){const{attribute:e,numInstances:i}=t;if(wo(Tu,e),e.constant)return void e.setConstantValue(e.value);e.allocate(i)&&wo(Eu,e,i);const r=e.updateBuffer(t);r&&(this.needsRedraw=!0,wo(Su,e,i))}}class Cu extends cu{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:i,duration:r,easing:n}}=this,o=n(t/r);this._value=gr(e,i,o)}}const Pu=1e-5;function Iu(t,e,i,r,n){const o=e-t,a=i-e,s=a*n,l=-o*r;return s+l+o+e}function Mu(t,e,i,r,n){if(Array.isArray(i)){const o=[];for(let a=0;a<i.length;a++)o[a]=Iu(t[a],e[a],i[a],r,n);return o}return Iu(t,e,i,r,n)}function ku(t,e){if(Array.isArray(t)){let i=0;for(let r=0;r<t.length;r++){const n=t[r]-e[r];i+=n*n}return Math.sqrt(i)}return Math.abs(t-e)}class Du extends cu{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:i,stiffness:r}=this.settings,{_prevValue:n=t,_currValue:o=t}=this;let a=Mu(n,o,e,i,r);const s=ku(a,e),l=ku(a,o);s<Pu&&l<Pu&&(a=e,this.end()),this._prevValue=o,this._currValue=a}}const Lu={interpolation:Cu,spring:Du};class Ou{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,i,r){const{transitions:n}=this;if(n.has(t)){const i=n.get(t),{value:r=i.settings.fromValue}=i;e=r,this.remove(t)}if(r=po(r),!r)return;const o=Lu[r.type];if(!o)return void Y.error("unsupported transition type '".concat(r.type,"'"))();const a=new o(this.timeline);a.start({...r,fromValue:e,toValue:i}),n.set(t,a)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,i]of this.transitions)i.update(),t[e]=i.value,i.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}const Ru={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},zu={COMPONENT:Symbol.for("component"),ASYNC_DEFAULTS:Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL:Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED:Symbol.for("asyncPropResolved")},{COMPONENT:Fu}=zu;function Bu(t){const e=Zu(t);for(const i in e){const r=e[i],{validate:n}=r;if(n&&!n(t[i],r))throw new Error("Invalid prop ".concat(i,": ").concat(t[i]))}}function Nu(t,e){const i=Uu({newProps:t,oldProps:e,propTypes:Zu(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=Gu(t,e);let n=!1;return r||(n=qu(t,e)),{dataChanged:r,propsChanged:i,updateTriggersChanged:n,extensionsChanged:Wu(t,e),transitionsChanged:ju(t,e)}}function ju(t,e){if(!t.transitions)return null;const i={},r=Zu(t);for(const n in t.transitions){const o=r[n],a=o&&o.type,s="number"===a||"color"===a||"array"===a;s&&Vu(t[n],e[n],o)&&(i[n]=!0)}return i}function Uu({newProps:t,oldProps:e,ignoreProps:i={},propTypes:r={},triggerName:n="props"}={}){if(e===t)return null;if("object"!==typeof t||null===t)return"".concat(n," changed shallowly");if("object"!==typeof e||null===e)return"".concat(n," changed shallowly");for(const o of Object.keys(t))if(!(o in i)){if(!(o in e))return"".concat(n,".").concat(o," added");const i=Vu(t[o],e[o],r[o]);if(i)return"".concat(n,".").concat(o," ").concat(i)}for(const o of Object.keys(e))if(!(o in i)){if(!(o in t))return"".concat(n,".").concat(o," dropped");if(!Object.hasOwnProperty.call(t,o)){const i=Vu(t[o],e[o],r[o]);if(i)return"".concat(n,".").concat(o," ").concat(i)}}return null}function Vu(t,e,i){let r=i&&i.equal;return r&&!r(t,e,i)?"changed deeply":r||(r=t&&e&&t.equals,!r||r.call(t,e))?r||e===t?null:"changed shallowly":"changed deeply"}function Gu(t,e){if(null===e)return"oldProps is null, initial diff";let i=null;const{dataComparator:r,_dataDiff:n}=t;return r?r(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&n&&(i=n(t.data,e.data)||i),i}function qu(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){const i=Hu(t,e,"all");if(i)return{all:!0}}const i={};let r=!1;for(const n in t.updateTriggers)if("all"!==n){const o=Hu(t,e,n);o&&(i[n]=!0,r=i)}return r}function Wu(t,e){if(null===e)return"oldProps is null, initial diff";const i=e.extensions,{extensions:r}=t;if(r===i)return!1;if(r.length!==i.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(i[n]))return!0;return!1}function Hu(t,e,i){let r=t.updateTriggers[i];r=void 0===r||null===r?{}:r;let n=e.updateTriggers[i];n=void 0===n||null===n?{}:n;const o=Uu({oldProps:n,newProps:r,triggerName:i});return o}function Zu(t){const e=t[Fu],i=e&&e.constructor;return i?i._propTypes:{}}const Xu="count(): argument not an object",Yu="count(): argument not a container";function Ku(t){if(!Qu(t))throw new Error(Xu);if("function"===typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Ju(t))return Object.keys(t).length;throw new Error(Yu)}function Ju(t){return null!==t&&"object"===typeof t&&t.constructor===Object}function Qu(t){return null!==t&&"object"===typeof t}function $u(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}function tc(t){let e,i={};return r=>{for(const n in r)if(!$u(r[n],i[n])){e=t(r),i=r;break}return e}}function ec(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(t=>"project64"===t.name))){const t=i.modules.findIndex(t=>"project32"===t.name);t>=0&&i.modules.splice(t,1)}if("inject"in e)if(t.inject){const r={...t.inject};for(const t in e.inject)r[t]=(r[t]||"")+e.inject[t];i.inject=r}else i.inject=e.inject;return i}const ic=[0,0,0,0],rc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],nc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],oc=[0,0,0],ac=[0,0,0],sc=tc(hc);function lc(t,e,i=ac){let r,n=i,o=!0;switch(r=e===K.LNGLAT_OFFSETS||e===K.METER_OFFSETS?i:t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case J.WEB_MERCATOR:e!==K.LNGLAT&&e!==K.CARTESIAN||(o=!1);break;case J.WEB_MERCATOR_AUTO_OFFSET:e===K.LNGLAT?n=r:e===K.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case J.IDENTITY:n=t.position.map(Math.fround);break;case J.GLOBE:o=!1,r=null;break;default:o=!1}return n[2]=n[2]||0,{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:o}}function uc(t,e,i){const{viewMatrixUncentered:r,projectionMatrix:n}=t;let{viewMatrix:o,viewProjectionMatrix:a}=t,s=ic,l=ic,u=t.cameraPosition;const{geospatialOrigin:c,shaderCoordinateOrigin:h,offsetMode:p}=lc(t,e,i);return p&&(l=t.projectPosition(c||h),u=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],l[3]=1,s=Sn([],l,a),o=r||o,a=$r([],n,o),a=$r([],a,rc)),{viewMatrix:o,viewProjectionMatrix:a,projectionCenter:s,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:h,geospatialOrigin:c}}function cc({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:r=K.DEFAULT,coordinateOrigin:n,autoWrapLongitude:o=!1}={}){r===K.DEFAULT&&(r=t.isGeospatial?K.LNGLAT:K.CARTESIAN);const a=sc({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n});return a.project_uWrapLongitude=o,a.project_uModelMatrix=i||nc,a}function hc({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r}){const{projectionCenter:n,viewProjectionMatrix:o,originCommon:a,cameraPosCommon:s,shaderCoordinateOrigin:l,geospatialOrigin:u}=uc(t,i,r),c=t.getDistanceScales(),h=[t.width*e,t.height*e],p=t.projectionMatrix.transform([0,0,-t.focalDistance,1])[3]||1,d={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:a.slice(0,3),project_uCenter:n,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:p,project_uCommonUnitsPerMeter:c.unitsPerMeter,project_uCommonUnitsPerWorldUnit:c.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:oc,project_uScale:t.scale,project_uViewProjectionMatrix:o,project_uCameraPosition:s};if(u){const e=t.getDistanceScales(u);switch(i){case K.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=e.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=e.unitsPerMeter2;break;case K.LNGLAT:case K.LNGLAT_OFFSETS:d.project_uCommonUnitsPerWorldUnit=e.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=e.unitsPerDegree2;break;case K.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,e.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,e.unitsPerMeter2[2]];break;default:break}}return d}function pc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function dc(t,e){const i=Sn([],e,t);return En(i,i,1/i[3]),i}function fc(t,e){const i=t%e;return i<0?e+i:i}function mc(t,e,i){return i*e+(1-i)*t}function gc(t,e,i){return t<e?e:t>i?i:t}function yc(t){return Math.log(t)*Math.LOG2E}const vc=Math.log2||yc;function _c(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const bc=Math.PI,xc=bc/4,wc=bc/180,Tc=180/bc,Ec=512,Sc=4003e4,Ac=85.051129,Cc=1.5;function Pc(t){return Math.pow(2,t)}function Ic(t){return vc(t)}function Mc(t){const[e,i]=t;_c(Number.isFinite(e)),_c(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=e*wc,n=i*wc,o=Ec*(r+bc)/(2*bc),a=Ec*(bc+Math.log(Math.tan(xc+.5*n)))/(2*bc);return[o,a]}function kc(t){const[e,i]=t,r=e/Ec*(2*bc)-bc,n=2*(Math.atan(Math.exp(i/Ec*(2*bc)-bc))-xc);return[r*Tc,n*Tc]}function Dc(t){const{latitude:e}=t;_c(Number.isFinite(e));const i=Math.cos(e*wc);return Ic(Sc*i)-9}function Lc(t){const{latitude:e,longitude:i,highPrecision:r=!1}=t;_c(Number.isFinite(e)&&Number.isFinite(i));const n=Ec,o=Math.cos(e*wc),a=n/360,s=a/o,l=n/Sc/o,u={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[a,s,l],degreesPerUnit:[1/a,1/s,1/l]};if(r){const t=wc*Math.tan(e*wc)/o,i=a*t/2,r=n/Sc*t,c=r/s*l;u.unitsPerDegree2=[0,i,r],u.unitsPerMeter2=[c,0,c]}return u}function Oc(t,e){const[i,r,n]=t,[o,a,s]=e,{unitsPerMeter:l,unitsPerMeter2:u}=Lc({longitude:i,latitude:r,highPrecision:!0}),c=Mc(t);c[0]+=o*(l[0]+u[0]*a),c[1]+=a*(l[1]+u[1]*a);const h=kc(c),p=(n||0)+(s||0);return Number.isFinite(n)||Number.isFinite(s)?[h[0],h[1],p]:h}function Rc(t){const{height:e,pitch:i,bearing:r,altitude:n,scale:o,center:a}=t,s=pc();tn(s,s,[0,0,-n]),nn(s,s,-i*wc),an(s,s,r*wc);const l=o/e;return en(s,s,[l,l,l]),a&&tn(s,s,kr([],a)),s}function zc(t){const{width:e,height:i,altitude:r,pitch:n=0,offset:o,center:a,scale:s,nearZMultiplier:l=1,farZMultiplier:u=1}=t;let{fovy:c=Fc(Cc)}=t;void 0!==r&&(c=Fc(r));const h=c*wc,p=n*wc,d=Bc(c);let f=d;a&&(f+=a[2]*s/Math.cos(p)/i);const m=h*(.5+(o?o[1]:0)/i),g=Math.sin(m)*f/Math.sin(gc(Math.PI/2-p-m,.01,Math.PI-.01)),y=Math.sin(p)*g+f,v=10*f,_=Math.min(y*u,v);return{fov:h,aspect:e/i,focalDistance:d,near:l,far:_}}function Fc(t){return 2*Math.atan(.5/t)*Tc}function Bc(t){return.5/Math.tan(.5*t*wc)}function Nc(t,e){const[i,r,n=0]=t;return _c(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(n)),dc(e,[i,r,n,1])}function jc(t,e,i=0){const[r,n,o]=t;if(_c(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o)){const t=dc(e,[r,n,o,1]);return t}const a=dc(e,[r,n,0,1]),s=dc(e,[r,n,1,1]),l=a[2],u=s[2],c=l===u?0:((i||0)-l)/(u-l);return bn([],a,s,c)}function Uc(t){const{width:e,height:i,bounds:r,minExtent:n=0,maxZoom:o=24,offset:a=[0,0]}=t,[[s,l],[u,c]]=r,h=Vc(t.padding),p=Mc([s,gc(c,-Ac,Ac)]),d=Mc([u,gc(l,-Ac,Ac)]),f=[Math.max(Math.abs(d[0]-p[0]),n),Math.max(Math.abs(d[1]-p[1]),n)],m=[e-h.left-h.right-2*Math.abs(a[0]),i-h.top-h.bottom-2*Math.abs(a[1])];_c(m[0]>0&&m[1]>0);const g=m[0]/f[0],y=m[1]/f[1],v=(h.right-h.left)/2/g,_=(h.top-h.bottom)/2/y,b=[(d[0]+p[0])/2+v,(d[1]+p[1])/2+_],x=kc(b),w=Math.min(o,vc(Math.abs(Math.min(g,y))));return _c(Number.isFinite(w)),{longitude:x[0],latitude:x[1],zoom:w}}function Vc(t=0){return"number"===typeof t?{top:t,bottom:t,left:t,right:t}:(_c(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Gc=Math.PI/180;function qc(t,e=0){const{width:i,height:r,unproject:n}=t,o={targetZ:e},a=n([0,r],o),s=n([i,r],o);let l,u;const c=t.fovy?.5*t.fovy*Gc:Math.atan(.5/t.altitude),h=(90-t.pitch)*Gc;return c>h-.01?(l=Wc(t,0,e),u=Wc(t,i,e)):(l=n([0,0],o),u=n([i,0],o)),[a,s,u,l]}function Wc(t,e,i){const{pixelUnprojectionMatrix:r}=t,n=dc(r,[e,0,1,1]),o=dc(r,[e,t.height,1,1]),a=i*t.distanceScales.unitsPerMeter[2],s=(a-n[2])/(o[2]-n[2]),l=bn([],n,o,s),u=kc(l);return u.push(i),u}const Hc=512;function Zc(t){const{width:e,height:i,pitch:r=0}=t;let{longitude:n,latitude:o,zoom:a,bearing:s=0}=t;(n<-180||n>180)&&(n=fc(n+180,360)-180),(s<-180||s>180)&&(s=fc(s+180,360)-180);const l=vc(i/Hc);if(a<=l)a=l,o=0;else{const t=i/2/Math.pow(2,a),e=kc([0,t])[1];if(o<e)o=e;else{const e=kc([0,Hc-t])[1];o>e&&(o=e)}}return{width:e,height:i,longitude:n,latitude:o,zoom:a,pitch:r,bearing:s}}const Xc=.01,Yc=["longitude","latitude","zoom"],Kc={curve:1.414,speed:1.2};function Jc(t,e,i,r){const{startZoom:n,startCenterXY:o,uDelta:a,w0:s,u1:l,S:u,rho:c,rho2:h,r0:p}=$c(t,e,r);if(l<Xc){const r={};for(const n of Yc){const o=t[n],a=e[n];r[n]=mc(o,a,i)}return r}const d=i*u,f=Math.cosh(p)/Math.cosh(p+c*d),m=s*((Math.cosh(p)*Math.tanh(p+c*d)-Math.sinh(p))/h)/l,g=1/f,y=n+Ic(g),v=yn([],a,m);mn(v,v,o);const _=kc(v);return{longitude:_[0],latitude:_[1],zoom:y}}function Qc(t,e,i){const r={...Kc,...i},{screenSpeed:n,speed:o,maxDuration:a}=r,{S:s,rho:l}=$c(t,e,r),u=1e3*s;let c;return c=Number.isFinite(n)?u/(n/l):u/o,Number.isFinite(a)&&c>a?0:c}function $c(t,e,i){i=Object.assign({},Kc,i);const r=i.curve,n=t.zoom,o=[t.longitude,t.latitude],a=Pc(n),s=e.zoom,l=[e.longitude,e.latitude],u=Pc(s-n),c=Mc(o),h=Mc(l),p=wn([],h,c),d=Math.max(t.width,t.height),f=d/u,m=vn(p)*a,g=Math.max(m,Xc),y=r*r,v=(f*f-d*d+y*y*g*g)/(2*d*y*g),_=(f*f-d*d-y*y*g*g)/(2*f*y*g),b=Math.log(Math.sqrt(v*v+1)-v),x=Math.log(Math.sqrt(_*_+1)-_),w=(x-b)/r;return{startZoom:n,startCenterXY:c,uDelta:p,w0:d,u1:m,S:w,rho:r,rho2:y,r0:b,r1:x}}const th=Math.PI/180,eh=Nn(),ih=[0,0,0],rh=0,nh={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class oh{constructor(t={}){const{id:e=null,x:i=0,y:r=0,width:n=1,height:o=1}=t;this.id=e||this.constructor.displayName||"viewport",this.x=i,this.y=r,this.width=n||1,this.height=o||1,this._frustumPlanes={},this._initViewMatrix(t),this._initProjectionMatrix(t),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?J.WEB_MERCATOR:J.WEB_MERCATOR_AUTO_OFFSET:J.IDENTITY}equals(t){return t instanceof oh&&(this===t||t.width===this.width&&t.height===this.height&&t.scale===this.scale&&yr(t.projectionMatrix,this.projectionMatrix)&&yr(t.viewMatrix,this.viewMatrix))}project(t,{topLeft:e=!0}={}){const i=this.projectPosition(t),r=Nc(i,this.pixelProjectionMatrix),[n,o]=r,a=e?o:this.height-o;return 2===t.length?[n,a]:[n,a,r[2]]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[r,n,o]=t,a=e?n:this.height-n,s=i&&i*this.distanceScales.unitsPerMeter[2],l=jc([r,a,o],this.pixelUnprojectionMatrix,s),[u,c,h]=this.unprojectPosition(l);return Number.isFinite(o)?[u,c,h]:Number.isFinite(i)?[u,c,i]:[u,c]}projectPosition(t){const[e,i]=this.projectFlat(t),r=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,i,r]}unprojectPosition(t){const[e,i]=this.unprojectFlat(t),r=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,i,r]}projectFlat(t){return this.isGeospatial?Mc(t):t}unprojectFlat(t){return this.isGeospatial?kc(t):t}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,0],e),r=this.unproject([this.width,0],e),n=this.unproject([0,this.height],e),o=this.unproject([this.width,this.height],e);return[Math.min(i[0],r[0],n[0],o[0]),Math.min(i[1],r[1],n[1],o[1]),Math.max(i[0],r[0],n[0],o[0]),Math.max(i[1],r[1],n[1],o[1])]}getDistanceScales(t=null){return t?Lc({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:i=1,height:r=1}){return t<this.x+this.width&&this.x<t+i&&e<this.y+this.height&&this.y<e+r}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,Un(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(t,e){return null}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_createProjectionMatrix({orthographic:t,fovyRadians:e,aspect:i,focalDistance:r,near:n,far:o}){return t?(new Dn).orthographic({fovy:e,aspect:i,focalDistance:r,near:n,far:o}):(new Dn).perspective({fovy:e,aspect:i,near:n,far:o})}_initViewMatrix(t){const{viewMatrix:e=eh,longitude:i=null,latitude:r=null,zoom:n=null,position:o=null,modelMatrix:a=null,focalDistance:s=1,distanceScales:l=null}=t;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(i),this.zoom=n,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Dc({latitude:r})+Math.log2(s):rh);const u=Math.pow(2,this.zoom);this.scale=u,this.distanceScales=this.isGeospatial?Lc({latitude:r,longitude:i}):l||nh,this.focalDistance=s,this.distanceScales.metersPerUnit=new Zr(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new Zr(this.distanceScales.unitsPerMeter),this.position=ih,this.meterOffset=ih,o&&(this.position=o,this.modelMatrix=a,this.meterOffset=a?a.transformVector(o):o),this.isGeospatial?(this.longitude=i,this.latitude=r,this.center=this._getCenterInWorld({longitude:i,latitude:r})):this.center=o?this.projectPosition(o):[0,0,0],this.viewMatrixUncentered=e,this.viewMatrix=(new Dn).multiplyRight(this.viewMatrixUncentered).translate(new Zr(this.center||ih).negate())}_getCenterInWorld({longitude:t,latitude:e}){const{meterOffset:i,distanceScales:r}=this,n=new Zr(this.projectPosition([t,e,0]));if(i){const t=new Zr(i).scale(r.unitsPerMeter);n.add(t)}return n}_initProjectionMatrix(t){const{projectionMatrix:e=null,orthographic:i=!1,fovyRadians:r,fovy:n=75,near:o=.1,far:a=1e3,focalDistance:s=1}=t;this.projectionMatrix=e||this._createProjectionMatrix({orthographic:i,fovyRadians:r||n*th,aspect:this.width/this.height,focalDistance:s,near:o,far:a})}_initPixelMatrices(){const t=Nn();$r(t,t,this.projectionMatrix),$r(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=Jr([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=jn(this.viewMatrixInverse);const e=Nn(),i=Nn();en(e,e,[this.width/2,-this.height/2,1]),tn(e,e,[1,-1,0]),$r(i,e,this.viewProjectionMatrix),this.pixelProjectionMatrix=i,this.viewportMatrix=e,this.pixelUnprojectionMatrix=Jr(Nn(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Y.warn("Pixel project matrix not invertible")()}}oh.displayName="Viewport";class ah extends oh{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:r=11,pitch:n=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:s=1.01,orthographic:l=!1,repeat:u=!1,worldOffset:c=0}=t;let{width:h,height:p,altitude:d=1.5}=t;const f=Math.pow(2,r);h=h||1,p=p||1,d=Math.max(.75,d);const{fov:m,aspect:g,focalDistance:y,near:v,far:_}=zc({width:h,height:p,pitch:n,altitude:d,nearZMultiplier:a,farZMultiplier:s});let b=Rc({height:p,pitch:n,bearing:o,scale:f,altitude:d});if(c){const t=(new Dn).translate([512*c,0,0]);b=t.multiplyLeft(b)}super({...t,width:h,height:p,viewMatrix:b,longitude:i,latitude:e,zoom:r,orthographic:l,fovyRadians:m,aspect:g,focalDistance:y,near:v,far:_}),this.latitude=e,this.longitude=i,this.zoom=r,this.pitch=n,this.bearing=o,this.altitude=d,this.orthographic=l,this._subViewports=u?[]:null,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let r=e;r<=i;r++){const t=r?new ah({...this,worldOffset:r}):this;this._subViewports.push(t)}}return this._subViewports}addMetersToLngLat(t,e){return Oc(t,e)}panByPosition(t,e){const i=jc(e,this.pixelUnprojectionMatrix),r=this.projectFlat(t),n=mn([],r,_n([],i)),o=mn([],this.center,n),[a,s]=this.unprojectFlat(o);return{longitude:a,latitude:s}}getBounds(t={}){const e=qc(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:i,height:r}=this,{longitude:n,latitude:o,zoom:a}=Uc({width:i,height:r,bounds:t,...e});return new ah({width:i,height:r,longitude:n,latitude:o,zoom:a})}}function sh(t,e,i=!1){const r=e.projectPosition(t);if(i&&e instanceof ah){const[i,n,o=0]=t,a=e.getDistanceScales([i,n]);r[2]=o*a.unitsPerMeter[2]}return r}function lh(t){const e={...t};let{coordinateSystem:i}=t;const{viewport:r,coordinateOrigin:n,fromCoordinateSystem:o,fromCoordinateOrigin:a}=t;return i===K.DEFAULT&&(i=r.isGeospatial?K.LNGLAT:K.CARTESIAN),void 0===o&&(e.fromCoordinateSystem=i),void 0===a&&(e.fromCoordinateOrigin=n),e.coordinateSystem=i,e}function uh(t,{viewport:e,modelMatrix:i,coordinateSystem:r,coordinateOrigin:n,offsetMode:o}){let[a,s,l=0]=t;switch(i&&([a,s,l]=Sn([],[a,s,l,1],i)),r){case K.LNGLAT:return sh([a,s,l],e,o);case K.LNGLAT_OFFSETS:return sh([a+n[0],s+n[1],l+(n[2]||0)],e,o);case K.METER_OFFSETS:return sh(Oc(n,[a,s,l]),e,o);case K.CARTESIAN:default:return e.isGeospatial?[a+n[0],s+n[1],l+n[2]]:e.projectPosition([a,s,l])}}function ch(t,e){const{viewport:i,coordinateSystem:r,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:a,fromCoordinateOrigin:s}=lh(e),{geospatialOrigin:l,shaderCoordinateOrigin:u,offsetMode:c}=lc(i,r,n),h=uh(t,{viewport:i,modelMatrix:o,coordinateSystem:a,coordinateOrigin:s,offsetMode:c});if(c){const t=i.projectPosition(l||u);Ur(h,h,t)}return h}ah.displayName="WebMercatorViewport";const hh={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},ph={};function dh(t,e){const i=t.context&&t.context.gl;if(!i||!e)return null;if(e instanceof wi)return e;e.constructor&&"Object"!==e.constructor.name&&(e={data:e});let r=null;e.compressed&&(r={[10241]:e.data.length>1?9985:9729});const n=new wi(i,{...e,parameters:{...hh,...r,...t.props.textureParameters}});return ph[n.id]=!0,n}function fh(t){t&&t instanceof wi&&ph[t.id]&&(t.delete(),delete ph[t.id])}const mh={boolean:{validate(t,e){return!0},equal(t,e,i){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||bh(t)&&(3===t.length||4===t.length)},equal(t,e,i){return gh(t,e)}},accessor:{validate(t,e){const i=xh(t);return"function"===i||i===xh(e.value)},equal(t,e,i){return"function"===typeof e||gh(t,e)}},array:{validate(t,e){return e.optional&&!t||bh(t)},equal(t,e,i){return i.compare?gh(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||"function"===typeof t},equal(t,e,i){return!i.compare||t===e}},data:{transform:(t,e,i)=>{const{dataTransform:r}=i?i.props:{};return r&&t?r(t):t}},image:{transform:(t,e,i)=>dh(i,t),release:t=>{fh(t)}}};function gh(t,e){if(t===e)return!0;if(!bh(t)||!bh(e))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}function yh(t){const e={},i={},r={};for(const[n,o]of Object.entries(t))if(o&&o.deprecatedFor)r[n]=Array.isArray(o.deprecatedFor)?o.deprecatedFor:[o.deprecatedFor];else{const t=vh(n,o);e[n]=t,i[n]=t.value}return{propTypes:e,defaultProps:i,deprecatedProps:r}}function vh(t,e){switch(xh(e)){case"object":return _h(t,e);case"array":return _h(t,{type:"array",value:e,compare:!1});case"boolean":return _h(t,{type:"boolean",value:e});case"number":return _h(t,{type:"number",value:e});case"function":return _h(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function _h(t,e){return"type"in e?{name:t,...mh[e.type],...e}:"value"in e?{name:t,type:xh(e.value),...e}:{name:t,type:"object",value:e}}function bh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function xh(t){return bh(t)?"array":null===t?"null":typeof t}const{COMPONENT:wh,ASYNC_ORIGINAL:Th,ASYNC_RESOLVED:Eh,ASYNC_DEFAULTS:Sh}=zu;function Ah(){const t=this,e=Ch(t.constructor),i=Object.create(e);i[wh]=t,i[Th]={},i[Eh]={};for(let r=0;r<arguments.length;++r){const t=arguments[r];for(const e in t)i[e]=t[e]}return Object.freeze(i),i}function Ch(t){const e=Oh(t,"_mergedDefaultProps");return e||(Ph(t),t._mergedDefaultProps)}function Ph(t){const e=t.prototype;if(!e)return;const i=Object.getPrototypeOf(t),r=Ch(i),n=Oh(t,"defaultProps")||{},o=yh(n),a=Ih(o.defaultProps,r,t),s={...i._propTypes,...o.propTypes};kh(a,s);const l={...i._deprecatedProps,...o.deprecatedProps};Mh(a,l),t._mergedDefaultProps=a,t._propTypes=s,t._deprecatedProps=l}function Ih(t,e,i){const r=Object.create(null);Object.assign(r,e,t);const n=Rh(i);return delete t.id,Object.defineProperties(r,{id:{writable:!0,value:n}}),r}function Mh(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(t){const r="".concat(this.id,": ").concat(i);for(const n of e[i])Lh(this,n)||(this[n]=t);Y.deprecated(r,e[i].join("/"))()}})}function kh(t,e){const i={},r={};for(const n in e){const t=e[n],{name:o,value:a}=t;t.async&&(i[o]=a,r[o]=Dh(o,a))}t[Sh]=i,t[Th]={},Object.defineProperties(t,r)}function Dh(t){return{enumerable:!0,set(e){"string"===typeof e||e instanceof Promise||eo(e)?this[Th][t]=e:this[Eh][t]=e},get(){if(this[Eh]){if(t in this[Eh]){const e=this[Eh][t];return e||this[Sh][t]}if(t in this[Th]){const e=this[wh]&&this[wh].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Sh][t]}}return this[Sh][t]}}}function Lh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Oh(t,e){return Lh(t,e)&&t[e]}function Rh(t){const e=Oh(t,"layerName")||Oh(t,"componentName");return e||Y.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}const{ASYNC_ORIGINAL:zh,ASYNC_RESOLVED:Fh,ASYNC_DEFAULTS:Bh}=zu,Nh=Object.freeze({});class jh{constructor(t=null){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=Nh,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}freezeAsyncOldProps(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){const e=t[Fh]||{},i=t[zh]||t,r=t[Bh]||{};for(const n in e){const t=e[n];this._createAsyncPropData(n,r[n]),this._updateAsyncProp(n,t),e[n]=this.getAsyncProp(n)}for(const n in i){const t=i[n];this._createAsyncPropData(n,r[n]),this._updateAsyncProp(n,t)}}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"===typeof e){var i;const r=null===(i=this.layer)||void 0===i?void 0:i.props.fetch,n=e;r&&(e=r(n,{propName:t,layer:this.layer}))}e instanceof Promise?this._watchPromise(t,e):eo(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e)}}_didAsyncInputValueChange(t,e){const i=this.asyncProps[t];return e!==i.resolvedValue&&e!==i.lastValue&&(i.lastValue=e,!0)}_setPropValue(t,e){this.freezeAsyncOldProps();const i=this.asyncProps[t];e=this._postProcessValue(i,e),i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount}_setAsyncPropValue(t,e,i){const r=this.asyncProps[t];r&&i>=r.resolvedLoadCount&&void 0!==e&&(this.freezeAsyncOldProps(),r.resolvedValue=e,r.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const i=this.asyncProps[t];i.pendingLoadCount++;const r=i.pendingLoadCount;e.then(e=>{var n;e=this._postProcessValue(i,e),this._setAsyncPropValue(t,e,r);const o=null===(n=this.layer)||void 0===n?void 0:n.props.onDataLoad;"data"===t&&o&&o(e,{propName:t,layer:this.layer})}).catch(e=>{var i;null===(i=this.layer)||void 0===i||i.raiseError(e,"loading ".concat(t," of ").concat(this.layer))})}async _resolveAsyncIterable(t,e){var i;"data"!==t&&this._setPropValue(t,e);const r=this.asyncProps[t];r.pendingLoadCount++;const n=r.pendingLoadCount;let o=[],a=0;for await(const l of e){const{dataTransform:e}=this.component?this.component.props:{};o=e?e(l,o):o.concat(l),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:a,endRow:o.length}]}),a=o.length,this._setAsyncPropValue(t,o,n)}const s=null===(i=this.layer)||void 0===i?void 0:i.props.onDataLoad;s&&s(o,{propName:t,layer:this.layer})}_postProcessValue(t,e){const i=t.type;return i&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(e,i,this.component):e}_createAsyncPropData(t,e){const i=this.asyncProps[t];if(!i){const i=this.component&&this.component.constructor._propTypes;this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}const{ASYNC_ORIGINAL:Uh,ASYNC_RESOLVED:Vh,ASYNC_DEFAULTS:Gh}=zu,qh={};let Wh=0;class Hh{constructor(){this.props=Ah.apply(this,arguments),this.id=this.props.id,this.count=Wh++,this.lifecycle=Ru.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}clone(t){const{props:e}=this,i={};for(const r in e[Gh])r in e[Vh]?i[r]=e[Vh][r]:r in e[Uh]&&(i[r]=e[Uh][r]);return new this.constructor({...e,...i,...t})}get stats(){return this.internalState.stats}_initState(){this.internalState=new jh({})}}Hh.componentName="Component",Hh.defaultProps=qh;class Zh extends jh{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.model=null,this.needsRedraw=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(t){this.component=t}}const Xh=t=>"boolean"===typeof t,Yh=t=>"function"===typeof t,Kh=t=>null!==t&&"object"===typeof t,Jh=t=>Kh(t)&&t.constructor==={}.constructor,Qh=t=>t&&"function"===typeof t[Symbol.iterator],$h=t=>t&&"function"===typeof t[Symbol.asyncIterator],tp=t=>"undefined"!==typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ep=t=>"undefined"!==typeof Blob&&t instanceof Blob,ip=t=>t&&"object"===typeof t&&t.isBuffer,rp=t=>"undefined"!==typeof ReadableStream&&t instanceof ReadableStream||Kh(t)&&Yh(t.tee)&&Yh(t.cancel)&&Yh(t.getReader),np=t=>Kh(t)&&Yh(t.read)&&Yh(t.pipe)&&Xh(t.readable),op=t=>rp(t)||np(t);function ap(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function sp(t){var e;if(!t)return!1;Array.isArray(t)&&(t=t[0]);const i=Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions);return i}function lp(t){var e,i;let r;return ap(t,"null loader"),ap(sp(t),"invalid loader"),Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(i=t)&&void 0!==i&&i.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}let up="";const cp={};function hp(t){for(const e in cp)if(t.startsWith(e)){const i=cp[e];t=t.replace(e,i)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(up).concat(t)),t}const pp=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,dp=/^([-\w.]+\/[-\w.+]+)/;function fp(t){const e=dp.exec(t);return e?e[1]:t}function mp(t){const e=pp.exec(t);return e?e[1]:""}const gp=/\?.*/;function yp(t){const e=t.match(gp);return e&&e[0]}function vp(t){return t.replace(gp,"")}function _p(t){if(tp(t)){const e=t;return e.url}if(ep(t)){const e=t;return e.name||""}return"string"===typeof t?t:""}function bp(t){if(tp(t)){const e=t,i=e.headers.get("content-type")||"",r=vp(e.url);return fp(i)||mp(r)}if(ep(t)){const e=t;return e.type||""}return"string"===typeof t?mp(t):""}function xp(t){if(tp(t)){const e=t;return e.headers["content-length"]||-1}if(ep(t)){const e=t;return e.size}return"string"===typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function wp(t){if(tp(t))return t;const e={},i=xp(t);i>=0&&(e["content-length"]=String(i));const r=_p(t),n=bp(t);n&&(e["content-type"]=n);const o=await Sp(t);o&&(e["x-first-bytes"]=o),"string"===typeof t&&(t=(new TextEncoder).encode(t));const a=new Response(t,{headers:e});return Object.defineProperty(a,"url",{value:r}),a}async function Tp(t){if(!t.ok){const e=await Ep(t);throw new Error(e)}}async function Ep(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const i=t.headers.get("Content-Type");let r=t.statusText;i.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch(i){}return e}async function Sp(t){const e=5;if("string"===typeof t)return"data:,".concat(t.slice(0,e));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(t=>{const i=new FileReader;i.onload=e=>{var i;return t(null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.result)},i.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const i=t.slice(0,e),r=Ap(i);return"data:base64,".concat(r)}return null}function Ap(t){let e="";const i=new Uint8Array(t);for(let r=0;r<i.byteLength;r++)e+=String.fromCharCode(i[r]);return btoa(e)}async function Cp(t,e){if("string"===typeof t){t=hp(t);let i=e;return null!==e&&void 0!==e&&e.fetch&&"function"!==typeof(null===e||void 0===e?void 0:e.fetch)&&(i=e.fetch),await fetch(t,i)}return await wp(t)}const Pp=new V({id:"loaders.gl"});class Ip{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Mp{constructor(){Object(s["a"])(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.error.bind(this.console,...e)}}var kp=i("22dc");const Dp={fetch:null,mimeType:void 0,nothrow:!1,log:new Mp,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:kp["a"],_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Lp={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Op(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Rp=()=>{const t=Op();return t.globalOptions=t.globalOptions||{...Dp},t.globalOptions};function zp(t,e,i,r){return i=i||[],i=Array.isArray(i)?i:[i],Fp(t,i),jp(e,t,r)}function Fp(t,e){Bp(t,null,Dp,Lp,e);for(const i of e){const r=t&&t[i.id]||{},n=i.options&&i.options[i.id]||{},o=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Bp(r,i.id,n,o,e)}}function Bp(t,e,i,r,n){const o=e||"Top level",a=e?"".concat(e,"."):"";for(const s in t){const l=!e&&Kh(t[s]),u="baseUri"===s&&!e,c="workerUrl"===s&&e;if(!(s in i)&&!u&&!c)if(s in r)Pp.warn("".concat(o," loader option '").concat(a).concat(s,"' no longer supported, use '").concat(r[s],"'"))();else if(!l){const t=Np(s,n);Pp.warn("".concat(o," loader option '").concat(a).concat(s,"' not recognized. ").concat(t))()}}}function Np(t,e){const i=t.toLowerCase();let r="";for(const n of e)for(const e in n.options){if(t===e)return"Did you mean '".concat(n.id,".").concat(e,"'?");const o=e.toLowerCase(),a=i.startsWith(o)||o.startsWith(i);a&&(r=r||"Did you mean '".concat(n.id,".").concat(e,"'?"))}return r}function jp(t,e,i){const r=t.options||{},n={...r};return Vp(n,i),null===n.log&&(n.log=new Ip),Up(n,Rp()),Up(n,e),n}function Up(t,e){for(const i in e)if(i in e){const r=e[i];Jh(r)&&Jh(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function Vp(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Gp(t,e){const i=Rp(),r=t||i;return"function"===typeof r.fetch?r.fetch:Kh(r.fetch)?t=>Cp(t,r):null!==e&&void 0!==e&&e.fetch?null===e||void 0===e?void 0:e.fetch:Cp}function qp(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Wp="3.4.15";function Hp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wp;qp(t,"no worker provided");const i=t.version;return!(!e||!i)}var Zp=i("f5f4");class Xp{terminate(){}}const Yp=new Map;function Kp(t){qp(t.source&&!t.url||!t.source&&t.url);let e=Yp.get(t.source||t.url);return e||(t.url&&(e=Jp(t.url),Yp.set(t.url,e)),t.source&&(e=Qp(t.source),Yp.set(t.source,e))),qp(e),e}function Jp(t){if(!t.startsWith("http"))return t;const e=$p(t);return Qp(e)}function Qp(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function $p(t){return"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")}function td(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;const r=i||new Set;if(t){if(ed(t))r.add(t);else if(ed(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"===typeof t)for(const n in t)td(t[n],e,r)}else;return void 0===i?Array.from(r):[]}function ed(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!==typeof MessagePort&&t instanceof MessagePort||("undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}const id=()=>{};class rd{static isSupported(){return"undefined"!==typeof Worker&&Zp["a"]||"undefined"!==typeof Xp&&!Zp["a"]}constructor(t){Object(s["a"])(this,"name",void 0),Object(s["a"])(this,"source",void 0),Object(s["a"])(this,"url",void 0),Object(s["a"])(this,"terminated",!1),Object(s["a"])(this,"worker",void 0),Object(s["a"])(this,"onMessage",void 0),Object(s["a"])(this,"onError",void 0),Object(s["a"])(this,"_loadableURL","");const{name:e,source:i,url:r}=t;qp(i||r),this.name=e,this.source=i,this.url=r,this.onMessage=id,this.onError=t=>console.log(t),this.worker=Zp["a"]?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=id,this.onError=id,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||td(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=Kp({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/"),i=e?this.url:"./".concat(this.url);t=new Xp(i,{eval:!1})}else{if(!this.source)throw new Error("no worker");t=new Xp(this.source,{eval:!0})}return t.on("message",t=>{this.onMessage(t)}),t.on("error",t=>{this.onError(t)}),t.on("exit",t=>{}),t}}class nd{constructor(t,e){Object(s["a"])(this,"name",void 0),Object(s["a"])(this,"workerThread",void 0),Object(s["a"])(this,"isRunning",!0),Object(s["a"])(this,"result",void 0),Object(s["a"])(this,"_resolve",()=>{}),Object(s["a"])(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((t,e)=>{this._resolve=t,this._reject=e})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){qp(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){qp(this.isRunning),this.isRunning=!1,this._reject(t)}}class od{static isSupported(){return rd.isSupported()}constructor(t){Object(s["a"])(this,"name","unnamed"),Object(s["a"])(this,"source",void 0),Object(s["a"])(this,"url",void 0),Object(s["a"])(this,"maxConcurrency",1),Object(s["a"])(this,"maxMobileConcurrency",1),Object(s["a"])(this,"onDebug",()=>{}),Object(s["a"])(this,"reuseWorkers",!0),Object(s["a"])(this,"props",{}),Object(s["a"])(this,"jobQueue",[]),Object(s["a"])(this,"idleQueue",[]),Object(s["a"])(this,"count",0),Object(s["a"])(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e,i)=>t.done(i),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(t,e)=>t.error(e);const r=new Promise(r=>(this.jobQueue.push({name:t,onMessage:e,onError:i,onStart:r}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const i=new nd(e.name,t);t.onMessage=t=>e.onMessage(i,t.type,t.payload),t.onError=t=>e.onError(i,t),e.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){const e=this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency();e?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new rd({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Zp["b"]?this.maxMobileConcurrency:this.maxConcurrency}}const ad={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class sd{static isSupported(){return rd.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return sd._workerFarm=sd._workerFarm||new sd({}),sd._workerFarm.setProps(t),sd._workerFarm}constructor(t){Object(s["a"])(this,"props",void 0),Object(s["a"])(this,"workerPools",new Map),this.props={...ad},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:i,url:r}=t;let n=this.workerPools.get(e);return n||(n=new od({name:e,source:i,url:r}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Object(s["a"])(sd,"_workerFarm",void 0);const ld="latest";function ud(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e[t.id]||{},r="".concat(t.id,"-worker.js");let n=i.workerUrl;if(n||"compression"!==t.id||(n=e.workerUrl),"test"===e._workerType&&(n="modules/".concat(t.module,"/dist/").concat(r)),!n){let e=t.version;"latest"===e&&(e=ld);const i=e?"@".concat(e):"";n="https://unpkg.com/@loaders.gl/".concat(t.module).concat(i,"/dist/").concat(r)}return qp(n),n}function cd(t,e){return!!sd.isSupported()&&(!!(Zp["a"]||null!==e&&void 0!==e&&e._nodeWorkers)&&(t.worker&&(null===e||void 0===e?void 0:e.worker)))}async function hd(t,e,i,r,n){const o=t.id,a=ud(t,i),s=sd.getWorkerFarm(i),l=s.getWorkerPool({name:o,url:a});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));const u=await l.startJob("process-on-worker",pd.bind(null,n));u.postMessage("process",{input:e,options:i,context:r});const c=await u.result;return await c.result}async function pd(t,e,i,r){switch(i){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:o,input:a,options:s}=r;try{const i=await t(a,s);e.postMessage("done",{id:o,result:i})}catch(n){const t=n instanceof Error?n.message:"unknown error";e.postMessage("error",{id:o,error:t})}break;default:console.warn("parse-with-worker unknown message ".concat(i))}}function dd(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const r=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==n[o])return!1;return!0}function fd(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const r=e.map(t=>t instanceof ArrayBuffer?new Uint8Array(t):t),n=r.reduce((t,e)=>t+e.byteLength,0),o=new Uint8Array(n);let a=0;for(const s of r)o.set(s,a),a+=s.byteLength;return o.buffer}async function md(t){const e=[];for await(const i of t)e.push(i);return fd(...e)}const gd=262144;function*yd(t,e){const i=(null===e||void 0===e?void 0:e.chunkSize)||gd;let r=0;const n=new TextEncoder;while(r<t.length){const e=Math.min(t.length-r,i),o=t.slice(r,r+e);r+=e,yield n.encode(o)}}const vd=262144;function _d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const{chunkSize:i=vd}=e;let r=0;while(r<t.byteLength){const e=Math.min(t.byteLength-r,i),n=new ArrayBuffer(e),o=new Uint8Array(t,r,e),a=new Uint8Array(n);a.set(o),r+=e,yield n}}()}const bd=1048576;async function*xd(t,e){const i=(null===e||void 0===e?void 0:e.chunkSize)||bd;let r=0;while(r<t.size){const e=r+i,n=await t.slice(r,e).arrayBuffer();r=e,yield n}}function wd(t){return t}function Td(t){return t&&"object"===typeof t&&t.isBuffer}function Ed(t){if(Td(t))return wd(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"===typeof t){const e=t,i=(new TextEncoder).encode(e);return i.buffer}if(t&&"object"===typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Sd(t,e){return kp["a"]?Ad(t,e):Cd(t,e)}async function*Ad(t,e){const i=t.getReader();let r;try{while(1){const t=r||i.read();null!==e&&void 0!==e&&e._streamReadAhead&&(r=i.read());const{done:n,value:o}=await t;if(n)return;yield Ed(o)}}catch(n){i.releaseLock()}}async function*Cd(t,e){for await(const i of t)yield Ed(i)}function Pd(t,e){if("string"===typeof t)return yd(t,e);if(t instanceof ArrayBuffer)return _d(t,e);if(ep(t))return xd(t,e);if(op(t))return Sd(t,e);if(tp(t)){const i=t;return Sd(i.body,e)}throw new Error("makeIterator")}const Id="Cannot convert supplied data type";function Md(t,e,i){if(e.text&&"string"===typeof t)return t;if(ip(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;if(e.text&&!e.binary){const t=new TextDecoder("utf8");return t.decode(i)}return i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary){const e=new TextDecoder("utf8");return e.decode(t)}let i=t.buffer;const r=t.byteLength||t.length;return 0===t.byteOffset&&r===i.byteLength||(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(Id)}async function kd(t,e,i){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"===typeof t||r)return Md(t,e,i);if(ep(t)&&(t=await wp(t)),tp(t)){const i=t;return await Tp(i),e.binary?await i.arrayBuffer():await i.text()}if(op(t)&&(t=Pd(t,i)),Qh(t)||$h(t))return md(t);throw new Error(Id)}var Dd=i("0bd3");function Ld(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Od(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function Rd(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const r="/";return e=e.map((t,i)=>(i&&(t=t.replace(new RegExp("^".concat(r)),"")),i!==e.length-1&&(t=t.replace(new RegExp("".concat(r,"$")),"")),t)),e.join(r)}function zd(){const t=[];for(let n=0;n<arguments.length;n++)t[n]=n<0||arguments.length<=n?void 0:arguments[n];let e,i="",r=!1;for(let n=t.length-1;n>=-1&&!r;n--){let o;n>=0?o=t[n]:(void 0===e&&(e=Object(Dd["a"])()),o=e),0!==o.length&&(i="".concat(o,"/").concat(i),r=o.charCodeAt(0)===Fd)}return i=Nd(i,!r),r?"/".concat(i):i.length>0?i:"."}const Fd=47,Bd=46;function Nd(t,e){let i,r="",n=-1,o=0,a=!1;for(let s=0;s<=t.length;++s){if(s<t.length)i=t.charCodeAt(s);else{if(i===Fd)break;i=Fd}if(i===Fd){if(n===s-1||1===o);else if(n!==s-1&&2===o){if(r.length<2||!a||r.charCodeAt(r.length-1)!==Bd||r.charCodeAt(r.length-2)!==Bd)if(r.length>2){const t=r.length-1;let e=t;for(;e>=0;--e)if(r.charCodeAt(e)===Fd)break;if(e!==t){r=-1===e?"":r.slice(0,e),n=s,o=0,a=!1;continue}}else if(2===r.length||1===r.length){r="",n=s,o=0,a=!1;continue}e&&(r.length>0?r+="/..":r="..",a=!0)}else{const e=t.slice(n+1,s);r.length>0?r+="/".concat(e):r=e,a=!1}n=s,o=0}else i===Bd&&-1!==o?++o:o=-1}return r}function jd(t,e,i){if(i)return i;const n={fetch:Gp(e,t),...t};if(n.url){const t=vp(n.url);n.baseUrl=t,n.queryString=yp(n.url),n.filename=r.filename(t),n.baseUrl=r.dirname(t)}return Array.isArray(n.loaders)||(n.loaders=null),n}function Ud(t,e){if(!e&&t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...t]:t}return i&&i.length?i:null}const Vd=new V({id:"loaders.gl"}),Gd=()=>{const t=Op();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function qd(t){const e=Gd();t=Array.isArray(t)?t:[t];for(const i of t){const t=lp(i);e.find(e=>t===e)||e.unshift(t)}}function Wd(){return Gd()}const Hd=/\.([^.]+)$/;async function Zd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Kd(t))return null;let n=Xd(t,e,{...i,nothrow:!0},r);if(n)return n;if(ep(t)&&(t=await t.slice(0,10).arrayBuffer(),n=Xd(t,e,i,r)),!n&&(null===i||void 0===i||!i.nothrow))throw new Error(Jd(t));return n}function Xd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Kd(t))return null;if(e&&!Array.isArray(e))return lp(e);let n=[];e&&(n=n.concat(e)),null!==i&&void 0!==i&&i.ignoreRegisteredLoaders||n.push(...Wd()),Qd(n);const o=Yd(t,n,i,r);if(!o&&(null===i||void 0===i||!i.nothrow))throw new Error(Jd(t));return o}function Yd(t,e,i,r){const n=_p(t),o=bp(t),a=vp(n)||(null===r||void 0===r?void 0:r.url);let s=null,l="";var u;(null!==i&&void 0!==i&&i.mimeType&&(s=ef(e,null===i||void 0===i?void 0:i.mimeType),l="match forced by supplied MIME type ".concat(null===i||void 0===i?void 0:i.mimeType)),s=s||$d(e,a),l=l||(s?"matched url ".concat(a):""),s=s||ef(e,o),l=l||(s?"matched MIME type ".concat(o):""),s=s||rf(e,t),l=l||(s?"matched initial data ".concat(sf(t)):""),s=s||ef(e,null===i||void 0===i?void 0:i.fallbackMimeType),l=l||(s?"matched fallback MIME type ".concat(o):""),l)&&Vd.log(1,"selectLoader selected ".concat(null===(u=s)||void 0===u?void 0:u.name,": ").concat(l,"."));return s}function Kd(t){return!(t instanceof Response&&204===t.status)}function Jd(t){const e=_p(t),i=bp(t);let n="No valid loader found (";n+=e?"".concat(r.filename(e),", "):"no url provided, ",n+="MIME type: ".concat(i?'"'.concat(i,'"'):"not provided",", ");const o=t?sf(t):"";return n+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",n+=")",n}function Qd(t){for(const e of t)lp(e)}function $d(t,e){const i=e&&Hd.exec(e),r=i&&i[1];return r?tf(t,r):null}function tf(t,e){e=e.toLowerCase();for(const i of t)for(const t of i.extensions)if(t.toLowerCase()===e)return i;return null}function ef(t,e){for(const i of t){if(i.mimeTypes&&i.mimeTypes.includes(e))return i;if(e==="application/x.".concat(i.id))return i}return null}function rf(t,e){if(!e)return null;for(const i of t)if("string"===typeof e){if(nf(e,i))return i}else if(ArrayBuffer.isView(e)){if(of(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer){const t=0;if(of(e,t,i))return i}return null}function nf(t,e){if(e.testText)return e.testText(t);const i=Array.isArray(e.tests)?e.tests:[e.tests];return i.some(e=>t.startsWith(e))}function of(t,e,i){const r=Array.isArray(i.tests)?i.tests:[i.tests];return r.some(r=>af(t,e,i,r))}function af(t,e,i,r){if(r instanceof ArrayBuffer)return dd(r,t,r.byteLength);switch(typeof r){case"function":return r(t,i);case"string":const n=lf(t,e,r.length);return r===n;default:return!1}}function sf(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"===typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return lf(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){const i=0;return lf(t,i,e)}return""}function lf(t,e,i){if(t.byteLength<e+i)return"";const r=new DataView(t);let n="";for(let o=0;o<i;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}async function uf(t,e,i,r){qp(!r||"object"===typeof r),!e||Array.isArray(e)||sp(e)||(r=void 0,i=e,e=void 0),t=await t,i=i||{};const n=_p(t),o=e,a=Ud(o,r),s=await Zd(t,a,i);return s?(i=zp(i,s,a,n),r=jd({url:n,parse:uf,loaders:a},i,r||null),await cf(s,t,i,r)):null}async function cf(t,e,i,r){if(Hp(t),tp(e)){const t=e,{ok:i,redirected:n,status:o,statusText:a,type:s,url:l}=t,u=Object.fromEntries(t.headers.entries());r.response={headers:u,ok:i,redirected:n,status:o,statusText:a,type:s,url:l}}if(e=await kd(e,t,i),t.parseTextSync&&"string"===typeof e)return i.dataType="text",t.parseTextSync(e,i,r,t);if(cd(t,i))return await hd(t,e,i,r,uf);if(t.parseText&&"string"===typeof e)return await t.parseText(e,i,r,t);if(t.parse)return await t.parse(e,i,r,t);throw qp(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function hf(t,e,i,r){Array.isArray(e)||sp(e)||(void 0,i=e,e=void 0);const n=Gp(i);let o=t;return"string"===typeof t&&(o=await n(t)),ep(t)&&(o=await n(t)),await uf(o,e,i)}const pf="layer.changeFlag",df="layer.initialize",ff="layer.update",mf="layer.finalize",gf="layer.matched",yf=2**24-1,vf=Object.freeze([]),_f=tc(({oldViewport:t,viewport:e})=>t.equals(e));let bf=new Uint8ClampedArray(0);const xf={data:{type:"data",value:vf,async:!0},dataComparator:null,_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:r,loadOptions:n,signal:o})=>{const{resourceManager:a}=i.context;var s;(n=n||i.getLoadOptions(),r=r||i.props.loaders,o)&&(n={...n,fetch:{...null===(s=n)||void 0===s?void 0:s.fetch,signal:o}});let l=a.contains(t);return l||n||(a.add({resourceId:t,data:hf(t,r),persistent:!1}),l=!0),l?a.subscribe({resourceId:t,onChange:t=>i.internalState.reloadAsyncProp(e,t),consumerId:i.id,requestId:e}):hf(t,r,n)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:K.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,100*-t],compare:!1},highlightedObjectIndex:-1,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class wf extends Hh{toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}raiseError(t,e){var i,r,n,o;(e&&(t.message="".concat(e,": ").concat(t.message)),null===(i=(r=this.props).onError)||void 0===i?void 0:i.call(r,t))||(null===(n=this.context)||void 0===n||null===(o=n.onError)||void 0===o||o.call(n,t,this))}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(t=!0){this.internalState&&(this.internalState.needsRedraw=t)}setNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}hasUniformTransition(){return this.internalState.uniformTransitions.active}get isLoaded(){return this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}project(t){const{viewport:e}=this.context,i=uh(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,n,o]=Nc(i,e.pixelProjectionMatrix);return 2===t.length?[r,n]:[r,n,o]}unproject(t){const{viewport:e}=this.context;return e.unproject(t)}projectPosition(t){return ch(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===K.DEFAULT||t===K.LNGLAT||t===K.CARTESIAN}onHover(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}onClick(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Jn(t instanceof Uint8Array);const[e,i,r]=t,n=e+256*i+65536*r-1;return n}initializeState(){throw new Error("Layer ".concat(this," has not defined initializeState"))}getShaders(t){for(const e of this.props.extensions)t=ec(t,e.getShaders.call(this,e));return t}shouldUpdateState({oldProps:t,props:e,context:i,changeFlags:r}){return r.propsOrDataChanged}updateState({oldProps:t,props:e,context:i,changeFlags:r}){const n=this.getAttributeManager();if(r.dataChanged&&n){const{dataChanged:t}=r;if(Array.isArray(t))for(const e of t)n.invalidateAll(e);else n.invalidateAll()}const o=t.highlightedObjectIndex>=0||t.pickable,a=e.highlightedObjectIndex>=0||e.pickable;if(o!==a&&n){const{pickingColors:t,instancePickingColors:e}=n.attributes,i=t||e;i&&(a&&i.constant&&(i.constant=!1,n.invalidate(i.id)),i.value||a||(i.constant=!0,i.value=[0,0,0]))}}finalizeState(){for(const e of this.getModels())e.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo({info:t,mode:e}){const{index:i}=t;return i>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[i]),t}activateViewport(t){const e=this.internalState.viewport;this.internalState.viewport=t,e&&_f({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all",e=""){const i=this.getAttributeManager();i&&("all"===t?i.invalidateAll():i.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(t){const e=this.getAttributeManager();if(!e)return;const i=this.getNumInstances(t),r=this.getStartIndices(t);e.update({data:t.data,numInstances:i,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this,ignoreUnknownAttributes:!0});const n=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),i=Object.create(this.props);for(const t in e)Object.defineProperty(i,t,{value:e[t]});return i}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const i=Math.floor(bf.length/3);if(this.internalState.usesPickingColorCache=!0,i<e){e>yf&&Y.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),bf=cr.allocate(bf,e,{size:3,copy:!0,maxCount:Math.max(e,yf)});const t=Math.floor(bf.length/3),r=[];for(let e=i;e<t;e++)this.encodePickingColor(e,r),bf[3*e+0]=r[0],bf[3*e+1]=r[1],bf[3*e+2]=r[2]}t.value=bf.subarray(0,3*e)}_setModelAttributes(t,e){const i=this.getAttributeManager(),r=t.userData.excludeAttributes||{},n=i.getShaderAttributes(e,r);t.setAttributes(n)}disablePickingIndex(t){this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,r=e||i,n=r.getVertexOffset(t),o=r.getVertexOffset(t+1);r.buffer.subData({data:new Uint8Array(o-n),offset:n})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,i=t||e;this.internalState.usesPickingColorCache&&i.value.buffer!==bf.buffer&&(i.value=bf.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0})}getNumInstances(t){return t=t||this.props,void 0!==t.numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Ku(t.data)}getStartIndices(t){return t=t||this.props,void 0!==t.startIndices?t.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}_initialize(){wo(df,this),this._initState(),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}_update(){const t=this.needsUpdate();wo(ff,this,t),t&&this._updateState()}_updateState(){const t=this.props,e=this.context.viewport,i=this._updateUniformTransition();this.internalState.propsInTransition=i,this.context.viewport=this.internalState.viewport||e,this.props=i;try{const i=this._getUpdateParams(),n=this.getModels();if(this.context.gl)this.updateState(i);else try{this.updateState(i)}catch(r){}for(const t of this.props.extensions)t.updateState.call(this,i,t);const o=this.getModels()[0]!==n[0];this._updateModules(i,o),this.isComposite?this._renderLayers(i):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=e,this.props=t,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}_finalize(){wo(mf,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,t)}drawLayer({moduleParameters:t=null,uniforms:e={},parameters:i={}}){this._updateAttributeTransition();const r=this.props;this.props=this.internalState.propsInTransition||r;const{opacity:n}=this.props;e.opacity=Math.pow(n,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:n}=this.props,o=n&&n(e)||[0,0];de(this.context.gl,{polygonOffset:o}),ge(this.context.gl,i,()=>{const r={moduleParameters:t,uniforms:e,parameters:i,context:this.context};for(const t of this.props.extensions)t.draw.call(this,r,t);this.draw(r)})}finally{this.props=r}}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(t){const{changeFlags:e}=this.internalState;for(const r in t)if(t[r]){let i=!1;switch(r){case"dataChanged":Array.isArray(e[r])&&(e[r]=Array.isArray(t[r])?e[r].concat(t[r]):t[r],i=!0);default:e[r]||(e[r]=t[r],i=!0)}i&&wo(pf,this,r,t)}const i=e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged;e.propsOrDataChanged=i,e.somethingChanged=i||t.viewportChanged||t.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}diffProps(t,e){const i=Nu(t,e);if(i.updateTriggersChanged)for(const r in i.updateTriggersChanged)i.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(i.transitionsChanged)for(const r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,e[r],t[r],t.transitions[r]);return this.setChangeFlags(i)}validateProps(){Bu(this.props)}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}updateAutoHighlight(t){this.props.autoHighlight&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&"function"===typeof i&&(e.pickingHighlightColor=i(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_updateModules({props:t,oldProps:e},i){const{autoHighlight:r,highlightedObjectIndex:n,highlightColor:o}=t;if(i||e.autoHighlight!==r||e.highlightedObjectIndex!==n||e.highlightColor!==o){const t={};r||(t.pickingSelectedColor=null),Array.isArray(o)&&(t.pickingHighlightColor=o),Number.isInteger(n)&&(t.pickingSelectedColor=n>=0?this.encodePickingColor(n):null),this.setModuleParameters(t)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;const i=this.getAttributeManager(),r=i&&i.getNeedsRedraw(t);return e=e||r,e}_getAttributeManager(){return new Au(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}_initState(){Jn(!this.internalState&&!this.state),Jn(isFinite(this.props.coordinateSystem));const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Zh({attributeManager:t,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Y.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),t)}),this.internalState.layer=this,this.internalState.uniformTransitions=new Ou(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(t){wo(gf,this,this===t);const{state:e,internalState:i}=t;this!==t&&(this.internalState=i,this.internalState.layer=this,this.state=e,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}wf.layerName="Layer",wf.defaultProps=xf;const Tf="#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",Ef={name:"fp32",vs:Tf,fs:null},Sf=Object.keys(K).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(K[t],";")).join(""),Af=Object.keys(J).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(J[t],";")).join("");var Cf="".concat(Sf,"\n").concat(Af,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n");const Pf={};function If(t=Pf){return t.viewport?cc(t):{}}var Mf={name:"project",dependencies:[Ef],vs:Cf,getUniforms:If};const kf="\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    mat3 rotation = project_get_orientation_matrix(projectedPosition);\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n";var Df={name:"project32",dependencies:[Mf],vs:kf},Lf="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n";const Of={lightSources:{}};function Rf(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.map(t=>t*e/255)}function zf(t){let{ambientLight:e,pointLights:i=[],directionalLights:r=[]}=t;const n={};return n["lighting_uAmbientLight.color"]=e?Rf(e):[0,0,0],i.forEach((t,e)=>{n["lighting_uPointLight[".concat(e,"].color")]=Rf(t),n["lighting_uPointLight[".concat(e,"].position")]=t.position,n["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]}),n.lighting_uPointLightCount=i.length,r.forEach((t,e)=>{n["lighting_uDirectionalLight[".concat(e,"].color")]=Rf(t),n["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction}),n.lighting_uDirectionalLightCount=r.length,n}function Ff(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Of;if("lightSources"in t){const{ambientLight:e,pointLights:i,directionalLights:r}=t.lightSources||{},n=e||i&&i.length>0||r&&r.length>0;return n?Object.assign({},zf({ambientLight:e,pointLights:i,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const i of t.lights||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":e.directionalLights.push(i);break;case"point":e.pointLights.push(i);break;default:}return Ff({lightSources:e})}return{}}const Bf={name:"lights",vs:Lf,fs:Lf,getUniforms:Ff,defines:{MAX_LIGHTS:3}};var Nf="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";const jf={};function Uf(t){const{ambient:e=.35,diffuse:i=.6,shininess:r=32,specularColor:n=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:r,lighting_uSpecularColor:n.map(t=>t/255)}}function Vf(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jf;if(!("material"in t))return{};const{material:e}=t;return e?Uf(e):{lighting_uEnabled:!1}}const Gf={name:"gouraud-lighting",dependencies:[Bf],vs:Nf,defines:{LIGHTING_VERTEX:1},getUniforms:Vf},qf=new Uint8Array([0,255,255,255]),Wf={pickingSelectedColor:null,pickingHighlightColor:qf,pickingActive:!1,pickingAttribute:!1};function Hf(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wf;const e={};if(void 0!==t.pickingSelectedColor)if(t.pickingSelectedColor){const i=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=i}else e.picking_uSelectedColorValid=0;if(t.pickingHighlightColor){const i=Array.from(t.pickingHighlightColor,t=>t/255);Number.isFinite(i[3])||(i[3]=1),e.picking_uHighlightColor=i}return void 0!==t.pickingActive&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const Zf="uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",Xf="uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",Yf={name:"picking",vs:Zf,fs:Xf,getUniforms:Hf};var Kf={inject:{"vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  // for picking depth values\n  picking_setPickingAttribute(geometry.position.z);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...Yf};const Jf={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Qf{static get DRAW_MODE(){return Jf}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:e=He("geometry"),drawMode:i=Jf.TRIANGLES,attributes:r={},indices:n=null,vertexCount:o=null}=t;this.id=e,this.drawMode=0|i,this.attributes={},this.userData={},this._setAttributes(r,n),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const i in t){let e=t[i];e=ArrayBuffer.isView(e)?{value:e}:e,Ve(ArrayBuffer.isView(e.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),"POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i?(Ve(!this.indices),this.indices=e):this.attributes[i]=e}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let i=1/0;for(const r in t){const e=t[r],{value:n,size:o,constant:a}=e;!a&&n&&o>=1&&(i=Math.min(i,n.length/o))}return Ve(Number.isFinite(i)),i}}const $f={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function tm(t,e,i={}){const r=em(t,i);return r!==e&&(rm(t,i),!0)}function em(t,e={}){return Math.sign(im(t,e))}function im(t,e={}){const{start:i=0,end:r=t.length}=e,n=e.size||2;let o=0;for(let a=i,s=r-n;a<r;a+=n)o+=(t[a]-t[s])*(t[a+1]+t[s+1]),s=a;return o/2}function rm(t,e){const{start:i=0,end:r=t.length,size:n=2}=e,o=(r-i)/n,a=Math.floor(o/2);for(let s=0;s<a;++s){const e=i+s*n,r=i+(o-1-s)*n;for(let i=0;i<n;++i){const n=t[e+i];t[e+i]=t[r+i],t[r+i]=n}}}class nm extends Qf{constructor(t={}){const{id:e=He("column-geometry")}=t,{indices:i,attributes:r}=om(t);super({...t,id:e,indices:i,attributes:r})}}function om(t){const{radius:e,height:i=1,nradial:r=10}=t;let{vertices:n}=t;n&&(Y.assert(n.length>=r),n=n.flatMap(t=>[t[0],t[1]]),tm(n,$f.COUNTER_CLOCKWISE));const o=i>0,a=r+1,s=o?3*a+1:r,l=2*Math.PI/r,u=new Uint16Array(o?3*r*2:0),c=new Float32Array(3*s),h=new Float32Array(3*s);let p=0;if(o){for(let t=0;t<a;t++){const o=t*l,a=t%r,s=Math.sin(o),u=Math.cos(o);for(let t=0;t<2;t++)c[p+0]=n?n[2*a]:u*e,c[p+1]=n?n[2*a+1]:s*e,c[p+2]=(.5-t)*i,h[p+0]=n?n[2*a]:u,h[p+1]=n?n[2*a+1]:s,p+=3}c[p+0]=c[p-3],c[p+1]=c[p-2],c[p+2]=c[p-1],p+=3}for(let d=o?0:1;d<a;d++){const t=Math.floor(d/2)*Math.sign(.5-d%2),o=t*l,a=(t+r)%r,s=Math.sin(o),u=Math.cos(o);c[p+0]=n?n[2*a]:u*e,c[p+1]=n?n[2*a+1]:s*e,c[p+2]=i/2,h[p+2]=1,p+=3}if(o){let t=0;for(let e=0;e<r;e++)u[t++]=2*e+0,u[t++]=2*e+2,u[t++]=2*e+0,u[t++]=2*e+1,u[t++]=2*e+1,u[t++]=2*e+3}return{indices:u,attributes:{POSITION:{size:3,value:c},NORMAL:{size:3,value:h}}}}var am="\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio -= sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",sm="#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n";const lm=[0,0,0,255],um={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:lm},getLineColor:{type:"accessor",value:lm},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class cm extends wf{getShaders(){return super.getShaders({vs:am,fs:sm,modules:[Df,Gf,Kf]})}initializeState(){const t=this.getAttributeManager();t.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:lm},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:lm},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState({props:t,oldProps:e,changeFlags:i}){super.updateState({props:t,oldProps:e,changeFlags:i});const r=i.extensionsChanged;if(r){var n;const{gl:t}=this.context;null===(n=this.state.model)||void 0===n||n.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}(r||t.diskResolution!==e.diskResolution||t.vertices!==e.vertices||(t.extruded||t.stroked)!==(e.extruded||e.stroked))&&this._updateGeometry(t)}getGeometry(t,e,i){const r=new nm({radius:1,height:i?2:0,vertices:e,nradial:t});let n=0;if(e)for(let o=0;o<t;o++){const i=e[o],r=Math.sqrt(i[0]*i[0]+i[1]*i[1]);n+=r/t}else n=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*n}),r}_getModel(t){return new nu(t,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:t,vertices:e,extruded:i,stroked:r}){const n=this.getGeometry(t,e,i||r);this.setState({fillVertexCount:n.attributes.POSITION.value.length/3,wireframeVertexCount:n.indices.value.length}),this.state.model.setProps({geometry:n})}draw({uniforms:t}){const{viewport:e}=this.context,{lineWidthUnits:i,lineWidthScale:r,lineWidthMinPixels:n,lineWidthMaxPixels:o,elevationScale:a,extruded:s,filled:l,stroked:u,wireframe:c,offset:h,coverage:p,radius:d,angle:f}=this.props,{model:m,fillVertexCount:g,wireframeVertexCount:y,edgeDistance:v}=this.state,_="pixels"===i?e.metersPerPixel:1;m.setUniforms(t).setUniforms({radius:d,angle:f/180*Math.PI,offset:h,extruded:s,coverage:p,elevationScale:a,edgeDistance:v,widthScale:r*_,widthMinPixels:n,widthMaxPixels:o}),s&&c&&(m.setProps({isIndexed:!0}),m.setVertexCount(y).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(m.setProps({isIndexed:!1}),m.setVertexCount(g).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!s&&u&&(m.setProps({isIndexed:!1}),m.setVertexCount(2*g/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}cm.layerName="ColumnLayer",cm.defaultProps=um;const hm=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function pm(t,e=!1,i=Float32Array){let r;if(Number.isFinite(t[0]))r=new i(t);else{r=new i(4*t.length);let e=0;for(let i=0;i<t.length;i++){const n=t[i];r[e++]=n[0],r[e++]=n[1],r[e++]=n[2],r[e++]=Number.isFinite(n[3])?n[3]:255}}if(e)for(let n=0;n<r.length;n++)r[n]/=255;return r}var dm=Math.PI/3,fm=[0,dm,2*dm,3*dm,4*dm,5*dm];function mm(t){return t[0]}function gm(t){return t[1]}var ym=function(){var t,e,i,r=0,n=0,o=1,a=1,s=mm,l=gm;function u(t){var r,n={},o=[],a=t.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,u=t[r],r,t))&&!isNaN(h=+l.call(null,u,r,t))){var u,c,h,p=Math.round(h/=i),d=Math.round(c=c/e-(1&p)/2),f=h-p;if(3*Math.abs(f)>1){var m=c-d,g=d+(c<d?-1:1)/2,y=p+(h<p?-1:1),v=c-g,_=h-y;m*m+f*f>v*v+_*_&&(d=g+(1&p?1:-1)/2,p=y)}var b=d+"-"+p,x=n[b];x?x.push(u):(o.push(x=n[b]=[u]),x.x=(d+(1&p)/2)*e,x.y=p*i)}return o}function c(t){var e=0,i=0;return fm.map((function(r){var n=Math.sin(r)*t,o=-Math.cos(r)*t,a=n-e,s=o-i;return e=n,i=o,[a,s]}))}return u.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},u.centers=function(){for(var s=[],l=Math.round(n/i),u=Math.round(r/e),c=l*i;c<a+t;c+=i,++l)for(var h=u*e+(1&l)*e/2;h<o+e/2;h+=e)s.push([h,c]);return s},u.mesh=function(){var e=c(t).slice(0,4).join("l");return u.centers().map((function(t){return"M"+t+"m"+e})).join("")},u.x=function(t){return arguments.length?(s=t,u):s},u.y=function(t){return arguments.length?(l=t,u):l},u.radius=function(r){return arguments.length?(t=+r,e=2*t*Math.sin(dm),i=1.5*t,u):t},u.size=function(t){return arguments.length?(r=n=0,o=+t[0],a=+t[1],u):[o-r,a-n]},u.extent=function(t){return arguments.length?(r=+t[0][0],n=+t[0][1],o=+t[1][0],a=+t[1][1],u):[[r,n],[o,a]]},u.radius(1)};function vm(t,e){const{data:i,radius:r}=t,{viewport:n,attributes:o}=e,a=i.length?_m(i,e):null,s=bm(r,n,a),l=[],{iterable:u,objectInfo:c}=to(i),h=o.positions.value,{size:p}=o.positions.getAccessor();for(const m of u){c.index++;const t=c.index*p,e=[h[t],h[t+1]],i=Number.isFinite(e[0])&&Number.isFinite(e[1]);i?l.push({screenCoord:n.projectFlat(e),source:m,index:c.index}):Y.warn("HexagonLayer: invalid position")()}const d=ym().radius(s).x(t=>t.screenCoord[0]).y(t=>t.screenCoord[1]),f=d(l);return{hexagons:f.map((t,e)=>({position:n.unprojectFlat([t.x,t.y]),points:t,index:e})),radiusCommon:s}}function _m(t,e){const{attributes:i}=e,r=i.positions.value,{size:n}=i.positions.getAccessor();let o,a=1/0,s=1/0,l=-1/0,u=-1/0;for(o=0;o<n*t.length;o+=n){const t=r[o],e=r[o+1],i=Number.isFinite(t)&&Number.isFinite(e);i&&(a=Math.min(t,a),l=Math.max(t,l),s=Math.min(e,s),u=Math.max(e,u))}return[a,s,l,u].every(Number.isFinite)?[(a+l)/2,(s+u)/2]:null}function bm(t,e,i){const{unitsPerMeter:r}=e.getDistanceScales(i);return t*r[0]}function xm(t,e,i){const r=i;return r.domain=()=>t,r.range=()=>e,r}function wm(t,e){const i=i=>km(t,e,i);return xm(t,e,i)}function Tm(t,e){const i=i=>Dm(t,e,i);return xm(t,e,i)}function Em(t,e){const i=t.sort(Sm);let r=0;const n=Math.max(1,e.length),o=new Array(n-1);while(++r<n)o[r-1]=Am(i,r/n);const a=t=>Pm(o,e,t);return a.thresholds=()=>o,xm(t,e,a)}function Sm(t,e){return t-e}function Am(t,e){const i=t.length;if(e<=0||i<2)return t[0];if(e>=1)return t[i-1];const r=(i-1)*e,n=Math.floor(r),o=t[n],a=t[n+1];return o+(a-o)*(r-n)}function Cm(t,e){let i=0,r=t.length;while(i<r){const n=i+r>>>1;Sm(t[n],e)>0?r=n:i=n+1}return i}function Pm(t,e,i){return e[Cm(t,i)]}function Im(t,e,i,r){const n="".concat(r);let o=e.get(n);return void 0===o&&(o=t.push(r),e.set(n,o)),i[(o-1)%i.length]}function Mm(t,e){const i=new Map,r=[];for(const o of t){const t="".concat(o);i.has(t)||i.set(t,r.push(o))}const n=t=>Im(r,i,e,t);return xm(t,e,n)}function km(t,e,i){const r=t[1]-t[0];if(r<=0)return Y.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const n=r/e.length,o=Math.floor((i-t[0])/n),a=Math.max(Math.min(o,e.length-1),0);return e[a]}function Dm(t,e,i){return(i-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}function Lm(t){return void 0!==t&&null!==t}function Om(t){const e=[];return t.forEach(t=>{!e.includes(t)&&Lm(t)&&e.push(t)}),e}function Rm(t,e){const i="function"===typeof e?t.map(e):t;return i.filter(Lm)}function zm(t,e){return Rm(t,e)}function Fm(t,e){return Om(Rm(t,e))}function Bm(t,e,i){return Math.max(e,Math.min(i,t))}function Nm(t){switch(t){case"quantize":return wm;case"linear":return Tm;case"quantile":return Em;case"ordinal":return Mm;default:return wm}}const jm=t=>t.length,Um=3402823466e29,Vm=t=>t.points,Gm=t=>t.index,qm=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,Wm={getValue:jm,getPoints:Vm,getIndex:Gm,filterData:null};class Hm{constructor(t=[],e=Wm){this.aggregatedBins=this.getAggregatedBins(t,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,e){const{getValue:i=jm,getPoints:r=Vm,getIndex:n=Gm,filterData:o}=e,a="function"===typeof o,s=t.length,l=[];let u=0;for(let c=0;c<s;c++){const e=t[c],s=r(e),h=n(e),p=a?s.filter(o):s;e.filteredPoints=a?p:null;const d=p.length?i(p):null;null!==d&&void 0!==d&&(l[u]={i:Number.isFinite(h)?h:c,value:d,counts:p.length},u++)}return l}_percentileToIndex(t){const e=this.sortedBins.length;if(e<2)return[0,0];const[i,r]=t.map(t=>Bm(t,0,100)),n=Math.ceil(i/100*(e-1)),o=Math.floor(r/100*(e-1));return[n,o]}getBinMap(){const t={};for(const e of this.aggregatedBins)t[e.i]=e;return t}_updateMinMaxValues(){let t=0,e=0,i=Um,r=0;for(const n of this.aggregatedBins)t=t>n.counts?t:n.counts,e=e>n.value?e:n.value,i=i<n.value?i:n.value,r+=n.counts;this.maxCount=t,this.maxValue=e,this.minValue=i,this.totalCount=r}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>qm(t.value,e.value))),!this.sortedBins.length)return[];let e=0,i=this.sortedBins.length-1;if(Array.isArray(t)){const r=this._percentileToIndex(t);e=r[0],i=r[1]}return[this.sortedBins[e].value,this.sortedBins[i].value]}getValueDomainByScale(t,[e=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>qm(t.value,e.value))),!this.sortedBins.length)return[];const r=this._percentileToIndex([e,i]);return this._getScaleDomain(t,r)}_getScaleDomain(t,[e,i]){const r=this.sortedBins;switch(t){case"quantize":case"linear":return[r[e].value,r[i].value];case"quantile":return zm(r.slice(e,i+1),t=>t.value);case"ordinal":return Fm(r,t=>t.value);default:return[r[e].value,r[i].value]}}}const Zm={SUM:1,MEAN:2,MIN:3,MAX:4};function Xm(t,e){return t+e}function Ym(t,e){return e>t?e:t}function Km(t,e){return e<t?e:t}function Jm(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(Xm,0)/i.length:null}function Qm(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(Xm,0):null}function $m(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(Ym,-1/0):null}function tg(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(Km,1/0):null}function eg(t,e,i){const r=Zm[t]||Zm.SUM;switch(e=ig(e,i),r){case Zm.MIN:return t=>tg(t,e);case Zm.SUM:return t=>Qm(t,e);case Zm.MEAN:return t=>Jm(t,e);case Zm.MAX:return t=>$m(t,e);default:return null}}function ig(t,e={}){return Number.isFinite(t)?t:i=>(e.index=i.index,t(i.source,e))}function rg(t,e={}){return i=>(e.indices=i.map(t=>t.index),t(i.map(t=>t.source),e))}function ng(){}const og=["getBins","getDomain","getScaleFunc"],ag=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],sg=t=>t.cellSize;class lg{constructor(t){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||sg,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||ag)}static defaultDimensions(){return ag}updateState(t,e){const{oldProps:i,props:r,changeFlags:n}=t;this.updateGetValueFuncs(i,r,n);const o=this.needsReProjectPoints(i,r,n);let a=!1;if(n.dataChanged||o)this.getAggregatedData(r,e),a=!0;else{const t=this.getDimensionChanges(i,r,n)||[];t.forEach(t=>"function"===typeof t&&t()),a=!0}return this.setState({aggregationDirty:a}),this.state}setState(t){this.state={...this.state,...t}}setDimensionState(t,e){this.setState({dimensions:{...this.state.dimensions,[t]:{...this.state.dimensions[t],...e}}})}normalizeResult(t={}){return t.hexagons?{data:t.hexagons,...t}:t.layerData?{data:t.layerData,...t}:t}getAggregatedData(t,e){const i=this._getAggregator(t),r=i(t,e);this.setState({layerData:this.normalizeResult(r)}),this.changeFlags={layerData:!0},this.getSortedBins(t)}updateGetValueFuncs(t,e,i){for(const r in this.dimensionUpdaters){const{value:n,weight:o,aggregation:a}=this.dimensionUpdaters[r].getBins.triggers;let s=e[n.prop];const l=this.needUpdateDimensionStep(this.dimensionUpdaters[r].getBins,t,e,i);l&&(s=s?rg(s,{data:e.data}):eg(e[a.prop],e[o.prop],{data:e.data})),s&&this.setDimensionState(r,{getValue:s})}}needsReProjectPoints(t,e,i){return this._getCellSize(t)!==this._getCellSize(e)||this._getAggregator(t)!==this._getAggregator(e)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}addDimension(t){this._addDimension(t)}_addDimension(t=[]){t.forEach(t=>{const{key:e}=t;this.dimensionUpdaters[e]=this.getDimensionUpdaters(t),this.state.dimensions[e]={getValue:null,domain:null,sortedBins:null,scaleFunc:ng}})}getDimensionUpdaters({key:t,accessor:e,pickingInfo:i,getBins:r,getDomain:n,getScaleFunc:o,nullValue:a}){return{key:t,accessor:e,pickingInfo:i,getBins:{updater:this.getDimensionSortedBins,...r},getDomain:{updater:this.getDimensionValueDomain,...n},getScaleFunc:{updater:this.getDimensionScale,...o},attributeAccessor:this.getSubLayerDimensionAttribute(t,a)}}needUpdateDimensionStep(t,e,i,r){return Object.values(t.triggers).some(t=>t.updateTrigger?r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged[t.updateTrigger]):e[t.prop]!==i[t.prop])}getDimensionChanges(t,e,i){const r=[];for(const n in this.dimensionUpdaters){const o=og.find(r=>this.needUpdateDimensionStep(this.dimensionUpdaters[n][r],t,e,i));o&&r.push(this.dimensionUpdaters[n][o].updater.bind(this,e,this.dimensionUpdaters[n]))}return r.length?r:null}getUpdateTriggers(t){const e=t.updateTriggers||{},i={};for(const r in this.dimensionUpdaters){const{accessor:n}=this.dimensionUpdaters[r];i[n]={},og.forEach(o=>{Object.values(this.dimensionUpdaters[r][o].triggers).forEach(({prop:r,updateTrigger:o})=>{if(o){const t=e[o];"object"!==typeof t||Array.isArray(t)?void 0!==t&&(i[n][r]=t):Object.assign(i[n],t)}else i[n][r]=t[r]})})}return i}getSortedBins(t){for(const e in this.dimensionUpdaters)this.getDimensionSortedBins(t,this.dimensionUpdaters[e])}getDimensionSortedBins(t,e){const{key:i}=e,{getValue:r}=this.state.dimensions[i],n=new Hm(this.state.layerData.data||[],{getValue:r,filterData:t._filterData});this.setDimensionState(i,{sortedBins:n}),this.getDimensionValueDomain(t,e)}getDimensionValueDomain(t,e){const{getDomain:i,key:r}=e,{triggers:{lowerPercentile:n,upperPercentile:o,scaleType:a}}=i,s=this.state.dimensions[r].sortedBins.getValueDomainByScale(t[a.prop],[t[n.prop],t[o.prop]]);this.setDimensionState(r,{valueDomain:s}),this.getDimensionScale(t,e)}getDimensionScale(t,e){const{key:i,getScaleFunc:r,getDomain:n}=e,{domain:o,range:a}=r.triggers,{scaleType:s}=n.triggers,{onSet:l}=r,u=t[a.prop],c=t[o.prop]||this.state.dimensions[i].valueDomain,h=Nm(s&&t[s.prop]),p=h(c,u);"object"===typeof l&&"function"===typeof t[l.props]&&t[l.props](p.domain()),this.setDimensionState(i,{scaleFunc:p})}getSubLayerDimensionAttribute(t,e){return i=>{const{sortedBins:r,scaleFunc:n}=this.state.dimensions[t],o=r.binMap[i.index];if(o&&0===o.counts)return e;const a=o&&o.value,s=n.domain(),l=a>=s[0]&&a<=s[s.length-1];return l?n(a):e}}getSubLayerAccessors(t){const e={};for(const i in this.dimensionUpdaters){const{accessor:r}=this.dimensionUpdaters[i];e[r]=this.getSubLayerDimensionAttribute(t,i)}return e}getPickingInfo({info:t}){const e=t.picked&&t.index>-1;let i=null;if(e){const e=this.state.layerData.data[t.index],r={};for(const t in this.dimensionUpdaters){const{pickingInfo:i}=this.dimensionUpdaters[t],{sortedBins:n}=this.state.dimensions[t],o=n.binMap[e.index]&&n.binMap[e.index].value;r[i]=o}i=Object.assign(r,e,{points:e.filteredPoints||e.points})}return t.picked=Boolean(i),t.object=i,t}getAccessor(t){return this.dimensionUpdaters.hasOwnProperty(t)?this.dimensionUpdaters[t].attributeAccessor:ng}}const ug="compositeLayer.renderLayers";class cg extends wf{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t,i=e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id;return i?(t.object=e.__source.object,t.index=e.__source.index,t):t}renderLayers(){return null}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||e}getSubLayerRow(t,e,i){return t.__source={parent:this,object:e,index:i},t}getSubLayerAccessor(t){if("function"===typeof t){const e={data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(e.index=i.__source.index,t(i.__source.object,e)):t(i,r)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:i,visible:r,parameters:n,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:s,highlightColor:l,coordinateSystem:u,coordinateOrigin:c,wrapLongitude:h,positionFormat:p,modelMatrix:d,extensions:f,fetch:m,_subLayerProps:g}=this.props,y={opacity:e,pickable:i,visible:r,parameters:n,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:s,highlightColor:l,coordinateSystem:u,coordinateOrigin:c,wrapLongitude:h,positionFormat:p,modelMatrix:d,extensions:f,fetch:m},v=g&&g[t.id],_=v&&v.updateTriggers,b=t.id||"sublayer";if(v){const e=this.constructor._propTypes,i=t.type?t.type._propTypes:{};for(const t in v){const r=i[t]||e[t];r&&"accessor"===r.type&&(v[t]=this.getSubLayerAccessor(v[t]))}}Object.assign(y,t,v),y.id="".concat(this.props.id,"-").concat(b),y.updateTriggers={all:this.props.updateTriggers.all,...t.updateTriggers,..._};for(const x of f){const t=x.getSubLayerProps.call(this,x);t&&Object.assign(y,t,{updateTriggers:Object.assign(y.updateTriggers,t.updateTriggers)})}return y}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:t}=this.internalState;const e=!t||this.needsUpdate();e&&(t=this.renderLayers(),t=ro(t,Boolean),this.internalState.subLayers=t),wo(ug,this,e,t);for(const i of t)i.parent=this}}function hg(t,e){const i={};for(const r in t)e.includes(r)||(i[r]=t[r]);return i}cg.layerName="CompositeLayer";class pg extends cg{initializeState(t){super.initializeState(),this.setState({ignoreProps:hg(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes(t.props)}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:i}=this.context,r=Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:ye(i)});return r}updateShaders(t){}isAggregationDirty(t,e={}){const{props:i,oldProps:r,changeFlags:n}=t,{compareAll:o=!1,dimension:a}=e,{ignoreProps:s}=this.state,{props:l,accessors:u=[]}=a,{updateTriggersChanged:c}=n;if(n.dataChanged)return!0;if(c){if(c.all)return!0;for(const t of u)if(c[t])return!0}if(o)return!!n.extensionsChanged||Uu({oldProps:r,newProps:i,ignoreProps:s,propTypes:this.constructor._propTypes});for(const h of l)if(i[h]!==r[h])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!dg(e)}_getAttributeManager(){return new Au(this.context.gl,{id:this.props.id,stats:this.context.stats})}}function dg(t){let e=!0;for(const i in t){e=!1;break}return e}function fg(){}pg.layerName="AggregationLayer";const mg={colorDomain:null,colorRange:hm,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:fg,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:fg,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:vm,getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class gg extends pg{shouldUpdateState({changeFlags:t}){return t.somethingChanged}initializeState(){const t=new lg({getAggregator:t=>t.hexagonAggregator,getCellSize:t=>t.radius});this.state={cpuAggregator:t,aggregatorState:t.state,hexagonVertices:null};const e=this.getAttributeManager();e.add({positions:{size:3,accessor:"getPosition"}})}updateState(t){super.updateState(t);const{cpuAggregator:e,hexagonVertices:i}=this.state;t.changeFlags.propsOrDataChanged&&this.setState({aggregatorState:e.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes()})});const{hexagonVertices:r}=e.state.layerData||{};if(r&&i!==r){const t=this.convertLatLngToMeterOffset(r);t&&this.setState({hexagonVertices:r,vertices:t})}else this.updateRadiusAngle()}updateRadiusAngle(t){const{viewport:e}=this.context,{unitsPerMeter:i}=e.getDistanceScales(),{cpuAggregator:r}=this.state;if(r.state.layerData&&r.state.layerData.radiusCommon){const{radiusCommon:t}=r.state.layerData,e=t/i[0];this.setState({angle:90,radius:e})}}convertLatLngToMeterOffset(t){const{viewport:e}=this.context;if(Array.isArray(t)&&6===t.length){const i=t[0],r=t[3],n=[(i[0]+r[0])/2,(i[1]+r[1])/2],o=e.projectFlat(n),{metersPerUnit:a}=e.getDistanceScales(n),s=t.map(t=>{const i=e.projectFlat(t);return[(i[0]-o[0])*a[0],(i[1]-o[1])*a[1]]});return s}return Y.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,coverage:i,material:r,transitions:n}=this.props,{angle:o,radius:a,cpuAggregator:s,vertices:l}=this.state,u=this.getSubLayerClass("hexagon-cell",cm),c=this._getSublayerUpdateTriggers(),h=l&&l.length?{vertices:l,radius:1}:{radius:a,angle:o};return new u({...h,diskResolution:6,elevationScale:t,extruded:e,coverage:i,material:r,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:n&&{getFillColor:n.getColorValue||n.getColorWeight,getElevation:n.getElevationValue||n.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:c}),{data:s.state.layerData.data})}}function yg(t){const e=t.map(t=>t[0]),i=t.map(t=>t[1]),r=Math.min.apply(null,e),n=Math.max.apply(null,e),o=Math.min.apply(null,i),a=Math.max.apply(null,i);return[r,o,n,a]}function vg(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}gg.layerName="HexagonLayer",gg.defaultProps=mg;const _g=new Float32Array(12);function bg(t,e=2){let i=0;for(const r of t)for(let t=0;t<e;t++)_g[i++]=r[t]||0;return _g}function xg(t,e,i){const[r,n,o,a]=t,s=o-r,l=a-n;let u=s,c=l;s/l<e/i?u=e/i*l:c=i/e*s,u<e&&(u=e,c=i);const h=(o+r)/2,p=(a+n)/2;return[h-u/2,p-c/2,h+u/2,p+c/2]}function wg(t,e){const[i,r,n,o]=e;return[(t[0]-i)/(n-i),(t[1]-r)/(o-r)]}function Tg({gl:t,floatTargetSupport:e}){return{format:nt(t)?34836:6408,type:e?5126:5121}}var Eg="#define SHADER_NAME heatp-map-layer-vertex-shader\n\nuniform sampler2D maxTexture;\nuniform float intensity;\nuniform vec2 colorDomain;\nuniform float threshold;\nuniform float aggregationMode;\n\nattribute vec3 positions;\nattribute vec2 texCoords;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));\n  vTexCoords = texCoords;\n  vec4 maxTexture = texture2D(maxTexture, vec2(0.5));\n  float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;\n  float minValue = maxValue * threshold;\n  if (colorDomain[1] > 0.) {\n    maxValue = colorDomain[1];\n    minValue = colorDomain[0];\n  }\n  vIntensityMax = intensity / maxValue;\n  vIntensityMin = intensity / minValue;\n}\n",Sg="#define SHADER_NAME triangle-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D texture;\nuniform sampler2D colorTexture;\nuniform float aggregationMode;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvec4 getLinearColor(float value) {\n  float factor = clamp(value * vIntensityMax, 0., 1.);\n  vec4 color = texture2D(colorTexture, vec2(factor, 0.5));\n  color.a *= min(value * vIntensityMin, 1.0);\n  return color;\n}\n\nvoid main(void) {\n  vec4 weights = texture2D(texture, vTexCoords);\n  float weight = weights.r;\n\n  if (aggregationMode > 0.5) {\n    weight /= max(1.0, weights.a);\n  }\n  if (weight <= 0.) {\n     discard;\n  }\n\n  vec4 linearColor = getLinearColor(weight);\n  linearColor.a *= opacity;\n  gl_FragColor =linearColor;\n}\n";class Ag extends wf{getShaders(){return{vs:Eg,fs:Sg,modules:[Df]}}initializeState(){const{gl:t}=this.context,e=this.getAttributeManager();e.add({positions:{size:3,noAlloc:!0},texCoords:{size:2,noAlloc:!0}}),this.setState({model:this._getModel(t)})}_getModel(t){const{vertexCount:e}=this.props;return new nu(t,{...this.getShaders(),id:this.props.id,geometry:new Qf({drawMode:6,vertexCount:e})})}draw({uniforms:t}){const{model:e}=this.state,{texture:i,maxTexture:r,colorTexture:n,intensity:o,threshold:a,aggregationMode:s,colorDomain:l}=this.props;e.setUniforms({...t,texture:i,maxTexture:r,colorTexture:n,intensity:o,threshold:a,aggregationMode:s,colorDomain:l}).draw()}}Ag.layerName="TriangleLayer";var Cg="attribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float weights;\nvarying vec4 weightsTexture;\nuniform float radiusPixels;\nuniform float textureWidth;\nuniform vec4 commonBounds;\nuniform float weightsScale;\nvoid main()\n{\n  weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);\n\n  float radiusTexels  = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);\n  gl_PointSize = radiusTexels * 2.;\n\n  vec3 commonPosition = project_position(positions, positions64Low);\n  gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;\n  gl_Position.xy = (gl_Position.xy * 2.) - (1.);\n}\n",Pg="varying vec4 weightsTexture;\nfloat gaussianKDE(float u){\n  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);\n}\nvoid main()\n{\n  float dist = length(gl_PointCoord - vec2(0.5, 0.5));\n  if (dist > 0.5) {\n    discard;\n  }\n  gl_FragColor = weightsTexture * gaussianKDE(2. * dist);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",Ig="attribute vec4 inTexture;\nvarying vec4 outTexture;\n\nvoid main()\n{\noutTexture = inTexture;\ngl_Position = vec4(0, 0, 0, 1.);\ngl_PointSize = 1.0;\n}\n",Mg="varying vec4 outTexture;\nvoid main() {\n  gl_FragColor = outTexture;\n  gl_FragColor.g = outTexture.r / max(1.0, outTexture.a);\n}\n";const kg=2,Dg={mipmaps:!1,parameters:{[10240]:9729,[10241]:9729,[10242]:33071,[10243]:33071},dataFormat:6408},Lg=[0,0],Og={SUM:0,MEAN:1},Rg={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:hm,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},zg=[Qi.BLEND_EQUATION_MINMAX,Qi.TEXTURE_FLOAT],Fg={data:{props:["radiusPixels"]}};class Bg extends pg{initializeState(){const{gl:t}=this.context;if(!rr(t,zg))return this.setState({supported:!1}),void Y.error("HeatmapLayer: ".concat(this.id," is not supported on this browser"))();super.initializeState(Fg),this.setState({supported:!0,colorDomain:Lg}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){this.state.supported&&(super.updateState(t),this._updateHeatmapState(t))}_updateHeatmapState(t){const{props:e,oldProps:i}=t,r=this._getChangeFlags(t);(r.dataChanged||r.viewportChanged)&&(r.boundsChanged=this._updateBounds(r.dataChanged),this._updateTextureRenderingBounds()),r.dataChanged||r.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):r.viewportZoomChanged&&this._debouncedUpdateWeightmap(),e.colorRange!==i.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){if(!this.state.supported)return[];const{weightsTexture:t,triPositionBuffer:e,triTexCoordBuffer:i,maxWeightsTexture:r,colorTexture:n,colorDomain:o}=this.state,{updateTriggers:a,intensity:s,threshold:l,aggregation:u}=this.props,c=this.getSubLayerClass("triangle",Ag);return new c(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:K.DEFAULT,data:{attributes:{positions:e,texCoords:i}},vertexCount:4,maxTexture:r,colorTexture:n,aggregationMode:Og[u]||0,texture:t,intensity:s,threshold:l,colorDomain:o})}finalizeState(){super.finalizeState();const{weightsTransform:t,weightsTexture:e,maxWeightTransform:i,maxWeightsTexture:r,triPositionBuffer:n,triTexCoordBuffer:o,colorTexture:a,updateTimer:s}=this.state;null===t||void 0===t||t.delete(),null===e||void 0===e||e.delete(),null===i||void 0===i||i.delete(),null===r||void 0===r||r.delete(),null===n||void 0===n||n.delete(),null===o||void 0===o||o.delete(),null===a||void 0===a||a.delete(),s&&clearTimeout(s)}_getAttributeManager(){return new Au(this.context.gl,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const e={},{dimensions:i}=this.state;e.dataChanged=this.isAttributeChanged()||this.isAggregationDirty(t,{compareAll:!0,dimension:i.data}),e.viewportChanged=t.changeFlags.viewportChanged;const{zoom:r}=this.state;return t.context.viewport&&t.context.viewport.zoom===r||(e.viewportZoomChanged=!0),e}_createTextures(){const{gl:t}=this.context,{textureSize:e,format:i,type:r}=this.state;this.setState({weightsTexture:new wi(t,{width:e,height:e,format:i,type:r,...Dg}),maxWeightsTexture:new wi(t,{format:i,type:r,...Dg})})}_setupAttributes(){const t=this.getAttributeManager();t.add({positions:{size:3,type:5130,accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{gl:t}=this.context,{weightsTextureSize:e}=this.props,i=Math.min(e,fe(t,3379)),r=rr(t,Qi.COLOR_ATTACHMENT_RGBA32F),{format:n,type:o}=Tg({gl:t,floatTargetSupport:r}),a=r?1:1/255;this.setState({textureSize:i,format:n,type:o,weightsScale:a}),r||Y.warn("HeatmapLayer: ".concat(this.id," rendering to float texture not supported, fallingback to low precession format"))()}getShaders(t){return super.getShaders("max-weights-transform"===t?{vs:Ig,_fs:Mg}:{vs:Cg,_fs:Pg})}_createWeightsTransform(t={}){var e;const{gl:i}=this.context;let{weightsTransform:r}=this.state;const{weightsTexture:n}=this.state;null===(e=r)||void 0===e||e.delete(),r=new ou(i,{id:"".concat(this.id,"-weights-transform"),elementCount:1,_targetTexture:n,_targetTextureVarying:"weightsTexture",...t}),this.setState({weightsTransform:r})}_setupResources(){const{gl:t}=this.context;this._createTextures();const{textureSize:e,weightsTexture:i,maxWeightsTexture:r}=this.state,n=this.getShaders("weights-transform");this._createWeightsTransform(n);const o=this.getShaders("max-weights-transform"),a=new ou(t,{id:"".concat(this.id,"-max-weights-transform"),_sourceTextures:{inTexture:i},_targetTexture:r,_targetTextureVarying:"outTexture",...o,elementCount:e*e});this.setState({weightsTexture:i,maxWeightsTexture:r,maxWeightTransform:a,zoom:null,triPositionBuffer:new hi(t,{byteLength:48,accessor:{size:3}}),triTexCoordBuffer:new hi(t,{byteLength:48,accessor:{size:2}})})}updateShaders(t){this._createWeightsTransform(t)}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32776}})}_updateBounds(t=!1){const{viewport:e}=this.context,i=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([e.width,e.height]),e.unproject([0,e.height])].map(t=>t.map(Math.fround)),r=yg(i),n={visibleWorldBounds:r,viewportCorners:i};let o=!1;if(t||!this.state.worldBounds||!vg(this.state.worldBounds,r)){const t=this._worldToCommonBounds(r),e=this._commonToWorldBounds(t);this.props.coordinateSystem===K.LNGLAT&&(e[1]=Math.max(e[1],-85.051129),e[3]=Math.min(e[3],85.051129),e[0]=Math.max(e[0],-360),e[2]=Math.min(e[2],360));const i=this._worldToCommonBounds(e);n.worldBounds=e,n.normalizedCommonBounds=i,o=!0}return this.setState(n),o}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:e,normalizedCommonBounds:i,viewportCorners:r}=this.state,{viewport:n}=this.context;t.subData(bg(r,3));const o=r.map(t=>wg(n.projectPosition(t),i));e.subData(bg(o,2))}_updateColorTexture(t){const{colorRange:e}=t.props;let{colorTexture:i}=this.state;const r=pm(e,!1,Uint8Array);i?i.setImageData({data:r,width:e.length}):i=new wi(this.context.gl,{data:r,width:e.length,height:1,...Dg}),this.setState({colorTexture:i})}_updateWeightmap(){const{radiusPixels:t,colorDomain:e,aggregation:i}=this.props,{weightsTransform:r,worldBounds:n,textureSize:o,weightsTexture:a,weightsScale:s}=this.state;this.state.isWeightMapDirty=!1;const l=this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0});if(e&&"SUM"===i){const{viewport:t}=this.context,i=t.distanceScales.metersPerUnit[2]*(l[2]-l[0])/o;this.state.colorDomain=e.map(t=>t*i*s)}else this.state.colorDomain=e||Lg;const u={radiusPixels:t,commonBounds:l,textureWidth:o,weightsScale:s};r.update({elementCount:this.getNumInstances()}),r.run({uniforms:u,parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32774},clearRenderTarget:!0,attributes:this.getAttributes(),moduleSettings:this.getModuleSettings()}),this._updateMaxWeightValue(),a.setParameters({[10240]:9729,[10241]:9729})}_debouncedUpdateWeightmap(t=!1){let{updateTimer:e}=this.state;const{debounceTimeout:i}=this.props;t?(e=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(e),e=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:e})}_worldToCommonBounds(t,e={}){const{useLayerCoordinateSystem:i=!1}=e,[r,n,o,a]=t,{viewport:s}=this.context,{textureSize:l}=this.state,{coordinateSystem:u}=this.props,c=i&&(u===K.LNGLAT_OFFSETS||u===K.METER_OFFSETS),h=c?s.projectPosition(this.props.coordinateOrigin):[0,0],p=l*kg/s.scale;let d,f;return i&&!c?(d=this.projectPosition([r,n,0]),f=this.projectPosition([o,a,0])):(d=s.projectPosition([r,n,0]),f=s.projectPosition([o,a,0])),xg([d[0]-h[0],d[1]-h[1],f[0]-h[0],f[1]-h[1]],p,p)}_commonToWorldBounds(t){const[e,i,r,n]=t,{viewport:o}=this.context,a=o.unprojectPosition([e,i]),s=o.unprojectPosition([r,n]);return a.slice(0,2).concat(s.slice(0,2))}}Bg.layerName="HeatmapLayer",Bg.defaultProps=Rg;var Ng=i("e192"),jg=i.n(Ng),Ug=(i("ac6d"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"deckgl-container",attrs:{width:t.width,height:t.height}},[t._t("background"),t._t("default"),i("canvas",{ref:"canvas",attrs:{id:"deck-canvas"},on:{contextmenu:t.handleContextMenu}}),t._t("foreground")],2)}),Vg=[];let Gg=1,qg=1;class Wg{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:n=1}=t,o=Gg++,a={time:0,delay:e,duration:i,rate:r,repeat:n};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(t){this.channels.delete(t);for(const[e,i]of this.animations)i.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}getTime(t){if(void 0===t)return this.time;const e=this.channels.get(t);return void 0===e?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const r of e)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:t,channel:e}=r;t.setTime(this.getTime(e))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const i=qg++;return this.animations.set(i,{animation:t,channel:e}),t.setTime(this.getTime(e)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const i=e-t.delay,r=t.duration*t.repeat;i>=r?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}class Hg{constructor(t,e,i){this.id=t,this.context=i,this._loadCount=0,this._subscribers=new Set,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const i=++this._loadCount;let r=t;"string"===typeof t&&(r=hf(t)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(t=>{this._loadCount===i&&(this.isLoaded=!0,this._error=null,this._content=t)}).catch(t=>{this._loadCount===i&&(this.isLoaded=!0,this._error=t||!0)})):(this.isLoaded=!0,this._error=null,this._content=t);for(const n of this._subscribers)n.onChange(this.getData())}}class Zg{constructor({gl:t,protocol:e}){this.protocol=e||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return!!t.startsWith(this.protocol)||t in this._resources}add({resourceId:t,data:e,forceUpdate:i=!1,persistent:r=!0}){let n=this._resources[t];n?n.setData(e,i):(n=new Hg(t,e,this._context),this._resources[t]=n),n.persistent=r}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const t in e){const i=e[t];i.resource&&i.resource.unsubscribe(i)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:i,requestId:r="default"}){const{_resources:n,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),n[t]||this.add({resourceId:t,data:null,persistent:!1}));const a=n[t];if(this._track(i,r,a,e),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,i,r){const n=this._consumers,o=n[t]=n[t]||{},a=o[e]||{};a.resource&&(a.resource.unsubscribe(a),a.resource=null,this.prune()),i&&(o[e]=a,a.onChange=r,a.resource=i,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];e.persistent||e.inUse()||(e.delete(),delete this._resources[t])}}}const Xg="\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry;\n",Yg="\n#define SMOOTH_EDGE_RADIUS 0.5\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n";var Kg={name:"geometry",vs:Xg,fs:Yg};const Jg=[Kg,Mf],Qg=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function $g(t){const e=Cl.getDefaultProgramManager(t);for(const i of Jg)e.addDefaultModule(i);for(const i of Qg)e.addShaderHook(i);return e}const ty="layerManager.setLayers",ey="layerManager.activateViewport",iy=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}});class ry{constructor(t,{deck:e,stats:i,viewport:r,timeline:n}={}){this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new Zg({gl:t,protocol:"deck://"}),this.context={...iy,layerManager:this,gl:t,deck:e,programManager:t&&$g(t),stats:i||new Fe({id:"deck.gl"}),viewport:r||new oh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:n||new Wg,resourceManager:this.resourceManager},this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(t);e=e||r}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t=null}={}){return t?this.layers.filter(e=>t.find(t=>0===e.id.indexOf(t))):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){wo(ty,this,e,t),this.lastRenderedLayers=t,t=ro(t,Boolean);for(const i of t)i.context=this.context;return this._updateLayers(this.layers,t),this}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this.lastRenderedLayers,t)),this._nextLayers=null}activateViewport(t){return wo(ey,this,t),t&&(this.context.viewport=t),this}_handleError(t,e,i){i.raiseError(e,"".concat(t," of ").concat(i))}_updateLayers(t,e){const i={};for(const o of t)i[o.id]?Y.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(e,i,r),this._finalizeOldLayers(i);let n=!1;for(const o of r)if(o.hasUniformTransition()){n=!0;break}this._needsUpdate=n,this.layers=r}_updateSublayersRecursively(t,e,i){for(const n of t){n.context=this.context;const t=e[n.id];null===t&&Y.warn("Multiple new layers with same id ".concat(n.id))(),e[n.id]=null;let o=null;try{this._debug&&t!==n&&n.validateProps(),t?(this._transferLayerState(t,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),o=n.isComposite&&n.getSubLayers()}catch(r){this._handleError("matching",r,n)}o&&this._updateSublayersRecursively(o,e,i)}}_finalizeOldLayers(t){for(const e in t){const i=t[e];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Ru.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=Ru.MATCHED,e!==t&&(t.lifecycle=Ru.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=Ru.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Ru.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function ny(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const i in t){const r=t[i],n=e[i],o=r===n||Array.isArray(r)&&Array.isArray(n)&&ny(r,n);if(!o)return!1}return!0}class oy{constructor(t={}){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return"string"===typeof t?this.views.find(e=>e.id===t):t}getViewState(t){const e=this.getView(t),i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,e){const i=this.getViewports(),r={x:t[0],y:t[1]};for(let n=i.length-1;n>=0;--n){const o=i[n];if(o.containsPixel(r)){const i=t.slice();return i[0]-=o.x,i[1]-=o.y,o.unproject(i,e)}}return null}setProps(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=ro(t,Boolean);const e=this._diffViews(t,this.views);e&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){if(t){const e=!ny(t,this.viewState);e&&this.setNeedsUpdate("viewState changed"),this.viewState=t}else Y.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(e)}_createController(t,e){const i=e.type,r=new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:e=>t._getViewport(e,{width:e.width,height:e.height}),...e});return r}_updateController(t,e,i,r){let n=t.controller;return n?(n={...e,...t.props,...n,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height},r?r.setProps(n):r=this._createController(t,n),r):null}_rebuildViewports(){const{width:t,height:e,views:i}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let o=i.length;o--;){const a=i[o],s=this.getViewState(a),l=a.makeViewport({width:t,height:e,viewState:s});let u=r[a.id];a.controller&&!u&&(n=!0),!n&&a.controller||!u||(u.finalize(),u=null),this.controllers[a.id]=this._updateController(a,s,l,u),this._viewports.unshift(l)}for(const o in r)r[o]&&!this.controllers[o]&&r[o].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length||t.some((i,r)=>!t[r].equals(e[r]))}}const ay=/([0-9]+\.?[0-9]*)(%|px)/;function sy(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=t.match(ay);if(e&&e.length>=3){const t="%"===e[2],i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error("Could not parse position string ".concat(t))}}function ly(t,e){return t.relative?Math.round(t.position*e):t.position}class uy{constructor(t={}){const{id:e=null,x:i=0,y:r=0,width:n="100%",height:o="100%",projectionMatrix:a=null,fovy:s=50,near:l=.1,far:u=1e3,modelMatrix:c=null,viewportInstance:h=null,type:p=oh}=t;Jn(!h||h instanceof oh),this.viewportInstance=h,this.id=e||this.constructor.displayName||"view",this.type=p,this.props={...t,id:this.id,projectionMatrix:a,fovy:s,near:l,far:u,modelMatrix:c},this._parseDimensions({x:i,y:r,width:n,height:o}),this.equals=this.equals.bind(this),Object.seal(this)}equals(t){if(this===t)return!0;if(this.viewportInstance)return t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance);const e=ny(this.props,t.props);return e}makeViewport({width:t,height:e,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:t,height:e});return this._getViewport(i,r)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(t){if(this.props.viewState&&"object"===typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const t in this.props.viewState)"id"!==t&&(e[t]=this.props.viewState[t]);return e}return t}getDimensions({width:t,height:e}){return{x:ly(this._x,t),y:ly(this._y,e),width:ly(this._width,t),height:ly(this._height,e)}}_getControllerProps(t){let e=this.props.controller;return e?!0===e?t:("function"===typeof e&&(e={type:e}),{...t,...e}):null}_getViewport(t,e){const{type:i}=this;return new i({...t,...this.props,...e})}_parseDimensions({x:t,y:e,width:i,height:r}){this._x=sy(t),this._y=sy(e),this._width=sy(i),this._height=sy(r)}}const cy=()=>{},hy={BREAK:1,SNAP_TO_END:2,IGNORE:3},py={transitionEasing:t=>t,transitionInterruption:hy.BREAK,onTransitionStart:cy,onTransitionInterrupt:cy,onTransitionEnd:cy};class dy{constructor(t,e={}){this.ControllerState=t,this.props={...py,...e},this.propsInTransition=null,this.transition=new cu(e.timeline),this.onViewStateChange=e.onViewStateChange||cy,this.onStateChange=e.onStateChange||cy,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const i=this.props;if(t={...py,...t},this.props=t,this._shouldIgnoreViewportChange(i,t))return e;if(this._isTransitionEnabled(t)){const{interruption:r,endProps:n}=this.transition.settings,o={...i,...r===hy.SNAP_TO_END?n:this.propsInTransition||i};this._triggerTransition(o,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:i}=t;return(e>0||"auto"===e)&&Boolean(i)}_isUpdateDueToCurrentTransition(t){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition)}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===hy.IGNORE||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}_triggerTransition(t,e){const i=new this.ControllerState(t),r=new this.ControllerState(e).shortestPathFrom(i),{transitionInterpolator:n}=e,o=n.getDuration?n.getDuration(t,e):e.transitionDuration;if(0===o)return;const a=e.transitionInterpolator.initializeProps(t,r);this.propsInTransition={},this.duration=o,this.transition.start({duration:o,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:a.start,endProps:a.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t(e)}}_onTransitionUpdate(t){const{time:e,settings:{interpolator:i,startProps:r,endProps:n,duration:o,easing:a}}=t,s=a(e/o),l=i.interpolateProps(r,n,s);this.propsInTransition=new this.ControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}class fy{constructor(t={}){Array.isArray(t)&&(t={compare:t,extract:t,required:t});const{compare:e,extract:i,required:r}=t;this._propsToCompare=e,this._propsToExtract=i,this._requiredProps=r}arePropsEqual(t,e){for(const i of this._propsToCompare||Object.keys(e))if(!(i in t)||!(i in e)||!yr(t[i],e[i]))return!1;return!0}initializeProps(t,e){let i;if(this._propsToExtract){const r={},n={};for(const i of this._propsToExtract)r[i]=t[i],n[i]=e[i];i={start:r,end:n}}else i={start:t,end:e};return this._checkRequiredProps(i.start),this._checkRequiredProps(i.end),i}interpolateProps(t,e,i){return e}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const i=t[e];Jn(Number.isFinite(i)||Array.isArray(i),"".concat(e," is required for transition"))})}}const my=["longitude","latitude","zoom","bearing","pitch"],gy=["longitude","latitude","zoom"];class yy extends fy{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps;super(e||{compare:my,extract:my,required:gy}),this.opts=t}initializeProps(t,e){const i=super.initializeProps(t,e),{makeViewport:r,around:n}=this.opts;if(r&&n){const o=r(t),a=r(e),s=o.unproject(n);i.start.around=n,Object.assign(i.end,{around:a.project(s),aroundPosition:s,width:e.width,height:e.height})}return i}interpolateProps(t,e,i){const r={};for(const n of this._propsToExtract)r[n]=gr(t[n]||0,e[n]||0,i);if(e.aroundPosition){const n=this.opts.makeViewport({...e,...r});Object.assign(r,n.panByPosition(e.aroundPosition,gr(t.around,e.around,i)))}return r}}const vy={transitionDuration:0},_y={transitionDuration:300,transitionEasing:t=>t,transitionInterruption:hy.BREAK},by=300,xy=t=>1-(1-t)*(1-t),wy={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]};class Ty{constructor(t,e={}){this.ControllerState=t,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new dy(t,{...e,onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)});const i=this.linearTransitionProps;this._transition=i&&{..._y,transitionInterpolator:new yy({transitionProps:i})},this._events=null,this._interactionState={isDragging:!1},this._customEvents=[],this.onViewStateChange=null,this.onStateChange=null,this.handleEvent=this.handleEvent.bind(this),this.setProps(e)}get linearTransitionProps(){return null}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.setProps(this.controllerStateProps)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){const{ControllerState:e}=this;this.controllerState=new e({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state});const i=this._eventStartBlocked;switch(t.type){case"panstart":return!i&&this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return!i&&this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return!i&&this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}getCenter(t){const{x:e,y:i}=this.controllerStateProps,{offsetCenter:r}=t;return[r.x-e,r.y-i]}isPointInBounds(t,e){const{width:i,height:r}=this.controllerStateProps;if(e&&e.handled)return!1;const n=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=r;return n&&e&&e.stopPropagation(),n}isFunctionKeyPressed(t){const{srcEvent:e}=t;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),"makeViewport"in t&&(this.makeViewport=t.makeViewport),"dragMode"in t&&(this.dragMode=t.dragMode),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);let{inertia:e}=t;!0===e&&(e=by),this.inertia=e;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:n=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:s=!1,keyboard:l=!0}=t,u=Boolean(this.onViewStateChange);this.toggleEvents(wy.WHEEL,u&&i),this.toggleEvents(wy.PAN,u&&(r||n)),this.toggleEvents(wy.PINCH,u&&(a||s)),this.toggleEvents(wy.TRIPLE_PAN,u&&s),this.toggleEvents(wy.DOUBLE_TAP,u&&o),this.toggleEvents(wy.KEYBOARD,u&&l),this.scrollZoom=i,this.dragPan=r,this.dragRotate=n,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=s,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(t=>{this._events[t]!==e&&(this._events[t]=e,e?this.eventManager.on(t,this.handleEvent):this.eventManager.off(t,this.handleEvent))})}updateViewport(t,e={},i={}){const r={...t.getViewportProps(),...e},n=this.controllerState!==t;if(this._state=t.getState(),this._setInteractionState(i),n){const t=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:t})}}_onTransition(t){this.onViewStateChange&&(t.interactionState=this._interactionState,this.onViewStateChange(t))}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange&&this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton;(this.invertPan||"pan"===this.dragMode)&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:e});return this._panMove=i,this.updateViewport(r,vy,{isDragging:!0}),!0}_onPan(t){return!!this.isDragging()&&(this._panMove?this._onPanMove(t):this._onPanRotate(t))}_onPanEnd(t){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t))}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),i=this.controllerState.pan({pos:e});return this.updateViewport(i,vy,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const i=this.getCenter(t),r=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],n=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:xy},{isDragging:!1,isPanning:!0})}else{const t=this.controllerState.panEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),i=this.controllerState.rotate({pos:e});return this.updateViewport(i,vy,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const i=this.getCenter(t),r=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],n=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:xy},{isDragging:!1,isRotating:!0})}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;t.preventDefault();const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom,{delta:n}=t;let o=2/(1+Math.exp(-Math.abs(n*i)));n<0&&0!==o&&(o=1/o);const a=this.controllerState.zoom({pos:e,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:e}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.rotateStart({pos:e});return this.updateViewport(i,vy,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const i=this.controllerState.rotate({pos:e});return this.updateViewport(i,vy,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const i=this.getCenter(t),r=[i[0],i[1]+=t.velocityY*e/2],n=this.controllerState.rotate({pos:r});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:xy},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(i,vy,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:i}=t,r=this.getCenter(t);e=e.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=t;e=e.rotate({deltaAngleX:this._startPinchRotation-i})}return this.updateViewport(e,vy,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e,_lastPinchEvent:i}=this;if(this.touchZoom&&e&&i&&t.scale!==i.scale){const r=this.getCenter(t);let n=this.controllerState.rotateEnd();const o=Math.log2(t.scale),a=(o-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),s=Math.pow(2,o+a*e/2);n=n.zoom({pos:r,scale:s}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:r}),transitionDuration:e,transitionEasing:xy},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const t=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,this._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.isFunctionKeyPressed(t),r=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:n,rotateSpeedY:o}=this.keyboard,{controllerState:a}=this;let s;const l={};switch(t.srcEvent.code){case"Minus":s=e?a.zoomOut(i).zoomOut(i):a.zoomOut(i),l.isZooming=!0;break;case"Equal":s=e?a.zoomIn(i).zoomIn(i):a.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":e?(s=a.rotateLeft(n),l.isRotating=!0):(s=a.moveLeft(r),l.isPanning=!0);break;case"ArrowRight":e?(s=a.rotateRight(n),l.isRotating=!0):(s=a.moveRight(r),l.isPanning=!0);break;case"ArrowUp":e?(s=a.rotateUp(o),l.isRotating=!0):(s=a.moveUp(r),l.isPanning=!0);break;case"ArrowDown":e?(s=a.rotateDown(o),l.isRotating=!0):(s=a.moveDown(r),l.isPanning=!0);break;default:return!1}return this.updateViewport(s,this._getTransitionProps(),l),!0}_getTransitionProps(t){const{_transition:e}=this;return e?t?{...e,transitionInterpolator:new yy({...t,transitionProps:this.linearTransitionProps,makeViewport:this.controllerState.makeViewport})}:e:vy}}class Ey{constructor(t){this._viewportProps=this._applyConstraints(t)}getViewportProps(){return this._viewportProps}getState(){return this._state}shortestPathFrom(t){return this._viewportProps}_applyConstraints(t){return t}}const Sy=5,Ay=1.2,Cy={pitch:0,bearing:0,altitude:1.5,minZoom:0,maxZoom:20,minPitch:0,maxPitch:60};class Py extends Ey{constructor({makeViewport:t,width:e,height:i,latitude:r,longitude:n,zoom:o,bearing:a=Cy.bearing,pitch:s=Cy.pitch,altitude:l=Cy.altitude,maxZoom:u=Cy.maxZoom,minZoom:c=Cy.minZoom,maxPitch:h=Cy.maxPitch,minPitch:p=Cy.minPitch,startPanLngLat:d,startZoomLngLat:f,startRotatePos:m,startBearing:g,startPitch:y,startZoom:v,normalize:_}={}){Jn(Number.isFinite(n)),Jn(Number.isFinite(r)),Jn(Number.isFinite(o)),super({width:e,height:i,latitude:r,longitude:n,zoom:o,bearing:a,pitch:s,altitude:l,maxZoom:u,minZoom:c,maxPitch:h,minPitch:p,normalize:_}),this._state={startPanLngLat:d,startZoomLngLat:f,startRotatePos:m,startBearing:g,startPitch:y,startZoom:v},this.makeViewport=t}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const i=this._state.startPanLngLat||this._unproject(e);if(!i)return this;const r=this.makeViewport(this._viewportProps),n=r.panByPosition(i,t);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:n,startPitch:o}=this._state;if(!r||!Number.isFinite(n)||!Number.isFinite(o))return this;let a;return a=t?this._calculateNewPitchAndBearing({...this._getRotationParams(t,r),startBearing:n,startPitch:o}):{bearing:n+e,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this._viewportProps.zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:r,startZoomLngLat:n}=this._state;Number.isFinite(r)||(r=this._viewportProps.zoom,n=this._unproject(e)||this._unproject(t));const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this._viewportProps,zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(n,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this._viewportProps.bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this._viewportProps.bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this._viewportProps.pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this._viewportProps.pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this._viewportProps},{bearing:r,longitude:n}=i;return Math.abs(r-e.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(n-e.longitude)>180&&(i.longitude=n<0?n+360:n-360),i}_zoomFromCenter(t){const{width:e,height:i}=this._viewportProps;return this.zoom({pos:[e/2,i/2],scale:t})}_panFromCenter(t){const{width:e,height:i}=this._viewportProps;return this.pan({startPos:[e/2,i/2],pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this._viewportProps,...this._state,...t})}_applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:r}=t;t.zoom=mr(r,i,e);const{maxPitch:n,minPitch:o,pitch:a}=t;t.pitch=mr(a,o,n);const{normalize:s=!0}=t;return s&&Object.assign(t,Zc(t)),t}_unproject(t){const e=this.makeViewport(this._viewportProps);return t&&e.unproject(t)}_calculateNewZoom({scale:t,startZoom:e}){const{maxZoom:i,minZoom:r}=this._viewportProps,n=e+Math.log2(t);return mr(n,r,i)}_calculateNewPitchAndBearing({deltaScaleX:t,deltaScaleY:e,startBearing:i,startPitch:r}){e=mr(e,-1,1);const{minPitch:n,maxPitch:o}=this._viewportProps,a=i+180*t;let s=r;return e>0?s=r+e*(o-r):e<0&&(s=r-e*(n-r)),{pitch:s,bearing:a}}_getRotationParams(t,e){const i=t[0]-e[0],r=t[1]-e[1],n=t[1],o=e[1],{width:a,height:s}=this._viewportProps,l=i/a;let u=0;return r>0?Math.abs(s-o)>Sy&&(u=r/(o-s)*Ay):r<0&&o>Sy&&(u=1-n/o),u=Math.min(1,Math.max(-1,u)),{deltaScaleX:l,deltaScaleY:u}}}class Iy extends Ty{constructor(t){t.dragMode=t.dragMode||"pan",super(Py,t)}setProps(t){const e=this.controllerStateProps;super.setProps(t);const i=!e||e.height!==t.height;i&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state}))}get linearTransitionProps(){return["longitude","latitude","zoom","bearing","pitch"]}}class My extends uy{constructor(t){super({...t,type:ah})}get controller(){return this._getControllerProps({type:Iy})}}My.displayName="MapView";const ky=[255,255,255],Dy=1;let Ly=0;class Oy{constructor(t={}){const{color:e=ky}=t,{intensity:i=Dy}=t;this.id=t.id||"ambient-".concat(Ly++),this.color=e,this.intensity=i,this.type="ambient"}}const Ry=[255,255,255],zy=1,Fy=[0,0,-1];let By=0;class Ny{constructor(t={}){const{color:e=Ry}=t,{intensity:i=zy}=t,{direction:r=Fy}=t,{_shadow:n=!1}=t;this.id=t.id||"directional-".concat(By++),this.color=e,this.intensity=i,this.type="directional",this.direction=new Zr(r).normalize().toArray(),this.shadow=n}getProjectedLight(){return this}}class jy{constructor(t={}){const{id:e="effect"}=t;this.id=e,this.props={...t}}preRender(){}getModuleParameters(){}cleanup(){}}class Uy{constructor(t,e={}){const{id:i="pass"}=e;this.id=i,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(){}cleanup(){}}class Vy extends Uy{render(t){const e=this.gl;return de(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{viewports:e,views:i,onViewportActive:r,clearCanvas:n=!0}=t;t.pass=t.pass||"unknown";const o=this.gl;n&&Wy(o);const a=[];for(const s of e){const e=s.viewport||s,n=i&&i[e.id];r(e);const l=this._getDrawLayerParams(e,t);t.view=n;const u=e.subViewports||[e];for(const i of u){t.viewport=i;const e=this._drawLayersInViewport(o,t,l);a.push(e)}}return a}_getDrawLayerParams(t,{layers:e,pass:i,layerFilter:r,effects:n,moduleParameters:o}){const a=[],s=Gy(),l={viewport:t,isPicking:i.startsWith("picking"),renderPass:i};for(let u=0;u<e.length;u++){const t=e[u],c=this._shouldDrawLayer(t,l,r),h=s(t,c),p={shouldDrawLayer:c,layerRenderIndex:h};c&&(p.moduleParameters=this._getModuleParameters(t,n,i,o),p.layerParameters=this.getLayerParameters(t,u)),a[u]=p}return a}_drawLayersInViewport(t,{layers:e,pass:i,viewport:r,view:n},o){const a=qy(t,{viewport:r});if(n&&n.props.clear){const e=!0===n.props.clear?{color:!0,depth:!0}:n.props.clear;ge(t,{scissorTest:!0,scissor:a},()=>Ri(t,e))}const s={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};de(t,{viewport:a});for(let u=0;u<e.length;u++){const t=e[u],{shouldDrawLayer:n,layerRenderIndex:a,moduleParameters:c,layerParameters:h}=o[u];if(n&&t.props.pickable&&s.pickableCount++,t.isComposite)s.compositeCount++;else if(n){s.visibleCount++,c.viewport=r;try{t.drawLayer({moduleParameters:c,uniforms:{layerIndex:a},parameters:h})}catch(l){t.raiseError(l,"drawing ".concat(t," to ").concat(i))}}}return s}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e){return t.props.parameters}_shouldDrawLayer(t,e,i){const r=this.shouldDrawLayer(t)&&t.props.visible;if(!r)return!1;if(e.layer=t,i&&!i(e))return!1;let n=t.parent;while(n){if(!n.filterSubLayer(e))return!1;e.layer=n,n=n.parent}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,i,r){const n=Object.assign(Object.create(t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:ye(this.gl)});if(e)for(const o of e)Object.assign(n,o.getModuleParameters(t));return Object.assign(n,this.getModuleParameters(t,e),r)}}function Gy(t=0,e={}){const i={},r=(n,o)=>{const a=n.props._offset,s=n.id,l=n.parent&&n.parent.id;let u;if(l&&!(l in e)&&r(n.parent,!1),l in i){const t=i[l]=i[l]||Gy(e[l],e);u=t(n,o),i[s]=t}else Number.isFinite(a)?(u=a+(e[l]||0),i[s]=null):u=t;return o&&u>=t&&(t=u+1),e[s]=u,u};return r}function qy(t,{viewport:e}){const i=t.canvas?t.canvas.clientHeight||t.canvas.height:100,r=e,n=ye(t);return[r.x*n,(i-r.y-r.height)*n,r.width*n,r.height*n]}function Wy(t){const e=t.drawingBufferWidth,i=t.drawingBufferHeight;de(t,{viewport:[0,0,e,i]}),t.clear(16640)}class Hy extends Vy{constructor(t,e){super(t,e),this.shadowMap=new wi(t,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Ai(t,{format:33189,width:1,height:1}),this.fbo=new Xi(t,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(t){const e=this.fbo;ge(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=t.viewports[0],r=ye(this.gl),n=i.width*r,o=i.height*r;n===e.width&&o===e.height||e.resize({width:n,height:o}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return!1!==t.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const Zy="\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",Xy="\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",Yy=tc(tv),Ky=tc(ev),Jy=[0,0,0,1],Qy=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function $y(t,e){const[i,r,n]=t,o=jc([i,r,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function tv({viewport:t,center:e}){return new Dn(t.viewProjectionMatrix).invert().transform(e)}function ev({viewport:t,shadowMatrices:e}){const i=[],r=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,o=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(t=>$y(t,r));for(const a of e){const e=a.clone().translate(new Zr(t.center).negate()),r=o.map(t=>e.transform(t)),n=(new Dn).ortho({left:Math.min(...r.map(t=>t[0])),right:Math.max(...r.map(t=>t[0])),bottom:Math.min(...r.map(t=>t[1])),top:Math.max(...r.map(t=>t[1])),near:Math.min(...r.map(t=>-t[2])),far:Math.max(...r.map(t=>-t[2]))});i.push(n.multiplyRight(a))}return i}function iv(t={},e={}){const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&t.shadowMaps.length>0,shadow_uColor:t.shadowColor||Jy,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=Yy({viewport:t.viewport,center:e.project_uCenter}),n=[],o=Ky({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const i=o[a],s=i.clone().translate(new Zr(t.viewport.center).negate());e.project_uCoordinateSystem===K.LNGLAT&&e.project_uProjectionMode===J.WEB_MERCATOR?(o[a]=s,n[a]=r):(o[a]=i.clone().multiplyRight(Qy),n[a]=s.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=n[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}var rv={name:"shadow",dependencies:[Mf],vs:Zy,fs:Xy,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(t={},e={})=>{if(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0){const{shadowEnabled:i=!0}=t;return i&&t.shadowMatrices&&t.shadowMatrices.length>0?iv(t,e):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}};const nv={color:[255,255,255],intensity:1},ov=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],av=[0,0,0,200/255];class sv extends jy{constructor(t){super(t),this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowColor=av,this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.shadow=!1,this.programManager=null;for(const e in t){const i=t[e];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow)}preRender(t,{layers:e,layerFilter:i,viewports:r,onViewportActive:n,views:o}){if(this.shadow){this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=Cl.getDefaultProgramManager(t),rv&&this.programManager.addDefaultModule(rv)),this.dummyShadowMap||(this.dummyShadowMap=new wi(t,{width:1,height:1}));for(let t=0;t<this.shadowPasses.length;t++){const a=this.shadowPasses[t];a.render({layers:e,layerFilter:i,viewports:r,onViewportActive:n,views:o,moduleParameters:{shadowLightId:t,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(e=>e.getProjectedLight({layer:t})),pointLights:this.pointLights.map(e=>e.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(rv),this.programManager=null)}_createLightMatrix(){const t=[];for(const e of this.directionalLights){const i=(new Dn).lookAt({eye:new Zr(e.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const i=new Hy(t);this.shadowPasses[e]=i,this.shadowMaps[e]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:i}=this;t||0!==e.length||0!==i.length||(this.ambientLight=new Oy(nv),this.directionalLights.push(new Ny(ov[0]),new Ny(ov[1])))}}const lv=new sv;class uv{constructor(){this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(t){"effects"in t&&(t.effects.length===this.effects.length&&ny(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed"))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(t=[]){this.cleanup(),this.effects=t,this._createInternalEffects()}cleanup(){for(const t of this.effects)t.cleanup();for(const t of this._internalEffects)t.cleanup();this.effects.length=0,this._internalEffects.length=0}_createInternalEffects(){this._internalEffects=this.effects.slice(),this.effects.some(t=>t instanceof sv)||this._internalEffects.push(lv)}}class cv extends Vy{}const hv={blendFunc:[1,0,32771,0],blendEquation:32774};class pv extends Vy{render(t){t.pickingFBO?(this.useAlpha=!0,this._drawPickingBuffer(t)):(this.useAlpha=!1,super.render(t))}_drawPickingBuffer({layers:t,layerFilter:e,views:i,viewports:r,onViewportActive:n,pickingFBO:o,deviceRect:{x:a,y:s,width:l,height:u},pass:c="picking",redrawReason:h,pickZ:p}){const d=this.gl;return this.pickZ=p,ge(d,{scissorTest:!0,scissor:[a,s,l,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...hv,blend:!p},()=>{super.render({target:o,layers:t,layerFilter:e,views:i,viewports:r,onViewportActive:n,pass:c,redrawReason:h})})}shouldDrawLayer(t){return t.props.pickable}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e){const i=this.pickZ?{blend:!1}:{...hv,blend:!0,blendColor:[0,0,0,this.useAlpha?(e+1)/255:1]};return{...t.props.parameters,...i}}}const dv="deckRenderer.renderLayers";class fv{constructor(t){this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new cv(t),this.pickLayersPass=new pv(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;t.layerFilter=this.layerFilter,t.effects=t.effects||[],t.target=t.target||Xi.getDefaultFramebuffer(this.gl),this._preRender(t.effects,t);const i=this.lastPostProcessEffect?this.renderBuffers[0]:t.target,r=e.render({...t,target:i});this._postRender(t.effects,t),this.renderCount++,wo(dv,this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){let i=null;for(const r of t)r.preRender(this.gl,e),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:t}=this;0===t.length&&t.push(new Xi(this.gl),new Xi(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const n of t)if(n.postRender){if(n===this.lastPostProcessEffect){r.target=e.target,n.postRender(this.gl,r);break}const t=n.postRender(this.gl,r);r.inputBuffer=t,r.swapBuffer=t===i[0]?i[1]:i[0]}}}const mv={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function gv({pickedColors:t,layers:e,deviceX:i,deviceY:r,deviceRadius:n,deviceRect:o}){if(t){const{x:a,y:s,width:l,height:u}=o;let c=n*n,h=-1,p=0;for(let e=0;e<u;e++){const n=e+s-r,o=n*n;if(o>c)p+=4*l;else for(let e=0;e<l;e++){const r=t[p+3]-1;if(r>=0){const t=e+a-i,r=t*t+o;r<=c&&(c=r,h=p)}p+=4}}if(h>=0){const i=t[h+3]-1,r=t.slice(h,h+4),n=e[i];if(n){const t=n.decodePickingColor(r),e=Math.floor(h/4/l),i=h/4-e*l;return{pickedColor:r,pickedLayer:n,pickedObjectIndex:t,pickedX:a+i,pickedY:s+e}}Y.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return mv}function yv({pickedColors:t,layers:e}){const i=new Map;if(t)for(let r=0;r<t.length;r+=4){const n=t[r+3]-1;if(n>=0){const o=t.slice(r,r+4),a=o.join(",");if(!i.has(a)){const t=e[n];t?i.set(a,{pickedColor:o,pickedLayer:t,pickedObjectIndex:t.decodePickingColor(o)}):Y.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function vv({pickInfo:t,mode:e,viewports:i,layerFilter:r,pixelRatio:n,x:o,y:a,z:s}){const l=t&&t.pickedLayer,u=r&&l&&(t=>r({layer:l,viewport:t,isPicking:!0,renderPass:"picking:".concat(e)})),c=xv(i,{x:o,y:a},u),h=c&&c.unproject([o-c.x,a-c.y],{targetZ:s});return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:o,y:a,pixel:[o,a],coordinate:h,devicePixel:t&&[t.pickedX,t.pickedY],pixelRatio:n}}function _v(t){const{pickInfo:e,lastPickedInfo:i,mode:r,layers:n}=t,{pickedColor:o,pickedLayer:a,pickedObjectIndex:s}=e,l=a?[a]:[];if("hover"===r){const t=i.index,e=i.layerId,r=a&&a.props.id;if(r!==e||s!==t){if(r!==e){const t=n.find(t=>t.props.id===e);t&&l.unshift(t)}i.layerId=r,i.index=s,i.info=null}}const u=vv(t),c=new Map;return c.set(null,u),l.forEach(t=>{let e={...u};t===a&&(e.color=o,e.index=s,e.picked=!0),e=bv({layer:t,info:e,mode:r}),t===a&&"hover"===r&&(i.info=e),c.set(e.layer.id,e),"hover"===r&&e.layer.updateAutoHighlight(e)}),c}function bv({layer:t,info:e,mode:i}){while(t&&e){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:r}),t=t.parent}return e}function xv(t,e,i){for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.containsPixel(e)&&(!i||i(n)))return n}return t[0]}class wv{constructor(t){this.gl=t,this.pickingFBO=null,this.pickLayersPass=new pv(t),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:i,viewports:r},n=this.lastPickedInfo.info){const o=n&&n.layer&&n.layer.id,a=n&&n.viewport&&n.viewport.id,s=o?i.find(t=>t.id===o):null,l=a&&r.find(t=>t.id===a)||r[0],u=l&&l.unproject([t-l.x,e-l.y]),c={x:t,y:e,viewport:l,coordinate:u,layer:s};return s?{...n,...c}:Object.assign(c,{color:null,object:null,index:-1})}_resizeBuffer(){const{gl:t}=this;return this.pickingFBO||(this.pickingFBO=new Xi(t),Xi.isSupported(t,{colorBufferFloat:!0})&&(this.depthFBO=new Xi(t),this.depthFBO.attach({[36064]:new wi(t,{format:nt(t)?34836:6408,type:5126})}))),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}_getPickable(t){if(!1===this._pickable)return null;const e=t.filter(t=>t.isPickable()&&!t.isComposite);return e.length>255?(Y.warn("Too many pickable layers, only picking the first 255")(),e.slice(0,255)):e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:i,x:r,y:n,radius:o=0,depth:a=1,mode:s="query",unproject3D:l,onViewportActive:u}){if(t=this._getPickable(t),!t)return{result:[],emptyInfo:vv({viewports:i,x:r,y:n})};this._resizeBuffer();const c=ye(this.gl),h=ve(this.gl,[r,n],!0),p=[h.x+Math.floor(h.width/2),h.y+Math.floor(h.height/2)],d=Math.round(o*c),{width:f,height:m}=this.pickingFBO,g=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:d,deviceWidth:f,deviceHeight:m});let y;const v=[],_={};for(let b=0;b<a;b++){const o=g&&this._drawAndSample({layers:t,views:e,viewports:i,onViewportActive:u,deviceRect:g,pass:"picking:".concat(s),redrawReason:s}),h=gv({pickedColors:o,layers:t,deviceX:p[0],deviceY:p[1],deviceRadius:d,deviceRect:g});let f;if(h.pickedLayer&&l&&this.depthFBO){const t=this._drawAndSample({layers:[h.pickedLayer],views:e,viewports:i,onViewportActive:u,deviceRect:{x:h.pickedX,y:h.pickedY,width:1,height:1},pass:"picking:".concat(s),redrawReason:"pick-z",pickZ:!0});f=t[0]*i[0].distanceScales.metersPerUnit[2]+i[0].position[2]}if(h.pickedColor&&b+1<a){const e=h.pickedColor[3]-1;_[e]=!0,t[e].disablePickingIndex(h.pickedObjectIndex)}y=_v({pickInfo:h,lastPickedInfo:this.lastPickedInfo,mode:s,layers:t,layerFilter:this.layerFilter,viewports:i,x:r,y:n,z:f,pixelRatio:c});for(const t of y.values())t.layer&&v.push(t);if(!h.pickedColor)break}for(const b in _)t[b].restorePickingColors();return{result:v,emptyInfo:y&&y.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:i,x:r,y:n,width:o=1,height:a=1,mode:s="query",maxObjects:l=null,onViewportActive:u}){if(t=this._getPickable(t),!t)return[];this._resizeBuffer();const c=ye(this.gl),h=ve(this.gl,[r,n],!0),p=h.x,d=h.y+h.height,f=ve(this.gl,[r+o,n+a],!0),m=f.x+f.width,g=f.y,y={x:p,y:g,width:m-p,height:d-g},v=this._drawAndSample({layers:t,views:e,viewports:i,onViewportActive:u,deviceRect:y,pass:"picking:".concat(s),redrawReason:s}),_=yv({pickedColors:v,layers:t}),b=new Map,x=Number.isFinite(l);for(let w=0;w<_.length;w++){if(x&&b.size>=l)break;const t=_[w];let e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:r,y:n,width:o,height:a,pixelRatio:c};e=bv({layer:t.pickedLayer,info:e,mode:s}),b.has(e.object)||b.set(e.object,e)}return Array.from(b.values())}_drawAndSample({layers:t,views:e,viewports:i,onViewportActive:r,deviceRect:n,pass:o,redrawReason:a,pickZ:s}){if(t.length<1)return null;const l=s?this.depthFBO:this.pickingFBO;this.pickLayersPass.render({layers:t,layerFilter:this.layerFilter,views:e,viewports:i,onViewportActive:r,pickingFBO:l,deviceRect:n,pass:o,redrawReason:a,pickZ:s});const{x:u,y:c,width:h,height:p}=n,d=new(s?Float32Array:Uint8Array)(h*p*4);return Gi(l,{sourceX:u,sourceY:c,sourceWidth:h,sourceHeight:p,target:d}),d}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:i,deviceWidth:r,deviceHeight:n}){const o=Math.max(0,t-i),a=Math.max(0,e-i),s=Math.min(r,t+i+1)-o,l=Math.min(n,e+i+1)-a;return s<=0||l<=0?null:{x:o,y:a,width:s,height:l}}}const Tv={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"};class Ev{constructor(t){const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,Tv),e.appendChild(this.el)),this.isVisible=!1}setTooltip(t,e,i){const r=this.el;if("string"===typeof t)r.innerText=t;else{if(!t)return this.isVisible=!1,void(r.style.display="none");"text"in t&&(r.innerText=t.text),"html"in t&&(r.innerHTML=t.html),"className"in t&&(r.className=t.className),Object.assign(r.style,t.style)}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(e,"px, ").concat(i,"px)")}remove(){this.el&&this.el.remove()}}const Sv="3.4.15",{_parseImageNode:Av}=globalThis,Cv="undefined"!==typeof Image,Pv="undefined"!==typeof ImageBitmap,Iv=Boolean(Av),Mv=!!kp["a"]||Iv;function kv(t){switch(t){case"auto":return Pv||Cv||Mv;case"imagebitmap":return Pv;case"image":return Cv;case"data":return Mv;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function Dv(){if(Pv)return"imagebitmap";if(Cv)return"image";if(Mv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Lv(t){const e=Rv(t);if(!e)throw new Error("Not an image");return e}function Ov(t){switch(Lv(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Rv(t){return"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!==typeof Image&&t instanceof Image?"image":t&&"object"===typeof t&&t.data&&t.width&&t.height?"data":null}const zv=/^data:image\/svg\+xml/,Fv=/\.svg((\?|#).*)?$/;function Bv(t){return t&&(zv.test(t)||Fv.test(t))}function Nv(t,e){if(Bv(e)){const e=new TextDecoder;let r=e.decode(t);try{"function"===typeof unescape&&"function"===typeof encodeURIComponent&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}const n="data:image/svg+xml;base64,".concat(btoa(r));return n}return jv(t,e)}function jv(t,e){if(Bv(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Uv(t,e,i){const r=Nv(t,i),n=self.URL||self.webkitURL,o="string"!==typeof r&&n.createObjectURL(r);try{return await Vv(o||r,e)}finally{o&&n.revokeObjectURL(o)}}async function Vv(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((e,r)=>{try{i.onload=()=>e(i),i.onerror=e=>r(new Error("Could not load image ".concat(t,": ").concat(e)))}catch(n){r(n)}})}const Gv={};let qv=!0;async function Wv(t,e,i){let r;if(Bv(i)){const n=await Uv(t,e,i);r=n}else r=jv(t,i);const n=e&&e.imagebitmap;return await Hv(r,n)}async function Hv(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!Zv(e)&&qv||(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),qv=!1}return await createImageBitmap(t)}function Zv(t){for(const e in t||Gv)return!1;return!0}function Xv(t){return Qv(t,"ftyp",4)?0===(96&t[8])?null:Yv(t):null}function Yv(t){const e=Kv(t,8,12).replace("\0"," ").trim();switch(e){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Kv(t,e,i){return String.fromCharCode(...t.slice(e,i))}function Jv(t){return[...t].map(t=>t.charCodeAt(0))}function Qv(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Jv(e);for(let n=0;n<r.length;++n)if(r[n]!==t[n+i])return!1;return!0}const $v=!1,t_=!0;function e_(t){const e=l_(t);return r_(e)||a_(e)||n_(e)||o_(e)||i_(e)}function i_(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=Xv(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function r_(t){const e=l_(t),i=e.byteLength>=24&&2303741511===e.getUint32(0,$v);return i?{mimeType:"image/png",width:e.getUint32(16,$v),height:e.getUint32(20,$v)}:null}function n_(t){const e=l_(t),i=e.byteLength>=10&&1195984440===e.getUint32(0,$v);return i?{mimeType:"image/gif",width:e.getUint16(6,t_),height:e.getUint16(8,t_)}:null}function o_(t){const e=l_(t),i=e.byteLength>=14&&16973===e.getUint16(0,$v)&&e.getUint32(2,t_)===e.byteLength;return i?{mimeType:"image/bmp",width:e.getUint32(18,t_),height:e.getUint32(22,t_)}:null}function a_(t){const e=l_(t),i=e.byteLength>=3&&65496===e.getUint16(0,$v)&&255===e.getUint8(2);if(!i)return null;const{tableMarkers:r,sofMarkers:n}=s_();let o=2;while(o+9<e.byteLength){const t=e.getUint16(o,$v);if(n.has(t))return{mimeType:"image/jpeg",height:e.getUint16(o+5,$v),width:e.getUint16(o+7,$v)};if(!r.has(t))return null;o+=2,o+=e.getUint16(o,$v)}return null}function s_(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}function l_(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function u_(t,e){const{mimeType:i}=e_(t)||{},r=globalThis._parseImageNode;return ap(r),await r(t,i)}async function c_(t,e,i){e=e||{};const r=e.image||{},n=r.type||"auto",{url:o}=i||{},a=h_(n);let s;switch(a){case"imagebitmap":s=await Wv(t,e,o);break;case"image":s=await Uv(t,e,o);break;case"data":s=await u_(t,e);break;default:ap(!1)}return"data"===n&&(s=Ov(s)),s}function h_(t){switch(t){case"auto":case"data":return Dv();default:return kv(t),t}}const p_=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],d_=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],f_={image:{type:"auto",decode:!0}},m_={id:"image",module:"images",name:"Images",version:Sv,mimeTypes:d_,extensions:p_,parse:c_,tests:[t=>Boolean(e_(new DataView(t)))],options:f_};var g_=i("c526");function y_(t){const e=t[0],i=t[t.length-1];return"{"===e&&"}"===i||"["===e&&"]"===i}var v_={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:y_,parseTextSync:JSON.parse};const __="8.5.10",b_=g_["global"].deck&&g_["global"].deck.VERSION;if(b_&&b_!==__)throw new Error("deck.gl - multiple versions detected: ".concat(b_," vs ").concat(__));b_||(Y.log(1,"deck.gl ".concat(__))(),g_["global"].deck=Object.assign(g_["global"].deck||{},{VERSION:__,version:__,log:Y,_registerLoggers:xo}),qd([v_,[m_,{imagebitmap:{premultiplyAlpha:"none"}}]]));var x_=g_["global"].deck;const w_=34918,T_=34919,E_=35007,S_=36795,A_=35976,C_=35887,P_=36202;class I_ extends Je{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=nt(t),r=rr(t,Qi.TIMER_QUERY);let n=i||r;for(const o of e)switch(o){case"queries":n=n&&i;break;case"timers":n=n&&r;break;default:Ve(!1)}return n}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(E_)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.begin(t?P_:C_)}beginTransformFeedbackQuery(){return this.begin(A_)}begin(t){return this._queryPending||(this.target=t,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,T_);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(S_)}getResult(){return this.gl2.getQueryParameter(this.handle,w_)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((i,r)=>{const n=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):e++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(n)};requestAnimationFrame(n)}),this._pollingPromise}_createHandle(){return I_.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}function M_(t){return"undefined"!==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function k_(t){return"undefined"!==typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}const D_=Object(T["a"])()&&"undefined"!==typeof document;let L_=0;class O_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{onCreateContext:e=(t=>Ae(t)),onAddHTML:i=null,onInitialize:r=(()=>{}),onRender:n=(()=>{}),onFinalize:o=(()=>{}),onError:a,gl:s=null,glOptions:l={},debug:u=!1,createFramebuffer:c=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:p=!0,stats:d=Ue.get("animation-loop-".concat(L_++))}=t;let{useDevicePixels:f=!0}=t;"useDevicePixelRatio"in t&&($.deprecated("useDevicePixelRatio","useDevicePixels")(),f=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:i,onInitialize:r,onRender:n,onFinalize:o,onError:a,gl:s,glOptions:l,debug:u,createFramebuffer:c},this.gl=s,this.needsRedraw=null,this.timeline=null,this.stats=d,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:p,useDevicePixels:f}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Ve("string"===typeof t),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=I_.isSupported(this.gl,["timers"])?new I_(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(t=>{this._running&&(this._addCallbackData(t||{}),!1!==t&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=document.getElementById(t);return i?Number(i.value):e}setViewParameters(){return $.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=D_?new Promise((t,e)=>{D_&&"complete"===document.readyState?t(document):window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):k_(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):M_(t)}_renderFrame(){this.display?this.display._renderFrame(...arguments):this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:i}=this._getSizeAndAspect();t===this.animationProps.width&&e===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){"object"===typeof t&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&"undefined"!==typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?Ce(this.props.gl,t):this.onCreateContext(t),!rt(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");me(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const i=this.props.onAddHTML(e);i&&(e.innerHTML=i)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:t>0&&e>0&&(i=t/e),{width:t,height:e,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&Ie(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Xi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}var R_=i("c8b5");const z_=1,F_=2,B_=4,N_={mousedown:z_,mousemove:F_,mouseup:B_};function j_(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function U_(t){const e=t.prototype.handler;t.prototype.handler=function(t){const i=this.store;t.button>0&&"pointerdown"===t.type&&(j_(i,e=>e.pointerId===t.pointerId)||i.push(t)),e.call(this,t)}}function V_(t){t.prototype.handler=function(t){let e=N_[t.type];e&z_&&t.button>=0&&(this.pressed=!0),e&F_&&0===t.buttons&&(e=B_),this.pressed&&(e&B_&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}U_(R_["PointerEventInput"]),V_(R_["MouseInput"]);const G_=R_["Manager"];var q_=R_;class W_{constructor(t,e,i){this.element=t,this.callback=e,this.options={enable:!0,...i}}}const H_=q_?[[q_.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[q_.Rotate,{enable:!1}],[q_.Pinch,{enable:!1}],[q_.Swipe,{enable:!1}],[q_.Pan,{threshold:0,enable:!1}],[q_.Press,{enable:!1}],[q_.Tap,{event:"doubletap",taps:2,enable:!1}],[q_.Tap,{event:"anytap",enable:!1}],[q_.Tap,{enable:!1}]]:null,Z_={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},X_={doubletap:["tap"]},Y_={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},K_={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},J_={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Q_={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var $_=i("55a9");const tb=-1!==$_["b"].indexOf("firefox"),{WHEEL_EVENTS:eb}=K_,ib="wheel",rb=4.000244140625,nb=40,ob=.25;class ab extends W_{constructor(t,e,i){super(t,e,i),this.handleEvent=t=>{if(!this.options.enable)return;let e=t.deltaY;$_["c"].WheelEvent&&(tb&&t.deltaMode===$_["c"].WheelEvent.DOM_DELTA_PIXEL&&(e/=$_["c"].devicePixelRatio),t.deltaMode===$_["c"].WheelEvent.DOM_DELTA_LINE&&(e*=nb)),0!==e&&e%rb===0&&(e=Math.floor(e/rb)),t.shiftKey&&e&&(e*=ob),this.callback({type:ib,center:{x:t.clientX,y:t.clientY},delta:-e,srcEvent:t,pointerType:"mouse",target:t.target})},this.events=(this.options.events||[]).concat(eb),this.events.forEach(e=>t.addEventListener(e,this.handleEvent,!!$_["a"]&&{passive:!1}))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===ib&&(this.options.enable=e)}}const{MOUSE_EVENTS:sb}=K_,lb="pointermove",ub="pointerover",cb="pointerout",hb="pointerenter",pb="pointerleave";class db extends W_{constructor(t,e,i){super(t,e,i),this.handleEvent=t=>{this.handleOverEvent(t),this.handleOutEvent(t),this.handleEnterEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(sb),this.events.forEach(e=>t.addEventListener(e,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===lb&&(this.enableMoveEvent=e),t===ub&&(this.enableOverEvent=e),t===cb&&(this.enableOutEvent=e),t===hb&&(this.enableEnterEvent=e),t===pb&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&"mouseover"===t.type&&this._emit(ub,t)}handleOutEvent(t){this.enableOutEvent&&"mouseout"===t.type&&this._emit(cb,t)}handleEnterEvent(t){this.enableEnterEvent&&"mouseenter"===t.type&&this._emit(hb,t)}handleLeaveEvent(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this._emit(pb,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.buttons&&(this.pressed=!1),this.pressed||this._emit(lb,t);break;case"mouseup":this.pressed=!1;break;default:}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:fb}=K_,mb="keydown",gb="keyup";class yb extends W_{constructor(t,e,i){super(t,e,i),this.handleEvent=t=>{const e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:mb,srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:gb,srcEvent:t,key:t.key,target:t.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(fb),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(e=>t.addEventListener(e,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===mb&&(this.enableDownEvent=e),t===gb&&(this.enableUpEvent=e)}}const vb="contextmenu";class _b extends W_{constructor(t,e,i){super(t,e,i),this.handleEvent=t=>{this.options.enable&&this.callback({type:vb,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===vb&&(this.options.enable=e)}}const bb=1,xb=2,wb=4,Tb={pointerdown:bb,pointermove:xb,pointerup:wb,mousedown:bb,mousemove:xb,mouseup:wb},Eb=0,Sb=1,Ab=2,Cb=1,Pb=2,Ib=4;function Mb(t){const e=Tb[t.srcEvent.type];if(!e)return null;const{buttons:i,button:r}=t.srcEvent;let n=!1,o=!1,a=!1;return e===xb?(n=Boolean(i&Cb),o=Boolean(i&Ib),a=Boolean(i&Pb)):(n=r===Eb,o=r===Sb,a=r===Ab),{leftButton:n,middleButton:o,rightButton:a}}function kb(t,e){const i=t.center;if(!i)return null;const r=e.getBoundingClientRect(),n=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,a={x:(i.x-r.left-e.clientLeft)/n,y:(i.y-r.top-e.clientTop)/o};return{center:i,offsetCenter:a}}const Db={srcElement:"root",priority:0};class Lb{constructor(t){this.handleEvent=t=>{if(this.isEmpty())return;const e=this._normalizeEvent(t);let i=t.srcEvent.target;while(i&&i!==e.rootElement){if(this._emit(e,i),e.handled)return;i=i.parentNode}this._emit(e,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,i,r=!1,n=!1){const{handlers:o,handlersByElement:a}=this;let s=Db;"string"===typeof i||i&&i.addEventListener?s={...Db,srcElement:i}:i&&(s={...Db,...i});let l=a.get(s.srcElement);l||(l=[],a.set(s.srcElement,l));const u={type:t,handler:e,srcElement:s.srcElement,priority:s.priority};r&&(u.once=!0),n&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let c=l.length-1;while(c>=0){if(l[c].priority>=u.priority)break;c--}l.splice(c+1,0,u)}remove(t,e){const{handlers:i,handlersByElement:r}=this;for(let n=i.length-1;n>=0;n--){const o=i[n];if(o.type===t&&o.handler===e){i.splice(n,1);const t=r.get(o.srcElement);t.splice(t.indexOf(o),1),0===t.length&&r.delete(o.srcElement)}}this._active=i.some(t=>!t.passive)}_emit(t,e){const i=this.handlersByElement.get(e);if(i){let e=!1;const r=()=>{t.handled=!0},n=()=>{t.handled=!0,e=!0},o=[];for(let a=0;a<i.length;a++){const{type:s,handler:l,once:u}=i[a];if(l({...t,type:s,stopPropagation:r,stopImmediatePropagation:n}),u&&o.push(i[a]),e)break}for(let t=0;t<o.length;t++){const{type:e,handler:i}=o[t];this.remove(e,i)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...Mb(t),...kb(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const Ob={events:null,recognizers:null,recognizerOptions:{},Manager:G_,touchAction:"none",tabIndex:0};class Rb{constructor(t=null,e){this._onBasicInput=t=>{const{srcEvent:e}=t,i=Y_[e.type];i&&this.manager.emit(i,t)},this._onOtherEvent=t=>{this.manager.emit(t.type,t)},this.options={...Ob,...e},this.events=new Map,this.setElement(t);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,i=e.Manager;this.manager=new i(t,{touchAction:e.touchAction,recognizers:e.recognizers||H_}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(Z_).forEach(t=>{const e=this.manager.get(t);e&&Z_[t].forEach(t=>{e.recognizeWith(t)})});for(const r in e.recognizerOptions){const t=this.manager.get(r);if(t){const i=e.recognizerOptions[r];delete i.enable,t.set(i)}}this.wheelInput=new ab(t,this._onOtherEvent,{enable:!1}),this.moveInput=new db(t,this._onOtherEvent,{enable:!1}),this.keyInput=new yb(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new _b(t,this._onOtherEvent,{enable:!1});for(const[r,n]of this.events)n.isEmpty()||(this._toggleRecognizer(n.recognizerName,!0),this.manager.on(r,n.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,i){this._addEventHandler(t,e,i,!1)}once(t,e,i){this._addEventHandler(t,e,i,!0)}watch(t,e,i){this._addEventHandler(t,e,i,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:i}=this;if(!i)return;const r=i.get(t);if(r&&r.options.enable!==e){r.set({enable:e});const n=X_[t];n&&!this.options.recognizers&&n.forEach(n=>{const o=i.get(n);e?(o.requireFailure(t),r.dropRequireFailure(n)):o.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,i,r,n){if("string"!==typeof t){i=e;for(const e in t)this._addEventHandler(e,t[e],i,r,n);return}const{manager:o,events:a}=this,s=Q_[t]||t;let l=a.get(s);l||(l=new Lb(this),a.set(s,l),l.recognizerName=J_[s]||s,o&&o.on(s,l.handleEvent)),l.add(t,e,i,r,n),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,e){if("string"!==typeof t){for(const e in t)this._removeEventHandler(e,t[e]);return}const{events:i}=this,r=Q_[t]||t,n=i.get(r);if(n&&(n.remove(t,e),n.isEmpty())){const{recognizerName:t}=n;let e=!1;for(const r of i.values())if(r.recognizerName===t&&!r.isEmpty()){e=!0;break}e||this._toggleRecognizer(t,!1)}}}function zb(){}const Fb=({isDragging:t})=>t?"grabbing":"grab";function Bb(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(jy)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.oneOfType([t.bool,t.number]),touchAction:t.string,eventRecognizerOptions:t.object,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onInteractionStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,onError:t.func,debug:t.bool,drawPickingColors:t.bool,_framebuffer:t.object,_animate:t.bool,_pickable:t.bool,_typedArrayManagerProps:t.object}}const Nb={id:"",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:zb,onResize:zb,onViewStateChange:zb,onInteractionStateChange:zb,onBeforeRender:zb,onAfterRender:zb,onLoad:zb,onError:(t,e)=>Y.error(t)(),_onMetrics:null,getCursor:Fb,debug:!1,drawPickingColors:!1};class jb{constructor(t){t={...Nb,...t},this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),t.viewState&&t.initialViewState&&Y.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===Object(g_["getBrowser"])()&&Y.warn("IE 11 support will be deprecated in v8.0")(),t.gl||"undefined"!==typeof document&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new Fe({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&cr.setProps(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Y.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Y.removed("onLayerClick","onClick")(),t.initialViewState&&!ny(this.props.initialViewState,t.initialViewState)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),r=this.layerManager.needsRedraw(t),n=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return e=e||i||r||n||o,e}redraw(t){if(!this.layerManager)return;const e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}getViews(){return this.viewManager.views}getViewports(t){return this.viewManager.getViewports(t)}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_pick(t,e,i){const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(e).timeStart();const n=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,...i});return r.get(e).timeEnd(),n}_createCanvas(t){let e=t.canvas;if("string"===typeof e&&(e=document.getElementById(e),Jn(e)),!e){e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay";const i=t.parent||document.body;i.appendChild(e)}return Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;let{width:e,height:i}=t;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(i||0===i)&&(i=Number.isFinite(i)?"".concat(i,"px"):i,this.canvas.style.position="absolute",this.canvas.style.height=i)}_updateCanvasSize(){if(this._checkForCanvasSizeChange()){const{width:t,height:e}=this;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}_checkForCanvasSizeChange(){const{canvas:t}=this;if(!t)return!1;const e=t.clientWidth||t.width,i=t.clientHeight||t.height;return(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,!0)}_createAnimationLoop(t){const{width:e,height:i,gl:r,glOptions:n,debug:o,onError:a,onBeforeRender:s,onAfterRender:l,useDevicePixels:u,autoResizeDrawingBuffer:c}=t;return new O_({width:e,height:i,useDevicePixels:u,autoResizeDrawingBuffer:c,autoResizeViewport:!1,gl:r,onCreateContext:t=>Ae({...n,...t,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:t=>this._setGLContext(t.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:s,onAfterRender:l,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new My({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_onPointerMove(t){const{_pickRequest:e}=this;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;{const i=t.offsetCenter;if(!i)return;e.x=i.x,e.y=i.y,e.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.event=t,e.mode="hover"}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:e,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.interactiveState.isHovering=e.length>0;let r=i,n=!1;for(const o of e)r=o,n=o.layer.onHover(o,t.event);if(!n&&this.props.onHover&&this.props.onHover(r,t.event),this.props.getTooltip){const t=this.props.getTooltip(r);this.tooltip.setTooltip(t,r.x,r.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.interactiveState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,Ce(t,{enable:!0,copyState:!0})),this.tooltip=new Ev(this.canvas),de(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new Wg;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Rb(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in Q)this.eventManager.on(r,this._onEvent);this.viewManager=new oy({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new ry(t,{deck:this,stats:this.stats,viewport:i,timeline:e}),this.effectManager=new uv,this.deckRenderer=new fv(t),this.deckPicker=new wv(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:i}=this.layerManager.context;de(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:i})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Y.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.interactiveState.isDragging=t.isDragging,this.props.onInteractionStateChange(t)}_onEvent(t){const e=Q[t.type],i=t.offsetCenter;if(!e||!i)return;const r=this.layerManager.getLayers(),n=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:r,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:o}=n,a=o&&(o[e.handler]||o.props[e.handler]),s=this.props[e.handler];let l=!1;a&&(l=a.call(o,n,t)),!l&&s&&s(n,t)}_onPointerDown(t){const e=t.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:e.x,y:e.y,radius:this.props.pickingRadius})}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const i=Ue.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}jb.getPropTypes=Bb,jb.defaultProps=Nb,jb.VERSION=x_.VERSION;const Ub=["bearing","pitch"],Vb={speed:1.2,curve:1.414};class Gb extends fy{constructor(t={}){super({compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),this.props={...Vb,...t}}interpolateProps(t,e,i){const r=Jc(t,e,i,this.props);for(const n of Ub)r[n]=gr(t[n]||0,e[n]||0,i);return r}getDuration(t,e){let{transitionDuration:i}=e;return"auto"===i&&(i=Qc(t,e,this.props)),i}}var qb={name:"VueDeckgl",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},layers:{type:Array,default:function(){return[]}},viewState:{type:Object,default:function(){return{latitude:40.6971494,longitude:-74.2598655,zoom:12,pitch:0}},required:!0},cursor:{type:String,default:"default"},controller:{type:[Boolean,Object],default:!0},effects:{type:Array,default:function(){return[]}},disableContextMenu:{type:Boolean,default:!1}},methods:{initializeDeck:function(t,e){var i=this;return new jb({canvas:this.$refs.canvas,width:"100%",height:"100%",viewState:t,controller:this.controller,getTooltip:function(t){if(t.object)return{html:"<p><b>Counts: ".concat(t.object.elevationValue,"</b></p>"),style:{color:"#fff",backgroundColor:"#000",fontSize:"0.8em",padding:"5px 10px",borderRadius:"10px",top:"10px",left:"10px"}}},onViewStateChange:function(t){var e=t.viewState;i.deck.setProps({viewState:e}),i.$emit("view-state-change",e)},onClick:function(t,e){i.$emit("click",{info:t,event:e})},onDrag:function(t,e){i.$emit("drag",{info:t,event:e})},onDragStart:function(t,e){i.$emit("onDragStart",{info:t,event:e})},onDragEnd:function(t,e){i.$emit("onDragEnd",{info:t,event:e})},getCursor:function(t){var e=t.isDragging;return e?"grabbing":i.cursor||"grab"},layers:e,effects:this.effects})},handleContextMenu:function(t){this.disableContextMenu&&t.preventDefault()}},watch:{layers:function(t){this.deck.setProps({layers:t})},viewState:function(t){this.deck.setProps({viewState:Object(l["a"])(Object(l["a"])({},t),{},{transitionInterpolator:new Gb})})},effects:function(t){this.deck.setProps({effects:t})}},created:function(){this.deck=null},mounted:function(){this.deck=this.initializeDeck(this.viewState,this.layers)},destroyed:function(){this.deck.finalize()}},Wb=qb,Hb=(i("45e4"),Object(y["a"])(Wb,Ug,Vg,!1,null,"74305515",null)),Zb=Hb.exports,Xb=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flex flex-col"},[i("div",{staticClass:"flex"},[i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"10%",expression:"`10%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(163 230 53)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"20%",expression:"`20%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(132 204 22)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"30%",expression:"`30%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(1 163 13)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"40%",expression:"`40%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(250 204 21)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"50%",expression:"`50%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(234 179 8)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"60%",expression:"`60%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(202 138 4)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"70%",expression:"`70%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(248 113 113)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"80%",expression:"`80%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(220 38 38)"}}),i("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"90%",expression:"`90%`",modifiers:{top:!0}}],staticClass:"w-5 h-5 isSelected",staticStyle:{backgroundColor:"rgb(185 28 28)"}})]),t._m(0)])},Yb=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flex items-center justify-between text-sm"},[i("p",[t._v("Low")]),i("p",[t._v("Medium")]),i("p",[t._v("High")])])}],Kb={},Jb=Kb,Qb=(i("f135"),Object(y["a"])(Jb,Xb,Yb,!1,null,null,null)),$b=Qb.exports,tx=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"flex flex-col gap-2"},[r("div",{staticClass:"flex gap-2 items-center justify-between"},[r("div",[t._v("Move Map")]),r("div",{staticClass:"flex gap-1 items-center justify-between"},[r("img",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"Press and Hold Mouse Left Key.Try to Move the mouse.",expression:"\n            `Press and Hold Mouse Left Key.Try to Move the mouse.`\n          ",modifiers:{bottom:!0}}],staticClass:"w-5 h-5",attrs:{src:i("3215")}})])]),r("div",{staticClass:"flex gap-2 items-center justify-between"},[r("div",[t._v("Zoom In Out")]),r("div",{staticClass:"flex gap-1 items-center justify-between"},[r("img",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"Scroll the mouse",expression:"`Scroll the mouse`",modifiers:{bottom:!0}}],staticClass:"w-5 h-5",attrs:{src:i("8d98")}})])]),r("div",{staticClass:"flex gap-2 items-center justify-between"},[r("div",[t._v("Rotate Map")]),r("div",{staticClass:"flex gap-1 items-center justify-between"},[t.isMac?r("img",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"Press and Hold Command Key",expression:"`Press and Hold Command Key`",modifiers:{bottom:!0}}],staticClass:"w-5 h-5",attrs:{src:i("2d62")}}):t._e(),t.isMac?t._e():r("img",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"Press and Hold Alt Key",expression:"`Press and Hold Alt Key`",modifiers:{bottom:!0}}],staticClass:"w-5 h-5",attrs:{src:i("00ca")}}),r("img",{staticClass:"w-3 h-3",attrs:{src:i("0bbb")}}),r("img",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"Press and Hold Mouse Left Key.Try to Move the mouse.",expression:"\n            `Press and Hold Mouse Left Key.Try to Move the mouse.`\n          ",modifiers:{bottom:!0}}],staticClass:"w-5 h-5",attrs:{src:i("3215")}})])])])])},ex=[],ix={computed:{isMac:function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0}}},rx=ix,nx=Object(y["a"])(rx,tx,ex,!1,null,null,null),ox=nx.exports,ax=i("758b"),sx={components:{VueDeckgl:Zb,ColorIntensityBox:$b,GuidelineBox:ox,PlacesAutocomplete:ax["default"]},props:{data:{type:Array,default:function(){return[]}},defaultFleetId:{type:String,default:""},filteredFleets:{type:Array,default:function(){return[]}},geofencesData:{type:Object,default:function(){}},isDataLoaded:{type:Boolean,default:!1},isCurrentView:{type:Boolean,default:!1}},data:function(){return{toggleBarForControl:!1,toggleBarForPlaceSearch:!1,toggleBarForInfo:!1,accessToken:"pk.eyJ1IjoidmhvaW5haSIsImEiOiJjbTBvMmgxbHcwNDBhMmxvaGxvajM5eDY3In0.B1h5M6Gt2bXLU89w_FfN8A",mapStyle:"mapbox://styles/mapbox/light-v11",viewState:{latitude:23.810331,longitude:90.412521,zoom:12,bearing:0,pitch:45},COLOR_RANGE:[[163,230,53],[132,204,22],[1,163,13],[250,204,21],[234,179,8],[202,138,4],[248,113,113],[220,38,38],[185,28,28]],map:null,showHexagonLayer:!0,showHeatmapLayer:!0,selectedMapStyle:"dark-v11"}},mounted:function(){var t=this;this.map=new jg.a.Map({accessToken:this.accessToken,container:this.$refs.map,interactive:!0,style:this.mapStyle,center:[this.viewState.longitude,this.viewState.latitude],zoom:this.viewState.zoom,pitch:this.viewState.pitch,bearing:this.viewState.bearing}),this.map.on("move",(function(){t.isDataLoaded&&setTimeout((function(){var e=t.map.getCenter(),i=t.map.getZoom(),r=t.map.getPitch(),n=t.map.getBearing();t.updateViewState({longitude:e.lng,latitude:e.lat,zoom:i,pitch:r,bearing:n})}),500)})),setTimeout((function(){var e=t.viewState,i=e.latitude,r=e.longitude,n=e.pitch,o=e.bearing,a=e.zoom;console.log("mounted",a),t.viewState={latitude:i,longitude:r,pitch:n,bearing:o,zoom:a,transitionDuration:3e3}}),5e3)},computed:{layers:function(){var t=[];if(this.showHexagonLayer){var e=new gg({id:"HexagonLayer",data:this.data,extruded:!0,getPosition:function(t){return t.COORDINATES},getColorWeight:function(t){return t.SPACES},getElevationWeight:function(t){return t.SPACES},elevationScale:1,radius:5,pickable:!0,colorRange:this.COLOR_RANGE});t.push(e)}if(this.showHeatmapLayer){var i=new Bg({id:"HeatmapLayer",data:this.data,aggregation:"SUM",getPosition:function(t){return t.COORDINATES},getWeight:function(t){return t.SPACES},colorRange:this.COLOR_RANGE,radiusPixels:25});t.push(i)}return t}},watch:{isCurrentView:{deep:!0,immediate:!0,handler:function(t){t&&this.mapRefresh()}},selectedMapStyle:{deep:!0,immediate:!0,handler:function(t){this.mapStyle="mapbox://styles/mapbox/".concat(t),this.map&&this.map.setStyle(this.mapStyle)}},data:{deep:!0,immediate:!0,handler:function(){this.mapRefresh(),this.isDataLoaded&&this.setCenterInDefaultGeoFence()}},filteredFleets:{deep:!0,immediate:!1,handler:function(t){var e=this;if(t.length>0){var i=t.map((function(t){if(t in e.geofencesData)return e.geofencesData[t]}));i.flat().length>0&&(this.updateCenterView(i.flat()),this.map.jumpTo({center:[this.viewState.longitude,this.viewState.latitude],zoom:8,bearing:0,pitch:45}))}}},geofencesData:{deep:!0,immediate:!1,handler:function(t){console.log("test-geofencesData",t),this.mapRefresh(),Object.keys(t).length>0&&this.setCenterInDefaultGeoFence()}},toggleBarForControl:{deep:!0,immediate:!1,handler:function(t){t&&(this.toggleBarForInfo=!1,this.toggleBarForPlaceSearch=!1)}},toggleBarForPlaceSearch:{deep:!0,immediate:!1,handler:function(t){t&&(this.toggleBarForControl=!1,this.toggleBarForInfo=!1)}},toggleBarForInfo:{deep:!0,immediate:!1,handler:function(t){t&&(this.toggleBarForControl=!1,this.toggleBarForPlaceSearch=!1)}}},methods:{mapRefresh:function(){this.map.resize()},calculateBounds:function(t){var e=t.map((function(t){return t.COORDINATES})),i=new jg.a.LngLatBounds(e[0],e[0]);return e.forEach((function(t){return i.extend(t)})),i},updateViewState:function(t){this.viewState=Object(l["a"])({},t),this.map.jumpTo({center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch})},handleClick:function(t){var e=t.event,i=t.info;console.log("handleClick",e,i)},updateCenterView:function(t){var e=this.calculateBounds(t);this.map.fitBounds(e,{padding:20,maxZoom:15,minZoom:5});var i=e.getCenter();this.viewState=Object(l["a"])(Object(l["a"])({},this.viewState),{},{longitude:i.lng,latitude:i.lat})},onUpdatingPlace:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var r,n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:r=t.geometry.location.lat().toString(),n=t.geometry.location.lng().toString(),e.viewState.latitude=r,e.viewState.longitude=n,e.viewState.zoom=17,e.map.jumpTo({center:[n,r],zoom:17,bearing:e.viewState.bearing,pitch:e.viewState.pitch});case 6:case"end":return i.stop()}}),i)})))()},resetCenterView:function(){this.mapRefresh(),this.updateCenterView(),this.updateViewState(Object(l["a"])({},this.viewState))},setCenterInDefaultGeoFence:function(){this.mapRefresh(),this.updateCenterView(this.geofencesData[this.defaultFleetId]),this.map.jumpTo({center:[this.viewState.longitude,this.viewState.latitude],zoom:12,bearing:0,pitch:45})}}},lx=sx,ux=(i("0a55"),Object(y["a"])(lx,x,w,!1,null,null,null)),cx=ux.exports,hx=i("86e1"),px=i("2c30"),dx=i("755e");i("a12f");i("bb23");function fx(t,e,i,r,n,o){if(n-r<=i)return;const a=r+n>>1;mx(t,e,a,r,n,o%2),fx(t,e,i,r,a-1,o+1),fx(t,e,i,a+1,n,o+1)}function mx(t,e,i,r,n,o){while(n>r){if(n-r>600){const a=n-r+1,s=i-r+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1),h=Math.max(r,Math.floor(i-s*u/a+c)),p=Math.min(n,Math.floor(i+(a-s)*u/a+c));mx(t,e,i,h,p,o)}const a=e[2*i+o];let s=r,l=n;gx(t,e,r,i),e[2*n+o]>a&&gx(t,e,r,n);while(s<l){gx(t,e,s,l),s++,l--;while(e[2*s+o]<a)s++;while(e[2*l+o]>a)l--}e[2*r+o]===a?gx(t,e,r,l):(l++,gx(t,e,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function gx(t,e,i,r){yx(t,i,r),yx(e,2*i,2*r),yx(e,2*i+1,2*r+1)}function yx(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function vx(t,e,i,r,n,o,a){const s=[0,t.length-1,0],l=[];let u,c;while(s.length){const h=s.pop(),p=s.pop(),d=s.pop();if(p-d<=a){for(let a=d;a<=p;a++)u=e[2*a],c=e[2*a+1],u>=i&&u<=n&&c>=r&&c<=o&&l.push(t[a]);continue}const f=Math.floor((d+p)/2);u=e[2*f],c=e[2*f+1],u>=i&&u<=n&&c>=r&&c<=o&&l.push(t[f]);const m=(h+1)%2;(0===h?i<=u:r<=c)&&(s.push(d),s.push(f-1),s.push(m)),(0===h?n>=u:o>=c)&&(s.push(f+1),s.push(p),s.push(m))}return l}function _x(t,e,i,r,n,o){const a=[0,t.length-1,0],s=[],l=n*n;while(a.length){const u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o){for(let n=h;n<=c;n++)bx(e[2*n],e[2*n+1],i,r)<=l&&s.push(t[n]);continue}const p=Math.floor((h+c)/2),d=e[2*p],f=e[2*p+1];bx(d,f,i,r)<=l&&s.push(t[p]);const m=(u+1)%2;(0===u?i-n<=d:r-n<=f)&&(a.push(h),a.push(p-1),a.push(m)),(0===u?i+n>=d:r+n>=f)&&(a.push(p+1),a.push(c),a.push(m))}return s}function bx(t,e,i,r){const n=t-i,o=e-r;return n*n+o*o}const xx=t=>t[0],wx=t=>t[1];class Tx{constructor(t,e=xx,i=wx,r=64,n=Float64Array){this.nodeSize=r,this.points=t;const o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new n(2*t.length);for(let l=0;l<t.length;l++)a[l]=l,s[2*l]=e(t[l]),s[2*l+1]=i(t[l]);fx(a,s,r,0,a.length-1,0)}range(t,e,i,r){return vx(this.ids,this.coords,t,e,i,r,this.nodeSize)}within(t,e,i){return _x(this.ids,this.coords,t,e,i,this.nodeSize)}}const Ex={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},Sx=Math.fround||(t=>e=>(t[0]=+e,t[0]))(new Float32Array(1));class Ax{constructor(t){this.options=Rx(Object.create(Ex),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:i,maxZoom:r,nodeSize:n}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;let a=[];for(let s=0;s<t.length;s++)t[s].geometry&&a.push(Px(t[s],s));this.trees[r+1]=new Tx(a,zx,Fx,n,Float32Array),e&&console.timeEnd(o);for(let s=r;s>=i;s--){const t=+Date.now();a=this._cluster(a,s),this.trees[s]=new Tx(a,zx,Fx,n,Float32Array),e&&console.log("z%d: %d clusters in %dms",s,a.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){const t=this.getClusters([i,r,180,o],e),a=this.getClusters([-180,r,n,o],e);return t.concat(a)}const a=this.trees[this._limitZoom(e)],s=a.range(kx(i),Dx(o),kx(n),Dx(r)),l=[];for(const u of s){const t=a.points[u];l.push(t.numPoints?Ix(t):this.points[t.index])}return l}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.points[e];if(!o)throw new Error(r);const a=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=n.within(o.x,o.y,a),l=[];for(const u of s){const e=n.points[u];e.parentId===t&&l.push(e.numPoints?Ix(e):this.points[e.index])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){e=e||10,i=i||0;const r=[];return this._appendLeaves(r,t,e,i,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:a}=this.options,s=a/o,l=(i-s)/n,u=(i+1+s)/n,c={features:[]};return this._addTileFeatures(r.range((e-s)/n,l,(e+1+s)/n,u),r.points,e,i,n,c),0===e&&this._addTileFeatures(r.range(1-s/n,l,1,u),r.points,n,i,n,c),e===n-1&&this._addTileFeatures(r.range(0,l,s/n,u),r.points,-1,i,n,c),c.features.length?c:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;while(e<=this.options.maxZoom){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,n){const o=this.getChildren(e);for(const a of o){const e=a.properties;if(e&&e.cluster?n+e.point_count<=r?n+=e.point_count:n=this._appendLeaves(t,e.cluster_id,i,r,n):n<r?n++:t.push(a),t.length===i)break}return n}_addTileFeatures(t,e,i,r,n,o){for(const a of t){const t=e[a],s=t.numPoints;let l,u,c;if(s)l=Mx(t),u=t.x,c=t.y;else{const e=this.points[t.index];l=e.properties,u=kx(e.geometry.coordinates[0]),c=Dx(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(u*n-i)),Math.round(this.options.extent*(c*n-r))]],tags:l};let p;s?p=t.id:this.options.generateId?p=t.index:this.points[t.index].id&&(p=this.points[t.index].id),void 0!==p&&(h.id=p),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const i=[],{radius:r,extent:n,reduce:o,minPoints:a}=this.options,s=r/(n*Math.pow(2,e));for(let l=0;l<t.length;l++){const r=t[l];if(r.zoom<=e)continue;r.zoom=e;const n=this.trees[e+1],u=n.within(r.x,r.y,s),c=r.numPoints||1;let h=c;for(const t of u){const i=n.points[t];i.zoom>e&&(h+=i.numPoints||1)}if(h>c&&h>=a){let t=r.x*c,a=r.y*c,s=o&&c>1?this._map(r,!0):null;const p=(l<<5)+(e+1)+this.points.length;for(const i of u){const l=n.points[i];if(l.zoom<=e)continue;l.zoom=e;const u=l.numPoints||1;t+=l.x*u,a+=l.y*u,l.parentId=p,o&&(s||(s=this._map(r,!0)),o(s,this._map(l)))}r.parentId=p,i.push(Cx(t/h,a/h,p,h,s))}else if(i.push(r),h>1)for(const t of u){const r=n.points[t];r.zoom<=e||(r.zoom=e,i.push(r))}}return i}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?Rx({},t.properties):t.properties;const i=this.points[t.index].properties,r=this.options.map(i);return e&&r===i?Rx({},r):r}}function Cx(t,e,i,r,n){return{x:Sx(t),y:Sx(e),zoom:1/0,id:i,parentId:-1,numPoints:r,properties:n}}function Px(t,e){const[i,r]=t.geometry.coordinates;return{x:Sx(kx(i)),y:Sx(Dx(r)),zoom:1/0,index:e,parentId:-1}}function Ix(t){return{type:"Feature",id:t.id,properties:Mx(t),geometry:{type:"Point",coordinates:[Lx(t.x),Ox(t.y)]}}}function Mx(t){const e=t.numPoints,i=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return Rx(Rx({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function kx(t){return t/360+.5}function Dx(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function Lx(t){return 360*(t-.5)}function Ox(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function Rx(t,e){for(const i in e)t[i]=e[i];return t}function zx(t){return t.x}function Fx(t){return t.y}var Bx=i("9f6a"),Nx=i.n(Bx);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function jx(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i}class Ux{constructor({markers:t,position:e}){this.markers=t,e&&(e instanceof google.maps.LatLng?this._position=e:this._position=new google.maps.LatLng(e))}get bounds(){if(0!==this.markers.length||this._position)return this.markers.reduce((t,e)=>t.extend(e.getPosition()),new google.maps.LatLngBounds(this._position,this._position))}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(t=>t.getVisible()).length}push(t){this.markers.push(t)}delete(){this.marker&&(this.marker.setMap(null),delete this.marker),this.markers.length=0}}class Vx{constructor({maxZoom:t=16}){this.maxZoom=t}noop({markers:t}){return Gx(t)}}const Gx=t=>{const e=t.map(t=>new Ux({position:t.getPosition(),markers:[t]}));return e};class qx extends Vx{constructor(t){var{maxZoom:e,radius:i=60}=t,r=jx(t,["maxZoom","radius"]);super({maxZoom:e}),this.superCluster=new Ax(Object.assign({maxZoom:this.maxZoom,radius:i},r)),this.state={zoom:null}}calculate(t){let e=!1;if(!Nx()(t.markers,this.markers)){e=!0,this.markers=[...t.markers];const i=this.markers.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:[t.getPosition().lng(),t.getPosition().lat()]},properties:{marker:t}}));this.superCluster.load(i)}const i={zoom:t.map.getZoom()};return e||this.state.zoom>this.maxZoom&&i.zoom>this.maxZoom||(e=e||!Nx()(this.state,i)),this.state=i,e&&(this.clusters=this.cluster(t)),{clusters:this.clusters,changed:e}}cluster({map:t}){return this.superCluster.getClusters([-180,-90,180,90],t.getZoom()).map(this.transformCluster.bind(this))}transformCluster({geometry:{coordinates:[t,e]},properties:i}){if(i.cluster)return new Ux({markers:this.superCluster.getLeaves(i.cluster_id,1/0).map(t=>t.properties.marker),position:new google.maps.LatLng({lat:e,lng:t})});{const t=i.marker;return new Ux({markers:[t],position:t.getPosition()})}}}class Wx{constructor(t,e){this.markers={sum:t.length};const i=e.map(t=>t.count),r=i.reduce((t,e)=>t+e,0);this.clusters={count:e.length,markers:{mean:r/e.length,sum:r,min:Math.min(...i),max:Math.max(...i)}}}}class Hx{render({count:t,position:e},i){const r=t>Math.max(10,i.clusters.markers.mean)?"#ff0000":"#0000ff",n=window.btoa(`\n  <svg fill="${r}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240">\n    <circle cx="120" cy="120" opacity=".6" r="70" />\n    <circle cx="120" cy="120" opacity=".3" r="90" />\n    <circle cx="120" cy="120" opacity=".2" r="110" />\n  </svg>`);return new google.maps.Marker({position:e,icon:{url:"data:image/svg+xml;base64,"+n,scaledSize:new google.maps.Size(45,45)},label:{text:String(t),color:"rgba(255,255,255,0.9)",fontSize:"12px"},zIndex:Number(google.maps.Marker.MAX_ZINDEX)+t})}}function Zx(t,e){for(let i in e.prototype)t.prototype[i]=e.prototype[i]}class Xx{constructor(){Zx(Xx,google.maps.OverlayView)}}var Yx;(function(t){t["CLUSTERING_BEGIN"]="clusteringbegin",t["CLUSTERING_END"]="clusteringend",t["CLUSTER_CLICK"]="click"})(Yx||(Yx={}));const Kx=(t,e,i)=>{i.fitBounds(e.bounds)};class Jx extends Xx{constructor({map:t,markers:e=[],algorithm:i=new qx({}),renderer:r=new Hx,onClusterClick:n=Kx}){super(),this.markers=[...e],this.clusters=[],this.algorithm=i,this.renderer=r,this.onClusterClick=n,t&&this.setMap(t)}addMarker(t,e){this.markers.includes(t)||(this.markers.push(t),e||this.render())}addMarkers(t,e){t.forEach(t=>{this.addMarker(t,!0)}),e||this.render()}removeMarker(t,e){const i=this.markers.indexOf(t);return-1!==i&&(t.setMap(null),this.markers.splice(i,1),e||this.render(),!0)}removeMarkers(t,e){let i=!1;return t.forEach(t=>{i=this.removeMarker(t,!0)||i}),i&&!e&&this.render(),i}clearMarkers(t){this.markers.length=0,t||this.render()}render(){const t=this.getMap();if(t instanceof google.maps.Map&&this.getProjection()){google.maps.event.trigger(this,Yx.CLUSTERING_BEGIN,this);const{clusters:e,changed:i}=this.algorithm.calculate({markers:this.markers,map:t,mapCanvasProjection:this.getProjection()});(i||void 0==i)&&(this.reset(),this.clusters=e,this.renderClusters()),google.maps.event.trigger(this,Yx.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener("idle",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(t=>t.setMap(null)),this.clusters.forEach(t=>t.delete()),this.clusters=[]}renderClusters(){const t=new Wx(this.markers,this.clusters),e=this.getMap();this.clusters.forEach(i=>{1===i.markers.length?i.marker=i.markers[0]:(i.marker=this.renderer.render(i,t),this.onClusterClick&&i.marker.addListener("click",t=>{google.maps.event.trigger(this,Yx.CLUSTER_CLICK,i),this.onClusterClick(t,i,e)})),i.marker.setMap(e)})}}var Qx=i("dde5"),$x=i("c820"),tw=i("8643"),ew={name:"DemandHeatmap",components:{BaseLayout:h["default"],ContentSection:b["default"],LiveMapFilterPills:_,DemandHeatmapV2:cx},data:function(){return{count:{pick_up:0,drop_off:0,fleets:{}},map:null,map_zoom:10,map_center:{lat:23.810331,lng:90.412521},map_summary:{},raw_data:[],filtered_data:[],map_data:[],raw_data_count:0,map_mode:"only_src",start_date:"",end_date:"",chartLoaded:!0,bikeLayer:null,heatmapLayer:null,clusterLayer:null,gradient:["rgba(255, 0, 0, 0)","rgba(255, 0, 0, 0.1)","rgba(255, 0, 0, 0.2)","rgba(255, 0, 0, 0.3)","rgba(255, 0, 0, 0.4)","rgba(255, 0, 0, 0.5)","rgba(255, 0, 0, 0.6)","rgba(255, 0, 0, 0.7)","rgba(255, 0, 0, 0.8)","rgba(255, 0, 0, 0.9)","rgba(255, 0, 0, 1)"],styles:[{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"}]}],limit:5e3,map_load_text:"Requesting Data...",fleetData:[],minSliderDate:(new Date).valueOf(),maxSliderDate:(new Date).valueOf(),showSlider:!1,isDataFullyLoaded:!1,tabs:[{id:"google",text:"2D"},{id:"mapbox",text:"3D"}],activeTabId:"mapbox",bikeData:[],defaultFleetId:"",allFleetGeoFence:{},selectedFilteredFleets:[]}},mounted:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getFleetDropdownData();case 2:return t.fleetData=e.sent,t.showSlider=!1,e.next=6,t.initDraw();case 6:return e.next=8,t.fetchDefaultGeofenceCoords();case 8:return e.next=10,t.fetchAllServiceArea();case 10:case"end":return e.stop()}}),e)})))()},computed:{google:dx["gmapApi"],mapFilters:function(){return this.$refs.heatmap_filter.definedFilters()},dateFilter:function(){return this.$refs.heatmap_filter.filter_date_range},sliderDates:function(){return Object(px["c"])(this.minSliderDate,this.maxSliderDate).map((function(t){return new Date(t)}))},getMapDataForMapbox:function(){var t=[];return this.map_data.length>0&&(t=this.map_data.map((function(t){return{SPACES:1,COORDINATES:[t.lng(),t.lat()]}}))),t}},watch:{filtered_data:function(){var t=this.getSortedFilteredDataByDate();this.minSliderDate=t.length>0?new Date(t[0].created_at).valueOf():(new Date).valueOf(),this.maxSliderDate=t.length>1?new Date(t[t.length-1].created_at).valueOf():(new Date).valueOf()}},methods:{parseToOverlay:tw["c"],getTabClass:function(t){return{"tab-item":!0,"tab-item--active":this.activeTabId===t}},onClickTab:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:e.activeTabId=t;case 1:case"end":return i.stop()}}),i)})))()},getSortedFilteredDataByDate:function(){return Object(u["a"])(this.filtered_data).sort((function(t,e){return new Date(t.created_at).valueOf()-new Date(e.created_at).valueOf()}))},onDateSliderChange:function(t){console.log("Slider ranged",t);var e=this.getDataFilteredByDateSlider(this.raw_data,t.from,t.to);this.filtered_data=e,this.plotFilteredData()},prettifySlider:function(t){var e=new Date(this.minSliderDate),i=new Date(this.maxSliderDate);return e.year===i.year&&e.month===i.month&&e.day===i.day?new Date(t).toLocaleDateString("en",{hour:"numeric",minute:"numeric",year:"numeric",month:"short",day:"numeric"}):new Date(t).toLocaleDateString("en",{year:"numeric",month:"short",day:"numeric"})},getSanitizedCoord:function(t){return parseFloat(t.trim())},populateFleetCounts:function(){var t=this;this.fleetData.forEach((function(e){t.count.fleets[e.id]=t.filtered_data.filter((function(t){return t.fleet_id==e.id})).length}))},getFleetDropdownData:function(){return Object(c["a"])(regeneratorRuntime.mark((function t(){var e,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e="/dashboard/fleets/?dropdown=true",t.prev=1,t.next=4,Qx["b"].get(e);case 4:return i=t.sent,console.log("Loaded Fleets DR Data",i.data),r=i.data.data,t.abrupt("return",Promise.resolve(r));case 10:return t.prev=10,t.t0=t["catch"](1),console.error(t.t0),t.abrupt("return",Promise.reject(t.t0));case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))()},fetchDefaultGeofenceCoords:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get($x["c"].organization.details(t.$store.getters["auth/organizationInfo"].id)).then((function(e){t.defaultFleetId=e.data.default_fleet.id}));case 2:case"end":return e.stop()}}),e)})))()},fetchAllServiceArea:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get($x["c"].dropdown.serviceAreas()).then((function(e){e.data.data.map((function(e){e.fleet&&(t.allFleetGeoFence=Object(l["a"])(Object(l["a"])({},t.allFleetGeoFence),{},Object(s["a"])({},e.fleet.id,t.parseToOverlay(e.coords).map((function(t){return{COORDINATES:[t.lng,t.lat]}})))))}))}));case 2:case"end":return e.stop()}}),e)})))()},getLocationFromCoordString:function(t){var e=t.split(",");return new this.google.maps.LatLng(this.getSanitizedCoord(e[0]),this.getSanitizedCoord(e[1]))},getDataFilteredByDateRange:function(t){var e=this,i=t.filter((function(t){return Date.parse("".concat(e.dateFilter.start,"T00:00:00Z"))<=Date.parse(t.created_at)&&Date.parse(t.created_at)<=Date.parse("".concat(e.dateFilter.end,"T23:59:59.99Z"))}));return i},getDataFilteredByDateSlider:function(t,e,i){return console.log(t.length,"HGAFCZBZHJSTYDXGCFBNJXGUYDRGSFCXBNVJGSUFHTXZCGVNJSGUFHTG"),t.filter((function(t){return new Date(e)<=Date.parse(t.created_at)&&Date.parse(t.created_at)<=new Date(i)}))},getDataFilteredBySelectedFleets:function(t){var e=[];for(var i in this.mapFilters.filterFleet.models)!0===this.mapFilters.filterFleet.models[i]&&e.push(i);return this.selectedFilteredFleets=e,t.filter((function(t){return e.includes(t.fleet_id)}))},plotFilteredData:function(){this.map_data=this.getProcessedMapData(this.filtered_data),console.log(this.map_data.length),this.populateFleetCounts(),this.resetBoundForHeatMapData(),this.addHeatMapLayer(),this.addClusterLayer()},filterData:function(){var t=this;this.filtered_data=this.getDataFilteredByDateRange(this.raw_data),this.mapFilters.filterFleet.isApplied&&(this.filtered_data=this.getDataFilteredBySelectedFleets(this.filtered_data)),console.log("Date filtered count",this.filtered_data.length),console.log(this.filtered_data.length),this.plotFilteredData(),this.showSlider=!1,this.$nextTick((function(){t.showSlider=!0}))},getProcessedMapData:function(t){var e=[];this.count.pick_up=0,this.count.drop_off=0;var i,r=Object(a["a"])(t);try{for(r.s();!(i=r.n()).done;){var n=i.value;n.src_coord&&(this.count.pick_up+=1),n.dest_coord&&(this.count.drop_off+=1),this.mapFilters.filterLocationPoint.isApplied?(n.src_coord&&this.mapFilters.filterLocationPoint.models.pickup_points&&e.push(this.getLocationFromCoordString(n.src_coord)),n.dest_coord&&this.mapFilters.filterLocationPoint.models.dropoff_points&&e.push(this.getLocationFromCoordString(n.dest_coord))):n.src_coord&&e.push(this.getLocationFromCoordString(n.src_coord))}}catch(o){r.e(o)}finally{r.f()}return this.map_load_text="Filtered ".concat(e.length," trips"),e},getTripMapData:function(){var t=arguments,e=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=t.length>0&&void 0!==t[0]&&t[0],r&&(e.raw_data=[],e.map_data=[]),console.log("Requesting map Data..."),i.next=5,e.$http.get("".concat(hx["a"].api.trip_heatmap,"?mode=").concat(e.map_mode,"&limit=").concat(e.limit,"&offset=").concat(e.raw_data.length,"&start_date=").concat(e.dateFilter.start,"&end_date=").concat(e.dateFilter.end)).then(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(i){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.map_summary=i.data.meta.summary,e.raw_data_count=i.data.meta.count?i.data.meta.count.total:0,r&&(n=e.raw_data_count-e.limit,e.limit=n>e.limit?Number.parseInt(n/2):n,console.log("resetted limit to "+e.limit)),e.raw_data=e.raw_data.concat(i.data.data),console.log(e.raw_data.length),e.filtered_data=e.getDataFilteredByDateRange(e.raw_data),console.log(e.filtered_data.length),e.map_load_text="Loaded ".concat(e.raw_data.length," of ").concat(e.raw_data_count," trips"),e.plotFilteredData(),e.raw_data_count!=e.raw_data.length){t.next=15;break}return e.map_load_text="Loaded...",e.vanishLoadText(),e.showSlider=!0,e.isDataFullyLoaded=!0,t.abrupt("return");case 15:return t.next=17,e.getTripMapData();case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){console.warn("Error Happened"),console.log(t)}));case 5:case"end":return i.stop()}}),i)})))()},asyncTimeout:function(t){return new Promise((function(e){return setTimeout(e,t)}))},vanishLoadText:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.asyncTimeout(5e3);case 2:t.map_load_text="";case 3:case"end":return e.stop()}}),e)})))()},stylizeMap:function(){var t=new this.google.maps.StyledMapType(this.styles,{name:"Trip Analysis Map",zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0});this.map.mapTypes.set("styled_map",t),this.map.setMapTypeId("styled_map")},initDraw:function(){var t=this;setTimeout((function(){t.$refs.map&&t.$refs.map.$mapPromise.then(function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("Hitting promise with",i),t.map=i,t.stylizeMap(),t.addBikeLayer(),e.next=6,t.getTripMapData(!0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),1e3)},resetBoundForHeatMapData:function(){var t,e=new this.google.maps.LatLngBounds,i=Object(a["a"])(this.map_data);try{for(i.s();!(t=i.n()).done;){var r=t.value;e.extend(r)}}catch(n){i.e(n)}finally{i.f()}this.map.setCenter(e.getCenter()),this.map.fitBounds(e)},addBikeLayer:function(){null!=this.map&&(this.bikeLayer=new this.google.maps.BicyclingLayer,this.bikeLayer.setMap(this.map))},addHeatMapLayer:function(){null!=this.map&&0!=this.map_data.length&&(null===this.heatmapLayer?(this.heatmapLayer=new this.google.maps.visualization.HeatmapLayer({data:this.map_data}),this.heatmapLayer.setMap(this.map),this.toggleHeatmapOpacity()):this.heatmapLayer.setData(this.map_data))},addClusterLayer:function(){var t=this;if(null!=this.map&&0!=this.map_data.length){var e=new this.google.maps.InfoWindow({content:"",disableAutoPan:!0}),i=this.map_data.map((function(i,r){var n=new t.google.maps.Marker({position:i,i:r});return n.addListener("click",(function(){e.setContent(i),e.open(t.map,n)})),n})),r=this.map;this.clusterLayer&&this.clusterLayer.setMap(null),this.clusterLayer=new Jx({markers:i,map:r})}},toggleHeatmap:function(){this.heatmapLayer&&this.map&&this.heatmapLayer.setMap(this.heatmapLayer.getMap()?null:this.map)},toggleHeatmapGradient:function(){this.heatmapLayer&&this.map&&this.heatmapLayer.set("gradient",this.heatmapLayer.get("gradient")?null:this.gradient)},toggleHeatmapOpacity:function(){this.heatmapLayer&&this.map&&this.heatmapLayer.set("opacity",this.heatmapLayer.get("opacity")?null:.6)},toggleHeatmapLayerDissipation:function(){this.heatmapLayer&&this.map&&this.heatmapLayer.set("dissipating",!this.heatmapLayer.get("dissipating"))}}},iw=ew,rw=(i("009c"),Object(y["a"])(iw,n,o,!1,null,"38e8f24d",null));e["default"]=rw.exports},"5a61":function(t,e){(function(){var e={}.hasOwnProperty;t.exports=function(){class t{constructor(t){var i,r,n;for(i in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),t||(t={}),this.options=t,this.options.version||(this.options.version="1.0"),r=t.stringify||{},r)e.call(r,i)&&(n=r[i],this[i]=n)}name(t){return this.options.noValidation?t:this.assertLegalName(""+t||"")}text(t){return this.options.noValidation?t:this.assertLegalChar(this.textEscape(""+t||""))}cdata(t){return this.options.noValidation?t:(t=""+t||"",t=t.replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(t))}comment(t){if(this.options.noValidation)return t;if(t=""+t||"",t.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+t);return this.assertLegalChar(t)}raw(t){return this.options.noValidation?t:""+t||""}attValue(t){return this.options.noValidation?t:this.assertLegalChar(this.attEscape(t=""+t||""))}insTarget(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}insValue(t){if(this.options.noValidation)return t;if(t=""+t||"",t.match(/\?>/))throw new Error("Invalid processing instruction value: "+t);return this.assertLegalChar(t)}xmlVersion(t){if(this.options.noValidation)return t;if(t=""+t||"",!t.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+t);return t}xmlEncoding(t){if(this.options.noValidation)return t;if(t=""+t||"",!t.match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+t);return this.assertLegalChar(t)}xmlStandalone(t){return this.options.noValidation?t:t?"yes":"no"}dtdPubID(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdSysID(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdElementValue(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdAttType(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdAttDefault(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdEntityValue(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdNData(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}assertLegalChar(t){var e,i;if(this.options.noValidation)return t;if("1.0"===this.options.version){if(e=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)t=t.replace(e,this.options.invalidCharReplacement);else if(i=t.match(e))throw new Error(`Invalid character in string: ${t} at index ${i.index}`)}else if("1.1"===this.options.version)if(e=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)t=t.replace(e,this.options.invalidCharReplacement);else if(i=t.match(e))throw new Error(`Invalid character in string: ${t} at index ${i.index}`);return t}assertLegalName(t){var e;if(this.options.noValidation)return t;if(t=this.assertLegalChar(t),e=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!t.match(e))throw new Error("Invalid character in name: "+t);return t}textEscape(t){var e;return this.options.noValidation?t:(e=this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,t.replace(e,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))}attEscape(t){var e;return this.options.noValidation?t:(e=this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,t.replace(e,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))}}return t.prototype.convertAttKey="@",t.prototype.convertPIKey="?",t.prototype.convertTextKey="#text",t.prototype.convertCDataKey="#cdata",t.prototype.convertCommentKey="#comment",t.prototype.convertRawKey="#raw",t}.call(this)}).call(this)},"5c2a":function(t,e){(function(){t.exports=function(){class t{constructor(t){this.nodes=t}clone(){return this.nodes=null}getNamedItem(t){return this.nodes[t]}setNamedItem(t){var e;return e=this.nodes[t.nodeName],this.nodes[t.nodeName]=t,e||null}removeNamedItem(t){var e;return e=this.nodes[t],delete this.nodes[t],e||null}item(t){return this.nodes[Object.keys(this.nodes)[t]]||null}getNamedItemNS(t,e){throw new Error("This DOM method is not implemented.")}setNamedItemNS(t){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(t,e){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(t.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),t}.call(this)}).call(this)},"619d":function(t,e,i){},"62b7":function(t,e,i){"use strict";i("f900")},"6fef":function(t,e,i){"use strict";i("1ccc")},7212:function(t,e,i){"use strict";i("84b4")},"744c":function(t,e,i){(function(){var e,r,n,o,a,s,l,u,c;({assign:u,isFunction:c}=i("45f3")),n=i("0a6d"),o=i("ae0a"),a=i("54dd"),l=i("1f08"),s=i("c376"),e=i("065e"),r=i("0985"),t.exports.create=function(t,e,i,r){var n,a;if(null==t)throw new Error("Root element needs a name.");return r=u({},e,i,r),n=new o(r),a=n.element(t),r.headless||(n.declaration(r),null==r.pubID&&null==r.sysID||n.dtd(r)),a},t.exports.begin=function(t,e,i){return c(t)&&([e,i]=[t,e],t={}),e?new a(t,e,i):new o(t)},t.exports.stringWriter=function(t){return new l(t)},t.exports.streamWriter=function(t,e){return new s(t,e)},t.exports.implementation=new n,t.exports.nodeType=e,t.exports.writerState=r}).call(this)},"74be":function(t,e,i){"use strict";(function(t,r){i.d(e,"e",(function(){return a})),i.d(e,"f",(function(){return s})),i.d(e,"c",(function(){return o})),i.d(e,"b",(function(){return l})),i.d(e,"d",(function(){return u})),i.d(e,"a",(function(){return c}));const n={self:"undefined"!==typeof self&&self,window:"undefined"!==typeof window&&window,global:"undefined"!==typeof t&&t,document:"undefined"!==typeof document&&document,process:"object"===typeof r&&r},o=globalThis,a=n.self||n.window||n.global,s=n.window||n.self||n.global,l=n.document||{},u=n.process||{},c=console}).call(this,i("c8ba"),i("4362"))},"758b":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"relative w-full"},[i("google-places-autocomplete",{on:{resultChanged:t.onChangingPlace,resultCleared:t.onClearingPlace},scopedSlots:t._u([{key:"input",fn:function(e){var r=e.context,n=e.events,o=e.actions;return i("div",{},[i("label",{staticClass:"font-bold text-gray-700 text-14px"},[t._v(" "+t._s(t.label)+" ")]),i("input",{directives:[{name:"model",rawName:"v-model",value:r.input,expression:"context.input"}],class:t.disabled?"places-autocomplete disabled":"places-autocomplete enabled",attrs:{type:"search",autocomplete:"autocomplete-off",placeholder:t.placeholder,disabled:t.disabled},domProps:{value:r.input},on:{focus:n.inputHasReceivedFocus,input:[function(e){e.target.composing||t.$set(r,"input",e.target.value)},n.inputHasChanged],keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),o.selectItemFromList.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:(e.preventDefault(),o.shiftResultsSelection.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:(e.preventDefault(),o.unshiftResultsSelection.apply(null,arguments))}]}})])}},{key:"item",fn:function(e){var r=e.place;return i("span",{},[i("i",{staticClass:"mr-3 fas fa-map-marker-alt text-oLightGray"}),t._v(" "+t._s(r.structured_formatting.main_text)+" "),i("span",{staticClass:"text-xs text-oLightGray"},[t._v(" "+t._s(r.structured_formatting.secondary_text?"- "+r.structured_formatting.secondary_text:"")+" ")])])}},{key:"activeItem",fn:function(e){var r=e.place;return i("span",{},[i("i",{staticClass:"mr-3 fas fa-map-marker-alt text-oLightGray"}),t._v(" "+t._s(r.structured_formatting.main_text)+" "),i("span",{staticClass:"text-xs text-oLightGray"},[t._v(" "+t._s(r.structured_formatting.secondary_text?"- "+r.structured_formatting.secondary_text:"")+" ")])])}}]),model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)},n=[],o=i("1da1"),a=(i("96cf"),i("4d28")),s={name:"PlacesAutocomplete",props:{value:{required:!1},label:{type:String,required:!1,default:"Search Location"},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default:"Enter address / location"}},components:{GooglePlacesAutocomplete:a["GooglePlacesAutocomplete"]},methods:{onChangingPlace:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:e.$emit("update:place",t);case 1:case"end":return i.stop()}}),i)})))()},onClearingPlace:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$emit("clear:place");case 1:case"end":return e.stop()}}),e)})))()}}},l=s,u=(i("3200"),i("2877")),c=Object(u["a"])(l,r,n,!1,null,null,null);e["default"]=c.exports},"791f":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return s}));var r=i("0ce1"),n=i("bdda");const o=globalThis;function a(){return"undefined"!==typeof o.orientation}function s(t){if(!t&&!Object(r["a"])())return"Node";if(Object(n["a"])(t))return"Electron";const e="undefined"!==typeof navigator?navigator:{},i=t||e.userAgent||"";if(i.indexOf("Edge")>-1)return"Edge";const a=-1!==i.indexOf("MSIE "),s=-1!==i.indexOf("Trident/");return a||s?"IE":o.chrome?"Chrome":o.safari?"Safari":o.mozInnerScreenX?"Firefox":"Unknown"}},"7cd2":function(t,e,i){"use strict";i("cc64")},"7d1d":function(t,e,i){"use strict";i.d(e,"d",(function(){return n})),i.d(e,"a",(function(){return o})),i.d(e,"g",(function(){return a})),i.d(e,"b",(function(){return s})),i.d(e,"e",(function(){return l})),i.d(e,"c",(function(){return c})),i.d(e,"f",(function(){return h}));i("99af"),i("a630"),i("3ca3"),i("d3b7"),i("6062b"),i("ddb0");function r(t){return t>9?""+t:"0"+t}function n(){return new Date}function o(t,e){return new Date(e,t+1,0).getDate()}function a(t){return new Date(t)}function s(t,e,i){var n=new Date(i,e,t);return"".concat(n.getFullYear(),"-").concat(r(n.getMonth()+1),"-").concat(r(n.getDate()))}function l(t,e){for(var i=[],r=1;r<=o(t,e);r++){var n=u(new Date(e,t,r));if(11===t&&1===n){n=i[i.length-1]+1,i.push(n);break}i.push(n)}return Array.from(new Set(i))}function u(t){t=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));var e=new Date(Date.UTC(t.getUTCFullYear(),0,1)),i=864e5;return Math.ceil(((t-e)/i+1)/7)}function c(t){return["January","February","March","April","May","June","July","August","September","October","November","December"][t]}function h(t){var e=Math.floor(t/31536e6),i=t%31536e6,r=Math.floor(i/2592e6),n=t%2592e6,o=Math.floor(n/864e5),a=t%864e5,s=Math.floor(a/36e5),l=t%36e5,u=Math.floor(l/6e4),c=t%6e4,h=Math.floor(c/1e3);return e>0?"".concat(e,"y ").concat(r,"mo ").concat(o,"d ago"):r>0&&e<=0?"".concat(r,"mo ").concat(o,"d ").concat(s,"h ago"):o>0&&r<=0&&e<=0?"".concat(o,"d ").concat(s,"h ").concat(u,"m ago"):s>0&&o<=0&&r<=0&&e<=0?"".concat(s,"h ").concat(u,"m ").concat(h,"s ago"):u>0&&s<=0&&o<=0&&r<=0&&e<=0?"".concat(u,"m ").concat(h,"s ago"):h>0&&u<=0&&s<=0&&o<=0&&r<=0&&e<=0?"".concat(h,"s ago"):h<=0&&u<=0&&s<=0&&o<=0&&r<=0&&e<=0?"--":void 0}},"7e21":function(t,e,i){!function(e,i){t.exports=i()}(0,(function(){"use strict";return function(t,e){e.prototype.weekday=function(t){var e=this.$locale().weekStart||0,i=this.$W,r=(i<e?i+7:i)-e;return this.$utils().u(t)?r:this.subtract(r,"day").add(t,"day")}}}))},"7f8d":function(t,e,i){function r(t,e,i){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,i)}r.prototype.init=function(t,e,i){this.assignments=[],this.centroids=[],"undefined"!==typeof t&&(this.dataset=t),"undefined"!==typeof e&&(this.k=e),"undefined"!==typeof i&&(this.distance=i)},r.prototype.run=function(t,e){this.init(t,e);for(var i=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();var n=!0;while(n){n=this.assign();for(var o=0;o<this.k;o++){for(var a=new Array(c),s=0,l=0;l<c;l++)a[l]=0;for(var u=0;u<i;u++){var c=this.dataset[u].length;if(o===this.assignments[u]){for(l=0;l<c;l++)a[l]+=this.dataset[u][l];s++}}if(s>0){for(l=0;l<c;l++)a[l]/=s;this.centroids[o]=a}else this.centroids[o]=this.randomCentroid(),n=!0}}return this.getClusters()},r.prototype.randomCentroid=function(){var t,e,i=this.dataset.length-1;do{e=Math.round(Math.random()*i),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},r.prototype.assign=function(){for(var t,e=!1,i=this.dataset.length,r=0;r<i;r++)t=this.argmin(this.dataset[r],this.centroids,this.distance),t!=this.assignments[r]&&(this.assignments[r]=t,e=!0);return e},r.prototype.getClusters=function(){for(var t,e=new Array(this.k),i=0;i<this.assignments.length;i++)t=this.assignments[i],"undefined"===typeof e[t]&&(e[t]=[]),e[t].push(i);return e},r.prototype.argmin=function(t,e,i){for(var r,n=Number.MAX_VALUE,o=0,a=e.length,s=0;s<a;s++)r=i(t,e[s]),r<n&&(n=r,o=s);return o},r.prototype.distance=function(t,e){var i=0,r=Math.min(t.length,e.length);while(r--){var n=t[r]-e[r];i+=n*n}return Math.sqrt(i)},t.exports&&(t.exports=r)},"83dc":function(t,e,i){!function(e,i){t.exports=i()}(0,(function(){"use strict";return function(t,e,i){e.prototype.isToday=function(){var t="YYYY-MM-DD",e=i();return this.format(t)===e.format(t)}}}))},"84b4":function(t,e,i){},8500:function(t,e,i){"use strict";i("e129")},8643:function(t,e,i){"use strict";i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return l}));i("5b81"),i("ac1f"),i("1276"),i("a15b"),i("d81d"),i("99af"),i("5319");var r=i("744c"),n=i.n(r),o=i("21a6");function a(t){if(t){var e=t.replaceAll("{","");e=e.replaceAll("}","");var i=e.split(",");Array.isArray(i)&&!i.length%2!==0||","==i[i.length-1]&&(console.log("Hit pop"),i.pop());for(var r=[],n=0;n<i.length;n+=2){var o=parseFloat(i[n]),a=parseFloat(i[n+1]);isNaN(o)||isNaN(a)||r.push({lat:o,lng:a})}return r}}function s(t){var e=n.a.create("kml",{version:"1.0",encoding:"UTF-8"});e.attribute("xmlns","http://www.opengis.net/kml/2.2");var i=e.ele("Document"),r=i.ele("Placemark"),o=r.ele("Polygon"),a=o.ele("outerBoundaryIs"),s=a.ele("LinearRing"),l=t.map((function(t){return"".concat(t.lng,",").concat(t.lat,",0")})).join(" ");return s.ele("coordinates",l),e.end({pretty:!0})}function l(t,e){var i=new Blob([e],{type:"application/vnd.google-earth.kml+xml"}),r=t.replace(" ","_").replace("-","_");Object(o["saveAs"])(i,"".concat(r,".kml"))}},"86e1":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var r={api:{gauge_chart:"/dashboard/analytics/gauge-chart/",bar_chart:"/dashboard/analytics/bar-chart/",map_chart:"/dashboard/analytics/map-chart/",line_chart:"/dashboard/analytics/line-chart/",activity_chart:"/dashboard/analytics/activity-chart/",trip_heatmap:"/dashboard/analytics/demand-heatmap/"}}},8930:function(t,e,i){(function(){var e,r;e=i("065e"),r=i("578f"),t.exports=class extends r{constructor(t,i){if(super(t),null==i)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=e.Comment,this.value=this.stringify.comment(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.comment(this,this.options.writer.filterOptions(t))}}}).call(this)},"8ba0":function(t,e,i){(function(){var e,r;e=i("9fa0"),r=i("1bf9"),t.exports=function(){class t{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new e,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(t){return this.params.hasOwnProperty(t)?this.params[t]:null}canSetParameter(t,e){return!0}setParameter(t,e){return null!=e?this.params[t]=e:delete this.params[t]}}return Object.defineProperty(t.prototype,"parameterNames",{get:function(){return new r(Object.keys(this.defaultParams))}}),t}.call(this)}).call(this)},"8d98":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA7AAAAOwBeShxvQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKXSURBVFiFtdfLi49RGAfwz2/GMEVymY1bblEsWKAm47IhIaVEjchlMyVZEDbMqNnwNygUWSjXsrOiRLkmt1zKGKthZgjlkrE4R734nff3+73Dt54673M7T89zzvOcl+JoxotIzYPwUwhj0I3tkboj779jNjpwDycz/JOR14FZ/2Pj8TiHXjzEK4zKyEehK8r6cBbjqnFcV4XOAtyPG0zBAxxBf0anP/IeYDLeRJt51QSRhxl4h00ZXlsM5gwWoiWuu6LsF7ZE2+lFNy/hJg6WkS3GVRyKdDXy/kQ7rkdfNWMtHqMhId+EL5E2JnQa8BRrigRwETsr6ByOlIddOF/r5iV8kF+/VULdu7AyR28G3quxDGPwLceoUbhu67EhrocldOvwHaNrCWCqcOfz5H2Z777ISyEpT/WBSukqYSDzPVDBJikfkmNUh2kJ2aQqeVlfZZEXwEjcSshKGJqxb8QFv2flT181B9Avf8Jdw+UYzC0sydFNnqe8ACphtdBu4URRJ4MJoISPcV3NUPvnARzAiriehX2D8PUXpknXrQmn0IM9kXoirylh0ytxo4qkrlM47a04Gqk18jprdVYkgAG8xRVhXnyI6x78KOCvLPJKMEVorUszvBbh2qaGV7IEKYwVhlEqQ9vwUmgww/EMWxO69dFX2WGU6t8lfMZMvE7onBUeoyUhI+sSepPxCCOU6ZT1CSNYhK+4k5BfEk79c+wXRm45tApt+3TOXmWxBbcVfM9F1OEuNhcxHiKkrq2SYg52CP8KeZnOxXyhvssK2C4Xbsag/w3WxCB2S7+Qs2jA3mhT6DVcDnOFf4Rnwn9CCyYIV2s0JgqHtl04lDcw519t/gslYQQfxxN8Eq7VQFw/xjHhtVz1wf0JSQSJX7G1hR0AAAAASUVORK5CYII="},"92e7":function(t,e,i){(function(){var e,r,n,o,a,s,l,u,c,h,p,d,f,m,g,y,v={}.hasOwnProperty,_=[].splice;({isObject:y,isFunction:g,isEmpty:m,getValue:f}=i("45f3")),u=null,n=null,o=null,a=null,s=null,p=null,d=null,h=null,l=null,r=null,c=null,e=null,t.exports=function(){class t{constructor(t){this.parent=t,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,u||(u=i("b8ee"),n=i("536e"),o=i("8930"),a=i("528d"),s=i("d7e3"),p=i("50d7"),d=i("9d2f"),h=i("f016"),l=i("0e1e"),r=i("065e"),c=i("04c6"),i("5c2a"),e=i("d1d4"))}setParent(t){var e,i,r,n,o;for(this.parent=t,t&&(this.options=t.options,this.stringify=t.stringify),n=this.children,o=[],i=0,r=n.length;i<r;i++)e=n[i],o.push(e.setParent(this));return o}element(t,e,i){var r,n,o,a,s,l,u,c,h;if(l=null,null===e&&null==i&&([e,i]=[{},null]),null==e&&(e={}),e=f(e),y(e)||([i,e]=[e,i]),null!=t&&(t=f(t)),Array.isArray(t))for(o=0,u=t.length;o<u;o++)n=t[o],l=this.element(n);else if(g(t))l=this.element(t.apply());else if(y(t)){for(s in t)if(v.call(t,s))if(h=t[s],g(h)&&(h=h.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===s.indexOf(this.stringify.convertAttKey))l=this.attribute(s.substr(this.stringify.convertAttKey.length),h);else if(!this.options.separateArrayItems&&Array.isArray(h)&&m(h))l=this.dummy();else if(y(h)&&m(h))l=this.element(s);else if(this.options.keepNullNodes||null!=h)if(!this.options.separateArrayItems&&Array.isArray(h))for(a=0,c=h.length;a<c;a++)n=h[a],r={},r[s]=n,l=this.element(r);else y(h)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===s.indexOf(this.stringify.convertTextKey)?l=this.element(h):(l=this.element(s),l.element(h)):l=this.element(s,h);else l=this.dummy()}else l=this.options.keepNullNodes||null!==i?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===t.indexOf(this.stringify.convertTextKey)?this.text(i):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===t.indexOf(this.stringify.convertCDataKey)?this.cdata(i):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===t.indexOf(this.stringify.convertCommentKey)?this.comment(i):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===t.indexOf(this.stringify.convertRawKey)?this.raw(i):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===t.indexOf(this.stringify.convertPIKey)?this.instruction(t.substr(this.stringify.convertPIKey.length),i):this.node(t,e,i):this.dummy();if(null==l)throw new Error("Could not create any elements with: "+t+". "+this.debugInfo());return l}insertBefore(t,e,i){var r,n,o,a,s;if(null!=t?t.type:void 0)return o=t,a=e,o.setParent(this),a?(n=children.indexOf(a),s=children.splice(n),children.push(o),Array.prototype.push.apply(children,s)):children.push(o),o;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return n=this.parent.children.indexOf(this),s=this.parent.children.splice(n),r=this.parent.element(t,e,i),Array.prototype.push.apply(this.parent.children,s),r}insertAfter(t,e,i){var r,n,o;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return n=this.parent.children.indexOf(this),o=this.parent.children.splice(n+1),r=this.parent.element(t,e,i),Array.prototype.push.apply(this.parent.children,o),r}remove(){var t;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return t=this.parent.children.indexOf(this),_.apply(this.parent.children,[t,t-t+1].concat([])),this.parent}node(t,e,i){var r;return null!=t&&(t=f(t)),e||(e={}),e=f(e),y(e)||([i,e]=[e,i]),r=new u(this,t,e),null!=i&&r.text(i),this.children.push(r),r}text(t){var e;return y(t)&&this.element(t),e=new d(this,t),this.children.push(e),this}cdata(t){var e;return e=new n(this,t),this.children.push(e),this}comment(t){var e;return e=new o(this,t),this.children.push(e),this}commentBefore(t){var e,i;return e=this.parent.children.indexOf(this),i=this.parent.children.splice(e),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,i),this}commentAfter(t){var e,i;return e=this.parent.children.indexOf(this),i=this.parent.children.splice(e+1),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,i),this}raw(t){var e;return e=new p(this,t),this.children.push(e),this}dummy(){var t;return t=new l(this),t}instruction(t,e){var i,r,n,o,a;if(null!=t&&(t=f(t)),null!=e&&(e=f(e)),Array.isArray(t))for(o=0,a=t.length;o<a;o++)i=t[o],this.instruction(i);else if(y(t))for(i in t)v.call(t,i)&&(r=t[i],this.instruction(i,r));else g(e)&&(e=e.apply()),n=new h(this,t,e),this.children.push(n);return this}instructionBefore(t,e){var i,r;return i=this.parent.children.indexOf(this),r=this.parent.children.splice(i),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,r),this}instructionAfter(t,e){var i,r;return i=this.parent.children.indexOf(this),r=this.parent.children.splice(i+1),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,r),this}declaration(t,e,i){var n,o;return n=this.document(),o=new a(n,t,e,i),0===n.children.length?n.children.unshift(o):n.children[0].type===r.Declaration?n.children[0]=o:n.children.unshift(o),n.root()||n}dtd(t,e){var i,n,o,a,l,u,c,h,p,d;for(n=this.document(),o=new s(n,t,e),p=n.children,a=l=0,c=p.length;l<c;a=++l)if(i=p[a],i.type===r.DocType)return n.children[a]=o,o;for(d=n.children,a=u=0,h=d.length;u<h;a=++u)if(i=d[a],i.isRoot)return n.children.splice(a,0,o),o;return n.children.push(o),o}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var t;t=this;while(t){if(t.type===r.Document)return t.rootObject;if(t.isRoot)return t;t=t.parent}}document(){var t;t=this;while(t){if(t.type===r.Document)return t;t=t.parent}}end(t){return this.document().end(t)}prev(){var t;if(t=this.parent.children.indexOf(this),t<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[t-1]}next(){var t;if(t=this.parent.children.indexOf(this),-1===t||t===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[t+1]}importDocument(t){var e,i,n,o,a;if(i=t.root().clone(),i.parent=this,i.isRoot=!1,this.children.push(i),this.type===r.Document&&(i.isRoot=!0,i.documentObject=this,this.rootObject=i,this.children))for(a=this.children,n=0,o=a.length;n<o;n++)if(e=a[n],e.type===r.DocType){e.name=i.name;break}return this}debugInfo(t){var e,i;return t=t||this.name,null!=t||(null!=(e=this.parent)?e.name:void 0)?null==t?"parent: <"+this.parent.name+">":(null!=(i=this.parent)?i.name:void 0)?"node: <"+t+">, parent: <"+this.parent.name+">":"node: <"+t+">":""}ele(t,e,i){return this.element(t,e,i)}nod(t,e,i){return this.node(t,e,i)}txt(t){return this.text(t)}dat(t){return this.cdata(t)}com(t){return this.comment(t)}ins(t,e){return this.instruction(t,e)}doc(){return this.document()}dec(t,e,i){return this.declaration(t,e,i)}e(t,e,i){return this.element(t,e,i)}n(t,e,i){return this.node(t,e,i)}t(t){return this.text(t)}d(t){return this.cdata(t)}c(t){return this.comment(t)}r(t){return this.raw(t)}i(t,e){return this.instruction(t,e)}u(){return this.up()}importXMLBuilder(t){return this.importDocument(t)}attribute(t,e){throw new Error("attribute() applies to element nodes only.")}att(t,e){return this.attribute(t,e)}a(t,e){return this.attribute(t,e)}removeAttribute(t){throw new Error("attribute() applies to element nodes only.")}replaceChild(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(t,e){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(t){var i,r;return i=this,i===t?0:this.document()!==t.document()?(r=e.Disconnected|e.ImplementationSpecific,Math.random()<.5?r|=e.Preceding:r|=e.Following,r):i.isAncestor(t)?e.Contains|e.Preceding:i.isDescendant(t)?e.Contains|e.Following:i.isPreceding(t)?e.Preceding:e.Following}isSameNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(t){var e,i,r;if(t.nodeType!==this.nodeType)return!1;if(t.children.length!==this.children.length)return!1;for(e=i=0,r=this.children.length-1;0<=r?i<=r:i>=r;e=0<=r?++i:--i)if(!this.children[e].isEqualNode(t.children[e]))return!1;return!0}getFeature(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(t){return!!t&&(t===this||this.isDescendant(t))}isDescendant(t){var e,i,r,n,o;for(o=this.children,r=0,n=o.length;r<n;r++){if(e=o[r],t===e)return!0;if(i=e.isDescendant(t),i)return!0}return!1}isAncestor(t){return t.isDescendant(this)}isPreceding(t){var e,i;return e=this.treePosition(t),i=this.treePosition(this),-1!==e&&-1!==i&&e<i}isFollowing(t){var e,i;return e=this.treePosition(t),i=this.treePosition(this),-1!==e&&-1!==i&&e>i}treePosition(t){var e,i;return i=0,e=!1,this.foreachTreeNode(this.document(),(function(r){if(i++,!e&&r===t)return e=!0})),e?i:-1}foreachTreeNode(t,e){var i,r,n,o,a;for(t||(t=this.document()),o=t.children,r=0,n=o.length;r<n;r++){if(i=o[r],a=e(i))return a;if(a=this.foreachTreeNode(i,e),a)return a}}}return Object.defineProperty(t.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.childNodeList&&this.childNodeList.nodes||(this.childNodeList=new c(this.children)),this.childNodeList}}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t-1]||null}}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t+1]||null}}),Object.defineProperty(t.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(t.prototype,"textContent",{get:function(){var t,e,i,n,o;if(this.nodeType===r.Element||this.nodeType===r.DocumentFragment){for(o="",n=this.children,e=0,i=n.length;e<i;e++)t=n[e],t.textContent&&(o+=t.textContent);return o}return null},set:function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),t}.call(this)}).call(this)},"9d2f":function(t,e,i){(function(){var e,r;e=i("065e"),r=i("578f"),t.exports=function(){class t extends r{constructor(t,i){if(super(t),null==i)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=e.Text,this.value=this.stringify.text(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.text(this,this.options.writer.filterOptions(t))}splitText(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(t.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"wholeText",{get:function(){var t,e,i;i="",e=this.previousSibling;while(e)i=e.data+i,e=e.previousSibling;i+=this.data,t=this.nextSibling;while(t)i+=t.data,t=t.nextSibling;return i}}),t}.call(this)}).call(this)},"9f6a":function(t,e,i){"use strict";t.exports=function t(e,i){if(e===i)return!0;if(e&&i&&"object"==typeof e&&"object"==typeof i){if(e.constructor!==i.constructor)return!1;var r,n,o;if(Array.isArray(e)){if(r=e.length,r!=i.length)return!1;for(n=r;0!==n--;)if(!t(e[n],i[n]))return!1;return!0}if(e instanceof Map&&i instanceof Map){if(e.size!==i.size)return!1;for(n of e.entries())if(!i.has(n[0]))return!1;for(n of e.entries())if(!t(n[1],i.get(n[0])))return!1;return!0}if(e instanceof Set&&i instanceof Set){if(e.size!==i.size)return!1;for(n of e.entries())if(!i.has(n[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(i)){if(r=e.length,r!=i.length)return!1;for(n=r;0!==n--;)if(e[n]!==i[n])return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(o=Object.keys(e),r=o.length,r!==Object.keys(i).length)return!1;for(n=r;0!==n--;)if(!Object.prototype.hasOwnProperty.call(i,o[n]))return!1;for(n=r;0!==n--;){var a=o[n];if(!t(e[a],i[a]))return!1}return!0}return e!==e&&i!==i}},"9fa0":function(t,e){(function(){t.exports=class{constructor(){}handleError(t){throw new Error(t)}}}).call(this)},a12f:function(t,e,i){"use strict";var r=i("0413"),n=i("52c2"),o=r.eudist,a=(r.mandist,r.dist,n.kmrand),s=n.kmpp,l=1e4;function u(t,e,i){i=i||[];for(var r=0;r<t;r++)i[r]=e;return i}function c(t,e,i,r){var n=[],c=[],h=[],p=[],d=!1,f=r||l,m=t.length,g=t[0].length,y=g>0,v=[];if(i)n="kmrand"==i?a(t,e):"kmpp"==i?s(t,e):i;else{var _={};while(n.length<e){var b=Math.floor(Math.random()*m);_[b]||(_[b]=!0,n.push(t[b]))}}do{u(e,0,v);for(var x=0;x<m;x++){for(var w=1/0,T=0,E=0;E<e;E++){p=y?o(t[x],n[E]):Math.abs(t[x]-n[E]);p<=w&&(w=p,T=E)}h[x]=T,v[T]++}for(var S=[],A=(c=[],0);A<e;A++)S[A]=y?u(g,0,S[A]):0,c[A]=n[A];if(y){for(var C=0;C<e;C++)n[C]=[];for(var P=0;P<m;P++)for(var I=h[P],M=S[I],k=t[P],D=0;D<g;D++)M[D]+=k[D];d=!0;for(var L=0;L<e;L++){for(var O=n[L],R=S[L],z=c[L],F=v[L],B=0;B<g;B++)O[B]=R[B]/F||0;if(d)for(var N=0;N<g;N++)if(z[N]!=O[N]){d=!1;break}}}else{for(var j=0;j<m;j++){var U=h[j];S[U]+=t[j]}for(var V=0;V<e;V++)n[V]=S[V]/v[V]||0;d=!0;for(var G=0;G<e;G++)if(c[G]!=n[G]){d=!1;break}}d=d||--f<=0}while(!d);return{it:l-f,k:e,idxs:h,centroids:n}}t.exports=c},a2bf:function(t,e,i){"use strict";var r=i("e8b5"),n=i("50c4"),o=i("0366"),a=function(t,e,i,s,l,u,c,h){var p,d=l,f=0,m=!!c&&o(c,h,3);while(f<s){if(f in i){if(p=m?m(i[f],f,e):i[f],u>0&&r(p))d=a(t,e,p,n(p.length),d,u-1)-1;else{if(d>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[d]=p}d++}f++}return d};t.exports=a},a4b6:function(t,e,i){(function(){var e,r,n,o={}.hasOwnProperty;({assign:n}=i("45f3")),e=i("065e"),i("528d"),i("d7e3"),i("536e"),i("8930"),i("b8ee"),i("50d7"),i("9d2f"),i("f016"),i("0e1e"),i("188f"),i("3b32"),i("1585"),i("b6e1"),r=i("0985"),t.exports=class{constructor(t){var e,i,r;for(e in t||(t={}),this.options=t,i=t.writer||{},i)o.call(i,e)&&(r=i[e],this["_"+e]=this[e],this[e]=r)}filterOptions(t){var e,i,o,a,s,l,u,c,h;return t||(t={}),t=n({},this.options,t),e={writer:this},e.pretty=t.pretty||!1,e.allowEmpty=t.allowEmpty||!1,e.indent=null!=(i=t.indent)?i:"  ",e.newline=null!=(o=t.newline)?o:"\n",e.offset=null!=(a=t.offset)?a:0,e.width=null!=(s=t.width)?s:0,e.dontPrettyTextNodes=null!=(l=null!=(u=t.dontPrettyTextNodes)?u:t.dontprettytextnodes)?l:0,e.spaceBeforeSlash=null!=(c=null!=(h=t.spaceBeforeSlash)?h:t.spacebeforeslash)?c:"",!0===e.spaceBeforeSlash&&(e.spaceBeforeSlash=" "),e.suppressPrettyCount=0,e.user={},e.state=r.None,e}indent(t,e,i){var r;return!e.pretty||e.suppressPrettyCount?"":e.pretty&&(r=(i||0)+e.offset+1,r>0)?new Array(r).join(e.indent):""}endline(t,e,i){return!e.pretty||e.suppressPrettyCount?"":e.newline}attribute(t,e,i){var r;return this.openAttribute(t,e,i),r=e.pretty&&e.width>0?t.name+'="'+t.value+'"':" "+t.name+'="'+t.value+'"',this.closeAttribute(t,e,i),r}cdata(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<![CDATA[",e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+="]]>"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}comment(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"\x3c!-- ",e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+=" --\x3e"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}declaration(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<?xml",e.state=r.InsideTag,n+=' version="'+t.version+'"',null!=t.encoding&&(n+=' encoding="'+t.encoding+'"'),null!=t.standalone&&(n+=' standalone="'+t.standalone+'"'),e.state=r.CloseTag,n+=e.spaceBeforeSlash+"?>",n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}docType(t,e,i){var n,o,a,s,l;if(i||(i=0),this.openNode(t,e,i),e.state=r.OpenTag,s=this.indent(t,e,i),s+="<!DOCTYPE "+t.root().name,t.pubID&&t.sysID?s+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(s+=' SYSTEM "'+t.sysID+'"'),t.children.length>0){for(s+=" [",s+=this.endline(t,e,i),e.state=r.InsideTag,l=t.children,o=0,a=l.length;o<a;o++)n=l[o],s+=this.writeChildNode(n,e,i+1);e.state=r.CloseTag,s+="]"}return e.state=r.CloseTag,s+=e.spaceBeforeSlash+">",s+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),s}element(t,i,n){var a,s,l,u,c,h,p,d,f,m,g,y,v,_,b,x,w,T,E;if(n||(n=0),y=!1,this.openNode(t,i,n),i.state=r.OpenTag,v=this.indent(t,i,n)+"<"+t.name,i.pretty&&i.width>0)for(g in d=v.length,b=t.attribs,b)o.call(b,g)&&(a=b[g],_=this.attribute(a,i,n),s=_.length,d+s>i.width?(E=this.indent(t,i,n+1)+_,v+=this.endline(t,i,n)+E,d=E.length):(E=" "+_,v+=E,d+=E.length));else for(g in x=t.attribs,x)o.call(x,g)&&(a=x[g],v+=this.attribute(a,i,n));if(u=t.children.length,c=0===u?null:t.children[0],0===u||t.children.every((function(t){return(t.type===e.Text||t.type===e.Raw||t.type===e.CData)&&""===t.value})))i.allowEmpty?(v+=">",i.state=r.CloseTag,v+="</"+t.name+">"+this.endline(t,i,n)):(i.state=r.CloseTag,v+=i.spaceBeforeSlash+"/>"+this.endline(t,i,n));else if(!i.pretty||1!==u||c.type!==e.Text&&c.type!==e.Raw&&c.type!==e.CData||null==c.value){if(i.dontPrettyTextNodes)for(w=t.children,h=0,f=w.length;h<f;h++)if(l=w[h],(l.type===e.Text||l.type===e.Raw||l.type===e.CData)&&null!=l.value){i.suppressPrettyCount++,y=!0;break}for(v+=">"+this.endline(t,i,n),i.state=r.InsideTag,T=t.children,p=0,m=T.length;p<m;p++)l=T[p],v+=this.writeChildNode(l,i,n+1);i.state=r.CloseTag,v+=this.indent(t,i,n)+"</"+t.name+">",y&&i.suppressPrettyCount--,v+=this.endline(t,i,n),i.state=r.None}else v+=">",i.state=r.InsideTag,i.suppressPrettyCount++,y=!0,v+=this.writeChildNode(c,i,n+1),i.suppressPrettyCount--,y=!1,i.state=r.CloseTag,v+="</"+t.name+">"+this.endline(t,i,n);return this.closeNode(t,i,n),v}writeChildNode(t,i,r){switch(t.type){case e.CData:return this.cdata(t,i,r);case e.Comment:return this.comment(t,i,r);case e.Element:return this.element(t,i,r);case e.Raw:return this.raw(t,i,r);case e.Text:return this.text(t,i,r);case e.ProcessingInstruction:return this.processingInstruction(t,i,r);case e.Dummy:return"";case e.Declaration:return this.declaration(t,i,r);case e.DocType:return this.docType(t,i,r);case e.AttributeDeclaration:return this.dtdAttList(t,i,r);case e.ElementDeclaration:return this.dtdElement(t,i,r);case e.EntityDeclaration:return this.dtdEntity(t,i,r);case e.NotationDeclaration:return this.dtdNotation(t,i,r);default:throw new Error("Unknown XML node type: "+t.constructor.name)}}processingInstruction(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<?",e.state=r.InsideTag,n+=t.target,t.value&&(n+=" "+t.value),e.state=r.CloseTag,n+=e.spaceBeforeSlash+"?>",n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}raw(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i),e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}text(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i),e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}dtdAttList(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!ATTLIST",e.state=r.InsideTag,n+=" "+t.elementName+" "+t.attributeName+" "+t.attributeType,"#DEFAULT"!==t.defaultValueType&&(n+=" "+t.defaultValueType),t.defaultValue&&(n+=' "'+t.defaultValue+'"'),e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}dtdElement(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!ELEMENT",e.state=r.InsideTag,n+=" "+t.name+" "+t.value,e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}dtdEntity(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!ENTITY",e.state=r.InsideTag,t.pe&&(n+=" %"),n+=" "+t.name,t.value?n+=' "'+t.value+'"':(t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),t.nData&&(n+=" NDATA "+t.nData)),e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}dtdNotation(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!NOTATION",e.state=r.InsideTag,n+=" "+t.name,t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.pubID?n+=' PUBLIC "'+t.pubID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n}openNode(t,e,i){}closeNode(t,e,i){}openAttribute(t,e,i){}closeAttribute(t,e,i){}}}).call(this)},a6d5:function(t,e,i){function r(t,e,i,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,i,r)}r.prototype.run=function(t,e,i,r){this._init(t,e,i,r);for(var n=0;n<this._datasetLength;n++)if(1!==this._visited[n]){this._visited[n]=1;var o=this._regionQuery(n);if(o.length<this.minPts)this.noise.push(n);else{var a=this.clusters.length;this.clusters.push([]),this._addToCluster(n,a),this._expandCluster(a,o)}}return this.clusters},r.prototype._init=function(t,e,i,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),i&&(this.minPts=i),r&&(this.distance=r)},r.prototype._expandCluster=function(t,e){for(var i=0;i<e.length;i++){var r=e[i];if(1!==this._visited[r]){this._visited[r]=1;var n=this._regionQuery(r);n.length>=this.minPts&&(e=this._mergeArrays(e,n))}1!==this._assigned[r]&&this._addToCluster(r,t)}},r.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},r.prototype._regionQuery=function(t){for(var e=[],i=0;i<this._datasetLength;i++){var r=this.distance(this.dataset[t],this.dataset[i]);r<this.epsilon&&e.push(i)}return e},r.prototype._mergeArrays=function(t,e){for(var i=e.length,r=0;r<i;r++){var n=e[r];t.indexOf(n)<0&&t.push(n)}return t},r.prototype._euclideanDistance=function(t,e){var i=0,r=Math.min(t.length,e.length);while(r--)i+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(i)},t.exports&&(t.exports=r)},a904:function(t,e,i){"use strict";i("cf62")},aafd:function(t,e,i){},ac62:function(t,e,i){function r(t,e,i){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,i)}r.prototype.insert=function(t,e){var i=this._queue.length,r=i;while(r--){var n=this._priorities[r];"desc"===this._sorting?e>n&&(i=r):e<n&&(i=r)}this._insertAt(t,e,i)},r.prototype.remove=function(t){var e=this._queue.length;while(e--){var i=this._queue[e];if(t===i){this._queue.splice(e,1),this._priorities.splice(e,1);break}}},r.prototype.forEach=function(t){this._queue.forEach(t)},r.prototype.getElements=function(){return this._queue},r.prototype.getElementPriority=function(t){return this._priorities[t]},r.prototype.getPriorities=function(){return this._priorities},r.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,i=this._queue.length;e<i;e++)t.push([this._queue[e],this._priorities[e]]);return t},r.prototype._init=function(t,e,i){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var r=0;r<t.length;r++)this.insert(t[r],e[r])}i&&(this._sorting=i)},r.prototype._insertAt=function(t,e,i){this._queue.length===i?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(i,0,t),this._priorities.splice(i,0,e))},t.exports&&(t.exports=r)},ac6d:function(t,e,i){},ae0a:function(t,e,i){(function(){var e,r,n,o,a,s,l;({isPlainObject:l}=i("45f3")),n=i("0a6d"),r=i("8ba0"),o=i("92e7"),e=i("065e"),s=i("5a61"),a=i("1f08"),t.exports=function(){class t extends o{constructor(t){super(null),this.name="#document",this.type=e.Document,this.documentURI=null,this.domConfig=new r,t||(t={}),t.writer||(t.writer=new a),this.options=t,this.stringify=new s(t)}end(t){var e;return e={},t?l(t)&&(e=t,t=this.options.writer):t=this.options.writer,t.document(this,t.filterOptions(e))}toString(t){return this.options.writer.document(this,this.options.writer.filterOptions(t))}createElement(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(t.prototype,"implementation",{value:new n}),Object.defineProperty(t.prototype,"doctype",{get:function(){var t,i,r,n;for(n=this.children,i=0,r=n.length;i<r;i++)if(t=n[i],t.type===e.DocType)return t;return null}}),Object.defineProperty(t.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(t.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(t.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(t.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===e.Declaration?this.children[0].encoding:null}}),Object.defineProperty(t.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===e.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(t.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===e.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(t.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(t.prototype,"origin",{get:function(){return null}}),Object.defineProperty(t.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(t.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(t.prototype,"contentType",{get:function(){return null}}),t}.call(this)}).call(this)},b4c6:function(t,e,i){},b6e1:function(t,e,i){(function(){var e,r;r=i("92e7"),e=i("065e"),t.exports=function(){class t extends r{constructor(t,i,r){if(super(t),null==i)throw new Error("Missing DTD notation name. "+this.debugInfo(i));if(!r.pubID&&!r.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(i));this.name=this.stringify.name(i),this.type=e.NotationDeclaration,null!=r.pubID&&(this.pubID=this.stringify.dtdPubID(r.pubID)),null!=r.sysID&&(this.sysID=this.stringify.dtdSysID(r.sysID))}toString(t){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(t))}}return Object.defineProperty(t.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this.sysID}}),t}.call(this)}).call(this)},b6f0:function(t,e,i){},b8ee:function(t,e,i){(function(){var e,r,n,o,a,s,l,u={}.hasOwnProperty;({isObject:l,isFunction:s,getValue:a}=i("45f3")),o=i("92e7"),e=i("065e"),r=i("2280"),n=i("5c2a"),t.exports=function(){class t extends o{constructor(t,i,r){var n,o,a,s;if(super(t),null==i)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(i),this.type=e.Element,this.attribs={},this.schemaTypeInfo=null,null!=r&&this.attribute(r),t.type===e.Document&&(this.isRoot=!0,this.documentObject=t,t.rootObject=this,t.children))for(s=t.children,o=0,a=s.length;o<a;o++)if(n=s[o],n.type===e.DocType){n.name=this.name;break}}clone(){var t,e,i,r;for(e in i=Object.create(this),i.isRoot&&(i.documentObject=null),i.attribs={},r=this.attribs,r)u.call(r,e)&&(t=r[e],i.attribs[e]=t.clone());return i.children=[],this.children.forEach((function(t){var e;return e=t.clone(),e.parent=i,i.children.push(e)})),i}attribute(t,e){var i,n;if(null!=t&&(t=a(t)),l(t))for(i in t)u.call(t,i)&&(n=t[i],this.attribute(i,n));else s(e)&&(e=e.apply()),this.options.keepNullAttributes&&null==e?this.attribs[t]=new r(this,t,""):null!=e&&(this.attribs[t]=new r(this,t,e));return this}removeAttribute(t){var e,i,r;if(null==t)throw new Error("Missing attribute name. "+this.debugInfo());if(t=a(t),Array.isArray(t))for(i=0,r=t.length;i<r;i++)e=t[i],delete this.attribs[e];else delete this.attribs[t];return this}toString(t){return this.options.writer.element(this,this.options.writer.filterOptions(t))}att(t,e){return this.attribute(t,e)}a(t,e){return this.attribute(t,e)}getAttribute(t){return this.attribs.hasOwnProperty(t)?this.attribs[t].value:null}setAttribute(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(t){return this.attribs.hasOwnProperty(t)?this.attribs[t]:null}setAttributeNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(t){return this.attribs.hasOwnProperty(t)}hasAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(t,e){return this.attribs.hasOwnProperty(t)?this.attribs[t].isId:e}setIdAttributeNS(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(t){var e,i,r;if(!super.isEqualNode(t))return!1;if(t.namespaceURI!==this.namespaceURI)return!1;if(t.prefix!==this.prefix)return!1;if(t.localName!==this.localName)return!1;if(t.attribs.length!==this.attribs.length)return!1;for(e=i=0,r=this.attribs.length-1;0<=r?i<=r:i>=r;e=0<=r?++i:--i)if(!this.attribs[e].isEqualNode(t.attribs[e]))return!1;return!0}}return Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(t.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(t.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"attributes",{get:function(){return this.attributeMap&&this.attributeMap.nodes||(this.attributeMap=new n(this.attribs)),this.attributeMap}}),t}.call(this)}).call(this)},bb23:function(t,e,i){t.exports&&(t.exports={DBSCAN:i("a6d5"),KMEANS:i("7f8d"),OPTICS:i("de4e"),PriorityQueue:i("ac62")})},bc84:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("transition",{attrs:{name:"fade"}},[t.visibility?i("button",{staticClass:"fixed inset-0 w-full h-full opacity-50 cursor-default bg-oBlack",staticStyle:{"z-index":"1050"},attrs:{tabindex:"-1"},on:{click:function(e){return t.close(!1)}}}):t._e()]),i("transition",{attrs:{name:"SOR","enter-active-class":"transition duration-300 ease-out transform","leave-active-class":"transition duration-300 ease-in transform","enter-class":"translate-x-full","enter-to-class":"translate-x-0","leave-class":"translate-x-0","leave-to-class":"translate-x-full"}},[t.visibility?i("div",{staticClass:"fixed bottom-0 right-0 h-full px-4 bg-white border-l-2 border-gray-400 border-opacity-50 shadow-lg container-sor",class:t.getEdgeStackSize},[t.busy?i("section",{staticClass:"py-4"},t._l(3,(function(t){return i("TheSuspense",{key:"es-skeletons-"+t,attrs:{rounded:""}},[i("SuspenseHeading",{attrs:{img:""}}),i("SuspenseText",{attrs:{lines:5}})],1)})),1):[i("header",{class:t.computeHeaderClassName},[t._t("header")],2),i("div",{staticClass:"pb-4 overflow-x-hidden overflow-y-auto sb-farhan"},[t._t("default")],2),t.hasFooterSlot?i("div",{staticClass:"w-full"},[i("footer",{class:t.footerClass.fixed+" "+t.footerClass.append+" "+(t.exitButton.hidden?"":"justify-between")+" "},[!1===t.exitButton.hidden?i("div",[i("anchor-button",{class:"",attrs:{variant:t.getCloseButtonVariant,isLoading:!1},on:{click:function(e){return t.close(!t.confirmFirst)}}},[t._v(" "+t._s(t.$t("components.stepNavigation.cancel"))+" ")])],1):t._e(),i("div",{staticClass:"flex items-center text-sm"},[t._t("footer",(function(){return[t._v(" Footer Slot ")]}),null,{close:t.close,confirmFirst:t.confirmFirst,exitButton:t.exitButton})],2)])]):t._e()]],2):t._e()]),t.confirmFirstVisibility?i("div",{staticClass:"fixed inset-0 w-full h-full transition-all duration-100 ease-in-out bg-gray-900 bg-opacity-50",staticStyle:{"z-index":"1105"}},[i("section",{staticClass:"relative max-w-lg mx-auto my-0 mt-20 overflow-y-auto transition-all duration-300 ease-in-out",staticStyle:{"z-index":"1110"}},[i("div",{staticClass:"relative overflow-hidden bg-white border border-gray-600 rounded-md shadow-lg"},[t._m(0),i("section",{staticClass:"px-4 text-2xl font-extrabold text-center"},[t._v(" "+t._s(t.confirmQuestion)+" ")]),i("section",{staticClass:"px-4 font-bold text-center"},[t._v(" "+t._s(t.$t("components.edgeStack.changeCaution"))+" ")]),i("section",{staticClass:"flex items-center px-4 py-4 mt-6 space-x-5 bg-gray-100"},[i("anchor-button",{class:"w-1/2",attrs:{variant:"warning-alt",isLoading:!1},on:{click:function(e){return t.close(!0)}}},[t._v(" "+t._s(t.$t("components.edgeStack.exit"))+" ")]),i("anchor-button",{class:"w-1/2",attrs:{variant:"primary",isLoading:!1},on:{click:t.closeConfirmFirst}},[t._v(" "+t._s(t.$t("components.edgeStack.cancel"))+" ")])],1)])])]):t._e()],1)},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"flex items-center justify-center mt-8 mb-2 text-gray-500"},[i("i",{staticClass:"text-4xl fas fa-exclamation-circle"})])}],o=(i("d3b7"),i("3ca3"),i("ddb0"),i("a6f4")),a=i("e068"),s=Object(o["c"])({components:{AnchorButton:function(){return i.e("chunk-389dd0fb").then(i.bind(null,"15e7"))}},name:"EdgeStack",props:{id:{type:String,required:!0},confirm:{type:Boolean,required:!1,default:!1},confirmQuestion:{type:String,required:!1,default:"Are you sure you want to exit?"},fullWidth:{type:Boolean,required:!1,default:!1},sizeClass:{type:String,required:!1,default:""},headerClassName:{type:String,required:!1,default:"mt-16 px-4 mb-6"},value:{type:Boolean,required:!1,default:!1},busy:{type:Boolean,default:!1},exitButton:{type:Object,default:function(){return{text:"Cancel",hidden:!1}}},footerClass:{type:Object,default:function(){return{fixed:"flex items-center px-6 pt-2 pb-5 w-full h-auto",append:""}}},debug:{type:Boolean,required:!1,default:!1}},setup:function(t,e){var i=e.slots,r=e.scopedSlots;t.debug&&console.log("edgeStack",i,r);var n=Object(o["a"])((function(){var e,n,o=null!==(e=null!==(n=null===i||void 0===i?void 0:i.footer)&&void 0!==n?n:null===r||void 0===r?void 0:r.footer())&&void 0!==e&&e;return t.debug&&console.log("hasFooterSlot, slots, scopedSlots:",!!o,i,r),!!o})),s=new a["a"],l=Object(o["h"])(t.value);Object(o["j"])(l,(function(t){!0===t?(document.body.style.overflow="hidden",document.body.style.marginRight="11px"):setTimeout((function(){document.body.style.overflow="auto",document.body.style.marginRight=""}),200)}));var u=Object(o["h"])(!1),c=Object(o["h"])(!1),h=Object(o["a"])((function(){return!0===u.value?"warning-alt":"secondary"})),p=Object(o["a"])((function(){return t.sizeClass?t.sizeClass:t.fullWidth?"w-full":"w-full md:w-3/6 2xl:w-2/5"})),d=function(){a["b"].emit(s.getEventName("opening",t.id)),setTimeout((function(){l.value=!0}),250),setTimeout((function(){a["b"].emit(s.getEventName("opened",t.id))}),350)},f=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.debug&&console.log({onClose_ConfirmFirst:u.value,onClose_Confirmed:e}),!0!==u.value||!1!==e?(c.value=!1,u.value=!1,a["b"].emit(s.getEventName("closing",t.id)),setTimeout((function(){l.value=!1}),250),setTimeout((function(){a["b"].emit(s.getEventName("closed",t.id))}),350)):c.value=!0},m=function(){var t=l.value;!0===t?f():d(),a["b"].emit(s.getEventName("toggled",{from:t,to:l.value}))},g=function(){c.value=!1},y=function(){a["b"].on(s.getEventName("open",t.id),(function(){d()})),a["b"].on(s.getEventName("close",t.id),(function(){f()})),a["b"].on(s.getEventName("toggle",t.id),(function(){m()})),a["b"].on(s.getEventName("confirmFirst",t.id),(function(t){u.value=t.confirmFirst})),t.debug&&console.log({EdgeStackComponents:{id:t.id,events:a["b"].all}})},v=function(){a["b"].off(s.getEventName("open",t.id),(function(){d()})),a["b"].off(s.getEventName("close",t.id),(function(){f()})),a["b"].off(s.getEventName("toggle",t.id),(function(){m()})),a["b"].off(s.getEventName("confirmFirst",t.id)),t.debug&&console.log({EdgeStackComponents:{id:t.id,events:a["b"].all}})};return Object(o["e"])(y),Object(o["f"])(v),{open:d,close:f,toggle:m,visibility:l,confirmFirst:u,confirmFirstVisibility:c,getEdgeStackSize:p,closeConfirmFirst:g,getCloseButtonVariant:h,computeHeaderClassName:Object(o["a"])((function(){return i.header?t.headerClassName:""})),hasFooterSlot:n}}}),l=s,u=(i("7cd2"),i("2877")),c=Object(u["a"])(l,r,n,!1,null,"1ef8d6ba",null);e["a"]=c.exports},bdda:function(t,e,i){"use strict";(function(t){function r(e){if("undefined"!==typeof window&&"object"===typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!==typeof t&&"object"===typeof t.versions&&Boolean(t.versions["electron"]))return!0;const i="object"===typeof navigator&&"string"===typeof navigator.userAgent&&navigator.userAgent,r=e||i;return!!(r&&r.indexOf("Electron")>=0)}i.d(e,"a",(function(){return r}))}).call(this,i("4362"))},c20d:function(t,e,i){var r=i("da84"),n=i("577e"),o=i("58a8").trim,a=i("5899"),s=r.parseInt,l=/^[+-]?0[Xx]/,u=8!==s(a+"08")||22!==s(a+"0x16");t.exports=u?function(t,e){var i=o(n(t));return s(i,e>>>0||(l.test(i)?16:10))}:s},c376:function(t,e,i){(function(){var e,r,n,o={}.hasOwnProperty;e=i("065e"),n=i("a4b6"),r=i("0985"),t.exports=class extends n{constructor(t,e){super(e),this.stream=t}endline(t,e,i){return t.isLastRootNode&&e.state===r.CloseTag?"":super.endline(t,e,i)}document(t,e){var i,r,n,o,a,s,l,u,c;for(l=t.children,r=n=0,a=l.length;n<a;r=++n)i=l[r],i.isLastRootNode=r===t.children.length-1;for(e=this.filterOptions(e),u=t.children,c=[],o=0,s=u.length;o<s;o++)i=u[o],c.push(this.writeChildNode(i,e,0));return c}cdata(t,e,i){return this.stream.write(super.cdata(t,e,i))}comment(t,e,i){return this.stream.write(super.comment(t,e,i))}declaration(t,e,i){return this.stream.write(super.declaration(t,e,i))}docType(t,e,i){var n,o,a,s;if(i||(i=0),this.openNode(t,e,i),e.state=r.OpenTag,this.stream.write(this.indent(t,e,i)),this.stream.write("<!DOCTYPE "+t.root().name),t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),t.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(t,e,i)),e.state=r.InsideTag,s=t.children,o=0,a=s.length;o<a;o++)n=s[o],this.writeChildNode(n,e,i+1);e.state=r.CloseTag,this.stream.write("]")}return e.state=r.CloseTag,this.stream.write(e.spaceBeforeSlash+">"),this.stream.write(this.endline(t,e,i)),e.state=r.None,this.closeNode(t,e,i)}element(t,i,n){var a,s,l,u,c,h,p,d,f,m,g,y,v,_,b;if(n||(n=0),this.openNode(t,i,n),i.state=r.OpenTag,m=this.indent(t,i,n)+"<"+t.name,i.pretty&&i.width>0)for(f in p=m.length,y=t.attribs,y)o.call(y,f)&&(a=y[f],g=this.attribute(a,i,n),s=g.length,p+s>i.width?(b=this.indent(t,i,n+1)+g,m+=this.endline(t,i,n)+b,p=b.length):(b=" "+g,m+=b,p+=b.length));else for(f in v=t.attribs,v)o.call(v,f)&&(a=v[f],m+=this.attribute(a,i,n));if(this.stream.write(m),u=t.children.length,c=0===u?null:t.children[0],0===u||t.children.every((function(t){return(t.type===e.Text||t.type===e.Raw||t.type===e.CData)&&""===t.value})))i.allowEmpty?(this.stream.write(">"),i.state=r.CloseTag,this.stream.write("</"+t.name+">")):(i.state=r.CloseTag,this.stream.write(i.spaceBeforeSlash+"/>"));else if(!i.pretty||1!==u||c.type!==e.Text&&c.type!==e.Raw&&c.type!==e.CData||null==c.value){for(this.stream.write(">"+this.endline(t,i,n)),i.state=r.InsideTag,_=t.children,h=0,d=_.length;h<d;h++)l=_[h],this.writeChildNode(l,i,n+1);i.state=r.CloseTag,this.stream.write(this.indent(t,i,n)+"</"+t.name+">")}else this.stream.write(">"),i.state=r.InsideTag,i.suppressPrettyCount++,!0,this.writeChildNode(c,i,n+1),i.suppressPrettyCount--,!1,i.state=r.CloseTag,this.stream.write("</"+t.name+">");return this.stream.write(this.endline(t,i,n)),i.state=r.None,this.closeNode(t,i,n)}processingInstruction(t,e,i){return this.stream.write(super.processingInstruction(t,e,i))}raw(t,e,i){return this.stream.write(super.raw(t,e,i))}text(t,e,i){return this.stream.write(super.text(t,e,i))}dtdAttList(t,e,i){return this.stream.write(super.dtdAttList(t,e,i))}dtdElement(t,e,i){return this.stream.write(super.dtdElement(t,e,i))}dtdEntity(t,e,i){return this.stream.write(super.dtdEntity(t,e,i))}dtdNotation(t,e,i){return this.stream.write(super.dtdNotation(t,e,i))}}}).call(this)},c4a1:function(t,e,i){!function(e,i){t.exports=i()}(0,(function(){"use strict";return function(t,e,i){e.prototype.isYesterday=function(){var t="YYYY-MM-DD",e=i().subtract(1,"day");return this.format(t)===e.format(t)}}}))},c526:function(t,e,i){t.exports=i("05c0")},c8b5:function(t,e,i){var r;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(n,o,a,s){"use strict";var l,u=["","webkit","Moz","MS","ms","o"],c=o.createElement("div"),h="function",p=Math.round,d=Math.abs,f=Date.now;function m(t,e,i){return setTimeout(w(t,i),e)}function g(t,e,i){return!!Array.isArray(t)&&(y(t,i[e],i),!0)}function y(t,e,i){var r;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s){r=0;while(r<t.length)e.call(i,t[r],r,t),r++}else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r,t)}function v(t,e,i){var r="DEPRECATED METHOD: "+e+"\n"+i+" AT \n";return function(){var e=new Error("get-stack-trace"),i=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=n.console&&(n.console.warn||n.console.log);return o&&o.call(n.console,r,i),t.apply(this,arguments)}}l="function"!==typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==s&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}:Object.assign;var _=v((function(t,e,i){var r=Object.keys(e),n=0;while(n<r.length)(!i||i&&t[r[n]]===s)&&(t[r[n]]=e[r[n]]),n++;return t}),"extend","Use `assign`."),b=v((function(t,e){return _(t,e,!0)}),"merge","Use `assign`.");function x(t,e,i){var r,n=e.prototype;r=t.prototype=Object.create(n),r.constructor=t,r._super=n,i&&l(r,i)}function w(t,e){return function(){return t.apply(e,arguments)}}function T(t,e){return typeof t==h?t.apply(e&&e[0]||s,e):t}function E(t,e){return t===s?e:t}function S(t,e,i){y(I(e),(function(e){t.addEventListener(e,i,!1)}))}function A(t,e,i){y(I(e),(function(e){t.removeEventListener(e,i,!1)}))}function C(t,e){while(t){if(t==e)return!0;t=t.parentNode}return!1}function P(t,e){return t.indexOf(e)>-1}function I(t){return t.trim().split(/\s+/g)}function M(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);var r=0;while(r<t.length){if(i&&t[r][i]==e||!i&&t[r]===e)return r;r++}return-1}function k(t){return Array.prototype.slice.call(t,0)}function D(t,e,i){var r=[],n=[],o=0;while(o<t.length){var a=e?t[o][e]:t[o];M(n,a)<0&&r.push(t[o]),n[o]=a,o++}return i&&(r=e?r.sort((function(t,i){return t[e]>i[e]})):r.sort()),r}function L(t,e){var i,r,n=e[0].toUpperCase()+e.slice(1),o=0;while(o<u.length){if(i=u[o],r=i?i+n:e,r in t)return r;o++}return s}var O=1;function R(){return O++}function z(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||n}var F=/mobile|tablet|ip(ad|hone|od)|android/i,B="ontouchstart"in n,N=L(n,"PointerEvent")!==s,j=B&&F.test(navigator.userAgent),U="touch",V="pen",G="mouse",q="kinect",W=25,H=1,Z=2,X=4,Y=8,K=1,J=2,Q=4,$=8,tt=16,et=J|Q,it=$|tt,rt=et|it,nt=["x","y"],ot=["clientX","clientY"];function at(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){T(t.options.enable,[t])&&i.handler(e)},this.init()}function st(t){var e,i=t.options.inputClass;return e=i||(N?Pt:j?zt:B?jt:Tt),new e(t,lt)}function lt(t,e,i){var r=i.pointers.length,n=i.changedPointers.length,o=e&H&&r-n===0,a=e&(X|Y)&&r-n===0;i.isFirst=!!o,i.isFinal=!!a,o&&(t.session={}),i.eventType=e,ut(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function ut(t,e){var i=t.session,r=e.pointers,n=r.length;i.firstInput||(i.firstInput=pt(e)),n>1&&!i.firstMultiple?i.firstMultiple=pt(e):1===n&&(i.firstMultiple=!1);var o=i.firstInput,a=i.firstMultiple,s=a?a.center:o.center,l=e.center=dt(r);e.timeStamp=f(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=yt(s,l),e.distance=gt(s,l),ct(i,e),e.offsetDirection=mt(e.deltaX,e.deltaY);var u=ft(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=u.x,e.overallVelocityY=u.y,e.overallVelocity=d(u.x)>d(u.y)?u.x:u.y,e.scale=a?_t(a.pointers,r):1,e.rotation=a?vt(a.pointers,r):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,ht(i,e);var c=t.element;C(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}function ct(t,e){var i=e.center,r=t.offsetDelta||{},n=t.prevDelta||{},o=t.prevInput||{};e.eventType!==H&&o.eventType!==X||(n=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=n.x+(i.x-r.x),e.deltaY=n.y+(i.y-r.y)}function ht(t,e){var i,r,n,o,a=t.lastInterval||e,l=e.timeStamp-a.timeStamp;if(e.eventType!=Y&&(l>W||a.velocity===s)){var u=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,h=ft(l,u,c);r=h.x,n=h.y,i=d(h.x)>d(h.y)?h.x:h.y,o=mt(u,c),t.lastInterval=e}else i=a.velocity,r=a.velocityX,n=a.velocityY,o=a.direction;e.velocity=i,e.velocityX=r,e.velocityY=n,e.direction=o}function pt(t){var e=[],i=0;while(i<t.pointers.length)e[i]={clientX:p(t.pointers[i].clientX),clientY:p(t.pointers[i].clientY)},i++;return{timeStamp:f(),pointers:e,center:dt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function dt(t){var e=t.length;if(1===e)return{x:p(t[0].clientX),y:p(t[0].clientY)};var i=0,r=0,n=0;while(n<e)i+=t[n].clientX,r+=t[n].clientY,n++;return{x:p(i/e),y:p(r/e)}}function ft(t,e,i){return{x:e/t||0,y:i/t||0}}function mt(t,e){return t===e?K:d(t)>=d(e)?t<0?J:Q:e<0?$:tt}function gt(t,e,i){i||(i=nt);var r=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return Math.sqrt(r*r+n*n)}function yt(t,e,i){i||(i=nt);var r=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return 180*Math.atan2(n,r)/Math.PI}function vt(t,e){return yt(e[1],e[0],ot)+yt(t[1],t[0],ot)}function _t(t,e){return gt(e[0],e[1],ot)/gt(t[0],t[1],ot)}at.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(z(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(z(this.element),this.evWin,this.domHandler)}};var bt={mousedown:H,mousemove:Z,mouseup:X},xt="mousedown",wt="mousemove mouseup";function Tt(){this.evEl=xt,this.evWin=wt,this.pressed=!1,at.apply(this,arguments)}x(Tt,at,{handler:function(t){var e=bt[t.type];e&H&&0===t.button&&(this.pressed=!0),e&Z&&1!==t.which&&(e=X),this.pressed&&(e&X&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:G,srcEvent:t}))}});var Et={pointerdown:H,pointermove:Z,pointerup:X,pointercancel:Y,pointerout:Y},St={2:U,3:V,4:G,5:q},At="pointerdown",Ct="pointermove pointerup pointercancel";function Pt(){this.evEl=At,this.evWin=Ct,at.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}n.MSPointerEvent&&!n.PointerEvent&&(At="MSPointerDown",Ct="MSPointerMove MSPointerUp MSPointerCancel"),x(Pt,at,{handler:function(t){var e=this.store,i=!1,r=t.type.toLowerCase().replace("ms",""),n=Et[r],o=St[t.pointerType]||t.pointerType,a=o==U,s=M(e,t.pointerId,"pointerId");n&H&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):n&(X|Y)&&(i=!0),s<0||(e[s]=t,this.callback(this.manager,n,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),i&&e.splice(s,1))}});var It={touchstart:H,touchmove:Z,touchend:X,touchcancel:Y},Mt="touchstart",kt="touchstart touchmove touchend touchcancel";function Dt(){this.evTarget=Mt,this.evWin=kt,this.started=!1,at.apply(this,arguments)}function Lt(t,e){var i=k(t.touches),r=k(t.changedTouches);return e&(X|Y)&&(i=D(i.concat(r),"identifier",!0)),[i,r]}x(Dt,at,{handler:function(t){var e=It[t.type];if(e===H&&(this.started=!0),this.started){var i=Lt.call(this,t,e);e&(X|Y)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:U,srcEvent:t})}}});var Ot={touchstart:H,touchmove:Z,touchend:X,touchcancel:Y},Rt="touchstart touchmove touchend touchcancel";function zt(){this.evTarget=Rt,this.targetIds={},at.apply(this,arguments)}function Ft(t,e){var i=k(t.touches),r=this.targetIds;if(e&(H|Z)&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,o,a=k(t.changedTouches),s=[],l=this.target;if(o=i.filter((function(t){return C(t.target,l)})),e===H){n=0;while(n<o.length)r[o[n].identifier]=!0,n++}n=0;while(n<a.length)r[a[n].identifier]&&s.push(a[n]),e&(X|Y)&&delete r[a[n].identifier],n++;return s.length?[D(o.concat(s),"identifier",!0),s]:void 0}x(zt,at,{handler:function(t){var e=Ot[t.type],i=Ft.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:U,srcEvent:t})}});var Bt=2500,Nt=25;function jt(){at.apply(this,arguments);var t=w(this.handler,this);this.touch=new zt(this.manager,t),this.mouse=new Tt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Ut(t,e){t&H?(this.primaryTouch=e.changedPointers[0].identifier,Vt.call(this,e)):t&(X|Y)&&Vt.call(this,e)}function Vt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var r=this.lastTouches,n=function(){var t=r.indexOf(i);t>-1&&r.splice(t,1)};setTimeout(n,Bt)}}function Gt(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var n=this.lastTouches[r],o=Math.abs(e-n.x),a=Math.abs(i-n.y);if(o<=Nt&&a<=Nt)return!0}return!1}x(jt,at,{handler:function(t,e,i){var r=i.pointerType==U,n=i.pointerType==G;if(!(n&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(r)Ut.call(this,e,i);else if(n&&Gt.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var qt=L(c.style,"touchAction"),Wt=qt!==s,Ht="compute",Zt="auto",Xt="manipulation",Yt="none",Kt="pan-x",Jt="pan-y",Qt=ee();function $t(t,e){this.manager=t,this.set(e)}function te(t){if(P(t,Yt))return Yt;var e=P(t,Kt),i=P(t,Jt);return e&&i?Yt:e||i?e?Kt:Jt:P(t,Xt)?Xt:Zt}function ee(){if(!Wt)return!1;var t={},e=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){t[i]=!e||n.CSS.supports("touch-action",i)})),t}$t.prototype={set:function(t){t==Ht&&(t=this.compute()),Wt&&this.manager.element.style&&Qt[t]&&(this.manager.element.style[qt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return y(this.manager.recognizers,(function(e){T(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),te(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,n=P(r,Yt)&&!Qt[Yt],o=P(r,Jt)&&!Qt[Jt],a=P(r,Kt)&&!Qt[Kt];if(n){var s=1===t.pointers.length,l=t.distance<2,u=t.deltaTime<250;if(s&&l&&u)return}if(!a||!o)return n||o&&i&et||a&&i&it?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var ie=1,re=2,ne=4,oe=8,ae=oe,se=16,le=32;function ue(t){this.options=l({},this.defaults,t||{}),this.id=R(),this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=ie,this.simultaneous={},this.requireFail=[]}function ce(t){return t&se?"cancel":t&oe?"end":t&ne?"move":t&re?"start":""}function he(t){return t==tt?"down":t==$?"up":t==J?"left":t==Q?"right":""}function pe(t,e){var i=e.manager;return i?i.get(t):t}function de(){ue.apply(this,arguments)}function fe(){de.apply(this,arguments),this.pX=null,this.pY=null}function me(){de.apply(this,arguments)}function ge(){ue.apply(this,arguments),this._timer=null,this._input=null}function ye(){de.apply(this,arguments)}function ve(){de.apply(this,arguments)}function _e(){ue.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function be(t,e){return e=e||{},e.recognizers=E(e.recognizers,be.defaults.preset),new Te(t,e)}ue.prototype={defaults:{},set:function(t){return l(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(g(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=pe(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return g(t,"dropRecognizeWith",this)||(t=pe(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(g(t,"requireFailure",this))return this;var e=this.requireFail;return t=pe(t,this),-1===M(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(g(t,"dropRequireFailure",this))return this;t=pe(t,this);var e=M(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,i=this.state;function r(i){e.manager.emit(i,t)}i<oe&&r(e.options.event+ce(i)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),i>=oe&&r(e.options.event+ce(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=le},canEmit:function(){var t=0;while(t<this.requireFail.length){if(!(this.requireFail[t].state&(le|ie)))return!1;t++}return!0},recognize:function(t){var e=l({},t);if(!T(this.options.enable,[this,e]))return this.reset(),void(this.state=le);this.state&(ae|se|le)&&(this.state=ie),this.state=this.process(e),this.state&(re|ne|oe|se)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},x(de,ue,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,r=e&(re|ne),n=this.attrTest(t);return r&&(i&Y||!n)?e|se:r||n?i&X?e|oe:e&re?e|ne:re:le}}),x(fe,de,{defaults:{event:"pan",threshold:10,pointers:1,direction:rt},getTouchAction:function(){var t=this.options.direction,e=[];return t&et&&e.push(Jt),t&it&&e.push(Kt),e},directionTest:function(t){var e=this.options,i=!0,r=t.distance,n=t.direction,o=t.deltaX,a=t.deltaY;return n&e.direction||(e.direction&et?(n=0===o?K:o<0?J:Q,i=o!=this.pX,r=Math.abs(t.deltaX)):(n=0===a?K:a<0?$:tt,i=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=n,i&&r>e.threshold&&n&e.direction},attrTest:function(t){return de.prototype.attrTest.call(this,t)&&(this.state&re||!(this.state&re)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=he(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),x(me,de,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Yt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&re)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),x(ge,ue,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,r=t.distance<e.threshold,n=t.deltaTime>e.time;if(this._input=t,!r||!i||t.eventType&(X|Y)&&!n)this.reset();else if(t.eventType&H)this.reset(),this._timer=m((function(){this.state=ae,this.tryEmit()}),e.time,this);else if(t.eventType&X)return ae;return le},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===ae&&(t&&t.eventType&X?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),x(ye,de,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Yt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&re)}}),x(ve,de,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:et|it,pointers:1},getTouchAction:function(){return fe.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(et|it)?e=t.overallVelocity:i&et?e=t.overallVelocityX:i&it&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(e)>this.options.velocity&&t.eventType&X},emit:function(t){var e=he(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),x(_e,ue,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Xt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,r=t.distance<e.threshold,n=t.deltaTime<e.time;if(this.reset(),t.eventType&H&&0===this.count)return this.failTimeout();if(r&&n&&i){if(t.eventType!=X)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||gt(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t;var s=this.count%e.taps;if(0===s)return this.hasRequireFailures()?(this._timer=m((function(){this.state=ae,this.tryEmit()}),e.interval,this),re):ae}return le},failTimeout:function(){return this._timer=m((function(){this.state=le}),this.options.interval,this),le},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ae&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),be.VERSION="2.0.7",be.defaults={domEvents:!1,touchAction:Ht,enable:!0,inputTarget:null,inputClass:null,preset:[[ye,{enable:!1}],[me,{enable:!1},["rotate"]],[ve,{direction:et}],[fe,{direction:et},["swipe"]],[_e],[_e,{event:"doubletap",taps:2},["tap"]],[ge]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var xe=1,we=2;function Te(t,e){this.options=l({},be.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=st(this),this.touchAction=new $t(this,this.options.touchAction),Ee(this,!0),y(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Ee(t,e){var i,r=t.element;r.style&&(y(t.options.cssProps,(function(n,o){i=L(r.style,o),e?(t.oldCssProps[i]=r.style[i],r.style[i]=n):r.style[i]=t.oldCssProps[i]||""})),e||(t.oldCssProps={}))}function Se(t,e){var i=o.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}Te.prototype={set:function(t){return l(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?we:xe},recognize:function(t){var e=this.session;if(!e.stopped){var i;this.touchAction.preventDefaults(t);var r=this.recognizers,n=e.curRecognizer;(!n||n&&n.state&ae)&&(n=e.curRecognizer=null);var o=0;while(o<r.length)i=r[o],e.stopped===we||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(t),!n&&i.state&(re|ne|oe)&&(n=e.curRecognizer=i),o++}},get:function(t){if(t instanceof ue)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(g(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(g(t,"remove",this))return this;if(t=this.get(t),t){var e=this.recognizers,i=M(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var i=this.handlers;return y(I(t),(function(t){i[t]=i[t]||[],i[t].push(e)})),this}},off:function(t,e){if(t!==s){var i=this.handlers;return y(I(t),(function(t){e?i[t]&&i[t].splice(M(i[t],e),1):delete i[t]})),this}},emit:function(t,e){this.options.domEvents&&Se(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};var r=0;while(r<i.length)i[r](e),r++}},destroy:function(){this.element&&Ee(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(be,{INPUT_START:H,INPUT_MOVE:Z,INPUT_END:X,INPUT_CANCEL:Y,STATE_POSSIBLE:ie,STATE_BEGAN:re,STATE_CHANGED:ne,STATE_ENDED:oe,STATE_RECOGNIZED:ae,STATE_CANCELLED:se,STATE_FAILED:le,DIRECTION_NONE:K,DIRECTION_LEFT:J,DIRECTION_RIGHT:Q,DIRECTION_UP:$,DIRECTION_DOWN:tt,DIRECTION_HORIZONTAL:et,DIRECTION_VERTICAL:it,DIRECTION_ALL:rt,Manager:Te,Input:at,TouchAction:$t,TouchInput:zt,MouseInput:Tt,PointerEventInput:Pt,TouchMouseInput:jt,SingleTouchInput:Dt,Recognizer:ue,AttrRecognizer:de,Tap:_e,Pan:fe,Swipe:ve,Pinch:me,Rotate:ye,Press:ge,on:S,off:A,each:y,merge:b,extend:_,assign:l,inherit:x,bindFn:w,prefixed:L});var Ae="undefined"!==typeof n?n:"undefined"!==typeof self?self:{};Ae.Hammer=be,r=function(){return be}.call(e,i,e,t),r===s||(t.exports=r)})(window,document)},cc64:function(t,e,i){},cf62:function(t,e,i){},d1d4:function(t,e){(function(){t.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},d7e3:function(t,e,i){(function(){var e,r,n,o,a,s,l,u;({isObject:u}=i("45f3")),l=i("92e7"),e=i("065e"),r=i("188f"),o=i("1585"),n=i("3b32"),a=i("b6e1"),s=i("5c2a"),t.exports=function(){class t extends l{constructor(t,i,r){var n,o,a,s;if(super(t),this.type=e.DocType,t.children)for(s=t.children,o=0,a=s.length;o<a;o++)if(n=s[o],n.type===e.Element){this.name=n.name;break}this.documentObject=t,u(i)&&({pubID:i,sysID:r}=i),null==r&&([r,i]=[i,r]),null!=i&&(this.pubID=this.stringify.dtdPubID(i)),null!=r&&(this.sysID=this.stringify.dtdSysID(r))}element(t,e){var i;return i=new n(this,t,e),this.children.push(i),this}attList(t,e,i,n,o){var a;return a=new r(this,t,e,i,n,o),this.children.push(a),this}entity(t,e){var i;return i=new o(this,!1,t,e),this.children.push(i),this}pEntity(t,e){var i;return i=new o(this,!0,t,e),this.children.push(i),this}notation(t,e){var i;return i=new a(this,t,e),this.children.push(i),this}toString(t){return this.options.writer.docType(this,this.options.writer.filterOptions(t))}ele(t,e){return this.element(t,e)}att(t,e,i,r,n){return this.attList(t,e,i,r,n)}ent(t,e){return this.entity(t,e)}pent(t,e){return this.pEntity(t,e)}not(t,e){return this.notation(t,e)}up(){return this.root()||this.documentObject}isEqualNode(t){return!!super.isEqualNode(t)&&(t.name===this.name&&(t.publicId===this.publicId&&t.systemId===this.systemId))}}return Object.defineProperty(t.prototype,"entities",{get:function(){var t,i,r,n,o;for(n={},o=this.children,i=0,r=o.length;i<r;i++)t=o[i],t.type!==e.EntityDeclaration||t.pe||(n[t.name]=t);return new s(n)}}),Object.defineProperty(t.prototype,"notations",{get:function(){var t,i,r,n,o;for(n={},o=this.children,i=0,r=o.length;i<r;i++)t=o[i],t.type===e.NotationDeclaration&&(n[t.name]=t);return new s(n)}}),Object.defineProperty(t.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(t.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),t}.call(this)}).call(this)},de4e:function(t,e,i){if(t.exports)var r=i("ac62");function n(t,e,i,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,i,r)}n.prototype.run=function(t,e,i,n){this._init(t,e,i,n);for(var o=0,a=this.dataset.length;o<a;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var s=this.clusters.length-1;this._orderedList.push(o);var l=new r(null,null,"asc"),u=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,u,l),this._expandCluster(s,l))}return this.clusters},n.prototype.getReachabilityPlot=function(){for(var t=[],e=0,i=this._orderedList.length;e<i;e++){var r=this._orderedList[e],n=this._reachability[r];t.push([r,n])}return t},n.prototype._init=function(t,e,i,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),i&&(this.minPts=i),r&&(this.distance=r)},n.prototype._updateQueue=function(t,e,i){var r=this;this._coreDistance=this._distanceToCore(t),e.forEach((function(e){if(void 0===r._processed[e]){var n=r.distance(r.dataset[t],r.dataset[e]),o=Math.max(r._coreDistance,n);void 0===r._reachability[e]?(r._reachability[e]=o,i.insert(e,o)):o<r._reachability[e]&&(r._reachability[e]=o,i.remove(e),i.insert(e,o))}}))},n.prototype._expandCluster=function(t,e){for(var i=e.getElements(),r=0,n=i.length;r<n;r++){var o=i[r];if(void 0===this._processed[o]){var a=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,a,e),this._expandCluster(t,e))}}},n.prototype._distanceToCore=function(t){for(var e=this.epsilon,i=0;i<e;i++){var r=this._regionQuery(t,i);if(r.length>=this.minPts)return i}},n.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var i=[],r=0,n=this.dataset.length;r<n;r++)this.distance(this.dataset[t],this.dataset[r])<e&&i.push(r);return i},n.prototype._euclideanDistance=function(t,e){var i=0,r=Math.min(t.length,e.length);while(r--)i+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(i)},t.exports&&(t.exports=n)},e129:function(t,e,i){},e192:function(t,e,i){(function(e,i){t.exports=i()})(0,(function(){"use strict";var t,e,i;function r(r,n){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),i=n(a),"undefined"!==typeof window&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=n;else t=n}return r(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=r;function r(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=i,this.p2y=r}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var i,r,n,o,a;for(void 0===e&&(e=1e-6),n=t,a=0;a<8;a++){if(o=this.sampleCurveX(n)-t,Math.abs(o)<e)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=o/s}if((n=t)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(o=this.sampleCurveX(n),Math.abs(o-t)<e)return n;t>o?i=n:r=n,n=.5*(r-i)+i}return n},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var n=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var a="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function l(t,e,r,n){var o=new i(t,e,r,n);return function(t){return o.solve(t)}}var u=l(.25,.1,.25,1);function c(t,e,i){return Math.min(i,Math.max(e,t))}function h(t,e,i){var r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function p(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var r=0,n=e;r<n.length;r+=1){var o=n[r];for(var a in o)t[a]=o[a]}return t}var d=1;function f(){return d++}function m(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function g(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function y(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function v(t,e){return-1!==t.indexOf(e,t.length-e.length)}function _(t,e,i){var r={};for(var n in t)r[n]=e.call(i||this,t[n],n,t);return r}function b(t,e,i){var r={};for(var n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?_(t,x):t}var w={};function T(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function E(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function S(t){for(var e=0,i=0,r=t.length,n=r-1,o=void 0,a=void 0;i<r;n=i++)e+=((a=t[n]).x-(o=t[i]).x)*(o.y+a.y);return e}function A(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function C(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,i,r,n){var o=r||n;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){var i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}var P=null;function I(t){if(null==P){var e=t.navigator?t.navigator.userAgent:null;P=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return P}function M(t){try{var e=a[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var k,D,L,O,R=a.performance&&a.performance.now?a.performance.now.bind(a.performance):Date.now.bind(Date),z=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,F=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,B={now:R,frame:function(t){var e=z(t);return{cancel:function(){return F(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var i=a.document.createElement("canvas"),r=i.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return i.width=t.width,i.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return k||(k=a.document.createElement("a")),k.href=t,k.href},hardwareConcurrency:a.navigator&&a.navigator.hardwareConcurrency||4,get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==D&&(D=a.matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}},N={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(t){!U&&O&&(V?G(t):L=t)}},U=!1,V=!1;function G(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,O),t.isContextLost())return;j.supported=!0}catch(t){}t.deleteTexture(e),U=!0}a.document&&((O=a.document.createElement("img")).onload=function(){L&&G(L),L=null,V=!0},O.onerror=function(){U=!0,L=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var q="01",W=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function H(t){return 0===t.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",q,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},W.prototype.normalizeStyleURL=function(t,e){if(!H(t))return t;var i=K(t);return i.path="/styles/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)},W.prototype.normalizeGlyphsURL=function(t,e){if(!H(t))return t;var i=K(t);return i.path="/fonts/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)},W.prototype.normalizeSourceURL=function(t,e){if(!H(t))return t;var i=K(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)},W.prototype.normalizeSpriteURL=function(t,e,i,r){var n=K(t);return H(t)?(n.path="/styles/v1"+n.path+"/sprite"+e+i,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=""+e+i,J(n))},W.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!H(t))return t;var i=K(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,(B.devicePixelRatio>=2||512===e?"@2x":"")+(j.supported?".webp":"$1")),i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/v4"+i.path;var r=this._customAccessToken||function(t){for(var e=0,i=t;e<i.length;e+=1){var r=i[e].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(i.params)||N.ACCESS_TOKEN;return N.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push("sku="+this._skuToken),this._makeAPIURL(i,r)},W.prototype.canonicalizeTileURL=function(t,e){var i=K(t);if(!i.path.match(/(^\/v4\/)/)||!i.path.match(/\.[\w]+$/))return t;var r="mapbox://tiles/";r+=i.path.replace("/v4/","");var n=i.params;return e&&(n=n.filter((function(t){return!t.match(/^access_token=/)}))),n.length&&(r+="?"+n.join("&")),r},W.prototype.canonicalizeTileset=function(t,e){for(var i=!!e&&H(e),r=[],n=0,o=t.tiles||[];n<o.length;n+=1){var a=o[n];X(a)?r.push(this.canonicalizeTileURL(a,i)):r.push(a)}return r},W.prototype._makeAPIURL=function(t,e){var i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=K(N.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"/"!==r.path&&(t.path=""+r.path+t.path),!N.REQUIRE_ACCESS_TOKEN)return J(t);if(!(e=e||N.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+i);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+i);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),J(t)};var Z=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function X(t){return Z.test(t)}var Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(t){var e=t.match(Y);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function J(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function Q(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var $=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};$.prototype.getStorageKey=function(t){var e,i=Q(N.ACCESS_TOKEN);return e=i&&i.u?a.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):N.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},$.prototype.fetchEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{var r=a.localStorage.getItem(e);r&&(this.eventData=JSON.parse(r));var n=a.localStorage.getItem(i);n&&(this.anonId=n)}catch(t){T("Unable to read from LocalStorage")}},$.prototype.saveEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{a.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){T("Unable to write to LocalStorage")}},$.prototype.processRequests=function(t){},$.prototype.postEvent=function(t,e,i,r){var n=this;if(N.EVENTS_URL){var o=K(N.EVENTS_URL);o.params.push("access_token="+(r||N.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.12.0",skuId:q,userId:this.anonId},s=e?p(a,e):a,l={url:J(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=xt(l,(function(t){n.pendingRequest=null,i(t),n.saveEventData(),n.processRequests(r)}))}},$.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,it=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,i,r){this.skuToken=i,(N.EVENTS_URL&&r||N.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||X(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},r)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var i=this.queue.shift(),r=i.id,n=i.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),g(this.anonId)||(this.anonId=m()),this.postEvent(n,{skuToken:this.skuToken},(function(t){t||r&&(e.success[r]=!0)}),t))}},e}($),rt=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){N.EVENTS_URL&&N.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||X(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var i=Q(N.ACCESS_TOKEN),r=i?i.u:N.ACCESS_TOKEN,n=r!==this.eventData.tokenU;g(this.anonId)||(this.anonId=m(),n=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),l=(o-this.eventData.lastSuccess)/864e5;n=n||l>=1||l<-1||a.getDate()!==s.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=r)}),t)}},e}($)),nt=rt.postTurnstileEvent.bind(rt),ot=new it,at=ot.postMapLoadEvent.bind(ot),st=500,lt=50;function ut(){a.caches&&!tt&&(tt=a.caches.open("mapbox-tiles"))}function ct(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,pt=1/0;function dt(){return null==ht&&(ht=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),ht}var ft={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ft);var mt,gt,yt=function(t){function e(e,i,r){401===i&&X(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=i,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),vt=A()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===a.location.protocol?a.parent:a).location.href},_t=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(vt())&&!/^\w+:/.test(i))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(t,e){var i,r=new a.AbortController,n=new a.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:vt(),signal:r.signal}),o=!1,s=!1,l=(i=n.url).indexOf("sku=")>0&&X(i);"json"===t.type&&n.headers.set("Accept","application/json");var u=function(i,r,o){if(!s){if(i&&"SecurityError"!==i.message&&T(i),r&&o)return c(r);var u=Date.now();a.fetch(n).then((function(i){if(i.ok){var r=l?i.clone():null;return c(i,r,u)}return e(new yt(i.statusText,i.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(i,r,l){("arrayBuffer"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((function(t){s||(r&&l&&function(t,e,i){if(ut(),tt){var r={status:e.status,statusText:e.statusText,headers:new a.Headers};e.headers.forEach((function(t,e){return r.headers.set(e,t)}));var n=C(e.headers.get("Cache-Control")||"");n["no-store"]||(n["max-age"]&&r.headers.set("Expires",new Date(i+1e3*n["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-i<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var i=new a.Response(e,r);ut(),tt&&tt.then((function(e){return e.put(ct(t.url),i)})).catch((function(t){return T(t.message)}))})))}}(n,r,l),o=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return l?function(t,e){if(ut(),!tt)return e(null);var i=ct(t.url);tt.then((function(t){t.match(i).then((function(r){var n=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),i=C(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(r);t.delete(i),n&&t.put(i,r.clone()),e(null,r,n)})).catch(e)})).catch(e)}(n,u):u(null,null),{cancel:function(){s=!0,o||r.abort()}}}(t,e);if(A()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){var i=new a.XMLHttpRequest;for(var r in i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer"),t.headers)i.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=function(){e(new Error(i.statusText))},i.onload=function(){if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){var r=i.response;if("json"===t.type)try{r=JSON.parse(i.response)}catch(t){return e(t)}e(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else e(new yt(i.statusText,i.status,t.url))},i.send(t.body),{cancel:function(){return i.abort()}}}(t,e)},bt=function(t,e){return _t(p(t,{type:"arrayBuffer"}),e)},xt=function(t,e){return _t(p(t,{method:"POST"}),e)};mt=[],gt=0;var wt=function(t,e){if(j.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gt>=N.MAX_PARALLEL_IMAGE_REQUESTS){var i={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return mt.push(i),i}gt++;var r=!1,n=function(){if(!r)for(r=!0,gt--;mt.length&&gt<N.MAX_PARALLEL_IMAGE_REQUESTS;){var t=mt.shift();t.cancelled||(t.cancel=wt(t.requestParameters,t.callback).cancel)}},o=bt(t,(function(t,i,r,o){n(),t?e(t):i&&(dt()?function(t,e){var i=new a.Blob([new Uint8Array(t)],{type:"image/png"});a.createImageBitmap(i).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(i,e):function(t,e,i,r){var n=new a.Image,o=a.URL;n.onload=function(){e(null,n),o.revokeObjectURL(n.src)},n.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new a.Blob([new Uint8Array(t)],{type:"image/png"});n.cacheControl=i,n.expires=r,n.src=t.byteLength?o.createObjectURL(s):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}(i,e,r,o))}));return{cancel:function(){o.cancel(),n()}}};function Tt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Et(t,e,i){if(i&&i[t]){var r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}var St=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t},At=function(t){function e(e,i){void 0===i&&(i={}),t.call(this,"error",p({error:e},i))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(St),Ct=function(){};Ct.prototype.on=function(t,e){return this._listeners=this._listeners||{},Tt(t,e,this._listeners),this},Ct.prototype.off=function(t,e){return Et(t,e,this._listeners),Et(t,e,this._oneTimeListeners),this},Ct.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Tt(t,e,this._oneTimeListeners),this},Ct.prototype.fire=function(t,e){"string"==typeof t&&(t=new St(t,e||{}));var i=t.type;if(this.listens(i)){t.target=this;for(var r=0,n=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];r<n.length;r+=1)n[r].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];o<a.length;o+=1){var s=a[o];Et(i,s,this._oneTimeListeners),s.call(this,t)}var l=this._eventedParent;l&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(t))}else t instanceof At&&console.error(t.error);return this},Ct.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Ct.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},It=function(t,e,i,r){this.message=(t?t+": ":"")+i,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)};function Mt(t){var e=t.value;return e?[new It(t.key,e,"constants have been deprecated as of v8")]:[]}function kt(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var r=0,n=e;r<n.length;r+=1){var o=n[r];for(var a in o)t[a]=o[a]}return t}function Dt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Lt(t){if(Array.isArray(t))return t.map(Lt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var i in t)e[i]=Lt(t[i]);return e}return Dt(t)}var Ot=function(t){function e(e,i){t.call(this,i),this.message=i,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Rt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var i=0,r=e;i<r.length;i+=1){var n=r[i];this.bindings[n[0]]=n[1]}};Rt.prototype.concat=function(t){return new Rt(this,t)},Rt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Rt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var zt={kind:"null"},Ft={kind:"number"},Bt={kind:"string"},Nt={kind:"boolean"},jt={kind:"color"},Ut={kind:"object"},Vt={kind:"value"},Gt={kind:"collator"},qt={kind:"formatted"},Wt={kind:"resolvedImage"};function Ht(t,e){return{kind:"array",itemType:t,N:e}}function Zt(t){if("array"===t.kind){var e=Zt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Xt=[zt,Ft,Bt,Nt,jt,qt,Ut,Ht(Vt),Wt];function Yt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Yt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var i=0,r=Xt;i<r.length;i+=1)if(!Yt(r[i],e))return null}return"Expected "+Zt(t)+" but found "+Zt(e)+" instead."}function Kt(t,e){return e.some((function(e){return e.kind===t.kind}))}function Jt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var Qt=e((function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function n(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in i)return i[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=s.indexOf("("),u=s.indexOf(")");if(-1!==l&&u+1===s.length){var c=s.substr(0,l),h=s.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[n(h[0]),n(h[1]),n(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[r(255*a(y,g,d+1/3)),r(255*a(y,g,d)),r(255*a(y,g,d-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,$t=function(t,e,i,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=i,this.a=r};$t.parse=function(t){if(t){if(t instanceof $t)return t;if("string"==typeof t){var e=Qt(t);if(e)return new $t(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},$t.prototype.toString=function(){var t=this.toArray(),e=t[1],i=t[2],r=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(i)+","+r+")"},$t.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},$t.black=new $t(0,0,0,1),$t.white=new $t(1,1,1,1),$t.transparent=new $t(0,0,0,0),$t.red=new $t(1,0,0,1);var te=function(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};te.prototype.compare=function(t,e){return this.collator.compare(t,e)},te.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ee=function(t,e,i,r,n){this.text=t,this.image=e,this.scale=i,this.fontStack=r,this.textColor=n},ie=function(t){this.sections=t};ie.fromString=function(t){return new ie([new ee(t,null,null,null,null)])},ie.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},ie.factory=function(t){return t instanceof ie?t:ie.fromString(t)},ie.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},ie.prototype.serialize=function(){for(var t=["format"],e=0,i=this.sections;e<i.length;e+=1){var r=i[e];if(r.image)t.push(["image",r.image.name]);else{t.push(r.text);var n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(n)}}return t};var re=function(t){this.name=t.name,this.available=t.available};function ne(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,i,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function oe(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof $t)return!0;if(t instanceof te)return!0;if(t instanceof ie)return!0;if(t instanceof re)return!0;if(Array.isArray(t)){for(var e=0,i=t;e<i.length;e+=1)if(!oe(i[e]))return!1;return!0}if("object"==typeof t){for(var r in t)if(!oe(t[r]))return!1;return!0}return!1}function ae(t){if(null===t)return zt;if("string"==typeof t)return Bt;if("boolean"==typeof t)return Nt;if("number"==typeof t)return Ft;if(t instanceof $t)return jt;if(t instanceof te)return Gt;if(t instanceof ie)return qt;if(t instanceof re)return Wt;if(Array.isArray(t)){for(var e,i=t.length,r=0,n=t;r<n.length;r+=1){var o=ae(n[r]);if(e){if(e===o)continue;e=Vt;break}e=o}return Ht(e||Vt,i)}return Ut}function se(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof $t||t instanceof ie||t instanceof re?t.toString():JSON.stringify(t)}re.prototype.toString=function(){return this.name},re.fromString=function(t){return t?new re({name:t,available:!1}):null},re.prototype.serialize=function(){return["image",this.name]};var le=function(t,e){this.type=t,this.value=e};le.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!oe(t[1]))return e.error("invalid value");var i=t[1],r=ae(i),n=e.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new le(r,i)},le.prototype.evaluate=function(){return this.value},le.prototype.eachChild=function(){},le.prototype.outputDefined=function(){return!0},le.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof $t?["rgba"].concat(this.value.toArray()):this.value instanceof ie?this.value.serialize():this.value};var ue=function(t){this.name="ExpressionEvaluationError",this.message=t};ue.prototype.toJSON=function(){return this.message};var ce={string:Bt,number:Ft,boolean:Nt,object:Ut},he=function(t,e){this.type=t,this.args=e};he.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var i,r=1,n=t[0];if("array"===n){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in ce)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=ce[s],r++}else o=Vt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],r++}i=Ht(o,a)}else i=ce[n];for(var l=[];r<t.length;r++){var u=e.parse(t[r],r,Vt);if(!u)return null;l.push(u)}return new he(i,l)},he.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var i=this.args[e].evaluate(t);if(!Yt(this.type,ae(i)))return i;if(e===this.args.length-1)throw new ue("Expected value to be of type "+Zt(this.type)+", but found "+Zt(ae(i))+" instead.")}return null},he.prototype.eachChild=function(t){this.args.forEach(t)},he.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},he.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);var r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var pe=function(t){this.type=qt,this.sections=t};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");for(var r=[],n=!1,o=1;o<=t.length-1;++o){var a=t[o];if(n&&"object"==typeof a&&!Array.isArray(a)){n=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Ft)))return null;var l=null;if(a["text-font"]&&!(l=e.parse(a["text-font"],1,Ht(Bt))))return null;var u=null;if(a["text-color"]&&!(u=e.parse(a["text-color"],1,jt)))return null;var c=r[r.length-1];c.scale=s,c.font=l,c.textColor=u}else{var h=e.parse(t[o],1,Vt);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new pe(r)},pe.prototype.evaluate=function(t){return new ie(this.sections.map((function(e){var i=e.content.evaluate(t);return ae(i)===Wt?new ee("",i,null,null,null):new ee(se(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},pe.prototype.eachChild=function(t){for(var e=0,i=this.sections;e<i.length;e+=1){var r=i[e];t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}},pe.prototype.outputDefined=function(){return!1},pe.prototype.serialize=function(){for(var t=["format"],e=0,i=this.sections;e<i.length;e+=1){var r=i[e];t.push(r.content.serialize());var n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),t.push(n)}return t};var de=function(t){this.type=Wt,this.input=t};de.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var i=e.parse(t[1],1,Bt);return i?new de(i):e.error("No image name provided.")},de.prototype.evaluate=function(t){var e=this.input.evaluate(t),i=re.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i},de.prototype.eachChild=function(t){t(this.input)},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){return["image",this.input.serialize()]};var fe={"to-boolean":Nt,"to-color":jt,"to-number":Ft,"to-string":Bt},me=function(t,e){this.type=t,this.args=e};me.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");for(var r=fe[i],n=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Vt);if(!a)return null;n.push(a)}return new me(r,n)},me.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,i,r=0,n=this.args;r<n.length;r+=1){if(i=null,(e=n[r].evaluate(t))instanceof $t)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(i=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":ne(e[0],e[1],e[2],e[3])))return new $t(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ue(i||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,l=this.args;s<l.length;s+=1){if(null===(a=l[s].evaluate(t)))return 0;var u=Number(a);if(!isNaN(u))return u}throw new ue("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?ie.fromString(se(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?re.fromString(se(this.args[0].evaluate(t))):se(this.args[0].evaluate(t))},me.prototype.eachChild=function(t){this.args.forEach(t)},me.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},me.prototype.serialize=function(){if("formatted"===this.type.kind)return new pe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new de(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var ge=["Unknown","Point","LineString","Polygon"],ye=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ye.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ye.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ge[this.feature.type]:this.feature.type:null},ye.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ye.prototype.canonicalID=function(){return this.canonical},ye.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ye.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=$t.parse(t)),e};var ve=function(t,e,i,r){this.name=t,this.type=e,this._evaluate=i,this.args=r};ve.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ve.prototype.eachChild=function(t){this.args.forEach(t)},ve.prototype.outputDefined=function(){return!1},ve.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},ve.parse=function(t,e){var i,r=t[0],n=ve.definitions[r];if(!n)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=a.filter((function(e){var i=e[0];return!Array.isArray(i)||i.length===t.length-1})),l=null,u=0,c=s;u<c.length;u+=1){var h=c[u],p=h[0],d=h[1];l=new je(e.registry,e.path,null,e.scope);for(var f=[],m=!1,g=1;g<t.length;g++){var y=t[g],v=Array.isArray(p)?p[g-1]:p.type,_=l.parse(y,1+f.length,v);if(!_){m=!0;break}f.push(_)}if(!m)if(Array.isArray(p)&&p.length!==f.length)l.error("Expected "+p.length+" arguments, but found "+f.length+" instead.");else{for(var b=0;b<f.length;b++){var x=Array.isArray(p)?p[b]:p.type,w=f[b];l.concat(b+1).checkSubtype(x,w.type)}if(0===l.errors.length)return new ve(r,o,d,f)}}if(1===s.length)(i=e.errors).push.apply(i,l.errors);else{for(var T=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Zt).join(", ")+")":"("+Zt(e.type)+"...)"})).join(" | "),E=[],S=1;S<t.length;S++){var A=e.parse(t[S],1+E.length);if(!A)return null;E.push(Zt(A.type))}e.error("Expected arguments of type "+T+", but found ("+E.join(", ")+") instead.")}return null},ve.register=function(t,e){for(var i in ve.definitions=e,e)t[i]=ve};var _e=function(t,e,i){this.type=Gt,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e};function be(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function xe(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function we(t,e){var i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*8192),Math.round(r*n*8192)]}function Te(t,e,i){return e[1]>t[1]!=i[1]>t[1]&&t[0]<(i[0]-e[0])*(t[1]-e[1])/(i[1]-e[1])+e[0]}function Ee(t,e){for(var i,r,n,o,a,s,l,u=!1,c=0,h=e.length;c<h;c++)for(var p=e[c],d=0,f=p.length;d<f-1;d++){if((o=(i=t)[0]-(r=p[d])[0])*(l=i[1]-(n=p[d+1])[1])-(s=i[0]-n[0])*(a=i[1]-r[1])==0&&o*s<=0&&a*l<=0)return!1;Te(t,p[d],p[d+1])&&(u=!u)}return u}function Se(t,e){for(var i=0;i<e.length;i++)if(Ee(t,e[i]))return!0;return!1}function Ae(t,e,i,r){var n=r[0]-i[0],o=r[1]-i[1],a=(t[0]-i[0])*o-n*(t[1]-i[1]),s=(e[0]-i[0])*o-n*(e[1]-i[1]);return a>0&&s<0||a<0&&s>0}function Ce(t,e,i){for(var r=0,n=i;r<n.length;r+=1)for(var o=n[r],a=0;a<o.length-1;++a)if(0!=(h=[(c=o[a+1])[0]-(u=o[a])[0],c[1]-u[1]])[0]*(p=[(l=e)[0]-(s=t)[0],l[1]-s[1]])[1]-h[1]*p[0]&&Ae(s,l,u,c)&&Ae(u,c,s,l))return!0;var s,l,u,c,h,p;return!1}function Pe(t,e){for(var i=0;i<t.length;++i)if(!Ee(t[i],e))return!1;for(var r=0;r<t.length-1;++r)if(Ce(t[r],t[r+1],e))return!1;return!0}function Ie(t,e){for(var i=0;i<e.length;i++)if(Pe(t,e[i]))return!0;return!1}function Me(t,e,i){for(var r=[],n=0;n<t.length;n++){for(var o=[],a=0;a<t[n].length;a++){var s=we(t[n][a],i);be(e,s),o.push(s)}r.push(o)}return r}function ke(t,e,i){for(var r=[],n=0;n<t.length;n++){var o=Me(t[n],e,i);r.push(o)}return r}function De(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){var n=.5*r,o=t[0]-i[0]>n?-r:i[0]-t[0]>n?r:0;0===o&&(o=t[0]-i[2]>n?-r:i[2]-t[0]>n?r:0),t[0]+=o}be(e,t)}function Le(t,e,i,r){for(var n=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[],s=0,l=t;s<l.length;s+=1)for(var u=0,c=l[s];u<c.length;u+=1){var h=c[u],p=[h.x+o[0],h.y+o[1]];De(p,e,i,n),a.push(p)}return a}function Oe(t,e,i,r){for(var n,o=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],s=[],l=0,u=t;l<u.length;l+=1){for(var c=[],h=0,p=u[l];h<p.length;h+=1){var d=p[h],f=[d.x+a[0],d.y+a[1]];be(e,f),c.push(f)}s.push(c)}if(e[2]-e[0]<=o/2){(n=e)[0]=n[1]=1/0,n[2]=n[3]=-1/0;for(var m=0,g=s;m<g.length;m+=1)for(var y=0,v=g[m];y<v.length;y+=1)De(v[y],e,i,o)}return s}_e.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Nt);if(!r)return null;var n=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Nt);if(!n)return null;var o=null;return i.locale&&!(o=e.parse(i.locale,1,Bt))?null:new _e(r,n,o)},_e.prototype.evaluate=function(t){return new te(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},_e.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},_e.prototype.outputDefined=function(){return!1},_e.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Re=function(t,e){this.type=Nt,this.geojson=t,this.geometries=e};function ze(t){if(t instanceof ve){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Re)return!1;var e=!0;return t.eachChild((function(t){e&&!ze(t)&&(e=!1)})),e}function Fe(t){if(t instanceof ve&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Fe(t)&&(e=!1)})),e}function Be(t,e){if(t instanceof ve&&e.indexOf(t.name)>=0)return!1;var i=!0;return t.eachChild((function(t){i&&!Be(t,e)&&(i=!1)})),i}Re.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(oe(t[1])){var i=t[1];if("FeatureCollection"===i.type)for(var r=0;r<i.features.length;++r){var n=i.features[r].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Re(i,i.features[r].geometry)}else if("Feature"===i.type){var o=i.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Re(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new Re(i,i)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Re.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){var o=Me(e.coordinates,r,n),a=Le(t.geometry(),i,r,n);if(!xe(i,r))return!1;for(var s=0,l=a;s<l.length;s+=1)if(!Ee(l[s],o))return!1}if("MultiPolygon"===e.type){var u=ke(e.coordinates,r,n),c=Le(t.geometry(),i,r,n);if(!xe(i,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Se(p[h],u))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){var o=Me(e.coordinates,r,n),a=Oe(t.geometry(),i,r,n);if(!xe(i,r))return!1;for(var s=0,l=a;s<l.length;s+=1)if(!Pe(l[s],o))return!1}if("MultiPolygon"===e.type){var u=ke(e.coordinates,r,n),c=Oe(t.geometry(),i,r,n);if(!xe(i,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Ie(p[h],u))return!1}return!0}(t,this.geometries)}return!1},Re.prototype.eachChild=function(){},Re.prototype.outputDefined=function(){return!0},Re.prototype.serialize=function(){return["within",this.geojson]};var Ne=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Ne.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var i=t[1];return e.scope.has(i)?new Ne(i,e.scope.get(i)):e.error('Unknown variable "'+i+'". Make sure "'+i+'" has been bound in an enclosing "let" expression before using it.',1)},Ne.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ne.prototype.eachChild=function(){},Ne.prototype.outputDefined=function(){return!1},Ne.prototype.serialize=function(){return["var",this.name]};var je=function(t,e,i,r,n){void 0===e&&(e=[]),void 0===r&&(r=new Rt),void 0===n&&(n=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=r,this.errors=n,this.expectedType=i};function Ue(t,e){for(var i,r=t.length-1,n=0,o=r,a=0;n<=o;)if((i=t[a=Math.floor((n+o)/2)])<=e){if(a===r||e<t[a+1])return a;n=a+1}else{if(!(i>e))throw new ue("Input is not a number.");o=a-1}return 0}je.prototype.parse=function(t,e,i,r,n){return void 0===n&&(n={}),e?this.concat(e,i,r)._parse(t,n):this._parse(t,n)},je.prototype._parse=function(t,e){function i(t,e,i){return"assert"===i?new he(e,[t]):"coerce"===i?new me(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var n=this.registry[r];if(n){var o=n.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=i(o,a,e.typeAnnotation||"coerce");else o=i(o,a,e.typeAnnotation||"assert")}if(!(o instanceof le)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof Ne)return t(e.boundExpression);if(e instanceof ve&&"error"===e.name)return!1;if(e instanceof _e)return!1;if(e instanceof Re)return!1;var i=e instanceof me||e instanceof he,r=!0;return e.eachChild((function(e){r=i?r&&t(e):r&&e instanceof le})),!!r&&ze(e)&&Be(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var l=new ye;try{o=new le(o.type,o.evaluate(l))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},je.prototype.concat=function(t,e,i){var r="number"==typeof t?this.path.concat(t):this.path,n=i?this.scope.concat(i):this.scope;return new je(this.registry,r,e||null,n,this.errors)},je.prototype.error=function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];var r=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Ot(r,t))},je.prototype.checkSubtype=function(t,e){var i=Yt(t,e);return i&&this.error(i),i};var Ve=function(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,n=i;r<n.length;r+=1){var o=n[r],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function Ge(t,e,i){return t*(1-i)+e*i}Ve.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var i=e.parse(t[1],1,Ft);if(!i)return null;var r=[],n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],l=o,u=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(r.length&&r[r.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var c=e.parse(s,u,n);if(!c)return null;n=n||c.type,r.push([a,c])}return new Ve(n,i,r)},Ve.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);var n=e.length;return r>=e[n-1]?i[n-1].evaluate(t):i[Ue(e,r)].evaluate(t)},Ve.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1)t(i[e])},Ve.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ve.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var qe=Object.freeze({__proto__:null,number:Ge,color:function(t,e,i){return new $t(Ge(t.r,e.r,i),Ge(t.g,e.g,i),Ge(t.b,e.b,i),Ge(t.a,e.a,i))},array:function(t,e,i){return t.map((function(t,r){return Ge(t,e[r],i)}))}}),We=6/29*3*(6/29),He=Math.PI/180,Ze=180/Math.PI;function Xe(t){return t>.008856451679035631?Math.pow(t,1/3):t/We+4/29}function Ye(t){return t>6/29?t*t*t:We*(t-4/29)}function Ke(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Je(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qe(t){var e=Je(t.r),i=Je(t.g),r=Je(t.b),n=Xe((.4124564*e+.3575761*i+.1804375*r)/.95047),o=Xe((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Xe((.0193339*e+.119192*i+.9503041*r)/1.08883)),alpha:t.a}}function $e(t){var e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Ye(e),i=.95047*Ye(i),r=1.08883*Ye(r),new $t(Ke(3.2404542*i-1.5371385*e-.4985314*r),Ke(-.969266*i+1.8760108*e+.041556*r),Ke(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function ti(t,e,i){var r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}var ei={forward:Qe,reverse:$e,interpolate:function(t,e,i){return{l:Ge(t.l,e.l,i),a:Ge(t.a,e.a,i),b:Ge(t.b,e.b,i),alpha:Ge(t.alpha,e.alpha,i)}}},ii={forward:function(t){var e=Qe(t),i=e.l,r=e.a,n=e.b,o=Math.atan2(n,r)*Ze;return{h:o<0?o+360:o,c:Math.sqrt(r*r+n*n),l:i,alpha:t.a}},reverse:function(t){var e=t.h*He,i=t.c;return $e({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:ti(t.h,e.h,i),c:Ge(t.c,e.c,i),l:Ge(t.l,e.l,i),alpha:Ge(t.alpha,e.alpha,i)}}},ri=Object.freeze({__proto__:null,lab:ei,hcl:ii}),ni=function(t,e,i,r,n){this.type=t,this.operator=e,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=n;o<a.length;o+=1){var s=a[o],l=s[1];this.labels.push(s[0]),this.outputs.push(l)}};function oi(t,e,i,r){var n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}ni.interpolationFactor=function(t,e,r,n){var o=0;if("exponential"===t.name)o=oi(e,t.base,r,n);else if("linear"===t.name)o=oi(e,1,r,n);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new i(a[0],a[1],a[2],a[3]).solve(oi(e,1,r,n))}return o},ni.parse=function(t,e){var i=t[0],r=t[1],n=t[2],o=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,2,Ft)))return null;var l=[],u=null;"interpolate-hcl"===i||"interpolate-lab"===i?u=jt:e.expectedType&&"value"!==e.expectedType.kind&&(u=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],d=c+3,f=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(l.length&&l[l.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);var m=e.parse(p,f,u);if(!m)return null;u=u||m.type,l.push([h,m])}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"==typeof u.N?new ni(u,i,r,n,l):e.error("Type "+Zt(u)+" is not interpolatable.")},ni.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);var n=e.length;if(r>=e[n-1])return i[n-1].evaluate(t);var o=Ue(e,r),a=ni.interpolationFactor(this.interpolation,r,e[o],e[o+1]),s=i[o].evaluate(t),l=i[o+1].evaluate(t);return"interpolate"===this.operator?qe[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?ii.reverse(ii.interpolate(ii.forward(s),ii.forward(l),a)):ei.reverse(ei.interpolate(ei.forward(s),ei.forward(l),a))},ni.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1)t(i[e])},ni.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},ni.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],i=0;i<this.labels.length;i++)e.push(this.labels[i],this.outputs[i].serialize());return e};var ai=function(t,e){this.type=t,this.args=e};ai.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var i=null,r=e.expectedType;r&&"value"!==r.kind&&(i=r);for(var n=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+n.length,i,void 0,{typeAnnotation:"omit"});if(!s)return null;i=i||s.type,n.push(s)}var l=r&&n.some((function(t){return Yt(r,t.type)}));return new ai(l?Vt:i,n)},ai.prototype.evaluate=function(t){for(var e,i=null,r=0,n=0,o=this.args;n<o.length&&(r++,(i=o[n].evaluate(t))&&i instanceof re&&!i.available&&(e||(e=i.name),i=null,r===this.args.length&&(i=e)),null===i);n+=1);return i},ai.prototype.eachChild=function(t){this.args.forEach(t)},ai.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ai.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var si=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};si.prototype.evaluate=function(t){return this.result.evaluate(t)},si.prototype.eachChild=function(t){for(var e=0,i=this.bindings;e<i.length;e+=1)t(i[e][1]);t(this.result)},si.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var i=[],r=1;r<t.length-1;r+=2){var n=t[r];if("string"!=typeof n)return e.error("Expected string, but found "+typeof n+" instead.",r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=e.parse(t[r+1],r+1);if(!o)return null;i.push([n,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return a?new si(i,a):null},si.prototype.outputDefined=function(){return this.result.outputDefined()},si.prototype.serialize=function(){for(var t=["let"],e=0,i=this.bindings;e<i.length;e+=1){var r=i[e];t.push(r[0],r[1].serialize())}return t.push(this.result.serialize()),t};var li=function(t,e,i){this.type=t,this.index=e,this.input=i};li.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,Ft),r=e.parse(t[2],2,Ht(e.expectedType||Vt));return i&&r?new li(r.type.itemType,i,r):null},li.prototype.evaluate=function(t){var e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ue("Array index out of bounds: "+e+" < 0.");if(e>=i.length)throw new ue("Array index out of bounds: "+e+" > "+(i.length-1)+".");if(e!==Math.floor(e))throw new ue("Array index must be an integer, but found "+e+" instead.");return i[e]},li.prototype.eachChild=function(t){t(this.index),t(this.input)},li.prototype.outputDefined=function(){return!1},li.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ui=function(t,e){this.type=Nt,this.needle=t,this.haystack=e};ui.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,Vt),r=e.parse(t[2],2,Vt);return i&&r?Kt(i.type,[Nt,Bt,Ft,zt,Vt])?new ui(i,r):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(i.type)+" instead"):null},ui.prototype.evaluate=function(t){var e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!Jt(e,["boolean","string","number","null"]))throw new ue("Expected first argument to be of type boolean, string, number or null, but found "+Zt(ae(e))+" instead.");if(!Jt(i,["string","array"]))throw new ue("Expected second argument to be of type array or string, but found "+Zt(ae(i))+" instead.");return i.indexOf(e)>=0},ui.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ui.prototype.outputDefined=function(){return!0},ui.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ci=function(t,e,i){this.type=Ft,this.needle=t,this.haystack=e,this.fromIndex=i};ci.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,Vt),r=e.parse(t[2],2,Vt);if(!i||!r)return null;if(!Kt(i.type,[Nt,Bt,Ft,zt,Vt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(i.type)+" instead");if(4===t.length){var n=e.parse(t[3],3,Ft);return n?new ci(i,r,n):null}return new ci(i,r)},ci.prototype.evaluate=function(t){var e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Jt(e,["boolean","string","number","null"]))throw new ue("Expected first argument to be of type boolean, string, number or null, but found "+Zt(ae(e))+" instead.");if(!Jt(i,["string","array"]))throw new ue("Expected second argument to be of type array or string, but found "+Zt(ae(i))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(t);return i.indexOf(e,r)}return i.indexOf(e)},ci.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},ci.prototype.outputDefined=function(){return!1},ci.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var hi=function(t,e,i,r,n,o){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o};hi.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],l=t[a+1];Array.isArray(s)||(s=[s]);var u=e.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return u.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return u.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,ae(p)))return null}else i=ae(p);if(void 0!==n[String(p)])return u.error("Branch labels must be unique.");n[String(p)]=o.length}var d=e.parse(l,a,r);if(!d)return null;r=r||d.type,o.push(d)}var f=e.parse(t[1],1,Vt);if(!f)return null;var m=e.parse(t[t.length-1],t.length-1,r);return m?"value"!==f.type.kind&&e.concat(1).checkSubtype(i,f.type)?null:new hi(i,r,f,n,o,m):null},hi.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(ae(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},hi.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},hi.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},hi.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],i=[],r={},n=0,o=Object.keys(this.cases).sort();n<o.length;n+=1){var a=o[n];void 0===(h=r[this.cases[a]])?(r[this.cases[a]]=i.length,i.push([this.cases[a],[a]])):i[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},l=0,u=i;l<u.length;l+=1){var c=u[l],h=c[0],p=c[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var pi=function(t,e,i){this.type=t,this.branches=e,this.otherwise=i};pi.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var r=[],n=1;n<t.length-1;n+=2){var o=e.parse(t[n],n,Nt);if(!o)return null;var a=e.parse(t[n+1],n+1,i);if(!a)return null;r.push([o,a]),i=i||a.type}var s=e.parse(t[t.length-1],t.length-1,i);return s?new pi(i,r,s):null},pi.prototype.evaluate=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var r=i[e],n=r[1];if(r[0].evaluate(t))return n.evaluate(t)}return this.otherwise.evaluate(t)},pi.prototype.eachChild=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var r=i[e],n=r[1];t(r[0]),t(n)}t(this.otherwise)},pi.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},pi.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var di=function(t,e,i,r){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=r};function fi(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function mi(t,e,i,r){return 0===r.compare(e,i)}function gi(t,e,i){var r="=="!==t&&"!="!==t;return function(){function n(t,e,i){this.type=Nt,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return n.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var i=t[0],o=e.parse(t[1],1,Vt);if(!o)return null;if(!fi(i,o.type))return e.concat(1).error('"'+i+"\" comparisons are not supported for type '"+Zt(o.type)+"'.");var a=e.parse(t[2],2,Vt);if(!a)return null;if(!fi(i,a.type))return e.concat(2).error('"'+i+"\" comparisons are not supported for type '"+Zt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Zt(o.type)+"' and '"+Zt(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new he(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new he(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Gt)))return null}return new n(o,a,s)},n.prototype.evaluate=function(n){var o=this.lhs.evaluate(n),a=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){var s=ae(o),l=ae(a);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new ue('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+l.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var u=ae(o),c=ae(a);if("string"!==u.kind||"string"!==c.kind)return e(n,o,a)}return this.collator?i(n,o,a,this.collator.evaluate(n)):e(n,o,a)},n.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},n.prototype.outputDefined=function(){return!0},n.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},n}()}di.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,Vt),r=e.parse(t[2],2,Ft);if(!i||!r)return null;if(!Kt(i.type,[Ht(Vt),Bt,Vt]))return e.error("Expected first argument to be of type array or string, but found "+Zt(i.type)+" instead");if(4===t.length){var n=e.parse(t[3],3,Ft);return n?new di(i.type,i,r,n):null}return new di(i.type,i,r)},di.prototype.evaluate=function(t){var e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Jt(e,["string","array"]))throw new ue("Expected first argument to be of type array or string, but found "+Zt(ae(e))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(t);return e.slice(i,r)}return e.slice(i)},di.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},di.prototype.outputDefined=function(){return!1},di.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var yi=gi("==",(function(t,e,i){return e===i}),mi),vi=gi("!=",(function(t,e,i){return e!==i}),(function(t,e,i,r){return!mi(0,e,i,r)})),_i=gi("<",(function(t,e,i){return e<i}),(function(t,e,i,r){return r.compare(e,i)<0})),bi=gi(">",(function(t,e,i){return e>i}),(function(t,e,i,r){return r.compare(e,i)>0})),xi=gi("<=",(function(t,e,i){return e<=i}),(function(t,e,i,r){return r.compare(e,i)<=0})),wi=gi(">=",(function(t,e,i){return e>=i}),(function(t,e,i,r){return r.compare(e,i)>=0})),Ti=function(t,e,i,r,n){this.type=Bt,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n};Ti.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var i=e.parse(t[1],1,Ft);if(!i)return null;var r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");var n=null;if(r.locale&&!(n=e.parse(r.locale,1,Bt)))return null;var o=null;if(r.currency&&!(o=e.parse(r.currency,1,Bt)))return null;var a=null;if(r["min-fraction-digits"]&&!(a=e.parse(r["min-fraction-digits"],1,Ft)))return null;var s=null;return r["max-fraction-digits"]&&!(s=e.parse(r["max-fraction-digits"],1,Ft))?null:new Ti(i,n,o,a,s)},Ti.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ti.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ti.prototype.outputDefined=function(){return!1},Ti.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Ei=function(t){this.type=Ft,this.input=t};Ei.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error("Expected argument of type string or array, but found "+Zt(i.type)+" instead."):new Ei(i):null},Ei.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ue("Expected value to be of type string or array, but found "+Zt(ae(e))+" instead.")},Ei.prototype.eachChild=function(t){t(this.input)},Ei.prototype.outputDefined=function(){return!1},Ei.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Si={"==":yi,"!=":vi,">":bi,"<":_i,">=":wi,"<=":xi,array:he,at:li,boolean:he,case:pi,coalesce:ai,collator:_e,format:pe,image:de,in:ui,"index-of":ci,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:Ei,let:si,literal:le,match:hi,number:he,"number-format":Ti,object:he,slice:di,step:Ve,string:he,"to-boolean":me,"to-color":me,"to-number":me,"to-string":me,var:Ne,within:Re};function Ai(t,e){var i=e[0],r=e[1],n=e[2],o=e[3];i=i.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);var a=o?o.evaluate(t):1,s=ne(i,r,n,a);if(s)throw new ue(s);return new $t(i/255*a,r/255*a,n/255*a,a)}function Ci(t,e){return t in e}function Pi(t,e){var i=e[t];return void 0===i?null:i}function Ii(t){return{type:t}}function Mi(t){return{result:"success",value:t}}function ki(t){return{result:"error",value:t}}function Di(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Li(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Oi(t){return!!t.expression&&t.expression.interpolated}function Ri(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function zi(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Fi(t){return t}function Bi(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Ni(t,e,i,r,n){return Bi(typeof i===n?r[i]:void 0,t.default,e.default)}function ji(t,e,i){if("number"!==Ri(i))return Bi(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];var n=Ue(t.stops.map((function(t){return t[0]})),i);return t.stops[n][1]}function Ui(t,e,i){var r=void 0!==t.base?t.base:1;if("number"!==Ri(i))return Bi(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];var o=Ue(t.stops.map((function(t){return t[0]})),i),a=function(t,e,i,r){var n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(i,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1],u=qe[e.type]||Fi;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=ri[t.colorSpace];u=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=s.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return u(i,r,a)}}:u(s,l,a)}function Vi(t,e,i){return"color"===e.type?i=$t.parse(i):"formatted"===e.type?i=ie.fromString(i.toString()):"resolvedImage"===e.type?i=re.fromString(i.toString()):Ri(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Bi(i,t.default,e.default)}ve.register(Si,{error:[{kind:"error"},[Bt],function(t,e){throw new ue(e[0].evaluate(t))}],typeof:[Bt,[Vt],function(t,e){return Zt(ae(e[0].evaluate(t)))}],"to-rgba":[Ht(Ft,4),[jt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[jt,[Ft,Ft,Ft],Ai],rgba:[jt,[Ft,Ft,Ft,Ft],Ai],has:{type:Nt,overloads:[[[Bt],function(t,e){return Ci(e[0].evaluate(t),t.properties())}],[[Bt,Ut],function(t,e){var i=e[1];return Ci(e[0].evaluate(t),i.evaluate(t))}]]},get:{type:Vt,overloads:[[[Bt],function(t,e){return Pi(e[0].evaluate(t),t.properties())}],[[Bt,Ut],function(t,e){var i=e[1];return Pi(e[0].evaluate(t),i.evaluate(t))}]]},"feature-state":[Vt,[Bt],function(t,e){return Pi(e[0].evaluate(t),t.featureState||{})}],properties:[Ut,[],function(t){return t.properties()}],"geometry-type":[Bt,[],function(t){return t.geometryType()}],id:[Vt,[],function(t){return t.id()}],zoom:[Ft,[],function(t){return t.globals.zoom}],"heatmap-density":[Ft,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ft,[],function(t){return t.globals.lineProgress||0}],accumulated:[Vt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Ft,Ii(Ft),function(t,e){for(var i=0,r=0,n=e;r<n.length;r+=1)i+=n[r].evaluate(t);return i}],"*":[Ft,Ii(Ft),function(t,e){for(var i=1,r=0,n=e;r<n.length;r+=1)i*=n[r].evaluate(t);return i}],"-":{type:Ft,overloads:[[[Ft,Ft],function(t,e){var i=e[1];return e[0].evaluate(t)-i.evaluate(t)}],[[Ft],function(t,e){return-e[0].evaluate(t)}]]},"/":[Ft,[Ft,Ft],function(t,e){var i=e[1];return e[0].evaluate(t)/i.evaluate(t)}],"%":[Ft,[Ft,Ft],function(t,e){var i=e[1];return e[0].evaluate(t)%i.evaluate(t)}],ln2:[Ft,[],function(){return Math.LN2}],pi:[Ft,[],function(){return Math.PI}],e:[Ft,[],function(){return Math.E}],"^":[Ft,[Ft,Ft],function(t,e){var i=e[1];return Math.pow(e[0].evaluate(t),i.evaluate(t))}],sqrt:[Ft,[Ft],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Ft,[Ft],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Ft,[Ft],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Ft,[Ft],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Ft,[Ft],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Ft,[Ft],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Ft,[Ft],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Ft,Ii(Ft),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Ft,Ii(Ft),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Ft,[Ft],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Ft,[Ft],function(t,e){var i=e[0].evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ft,[Ft],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Ft,[Ft],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Nt,[Bt,Vt],function(t,e){var i=e[0],r=e[1];return t.properties()[i.value]===r.value}],"filter-id-==":[Nt,[Vt],function(t,e){var i=e[0];return t.id()===i.value}],"filter-type-==":[Nt,[Bt],function(t,e){var i=e[0];return t.geometryType()===i.value}],"filter-<":[Nt,[Bt,Vt],function(t,e){var i=e[0],r=e[1],n=t.properties()[i.value],o=r.value;return typeof n==typeof o&&n<o}],"filter-id-<":[Nt,[Vt],function(t,e){var i=e[0],r=t.id(),n=i.value;return typeof r==typeof n&&r<n}],"filter->":[Nt,[Bt,Vt],function(t,e){var i=e[0],r=e[1],n=t.properties()[i.value],o=r.value;return typeof n==typeof o&&n>o}],"filter-id->":[Nt,[Vt],function(t,e){var i=e[0],r=t.id(),n=i.value;return typeof r==typeof n&&r>n}],"filter-<=":[Nt,[Bt,Vt],function(t,e){var i=e[0],r=e[1],n=t.properties()[i.value],o=r.value;return typeof n==typeof o&&n<=o}],"filter-id-<=":[Nt,[Vt],function(t,e){var i=e[0],r=t.id(),n=i.value;return typeof r==typeof n&&r<=n}],"filter->=":[Nt,[Bt,Vt],function(t,e){var i=e[0],r=e[1],n=t.properties()[i.value],o=r.value;return typeof n==typeof o&&n>=o}],"filter-id->=":[Nt,[Vt],function(t,e){var i=e[0],r=t.id(),n=i.value;return typeof r==typeof n&&r>=n}],"filter-has":[Nt,[Vt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Nt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Nt,[Ht(Bt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Nt,[Ht(Vt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Nt,[Bt,Ht(Vt)],function(t,e){var i=e[0];return e[1].value.indexOf(t.properties()[i.value])>=0}],"filter-in-large":[Nt,[Bt,Ht(Vt)],function(t,e){var i=e[0],r=e[1];return function(t,e,i,r){for(;i<=r;){var n=i+r>>1;if(e[n]===t)return!0;e[n]>t?r=n-1:i=n+1}return!1}(t.properties()[i.value],r.value,0,r.value.length-1)}],all:{type:Nt,overloads:[[[Nt,Nt],function(t,e){var i=e[1];return e[0].evaluate(t)&&i.evaluate(t)}],[Ii(Nt),function(t,e){for(var i=0,r=e;i<r.length;i+=1)if(!r[i].evaluate(t))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],function(t,e){var i=e[1];return e[0].evaluate(t)||i.evaluate(t)}],[Ii(Nt),function(t,e){for(var i=0,r=e;i<r.length;i+=1)if(r[i].evaluate(t))return!0;return!1}]]},"!":[Nt,[Nt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Nt,[Bt],function(t,e){var i=t.globals&&t.globals.isSupportedScript;return!i||i(e[0].evaluate(t))}],upcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Bt,Ii(Vt),function(t,e){return e.map((function(e){return se(e.evaluate(t))})).join("")}],"resolved-locale":[Bt,[Gt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Gi=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ye,this._defaultValue=e?function(t){return"color"===t.type&&zi(t.default)?new $t(0,0,0,0):"color"===t.type?$t.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function qi(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Si}function Wi(t,e){var i=new je(Si,[],e?function(t){var e={color:jt,string:Bt,number:Ft,enum:Bt,boolean:Nt,formatted:qt,resolvedImage:Wt};return"array"===t.type?Ht(e[t.value]||Vt,t.length):e[t.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Mi(new Gi(r,e)):ki(i.errors)}Gi.prototype.evaluateWithoutErrorHandling=function(t,e,i,r,n,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Gi.prototype.evaluate=function(t,e,i,r,n,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ue("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Hi=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Fe(e.expression)};Hi.prototype.evaluateWithoutErrorHandling=function(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)},Hi.prototype.evaluate=function(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)};var Zi=function(t,e,i,r){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Fe(e.expression),this.interpolationType=r};function Xi(t,e){if("error"===(t=Wi(t,e)).result)return t;var i=t.value.expression,r=ze(i);if(!r&&!Di(e))return ki([new Ot("","data expressions not supported")]);var n=Be(i,["zoom"]);if(!n&&!Li(e))return ki([new Ot("","zoom expressions not supported")]);var o=function t(e){var i=null;if(e instanceof si)i=t(e.result);else if(e instanceof ai)for(var r=0,n=e.args;r<n.length&&!(i=t(n[r]));r+=1);else(e instanceof Ve||e instanceof ni)&&e.input instanceof ve&&"zoom"===e.input.name&&(i=e);return i instanceof Ot||e.eachChild((function(e){var r=t(e);r instanceof Ot?i=r:!i&&r?i=new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&r&&i!==r&&(i=new Ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}(i);return o||n?o instanceof Ot?ki([o]):o instanceof ni&&!Oi(e)?ki([new Ot("",'"interpolate" expressions cannot be used with this property')]):Mi(o?new Zi(r?"camera":"composite",t.value,o.labels,o instanceof ni?o.interpolation:void 0):new Hi(r?"constant":"source",t.value)):ki([new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Zi.prototype.evaluateWithoutErrorHandling=function(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)},Zi.prototype.evaluate=function(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)},Zi.prototype.interpolationFactor=function(t,e,i){return this.interpolationType?ni.interpolationFactor(this.interpolationType,t,e,i):0};var Yi=function(t,e){this._parameters=t,this._specification=e,kt(this,function t(e,i){var r,n,o,a="color"===i.type,s=e.stops&&"object"==typeof e.stops[0][0],l=s||!(s||void 0!==e.property),u=e.type||(Oi(i)?"exponential":"interval");if(a&&((e=kt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],$t.parse(t[1])]}))),e.default=$t.parse(e.default?e.default:i.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ri[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===u)r=Ui;else if("interval"===u)r=ji;else if("categorical"===u){r=Ni,n=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var p=h[c];n[p[0]]=p[1]}o=typeof e.stops[0][0]}else{if("identity"!==u)throw new Error('Unknown function type "'+u+'"');r=Vi}if(s){for(var d={},f=[],m=0;m<e.stops.length;m++){var g=e.stops[m],y=g[0].zoom;void 0===d[y]&&(d[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},f.push(y)),d[y].stops.push([g[0].value,g[1]])}for(var v=[],_=0,b=f;_<b.length;_+=1){var x=b[_];v.push([d[x].zoom,t(d[x],i)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:ni.interpolationFactor.bind(void 0,w),zoomStops:v.map((function(t){return t[0]})),evaluate:function(t,r){var n=t.zoom;return Ui({stops:v,base:e.base},i,n).evaluate(n,r)}}}if(l){var T="exponential"===u?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:ni.interpolationFactor.bind(void 0,T),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return r(e,i,t.zoom,n,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?Bi(e.default,i.default):r(e,i,s,n,o)}}}(this._parameters,this._specification))};function Ki(t){var e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],l=Ri(i);if("object"!==l)return[new It(e,i,"object expected, "+l+" found")];for(var u in i){var c=u.split(".")[0],h=r[c]||r["*"],p=void 0;if(n[c])p=n[c];else if(r[c])p=xr;else if(n["*"])p=n["*"];else{if(!r["*"]){s.push(new It(e,i[u],'unknown property "'+u+'"'));continue}p=xr}s=s.concat(p({key:(e?e+".":e)+u,value:i[u],valueSpec:h,style:o,styleSpec:a,object:i,objectKey:u},i))}for(var d in r)n[d]||r[d].required&&void 0===r[d].default&&void 0===i[d]&&s.push(new It(e,i,'missing required property "'+d+'"'));return s}function Ji(t){var e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,o=t.key,a=t.arrayElementValidator||xr;if("array"!==Ri(e))return[new It(o,e,"array expected, "+Ri(e)+" found")];if(i.length&&e.length!==i.length)return[new It(o,e,"array length "+i.length+" expected, length "+e.length+" found")];if(i["min-length"]&&e.length<i["min-length"])return[new It(o,e,"array length at least "+i["min-length"]+" expected, length "+e.length+" found")];var s={type:i.value,values:i.values};n.$version<7&&(s.function=i.function),"object"===Ri(i.value)&&(s=i.value);for(var l=[],u=0;u<e.length;u++)l=l.concat(a({array:e,arrayIndex:u,value:e[u],valueSpec:s,style:r,styleSpec:n,key:o+"["+u+"]"}));return l}function Qi(t){var e=t.key,i=t.value,r=t.valueSpec,n=Ri(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new It(e,i,"number expected, "+n+" found")]:"minimum"in r&&i<r.minimum?[new It(e,i,i+" is less than the minimum value "+r.minimum)]:"maximum"in r&&i>r.maximum?[new It(e,i,i+" is greater than the maximum value "+r.maximum)]:[]}function $i(t){var e,i,r,n=t.valueSpec,o=Dt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,l=!s,u="array"===Ri(t.value.stops)&&"array"===Ri(t.value.stops[0])&&"object"===Ri(t.value.stops[0][0]),c=Ki({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new It(t.key,t.value,'identity function may not have a "stops" property')];var e=[],i=t.value;return e=e.concat(Ji({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Ri(i)&&0===i.length&&e.push(new It(t.key,i,"array must have at least one stop")),e},default:function(t){return xr({key:t.key,value:t.value,valueSpec:n,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new It(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new It(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!Oi(t.valueSpec)&&c.push(new It(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Di(t.valueSpec)?c.push(new It(t.key,t.value,"property functions not supported")):s&&!Li(t.valueSpec)&&c.push(new It(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!u||void 0!==t.value.property||c.push(new It(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==Ri(o))return[new It(s,o,"array expected, "+Ri(o)+" found")];if(2!==o.length)return[new It(s,o,"array length 2 expected, length "+o.length+" found")];if(u){if("object"!==Ri(o[0]))return[new It(s,o,"object expected, "+Ri(o[0])+" found")];if(void 0===o[0].zoom)return[new It(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new It(s,o,"object stop key must have value")];if(r&&r>Dt(o[0].zoom))return[new It(s,o[0].zoom,"stop zoom values must appear in ascending order")];Dt(o[0].zoom)!==r&&(r=Dt(o[0].zoom),i=void 0,a={}),e=e.concat(Ki({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Qi,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return qi(Lt(o[1]))?e.concat([new It(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(xr({key:s+"[1]",value:o[1],valueSpec:n,style:t.style,styleSpec:t.styleSpec}))}function p(t,r){var s=Ri(t.value),l=Dt(t.value),u=null!==t.value?t.value:r;if(e){if(s!==e)return[new It(t.key,u,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new It(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return Di(n)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(t.key,u,c)]}return"categorical"!==o||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==o&&"number"===s&&void 0!==i&&l<i?[new It(t.key,u,"stop domain values must appear in ascending order")]:(i=l,"categorical"===o&&l in a?[new It(t.key,u,"stop domain values must be unique")]:(a[l]=!0,[])):[new It(t.key,u,"integer expected, found "+l)]}}function tr(t){var e=("property"===t.expressionContext?Xi:Wi)(Lt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new It(""+t.key+e.key,t.value,e.message)}));var i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new It(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Fe(i))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Fe(i))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Be(i,["zoom","feature-state"]))return[new It(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!ze(i))return[new It(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function er(t){var e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(Dt(i))&&n.push(new It(e,i,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(i)+" found")):-1===Object.keys(r.values).indexOf(Dt(i))&&n.push(new It(e,i,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(i)+" found")),n}function ir(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,i=t.slice(1);e<i.length;e+=1){var r=i[e];if(!ir(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Yi.deserialize=function(t){return new Yi(t._parameters,t._specification)},Yi.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var rr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function nr(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};ir(t)||(t=ar(t));var e=Wi(t,rr);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,i,r){return e.value.evaluate(t,i,{},r)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var i=1;i<e.length;i++)if(t(e[i]))return!0;return!1}(t)}}function or(t,e){return t<e?-1:t>e?1:0}function ar(t){if(!t)return!0;var e,i=t[0];return t.length<=1?"any"!==i:"=="===i?sr(t[1],t[2],"=="):"!="===i?cr(sr(t[1],t[2],"==")):"<"===i||">"===i||"<="===i||">="===i?sr(t[1],t[2],i):"any"===i?(e=t.slice(1),["any"].concat(e.map(ar))):"all"===i?["all"].concat(t.slice(1).map(ar)):"none"===i?["all"].concat(t.slice(1).map(ar).map(cr)):"in"===i?lr(t[1],t.slice(2)):"!in"===i?cr(lr(t[1],t.slice(2))):"has"===i?ur(t[1]):"!has"===i?cr(ur(t[1])):"within"!==i||t}function sr(t,e,i){switch(t){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,t,e]}}function lr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(or)]]:["filter-in-small",t,["literal",e]]}}function ur(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function cr(t){return["!",t]}function hr(t){return ir(Lt(t.value))?tr(kt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var i=e.value,r=e.key;if("array"!==Ri(i))return[new It(r,i,"array expected, "+Ri(i)+" found")];var n,o=e.styleSpec,a=[];if(i.length<1)return[new It(r,i,"filter array must have at least 1 element")];switch(a=a.concat(er({key:r+"[0]",value:i[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Dt(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Dt(i[1])&&a.push(new It(r,i,'"$type" cannot be use with operator "'+i[0]+'"'));case"==":case"!=":3!==i.length&&a.push(new It(r,i,'filter array for operator "'+i[0]+'" must have 3 elements'));case"in":case"!in":i.length>=2&&"string"!==(n=Ri(i[1]))&&a.push(new It(r+"[1]",i[1],"string expected, "+n+" found"));for(var s=2;s<i.length;s++)n=Ri(i[s]),"$type"===Dt(i[1])?a=a.concat(er({key:r+"["+s+"]",value:i[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&a.push(new It(r+"["+s+"]",i[s],"string, number, or boolean expected, "+n+" found"));break;case"any":case"all":case"none":for(var l=1;l<i.length;l++)a=a.concat(t({key:r+"["+l+"]",value:i[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=Ri(i[1]),2!==i.length?a.push(new It(r,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"string"!==n&&a.push(new It(r+"[1]",i[1],"string expected, "+n+" found"));break;case"within":n=Ri(i[1]),2!==i.length?a.push(new It(r,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"object"!==n&&a.push(new It(r+"[1]",i[1],"object expected, "+n+" found"))}return a}(t)}function pr(t,e){var i=t.key,r=t.style,n=t.styleSpec,o=t.value,a=t.objectKey,s=n[e+"_"+t.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return xr({key:i,value:o,valueSpec:n.transition,style:r,styleSpec:n});var u,c=t.valueSpec||s[a];if(!c)return[new It(i,o,'unknown property "'+a+'"')];if("string"===Ri(o)&&Di(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new It(i,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(u[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new It(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&zi(Lt(o))&&"identity"===Dt(o.type)&&h.push(new It(i,o,'"text-font" does not support identity functions'))),h.concat(xr({key:t.key,value:o,valueSpec:c,style:r,styleSpec:n,expressionContext:"property",propertyType:e,propertyKey:a}))}function dr(t){return pr(t,"paint")}function fr(t){return pr(t,"layout")}function mr(t){var e=[],i=t.value,r=t.key,n=t.style,o=t.styleSpec;i.type||i.ref||e.push(new It(r,i,'either "type" or "ref" is required'));var a,s=Dt(i.type),l=Dt(i.ref);if(i.id)for(var u=Dt(i.id),c=0;c<t.arrayIndex;c++){var h=n.layers[c];Dt(h.id)===u&&e.push(new It(r,i.id,'duplicate layer id "'+i.id+'", previously used at line '+h.id.__line__))}if("ref"in i)["type","source","source-layer","filter","layout"].forEach((function(t){t in i&&e.push(new It(r,i[t],'"'+t+'" is prohibited for ref layers'))})),n.layers.forEach((function(t){Dt(t.id)===l&&(a=t)})),a?a.ref?e.push(new It(r,i.ref,"ref cannot reference another ref layer")):s=Dt(a.type):e.push(new It(r,i.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(i.source){var p=n.sources&&n.sources[i.source],d=p&&Dt(p.type);p?"vector"===d&&"raster"===s?e.push(new It(r,i.source,'layer "'+i.id+'" requires a raster source')):"raster"===d&&"raster"!==s?e.push(new It(r,i.source,'layer "'+i.id+'" requires a vector source')):"vector"!==d||i["source-layer"]?"raster-dem"===d&&"hillshade"!==s?e.push(new It(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===d&&p.lineMetrics||e.push(new It(r,i,'layer "'+i.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new It(r,i,'layer "'+i.id+'" must specify a "source-layer"')):e.push(new It(r,i.source,'source "'+i.source+'" not found'))}else e.push(new It(r,i,'missing required property "source"'));return e=e.concat(Ki({key:r,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return xr({key:r+".type",value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"})},filter:hr,layout:function(t){return Ki({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return fr(kt({layerType:s},t))}}})},paint:function(t){return Ki({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return dr(kt({layerType:s},t))}}})}}}))}function gr(t){var e=t.value,i=t.key,r=Ri(e);return"string"!==r?[new It(i,e,"string expected, "+r+" found")]:[]}var yr={promoteId:function(t){var e=t.key,i=t.value;if("string"===Ri(i))return gr({key:e,value:i});var r=[];for(var n in i)r.push.apply(r,gr({key:e+"."+n,value:i[n]}));return r}};function vr(t){var e=t.value,i=t.key,r=t.styleSpec,n=t.style;if(!e.type)return[new It(i,e,'"type" is required')];var o,a=Dt(e.type);switch(a){case"vector":case"raster":case"raster-dem":return Ki({key:i,value:e,valueSpec:r["source_"+a.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:yr});case"geojson":if(o=Ki({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:yr}),e.cluster)for(var s in e.clusterProperties){var l=e.clusterProperties[s],u=l[0],c="string"==typeof u?[u,["accumulated"],["get",s]]:u;o.push.apply(o,tr({key:i+"."+s+".map",value:l[1],expressionContext:"cluster-map"})),o.push.apply(o,tr({key:i+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return Ki({key:i,value:e,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return Ki({key:i,value:e,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new It(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return er({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:r})}}function _r(t){var e=t.value,i=t.styleSpec,r=i.light,n=t.style,o=[],a=Ri(e);if(void 0===e)return o;if("object"!==a)return o.concat([new It("light",e,"object expected, "+a+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);o=o.concat(l&&r[l[1]]&&r[l[1]].transition?xr({key:s,value:e[s],valueSpec:i.transition,style:n,styleSpec:i}):r[s]?xr({key:s,value:e[s],valueSpec:r[s],style:n,styleSpec:i}):[new It(s,e[s],'unknown property "'+s+'"')])}return o}var br={"*":function(){return[]},array:Ji,boolean:function(t){var e=t.value,i=t.key,r=Ri(e);return"boolean"!==r?[new It(i,e,"boolean expected, "+r+" found")]:[]},number:Qi,color:function(t){var e=t.key,i=t.value,r=Ri(i);return"string"!==r?[new It(e,i,"color expected, "+r+" found")]:null===Qt(i)?[new It(e,i,'color expected, "'+i+'" found')]:[]},constants:Mt,enum:er,filter:hr,function:$i,layer:mr,object:Ki,source:vr,light:_r,string:gr,formatted:function(t){return 0===gr(t).length?[]:tr(t)},resolvedImage:function(t){return 0===gr(t).length?[]:tr(t)}};function xr(t){var e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&zi(Dt(e))?$i(t):i.expression&&qi(Lt(e))?tr(t):i.type&&br[i.type]?br[i.type](t):Ki(kt({},t,{valueSpec:i.type?r[i.type]:i}))}function wr(t){var e=t.value,i=t.key,r=gr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new It(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new It(i,e,'"glyphs" url must include a "{range}" token'))),r}function Tr(t,e){void 0===e&&(e=Pt);var i=[];return i=i.concat(xr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:wr,"*":function(){return[]}}})),t.constants&&(i=i.concat(Mt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Er(i)}function Er(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Sr(t){return function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];return Er(t.apply(this,e))}}Tr.source=Sr(vr),Tr.light=Sr(_r),Tr.layer=Sr(mr),Tr.filter=Sr(hr),Tr.paintProperty=Sr(dr),Tr.layoutProperty=Sr(fr);var Ar=Tr,Cr=Ar.light,Pr=Ar.paintProperty,Ir=Ar.layoutProperty;function Mr(t,e){var i=!1;if(e&&e.length)for(var r=0,n=e;r<n.length;r+=1)t.fire(new At(new Error(n[r].message))),i=!0;return i}var kr=Dr;function Dr(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(var o=0;o<this.d*this.d;o++){var a=n[3+o],s=n[3+o+1];r.push(a===s?null:n.subarray(a,s))}var l=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var u=0;u<this.d*this.d;u++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var c=i/e*t;this.min=-c,this.max=t+c}Dr.prototype.insert=function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},Dr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dr.prototype._insertCell=function(t,e,i,r,n,o){this.cells[n].push(o)},Dr.prototype.query=function(t,e,i,r,n){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=i&&a<=r&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,i,r,this._queryCell,s,{},n),s},Dr.prototype._queryCell=function(t,e,i,r,n,o,a,s){var l=this.cells[n];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===a[p]){var d=4*p;(s?s(c[d+0],c[d+1],c[d+2],c[d+3]):t<=c[d+2]&&e<=c[d+3]&&i>=c[d+0]&&r>=c[d+1])?(a[p]=!0,o.push(u[p])):a[p]=!1}}},Dr.prototype._forEachCell=function(t,e,i,r,n,o,a,s){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),c=this._convertToCellCoord(i),h=this._convertToCellCoord(r),p=l;p<=c;p++)for(var d=u;d<=h;d++){var f=this.d*d+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&n.call(this,t,e,i,r,f,o,a,s))return}},Dr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Dr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Dr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];n[3+a]=o,n.set(s,o),o+=s.length}return n[3+t.length]=o,n.set(this.keys,o),n[3+t.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var Lr=a.ImageData,Or=a.ImageBitmap,Rr={};function zr(t,e,i){void 0===i&&(i={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Rr[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}for(var Fr in zr("Object",Object),kr.serialize=function(t,e){var i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},kr.deserialize=function(t){return new kr(t.buffer)},zr("Grid",kr),zr("Color",$t),zr("Error",Error),zr("ResolvedImage",re),zr("StylePropertyFunction",Yi),zr("StyleExpression",Gi,{omit:["_evaluator"]}),zr("ZoomDependentExpression",Zi),zr("ZoomConstantExpression",Hi),zr("CompoundExpression",ve,{omit:["_evaluate"]}),Si)Si[Fr]._classRegistryKey||zr("Expression_"+Fr,Si[Fr]);function Br(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Nr(t){return Or&&t instanceof Or}function jr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Br(t)||Nr(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var i=t;return e&&e.push(i.buffer),i}if(t instanceof Lr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],n=0,o=t;n<o.length;n+=1)r.push(jr(o[n],e));return r}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var l=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var u in t)if(t.hasOwnProperty(u)&&!(Rr[s].omit.indexOf(u)>=0)){var c=t[u];l[u]=Rr[s].shallow.indexOf(u)>=0?c:jr(c,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function Ur(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Br(t)||Nr(t)||ArrayBuffer.isView(t)||t instanceof Lr)return t;if(Array.isArray(t))return t.map(Ur);if("object"==typeof t){var e=t.$name||"Object",i=Rr[e].klass;if(!i)throw new Error("can't deserialize unregistered class "+e);if(i.deserialize)return i.deserialize(t);for(var r=Object.create(i.prototype),n=0,o=Object.keys(t);n<o.length;n+=1){var a=o[n];if("$name"!==a){var s=t[a];r[a]=Rr[e].shallow.indexOf(a)>=0?s:Ur(s)}}return r}throw new Error("can't deserialize object of type "+typeof t)}var Vr=function(){this.first=!0};Vr.prototype.update=function(t,e){var i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))};var Gr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function qr(t){for(var e=0,i=t;e<i.length;e+=1)if(Wr(i[e].charCodeAt(0)))return!0;return!1}function Wr(t){return!(746!==t&&747!==t&&(t<4352||!(Gr["Bopomofo Extended"](t)||Gr.Bopomofo(t)||Gr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Gr["CJK Compatibility Ideographs"](t)||Gr["CJK Compatibility"](t)||Gr["CJK Radicals Supplement"](t)||Gr["CJK Strokes"](t)||!(!Gr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Gr["CJK Unified Ideographs Extension A"](t)||Gr["CJK Unified Ideographs"](t)||Gr["Enclosed CJK Letters and Months"](t)||Gr["Hangul Compatibility Jamo"](t)||Gr["Hangul Jamo Extended-A"](t)||Gr["Hangul Jamo Extended-B"](t)||Gr["Hangul Jamo"](t)||Gr["Hangul Syllables"](t)||Gr.Hiragana(t)||Gr["Ideographic Description Characters"](t)||Gr.Kanbun(t)||Gr["Kangxi Radicals"](t)||Gr["Katakana Phonetic Extensions"](t)||Gr.Katakana(t)&&12540!==t||!(!Gr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Gr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Gr["Unified Canadian Aboriginal Syllabics"](t)||Gr["Unified Canadian Aboriginal Syllabics Extended"](t)||Gr["Vertical Forms"](t)||Gr["Yijing Hexagram Symbols"](t)||Gr["Yi Syllables"](t)||Gr["Yi Radicals"](t))))}function Hr(t){return!(Wr(t)||function(t){return!!(Gr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Gr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Gr["Letterlike Symbols"](t)||Gr["Number Forms"](t)||Gr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gr["Control Pictures"](t)&&9251!==t||Gr["Optical Character Recognition"](t)||Gr["Enclosed Alphanumerics"](t)||Gr["Geometric Shapes"](t)||Gr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gr["CJK Symbols and Punctuation"](t)||Gr.Katakana(t)||Gr["Private Use Area"](t)||Gr["CJK Compatibility Forms"](t)||Gr["Small Form Variants"](t)||Gr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Zr(t){return t>=1424&&t<=2303||Gr["Arabic Presentation Forms-A"](t)||Gr["Arabic Presentation Forms-B"](t)}function Xr(t,e){return!(!e&&Zr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Gr.Khmer(t))}function Yr(t){for(var e=0,i=t;e<i.length;e+=1)if(Zr(i[e].charCodeAt(0)))return!0;return!1}var Kr=null,Jr="unavailable",Qr=null,$r=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Jr="error"),Kr&&Kr(t)};function tn(){en.fire(new St("pluginStateChange",{pluginStatus:Jr,pluginURL:Qr}))}var en=new Ct,rn=function(){return Jr},nn=function(){if("deferred"!==Jr||!Qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jr="loading",tn(),Qr&&bt({url:Qr},(function(t){t?$r(t):(Jr="loaded",tn())}))},on={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===Jr||null!=on.applyArabicShaping},isLoading:function(){return"loading"===Jr},setState:function(t){Jr=t.pluginStatus,Qr=t.pluginURL},isParsed:function(){return null!=on.applyArabicShaping&&null!=on.processBidirectionalText&&null!=on.processStyledBidirectionalText},getPluginURL:function(){return Qr}},an=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vr,this.transition={})};an.prototype.isSupportedScript=function(t){return function(t,e){for(var i=0,r=t;i<r.length;i+=1)if(!Xr(r[i].charCodeAt(0),e))return!1;return!0}(t,on.isLoaded())},an.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},an.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}};var sn=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(zi(t))return new Yi(t,e);if(qi(t)){var i=Xi(t,e);if("error"===i.result)throw new Error(i.value.map((function(t){return t.key+": "+t.message})).join(", "));return i.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=$t.parse(t)),{kind:"constant",evaluate:function(){return r}}}(void 0===e?t.specification.default:e,t.specification)};sn.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},sn.prototype.possiblyEvaluate=function(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)};var ln=function(t){this.property=t,this.value=new sn(t,void 0)};ln.prototype.transitioned=function(t,e){return new cn(this.property,this.value,e,p({},t.transition,this.transition),t.now)},ln.prototype.untransitioned=function(){return new cn(this.property,this.value,null,{},0)};var un=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};un.prototype.getValue=function(t){return x(this._values[t].value.value)},un.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ln(this._values[t].property)),this._values[t].value=new sn(this._values[t].property,null===e?void 0:x(e))},un.prototype.getTransition=function(t){return x(this._values[t].transition)},un.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ln(this._values[t].property)),this._values[t].transition=x(e)||void 0},un.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var r=i[e],n=this.getValue(r);void 0!==n&&(t[r]=n);var o=this.getTransition(r);void 0!==o&&(t[r+"-transition"]=o)}return t},un.prototype.transitioned=function(t,e){for(var i=new hn(this._properties),r=0,n=Object.keys(this._values);r<n.length;r+=1){var o=n[r];i._values[o]=this._values[o].transitioned(t,e._values[o])}return i},un.prototype.untransitioned=function(){for(var t=new hn(this._properties),e=0,i=Object.keys(this._values);e<i.length;e+=1){var r=i[e];t._values[r]=this._values[r].untransitioned()}return t};var cn=function(t,e,i,r,n){this.property=t,this.value=e,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)};cn.prototype.possiblyEvaluate=function(t,e,i){var r=t.now||0,n=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(t,e,i);var a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),n,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(a))}return n};var hn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};hn.prototype.possiblyEvaluate=function(t,e,i){for(var r=new fn(this._properties),n=0,o=Object.keys(this._values);n<o.length;n+=1){var a=o[n];r._values[a]=this._values[a].possiblyEvaluate(t,e,i)}return r},hn.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var pn=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};pn.prototype.getValue=function(t){return x(this._values[t].value)},pn.prototype.setValue=function(t,e){this._values[t]=new sn(this._values[t].property,null===e?void 0:x(e))},pn.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var r=i[e],n=this.getValue(r);void 0!==n&&(t[r]=n)}return t},pn.prototype.possiblyEvaluate=function(t,e,i){for(var r=new fn(this._properties),n=0,o=Object.keys(this._values);n<o.length;n+=1){var a=o[n];r._values[a]=this._values[a].possiblyEvaluate(t,e,i)}return r};var dn=function(t,e,i){this.property=t,this.value=e,this.parameters=i};dn.prototype.isConstant=function(){return"constant"===this.value.kind},dn.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},dn.prototype.evaluate=function(t,e,i,r){return this.property.evaluate(this.value,this.parameters,t,e,i,r)};var fn=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};fn.prototype.get=function(t){return this._values[t]};var mn=function(t){this.specification=t};mn.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},mn.prototype.interpolate=function(t,e,i){var r=qe[this.specification.type];return r?r(t,e,i):t};var gn=function(t,e){this.specification=t,this.overrides=e};gn.prototype.possiblyEvaluate=function(t,e,i,r){return new dn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,r)}:t.expression,e)},gn.prototype.interpolate=function(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new dn(this,{kind:"constant",value:void 0},t.parameters);var r=qe[this.specification.type];return r?new dn(this,{kind:"constant",value:r(t.value.value,e.value.value,i)},t.parameters):t},gn.prototype.evaluate=function(t,e,i,r,n,o){return"constant"===t.kind?t.value:t.evaluate(e,i,r,n,o)};var yn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,i,r){if(void 0===t.value)return new dn(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var n=t.expression.evaluate(e,null,{},i,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof n?n.name:n,a=this._calculate(o,o,o,e);return new dn(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new dn(this,{kind:"constant",value:s},e)}return new dn(this,t.expression,e)},e.prototype.evaluate=function(t,e,i,r,n,o){if("source"===t.kind){var a=t.evaluate(e,i,r,n,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,r),t.evaluate({zoom:Math.floor(e.zoom)},i,r),t.evaluate({zoom:Math.floor(e.zoom)+1},i,r),e):t.value},e.prototype._calculate=function(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}},e.prototype.interpolate=function(t){return t},e}(gn),vn=function(t){this.specification=t};vn.prototype.possiblyEvaluate=function(t,e,i,r){if(void 0!==t.value){if("constant"===t.expression.kind){var n=t.expression.evaluate(e,null,{},i,r);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new an(Math.floor(e.zoom-1),e)),t.expression.evaluate(new an(Math.floor(e.zoom),e)),t.expression.evaluate(new an(Math.floor(e.zoom+1),e)),e)}},vn.prototype._calculate=function(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}},vn.prototype.interpolate=function(t){return t};var _n=function(t){this.specification=t};_n.prototype.possiblyEvaluate=function(t,e,i,r){return!!t.expression.evaluate(e,null,{},i,r)},_n.prototype.interpolate=function(){return!1};var bn=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var i=t[e];i.specification.overridable&&this.overridableProperties.push(e);var r=this.defaultPropertyValues[e]=new sn(i,void 0),n=this.defaultTransitionablePropertyValues[e]=new ln(i);this.defaultTransitioningPropertyValues[e]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}};zr("DataDrivenProperty",gn),zr("DataConstantProperty",mn),zr("CrossFadedDataDrivenProperty",yn),zr("CrossFadedProperty",vn),zr("ColorRampProperty",_n);var xn=function(t){function e(e,i){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new pn(i.layout)),i.paint)){for(var r in this._transitionablePaint=new un(i.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fn(i.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,i){void 0===i&&(i={}),null!=e&&this._validate(Ir,"layers."+this.id+".layout."+t,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return v(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,i){if(void 0===i&&(i={}),null!=e&&this._validate(Pr,"layers."+this.id+".paint."+t,t,e,i))return!1;if(v(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var r=this._transitionablePaint._values[t],n="cross-faded-data-driven"===r.property.specification["property-type"],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||n||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,i){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),b(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,i,r,n){return void 0===n&&(n={}),(!n||!1!==n.validate)&&Mr(this,t.call(Ar,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof dn&&Di(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(Ct),wn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Tn=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},En=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Sn(t,e){void 0===e&&(e=1);var i=0,r=0;return{members:t.map((function(t){var n=wn[t.type].BYTES_PER_ELEMENT,o=i=An(i,Math.max(e,n)),a=t.components||1;return r=Math.max(r,n),i+=n*a,{name:t.name,type:t.type,components:a,offset:o}})),size:An(i,Math.max(r,e)),alignment:e}}function An(t,e){return Math.ceil(t/e)*e}En.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},En.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},En.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},En.prototype.clear=function(){this.length=0},En.prototype.resize=function(t){this.reserve(t),this.length=t},En.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},En.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Cn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)},e.prototype.emplace=function(t,e,i){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t},e}(En);Cn.prototype.bytesPerElement=4,zr("StructArrayLayout2i4",Cn);var Pn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)},e.prototype.emplace=function(t,e,i,r,n){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,t},e}(En);Pn.prototype.bytesPerElement=8,zr("StructArrayLayout4i8",Pn);var In=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o)},e.prototype.emplace=function(t,e,i,r,n,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(En);In.prototype.bytesPerElement=12,zr("StructArrayLayout2i4i12",In);var Mn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o)},e.prototype.emplace=function(t,e,i,r,n,o,a){var s=4*t,l=8*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.uint8[l+4]=r,this.uint8[l+5]=n,this.uint8[l+6]=o,this.uint8[l+7]=a,t},e}(En);Mn.prototype.bytesPerElement=8,zr("StructArrayLayout2i4ub8",Mn);var kn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)},e.prototype.emplace=function(t,e,i){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t},e}(En);kn.prototype.bytesPerElement=8,zr("StructArrayLayout2f8",kn);var Dn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o,a,s,l,u){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,i,r,n,o,a,s,l,u)},e.prototype.emplace=function(t,e,i,r,n,o,a,s,l,u,c){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=u,this.uint16[h+9]=c,t},e}(En);Dn.prototype.bytesPerElement=20,zr("StructArrayLayout10ui20",Dn);var Ln=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o,a,s,l,u,c,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,r,n,o,a,s,l,u,c,h)},e.prototype.emplace=function(t,e,i,r,n,o,a,s,l,u,c,h,p){var d=12*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.int16[d+2]=r,this.int16[d+3]=n,this.uint16[d+4]=o,this.uint16[d+5]=a,this.uint16[d+6]=s,this.uint16[d+7]=l,this.int16[d+8]=u,this.int16[d+9]=c,this.int16[d+10]=h,this.int16[d+11]=p,t},e}(En);Ln.prototype.bytesPerElement=24,zr("StructArrayLayout4i4ui4i24",Ln);var On=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)},e.prototype.emplace=function(t,e,i,r){var n=3*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t},e}(En);On.prototype.bytesPerElement=12,zr("StructArrayLayout3f12",On);var Rn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(En);Rn.prototype.bytesPerElement=4,zr("StructArrayLayout1ul4",Rn);var zn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o,a,s,l){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,r,n,o,a,s,l)},e.prototype.emplace=function(t,e,i,r,n,o,a,s,l,u){var c=10*t,h=5*t;return this.int16[c+0]=e,this.int16[c+1]=i,this.int16[c+2]=r,this.int16[c+3]=n,this.int16[c+4]=o,this.int16[c+5]=a,this.uint32[h+3]=s,this.uint16[c+8]=l,this.uint16[c+9]=u,t},e}(En);zn.prototype.bytesPerElement=20,zr("StructArrayLayout6i1ul2ui20",zn);var Fn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o)},e.prototype.emplace=function(t,e,i,r,n,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(En);Fn.prototype.bytesPerElement=12,zr("StructArrayLayout2i2i2i12",Fn);var Bn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)},e.prototype.emplace=function(t,e,i,r,n,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=i,this.float32[a+2]=r,this.int16[s+6]=n,this.int16[s+7]=o,t},e}(En);Bn.prototype.bytesPerElement=16,zr("StructArrayLayout2f1f2i16",Bn);var Nn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)},e.prototype.emplace=function(t,e,i,r,n){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[a+1]=r,this.float32[a+2]=n,t},e}(En);Nn.prototype.bytesPerElement=12,zr("StructArrayLayout2ub2f12",Nn);var jn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)},e.prototype.emplace=function(t,e,i,r){var n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,this.uint16[n+2]=r,t},e}(En);jn.prototype.bytesPerElement=6,zr("StructArrayLayout3ui6",jn);var Un=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m,g){var y=this.length;return this.resize(y+1),this.emplace(y,t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m,g)},e.prototype.emplace=function(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m,g,y){var v=24*t,_=12*t,b=48*t;return this.int16[v+0]=e,this.int16[v+1]=i,this.uint16[v+2]=r,this.uint16[v+3]=n,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[v+10]=l,this.uint16[v+11]=u,this.uint16[v+12]=c,this.float32[_+7]=h,this.float32[_+8]=p,this.uint8[b+36]=d,this.uint8[b+37]=f,this.uint8[b+38]=m,this.uint32[_+10]=g,this.int16[v+22]=y,t},e}(En);Un.prototype.bytesPerElement=48,zr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Un);var Vn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m,g,y,v,_,b,x,w,T,E,S,A,C){var P=this.length;return this.resize(P+1),this.emplace(P,t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m,g,y,v,_,b,x,w,T,E,S,A,C)},e.prototype.emplace=function(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m,g,y,v,_,b,x,w,T,E,S,A,C,P){var I=34*t,M=17*t;return this.int16[I+0]=e,this.int16[I+1]=i,this.int16[I+2]=r,this.int16[I+3]=n,this.int16[I+4]=o,this.int16[I+5]=a,this.int16[I+6]=s,this.int16[I+7]=l,this.uint16[I+8]=u,this.uint16[I+9]=c,this.uint16[I+10]=h,this.uint16[I+11]=p,this.uint16[I+12]=d,this.uint16[I+13]=f,this.uint16[I+14]=m,this.uint16[I+15]=g,this.uint16[I+16]=y,this.uint16[I+17]=v,this.uint16[I+18]=_,this.uint16[I+19]=b,this.uint16[I+20]=x,this.uint16[I+21]=w,this.uint16[I+22]=T,this.uint32[M+12]=E,this.float32[M+13]=S,this.float32[M+14]=A,this.float32[M+15]=C,this.float32[M+16]=P,t},e}(En);Vn.prototype.bytesPerElement=68,zr("StructArrayLayout8i15ui1ul4f68",Vn);var Gn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(En);Gn.prototype.bytesPerElement=4,zr("StructArrayLayout1f4",Gn);var qn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)},e.prototype.emplace=function(t,e,i,r){var n=3*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,t},e}(En);qn.prototype.bytesPerElement=6,zr("StructArrayLayout3i6",qn);var Wn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)},e.prototype.emplace=function(t,e,i,r){var n=4*t;return this.uint32[2*t+0]=e,this.uint16[n+2]=i,this.uint16[n+3]=r,t},e}(En);Wn.prototype.bytesPerElement=8,zr("StructArrayLayout1ul2ui8",Wn);var Hn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)},e.prototype.emplace=function(t,e,i){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t},e}(En);Hn.prototype.bytesPerElement=4,zr("StructArrayLayout2ui4",Hn);var Zn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(En);Zn.prototype.bytesPerElement=2,zr("StructArrayLayout1ui2",Zn);var Xn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)},e.prototype.emplace=function(t,e,i,r,n){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,t},e}(En);Xn.prototype.bytesPerElement=16,zr("StructArrayLayout4f16",Xn);var Yn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return i.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},i.x1.get=function(){return this._structArray.int16[this._pos2+2]},i.y1.get=function(){return this._structArray.int16[this._pos2+3]},i.x2.get=function(){return this._structArray.int16[this._pos2+4]},i.y2.get=function(){return this._structArray.int16[this._pos2+5]},i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.anchorPoint.get=function(){return new n(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,i),e}(Tn);Yn.prototype.size=20;var Kn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Yn(this,t)},e}(zn);zr("CollisionBoxArray",Kn);var Jn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},i.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},i.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},i.segment.get=function(){return this._structArray.uint16[this._pos2+10]},i.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},i.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},i.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},i.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},i.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},i.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},i.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},i.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},i.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},i.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},i.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},i.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,i),e}(Tn);Jn.prototype.size=48;var Qn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Jn(this,t)},e}(Un);zr("PlacedSymbolArray",Qn);var $n=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},i.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},i.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},i.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},i.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},i.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},i.key.get=function(){return this._structArray.uint16[this._pos2+8]},i.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},i.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},i.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},i.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},i.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},i.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},i.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},i.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},i.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},i.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},i.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},i.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},i.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},i.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},i.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},i.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},i.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},i.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},i.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,i),e}(Tn);$n.prototype.size=68;var to=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new $n(this,t)},e}(Vn);zr("SymbolInstanceArray",to);var eo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Gn);zr("GlyphOffsetArray",eo);var io=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(qn);zr("SymbolLineVertexArray",io);var ro=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,i),e}(Tn);ro.prototype.size=8;var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new ro(this,t)},e}(Wn);zr("FeatureIndexArray",no);var oo=Sn([{name:"a_pos",components:2,type:"Int16"}],4).members,ao=function(t){void 0===t&&(t=[]),this.segments=t};function so(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)}ao.prototype.prepareSegment=function(t,e,i,r){var n=this.segments[this.segments.length-1];return t>ao.MAX_VERTEX_ARRAY_LENGTH&&T("Max vertices per segment is "+ao.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!n||n.vertexLength+t>ao.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n},ao.prototype.get=function(){return this.segments},ao.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var i=e[t];for(var r in i.vaos)i.vaos[r].destroy()}},ao.simpleSegment=function(t,e,i,r){return new ao([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])},ao.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zr("SegmentVector",ao);var lo=Sn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),uo=e((function(t){t.exports=function(t,e){var i,r,n,o,a,s,l,u;for(r=t.length-(i=3&t.length),n=e,a=3432918353,s=461845907,u=0;u<r;)l=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}})),co=e((function(t){t.exports=function(t,e){for(var i,r=t.length,n=e^r,o=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}})),ho=uo,po=co;ho.murmur3=uo,ho.murmur2=po;var fo=function(){this.ids=[],this.positions=[],this.indexed=!1};fo.prototype.add=function(t,e,i,r){this.ids.push(go(t)),this.positions.push(e,i,r)},fo.prototype.getPositions=function(t){for(var e=go(t),i=0,r=this.ids.length-1;i<r;){var n=i+r>>1;this.ids[n]>=e?r=n:i=n+1}for(var o=[];this.ids[i]===e;)o.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return o},fo.serialize=function(t,e){var i=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,i,r,n){for(;r<n;){for(var o=e[r+n>>1],a=r-1,s=n+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;yo(e,a,s),yo(i,3*a,3*s),yo(i,3*a+1,3*s+1),yo(i,3*a+2,3*s+2)}s-r<n-s?(t(e,i,r,s),r=s+1):(t(e,i,s+1,n),n=s)}}(i,r,0,i.length-1),e&&e.push(i.buffer,r.buffer),{ids:i,positions:r}},fo.deserialize=function(t){var e=new fo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var mo=Math.pow(2,53)-1;function go(t){var e=+t;return!isNaN(e)&&e<=mo?e:ho(String(t))}function yo(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}zr("FeaturePositionMap",fo);var vo=function(t,e){this.gl=t.gl,this.location=e},_o=function(t){function e(e,i){t.call(this,e,i),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(vo),bo=function(t){function e(e,i){t.call(this,e,i),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(vo),xo=function(t){function e(e,i){t.call(this,e,i),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(vo),wo=function(t){function e(e,i){t.call(this,e,i),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(vo),To=function(t){function e(e,i){t.call(this,e,i),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(vo),Eo=function(t){function e(e,i){t.call(this,e,i),this.current=$t.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(vo),So=new Float32Array(16),Ao=function(t){function e(e,i){t.call(this,e,i),this.current=So}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(vo);function Co(t){return[so(255*t.r,255*t.g),so(255*t.b,255*t.a)]}var Po=function(t,e,i){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=i};Po.prototype.setUniform=function(t,e,i){t.set(i.constantOr(this.value))},Po.prototype.getBinding=function(t,e,i){return"color"===this.type?new Eo(t,e):new bo(t,e)};var Io=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Io.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Io.prototype.setUniform=function(t,e,i,r){var n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&t.set(n)},Io.prototype.getBinding=function(t,e,i){return"u_pattern"===i.substr(0,9)?new To(t,e):new bo(t,e)};var Mo=function(t,e,i,r){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===i?2:1,offset:0}})),this.paintVertexArray=new r};Mo.prototype.populatePaintArray=function(t,e,i,r,n){var o=this.paintVertexArray.length,a=this.expression.evaluate(new an(0),e,{},r,[],n);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Mo.prototype.updatePaintArray=function(t,e,i,r){var n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(t,e,n)},Mo.prototype._setPaintValue=function(t,e,i){if("color"===this.type)for(var r=Co(i),n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}},Mo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Mo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ko=function(t,e,i,r,n,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===i?4:2,offset:0}})),this.paintVertexArray=new o};ko.prototype.populatePaintArray=function(t,e,i,r,n){var o=this.expression.evaluate(new an(this.zoom),e,{},r,[],n),a=this.expression.evaluate(new an(this.zoom+1),e,{},r,[],n),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},ko.prototype.updatePaintArray=function(t,e,i,r){var n=this.expression.evaluate({zoom:this.zoom},i,r),o=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(t,e,n,o)},ko.prototype._setPaintValue=function(t,e,i,r){if("color"===this.type)for(var n=Co(i),o=Co(r),a=t;a<e;a++)this.paintVertexArray.emplace(a,n[0],n[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}},ko.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ko.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ko.prototype.setUniform=function(t,e){var i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=c(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(r)},ko.prototype.getBinding=function(t,e,i){return new bo(t,e)};var Do=function(t,e,i,r,n,o){this.expression=t,this.type=e,this.useIntegerZoom=i,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n};Do.prototype.populatePaintArray=function(t,e,i){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],i)},Do.prototype.updatePaintArray=function(t,e,i,r,n){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],n)},Do.prototype._setPaintValues=function(t,e,i,r){if(r&&i){var n=r[i.min],o=r[i.mid],a=r[i.max];if(n&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],o.pixelRatio,n.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Do.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,lo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,lo.members,this.expression.isStateDependent))},Do.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Lo=function(t,e,i){this.binders={},this._buffers=[];var r=[];for(var n in t.paint._values)if(i(n)){var o=t.paint.get(n);if(o instanceof dn&&Di(o.property.specification)){var a=Ro(n,t.type),s=o.value,l=o.property.specification.type,u=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[n]=h?new Io(s.value,a):new Po(s.value,a,l),r.push("/u_"+n);else if("source"===s.kind||h){var p=zo(n,l,"source");this.binders[n]=h?new Do(s,l,u,e,p,t.id):new Mo(s,a,l,p),r.push("/a_"+n)}else{var d=zo(n,l,"composite");this.binders[n]=new ko(s,a,l,u,e,d),r.push("/z_"+n)}}}this.cacheKey=r.sort().join("")};Lo.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Mo||e instanceof ko?e.maxValue:0},Lo.prototype.populatePaintArrays=function(t,e,i,r,n){for(var o in this.binders){var a=this.binders[o];(a instanceof Mo||a instanceof ko||a instanceof Do)&&a.populatePaintArray(t,e,i,r,n)}},Lo.prototype.setConstantPatternPositions=function(t,e){for(var i in this.binders){var r=this.binders[i];r instanceof Io&&r.setConstantPatternPositions(t,e)}},Lo.prototype.updatePaintArrays=function(t,e,i,r,n){var o=!1;for(var a in t)for(var s=0,l=e.getPositions(a);s<l.length;s+=1){var u=l[s],c=i.feature(u.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof Mo||p instanceof ko||p instanceof Do)&&!0===p.expression.isStateDependent){var d=r.paint.get(h);p.expression=d.value,p.updatePaintArray(u.start,u.end,c,t[a],n),o=!0}}}return o},Lo.prototype.defines=function(){var t=[];for(var e in this.binders){var i=this.binders[e];(i instanceof Po||i instanceof Io)&&t.push.apply(t,i.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Lo.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var i=this.binders[e];if(i instanceof Mo||i instanceof ko)for(var r=0;r<i.paintVertexAttributes.length;r++)t.push(i.paintVertexAttributes[r].name);else if(i instanceof Do)for(var n=0;n<lo.members.length;n++)t.push(lo.members[n].name)}return t},Lo.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var i=this.binders[e];if(i instanceof Po||i instanceof Io||i instanceof ko)for(var r=0,n=i.uniformNames;r<n.length;r+=1)t.push(n[r])}return t},Lo.prototype.getPaintVertexBuffers=function(){return this._buffers},Lo.prototype.getUniforms=function(t,e){var i=[];for(var r in this.binders){var n=this.binders[r];if(n instanceof Po||n instanceof Io||n instanceof ko)for(var o=0,a=n.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var l=n.getBinding(t,e[s],s);i.push({name:s,property:r,binding:l})}}}return i},Lo.prototype.setUniforms=function(t,e,i,r){for(var n=0,o=e;n<o.length;n+=1){var a=o[n],s=a.name,l=a.property;this.binders[l].setUniform(a.binding,r,i.get(l),s)}},Lo.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var i=this.binders[e];if(t&&i instanceof Do){var r=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(i instanceof Mo||i instanceof ko)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}},Lo.prototype.upload=function(t){for(var e in this.binders){var i=this.binders[e];(i instanceof Mo||i instanceof ko||i instanceof Do)&&i.upload(t)}this.updatePaintBuffers()},Lo.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Mo||e instanceof ko||e instanceof Do)&&e.destroy()}};var Oo=function(t,e,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var r=0,n=t;r<n.length;r+=1){var o=n[r];this.programConfigurations[o.id]=new Lo(o,e,i)}this.needsUpload=!1,this._featureMap=new fo,this._bufferOffset=0};function Ro(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function zo(t,e,i){var r={color:{source:kn,composite:Xn},number:{source:Gn,composite:kn}},n=function(t){return{"line-pattern":{source:Dn,composite:Dn},"fill-pattern":{source:Dn,composite:Dn},"fill-extrusion-pattern":{source:Dn,composite:Dn}}[t]}(t);return n&&n[i]||r[e][i]}Oo.prototype.populatePaintArrays=function(t,e,i,r,n,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,n,o);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Oo.prototype.updatePaintArrays=function(t,e,i,r){for(var n=0,o=i;n<o.length;n+=1){var a=o[n];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,r)||this.needsUpload}},Oo.prototype.get=function(t){return this.programConfigurations[t]},Oo.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Oo.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},zr("ConstantBinder",Po),zr("CrossFadedConstantBinder",Io),zr("SourceExpressionBinder",Mo),zr("CrossFadedCompositeBinder",Do),zr("CompositeExpressionBinder",ko),zr("ProgramConfiguration",Lo,{omit:["_buffers"]}),zr("ProgramConfigurationSet",Oo);var Fo=Math.pow(2,14)-1,Bo=-Fo-1;function No(t){for(var e=8192/t.extent,i=t.loadGeometry(),r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){var a=n[o],s=Math.round(a.x*e),l=Math.round(a.y*e);a.x=c(s,Bo,Fo),a.y=c(l,Bo,Fo),(s<a.x||s>a.x+1||l<a.y||l>a.y+1)&&T("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return i}function jo(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}var Uo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Cn,this.indexArray=new jn,this.segments=new ao,this.programConfigurations=new Oo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Vo(t,e){for(var i=0;i<t.length;i++)if(Jo(e,t[i]))return!0;for(var r=0;r<e.length;r++)if(Jo(t,e[r]))return!0;return!!Ho(t,e)}function Go(t,e,i){return!!Jo(t,e)||!!Xo(e,t,i)}function qo(t,e){if(1===t.length)return Ko(e,t[0]);for(var i=0;i<e.length;i++)for(var r=e[i],n=0;n<r.length;n++)if(Jo(t,r[n]))return!0;for(var o=0;o<t.length;o++)if(Ko(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(Ho(t,e[a]))return!0;return!1}function Wo(t,e,i){if(t.length>1){if(Ho(t,e))return!0;for(var r=0;r<e.length;r++)if(Xo(e[r],t,i))return!0}for(var n=0;n<t.length;n++)if(Xo(t[n],e,i))return!0;return!1}function Ho(t,e){if(0===t.length||0===e.length)return!1;for(var i=0;i<t.length-1;i++)for(var r=t[i],n=t[i+1],o=0;o<e.length-1;o++)if(Zo(r,n,e[o],e[o+1]))return!0;return!1}function Zo(t,e,i,r){return E(t,i,r)!==E(e,i,r)&&E(t,e,i)!==E(t,e,r)}function Xo(t,e,i){var r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(var n=1;n<e.length;n++)if(Yo(t,e[n-1],e[n])<r)return!0;return!1}function Yo(t,e,i){var r=e.distSqr(i);if(0===r)return t.distSqr(e);var n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function Ko(t,e){for(var i,r,n,o=!1,a=0;a<t.length;a++)for(var s=0,l=(i=t[a]).length-1;s<i.length;l=s++)(r=i[s]).y>e.y!=(n=i[l]).y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(o=!o);return o}function Jo(t,e){for(var i=!1,r=0,n=t.length-1;r<t.length;n=r++){var o=t[r],a=t[n];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(i=!i)}return i}function Qo(t,e,i){var r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;var o=E(t,e,i[0]);return o!==E(t,e,i[1])||o!==E(t,e,i[2])||o!==E(t,e,i[3])}function $o(t,e,i){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function ta(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ea(t,e,i,r,o){if(!e[0]&&!e[1])return t;var a=n.convert(e)._mult(o);"viewport"===i&&a._rotate(-r);for(var s=[],l=0;l<t.length;l++)s.push(t[l].sub(a));return s}Uo.prototype.populate=function(t,e,i){var r=this.layers[0],n=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var l=s[a],u=l.feature,c=l.id,h=l.index,p=l.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,f={type:u.type,id:c,properties:u.properties,geometry:d?No(u):[]};if(this.layers[0]._featureFilter.filter(new an(this.zoom),f,i)){d||(f.geometry=No(u));var m=o?o.evaluate(f,{},i):void 0;n.push({id:c,properties:u.properties,type:u.type,sourceLayerIndex:p,index:h,geometry:f.geometry,patterns:{},sortKey:m})}}o&&n.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,y=n;g<y.length;g+=1){var v=y[g],_=v.geometry,b=v.index,x=v.sourceLayerIndex,w=t[b].feature;this.addFeature(v,_,b,i),e.featureIndex.insert(w,_,b,x,this.index)}},Uo.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},Uo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Uo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Uo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Uo.prototype.addFeature=function(t,e,i,r){for(var n=0,o=e;n<o.length;n+=1)for(var a=0,s=o[n];a<s.length;a+=1){var l=s[a],u=l.x,c=l.y;if(!(u<0||u>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),p=h.vertexLength;jo(this.layoutVertexArray,u,c,-1,-1),jo(this.layoutVertexArray,u,c,1,-1),jo(this.layoutVertexArray,u,c,1,1),jo(this.layoutVertexArray,u,c,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},r)},zr("CircleBucket",Uo,{omit:["layers"]});var ia=new bn({"circle-sort-key":new gn(Pt.layout_circle["circle-sort-key"])}),ra={paint:new bn({"circle-radius":new gn(Pt.paint_circle["circle-radius"]),"circle-color":new gn(Pt.paint_circle["circle-color"]),"circle-blur":new gn(Pt.paint_circle["circle-blur"]),"circle-opacity":new gn(Pt.paint_circle["circle-opacity"]),"circle-translate":new mn(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new mn(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mn(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mn(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gn(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gn(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gn(Pt.paint_circle["circle-stroke-opacity"])}),layout:ia},na="undefined"!=typeof Float32Array?Float32Array:Array;function oa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function aa(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=i[0],b=i[1],x=i[2],w=i[3];return t[0]=_*r+b*s+x*h+w*m,t[1]=_*n+b*l+x*p+w*g,t[2]=_*o+b*u+x*d+w*y,t[3]=_*a+b*c+x*f+w*v,t[4]=(_=i[4])*r+(b=i[5])*s+(x=i[6])*h+(w=i[7])*m,t[5]=_*n+b*l+x*p+w*g,t[6]=_*o+b*u+x*d+w*y,t[7]=_*a+b*c+x*f+w*v,t[8]=(_=i[8])*r+(b=i[9])*s+(x=i[10])*h+(w=i[11])*m,t[9]=_*n+b*l+x*p+w*g,t[10]=_*o+b*u+x*d+w*y,t[11]=_*a+b*c+x*f+w*v,t[12]=(_=i[12])*r+(b=i[13])*s+(x=i[14])*h+(w=i[15])*m,t[13]=_*n+b*l+x*p+w*g,t[14]=_*o+b*u+x*d+w*y,t[15]=_*a+b*c+x*f+w*v,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,i=arguments.length;i--;)e+=t[i]*t[i];return Math.sqrt(e)});var sa,la=aa;function ua(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*a,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*a,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*a,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*a,t}sa=new na(3),na!=Float32Array&&(sa[0]=0,sa[1]=0,sa[2]=0),function(){var t=new na(4);na!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var ca=(function(){var t=new na(2);na!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,ra)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Uo(t)},e.prototype.queryRadius=function(t){var e=t;return $o("circle-radius",this,e)+$o("circle-stroke-width",this,e)+ta(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,n,o,a,s){for(var l=ea(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),u=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),c="map"===this.paint.get("circle-pitch-alignment"),h=c?l:function(t,e){return t.map((function(t){return ha(t,e)}))}(l,s),p=c?u*a:u,d=0,f=r;d<f.length;d+=1)for(var m=0,g=f[d];m<g.length;m+=1){var y=g[m],v=c?y:ha(y,s),_=p,b=ua([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=b[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/b[3]),Go(h,v,_))return!0}return!1},e}(xn));function ha(t,e){var i=ua([],[t.x,t.y,0,1],e);return new n(i[0]/i[3],i[1]/i[3])}var pa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Uo);function da(t,e,i,r){var n=e.width,o=e.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==n*o*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(n*o*i);return t.width=n,t.height=o,t.data=r,t}function fa(t,e,i){var r=e.width,n=e.height;if(r!==t.width||n!==t.height){var o=da({},{width:r,height:n},i);ma(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,n)},i),t.width=r,t.height=n,t.data=o.data}}function ma(t,e,i,r,n,o){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,l=0;l<n.height;l++)for(var u=((i.y+l)*t.width+i.x)*o,c=((r.y+l)*e.width+r.x)*o,h=0;h<n.width*o;h++)s[c+h]=a[u+h];return e}zr("HeatmapBucket",pa,{omit:["layers"]});var ga=function(t,e){da(this,t,1,e)};ga.prototype.resize=function(t){fa(this,t,1)},ga.prototype.clone=function(){return new ga({width:this.width,height:this.height},new Uint8Array(this.data))},ga.copy=function(t,e,i,r,n){ma(t,e,i,r,n,1)};var ya=function(t,e){da(this,t,4,e)};ya.prototype.resize=function(t){fa(this,t,4)},ya.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},ya.prototype.clone=function(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))},ya.copy=function(t,e,i,r,n){ma(t,e,i,r,n,4)},zr("AlphaImage",ga),zr("RGBAImage",ya);var va={paint:new bn({"heatmap-radius":new gn(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gn(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mn(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _n(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mn(Pt.paint_heatmap["heatmap-opacity"])})};function _a(t){var e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new ya({width:i,height:r}),o=function(i,r,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);n.data[i+r+0]=Math.floor(255*a.r/a.a),n.data[i+r+1]=Math.floor(255*a.g/a.a),n.data[i+r+2]=Math.floor(255*a.b/a.a),n.data[i+r+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<r;++a,s+=4*i)for(var l=0,u=0;l<i;l++,u+=4){var c=l/(i-1),h=t.clips[a];o(s,u,h.start*(1-c)+h.end*c)}else for(var p=0,d=0;p<i;p++,d+=4)o(0,d,p/(i-1));return n}var ba=function(t){function e(e){t.call(this,e,va),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new pa(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=_a({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(xn),xa={paint:new bn({"hillshade-illumination-direction":new mn(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mn(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mn(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mn(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mn(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mn(Pt.paint_hillshade["hillshade-accent-color"])})},wa=function(t){function e(e){t.call(this,e,xa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(xn),Ta=Sn([{name:"a_pos",components:2,type:"Int16"}],4).members,Ea=Aa,Sa=Aa;function Aa(t,e,i){i=i||2;var r,n,o,a,s,l,u,c=e&&e.length,h=c?e[0]*i:t.length,p=Ca(t,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,i,r){var n,o,a,s=[];for(n=0,o=e.length;n<o;n++)(a=Ca(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(Ba(a));for(s.sort(Oa),n=0;n<s.length;n++)Ra(s[n],i),i=Pa(i,i.next);return i}(t,e,p,i)),t.length>80*i){r=o=t[0],n=a=t[1];for(var f=i;f<h;f+=i)(s=t[f])<r&&(r=s),(l=t[f+1])<n&&(n=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-r,a-n))?1/u:0}return Ia(p,d,i,r,n,u),d}function Ca(t,e,i,r,n){var o,a;if(n===Ja(t,e,i,r)>0)for(o=e;o<i;o+=r)a=Xa(o,t[o],t[o+1],a);else for(o=i-r;o>=e;o-=r)a=Xa(o,t[o],t[o+1],a);return a&&Va(a,a.next)&&(Ya(a),a=a.next),a}function Pa(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!Va(r,r.next)&&0!==Ua(r.prev,r,r.next))r=r.next;else{if(Ya(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Ia(t,e,i,r,n,o,a){if(t){!a&&o&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=Fa(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,a,s,l,u=1;do{for(i=t,t=null,o=null,a=0;i;){for(a++,r=i,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(a>1)}(n)}(t,r,n,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?ka(t,r,n,o):Ma(t))e.push(s.i/i),e.push(t.i/i),e.push(l.i/i),Ya(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?Ia(t=Da(Pa(t),e,i),e,i,r,n,o,2):2===a&&La(t,e,i,r,n,o):Ia(Pa(t),e,i,r,n,o,1);break}}}function Ma(t){var e=t.prev,i=t,r=t.next;if(Ua(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Na(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&Ua(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ka(t,e,i,r){var n=t.prev,o=t,a=t.next;if(Ua(n,o,a)>=0)return!1;for(var s=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,l=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,u=Fa(n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,e,i,r),c=Fa(s,l,e,i,r),h=t.prevZ,p=t.nextZ;h&&h.z>=u&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&Na(n.x,n.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ua(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&Na(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ua(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=u;){if(h!==t.prev&&h!==t.next&&Na(n.x,n.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ua(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&Na(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ua(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Da(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!Va(n,o)&&Ga(n,r,r.next,o)&&Ha(n,o)&&Ha(o,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(o.i/i),Ya(r),Ya(r.next),r=t=o),r=r.next}while(r!==t);return Pa(r)}function La(t,e,i,r,n,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ja(a,s)){var l=Za(a,s);return a=Pa(a,a.next),l=Pa(l,l.next),Ia(a,e,i,r,n,o),void Ia(l,e,i,r,n,o)}s=s.next}a=a.next}while(a!==t)}function Oa(t,e){return t.x-e.x}function Ra(t,e){if(e=function(t,e){var i,r=e,n=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a){if(a=s,s===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===a)return i;var l,u=i,c=i.x,h=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=c&&n!==r.x&&Na(o<h?n:a,o,c,h,o<h?a:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),Ha(r,t)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&za(i,r)))&&(i=r,p=l)),r=r.next}while(r!==u);return i}(t,e)){var i=Za(e,t);Pa(e,e.next),Pa(i,i.next)}}function za(t,e){return Ua(t.prev,t,e.prev)<0&&Ua(e.next,t,t.next)<0}function Fa(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ba(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Na(t,e,i,r,n,o,a,s){return(n-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(i-a)*(e-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function ja(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ga(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Ha(t,e)&&Ha(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(Ua(t.prev,t,e.prev)||Ua(t,e.prev,e))||Va(t,e)&&Ua(t.prev,t,t.next)>0&&Ua(e.prev,e,e.next)>0)}function Ua(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Va(t,e){return t.x===e.x&&t.y===e.y}function Ga(t,e,i,r){var n=Wa(Ua(t,e,i)),o=Wa(Ua(t,e,r)),a=Wa(Ua(i,r,t)),s=Wa(Ua(i,r,e));return n!==o&&a!==s||!(0!==n||!qa(t,i,e))||!(0!==o||!qa(t,r,e))||!(0!==a||!qa(i,t,r))||!(0!==s||!qa(i,e,r))}function qa(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Wa(t){return t>0?1:t<0?-1:0}function Ha(t,e){return Ua(t.prev,t,t.next)<0?Ua(t,e,t.next)>=0&&Ua(t,t.prev,e)>=0:Ua(t,e,t.prev)<0||Ua(t,t.next,e)<0}function Za(t,e){var i=new Ka(t.i,t.x,t.y),r=new Ka(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Xa(t,e,i,r){var n=new Ka(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ya(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ka(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ja(t,e,i,r){for(var n=0,o=e,a=i-r;o<i;o+=r)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}function Qa(t,e,i,r,n){!function t(e,i,r,n,o){for(;n>r;){if(n-r>600){var a=n-r+1,s=i-r+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1);t(e,i,Math.max(r,Math.floor(i-s*u/a+c)),Math.min(n,Math.floor(i+(a-s)*u/a+c)),o)}var h=e[i],p=r,d=n;for($a(e,r,i),o(e[n],h)>0&&$a(e,r,n);p<d;){for($a(e,p,d),p++,d--;o(e[p],h)<0;)p++;for(;o(e[d],h)>0;)d--}0===o(e[r],h)?$a(e,r,d):$a(e,++d,n),d<=i&&(r=d+1),i<=d&&(n=d-1)}}(t,e,i||0,r||t.length-1,n||ts)}function $a(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function ts(t,e){return t<e?-1:t>e?1:0}function es(t,e){var i=t.length;if(i<=1)return[t];for(var r,n,o=[],a=0;a<i;a++){var s=S(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===n&&(n=s<0),n===s<0?(r&&o.push(r),r=[t[a]]):r.push(t[a]))}if(r&&o.push(r),e>1)for(var l=0;l<o.length;l++)o[l].length<=e||(Qa(o[l],e,1,o[l].length-1,is),o[l]=o[l].slice(0,e));return o}function is(t,e){return e.area-t.area}function rs(t,e,i){for(var r=i.patternDependencies,n=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(n=!0);var l=s.constantOr(null);l&&(n=!0,r[l.to]=!0,r[l.from]=!0)}return n}function ns(t,e,i,r,n){for(var o=n.patternDependencies,a=0,s=e;a<s.length;a+=1){var l=s[a],u=l.paint.get(t+"-pattern").value;if("constant"!==u.kind){var c=u.evaluate({zoom:r-1},i,{},n.availableImages),h=u.evaluate({zoom:r},i,{},n.availableImages),p=u.evaluate({zoom:r+1},i,{},n.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[c=c&&c.name?c.name:c]=!0,o[h]=!0,o[p]=!0,i.patterns[l.id]={min:c,mid:h,max:p}}}return i}Aa.deviation=function(t,e,i,r){var n=e&&e.length,o=Math.abs(Ja(t,0,n?e[0]*i:t.length,i));if(n)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(Ja(t,e[a]*i,a<s-1?e[a+1]*i:t.length,i));var l=0;for(a=0;a<r.length;a+=3){var u=r[a]*i,c=r[a+1]*i,h=r[a+2]*i;l+=Math.abs((t[u]-t[h])*(t[c+1]-t[u+1])-(t[u]-t[c])*(t[h+1]-t[u+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Aa.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[n][o][a]);n>0&&i.holes.push(r+=t[n-1].length)}return i},Ea.default=Sa;var os=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Cn,this.indexArray=new jn,this.indexArray2=new Hn,this.programConfigurations=new Oo(t.layers,t.zoom),this.segments=new ao,this.segments2=new ao,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};os.prototype.populate=function(t,e,i){this.hasPattern=rs("fill",this.layers,e);for(var r=this.layers[0].layout.get("fill-sort-key"),n=[],o=0,a=t;o<a.length;o+=1){var s=a[o],l=s.feature,u=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d={type:l.type,id:u,properties:l.properties,geometry:p?No(l):[]};if(this.layers[0]._featureFilter.filter(new an(this.zoom),d,i)){p||(d.geometry=No(l));var f=r?r.evaluate(d,{},i,e.availableImages):void 0;n.push({id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:d.geometry,patterns:{},sortKey:f})}}r&&n.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,g=n;m<g.length;m+=1){var y=g[m],v=y.geometry,_=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var x=ns("fill",this.layers,y,this.zoom,e);this.patternFeatures.push(x)}else this.addFeature(y,v,_,i,{});e.featureIndex.insert(t[_].feature,v,_,b,this.index)}},os.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},os.prototype.addFeatures=function(t,e,i){for(var r=0,n=this.patternFeatures;r<n.length;r+=1){var o=n[r];this.addFeature(o,o.geometry,o.index,e,i)}},os.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},os.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},os.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ta),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},os.prototype.addFeature=function(t,e,i,r,n){for(var o=0,a=es(e,500);o<a.length;o+=1){for(var s=a[o],l=0,u=0,c=s;u<c.length;u+=1)l+=c[u].length;for(var h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray),p=h.vertexLength,d=[],f=[],m=0,g=s;m<g.length;m+=1){var y=g[m];if(0!==y.length){y!==s[0]&&f.push(d.length/2);var v=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),_=v.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(_+y.length-1,_),d.push(y[0].x),d.push(y[0].y);for(var b=1;b<y.length;b++)this.layoutVertexArray.emplaceBack(y[b].x,y[b].y),this.indexArray2.emplaceBack(_+b-1,_+b),d.push(y[b].x),d.push(y[b].y);v.vertexLength+=y.length,v.primitiveLength+=y.length}}for(var x=Ea(d,f),w=0;w<x.length;w+=3)this.indexArray.emplaceBack(p+x[w],p+x[w+1],p+x[w+2]);h.vertexLength+=l,h.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)},zr("FillBucket",os,{omit:["layers","patternFeatures"]});var as=new bn({"fill-sort-key":new gn(Pt.layout_fill["fill-sort-key"])}),ss={paint:new bn({"fill-antialias":new mn(Pt.paint_fill["fill-antialias"]),"fill-opacity":new gn(Pt.paint_fill["fill-opacity"]),"fill-color":new gn(Pt.paint_fill["fill-color"]),"fill-outline-color":new gn(Pt.paint_fill["fill-outline-color"]),"fill-translate":new mn(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new mn(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yn(Pt.paint_fill["fill-pattern"])}),layout:as},ls=function(t){function e(e){t.call(this,e,ss)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,i){t.prototype.recalculate.call(this,e,i);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new os(t)},e.prototype.queryRadius=function(){return ta(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,n,o,a){return qo(ea(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},e.prototype.isTileClipped=function(){return!0},e}(xn),us=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,cs=hs;function hs(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(ps,this,e)}function ps(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function ds(t){for(var e,i,r=0,n=0,o=t.length,a=o-1;n<o;a=n++)r+=((i=t[a]).x-(e=t[n]).x)*(e.y+i.y);return r}hs.types=["Unknown","Point","LineString","Polygon"],hs.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,o=0,a=0,s=0,l=[];t.pos<i;){if(o<=0){var u=t.readVarint();r=7&u,o=u>>3}if(o--,1===r||2===r)a+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&l.push(e),e=[]),e.push(new n(a,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&l.push(e),l},hs.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();i=7&c,r=c>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<a&&(a=n),n>s&&(s=n),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==i)throw new Error("unknown command "+i)}return[a,l,s,u]},hs.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=hs.types[this.type];function c(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];c(l=h);break;case 2:for(r=0;r<l.length;r++)c(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var a=ds(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)c(l[r][n])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var fs=ms;function ms(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(gs,this,e),this.length=this._features.length}function gs(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}function ys(t,e,i){if(3===t){var r=new fs(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}ms.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new cs(this._pbf,e,this.extent,this._keys,this._values)};var vs={VectorTile:function(t,e){this.layers=t.readFields(ys,{},e)},VectorTileFeature:cs,VectorTileLayer:fs},_s=vs.VectorTileFeature.types,bs=Math.pow(2,13);function xs(t,e,i,r,n,o,a,s){t.emplaceBack(e,i,2*Math.floor(r*bs)+a,n*bs*2,o*bs*2,Math.round(s))}var ws=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new In,this.indexArray=new jn,this.programConfigurations=new Oo(t.layers,t.zoom),this.segments=new ao,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ts(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}ws.prototype.populate=function(t,e,i){this.features=[],this.hasPattern=rs("fill-extrusion",this.layers,e);for(var r=0,n=t;r<n.length;r+=1){var o=n[r],a=o.feature,s=o.id,l=o.index,u=o.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h={type:a.type,id:s,properties:a.properties,geometry:c?No(a):[]};if(this.layers[0]._featureFilter.filter(new an(this.zoom),h,i)){var p={id:s,sourceLayerIndex:u,index:l,geometry:c?h.geometry:No(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(ns("fill-extrusion",this.layers,p,this.zoom,e)):this.addFeature(p,p.geometry,l,i,{}),e.featureIndex.insert(a,p.geometry,l,u,this.index,!0)}}},ws.prototype.addFeatures=function(t,e,i){for(var r=0,n=this.features;r<n.length;r+=1){var o=n[r];this.addFeature(o,o.geometry,o.index,e,i)}},ws.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},ws.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ws.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ws.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,us),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ws.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ws.prototype.addFeature=function(t,e,i,r,n){for(var o=0,a=es(e,500);o<a.length;o+=1){for(var s=a[o],l=0,u=0,c=s;u<c.length;u+=1)l+=c[u].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,d=s;p<d.length;p+=1){var f=d[p];if(0!==f.length&&!((D=f).every((function(t){return t.x<0}))||D.every((function(t){return t.x>8192}))||D.every((function(t){return t.y<0}))||D.every((function(t){return t.y>8192}))))for(var m=0,g=0;g<f.length;g++){var y=f[g];if(g>=1){var v=f[g-1];if(!Ts(y,v)){h.vertexLength+4>ao.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=y.sub(v)._perp()._unit(),b=v.dist(y);m+b>32768&&(m=0),xs(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,m),xs(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,m),xs(this.layoutVertexArray,v.x,v.y,_.x,_.y,0,0,m+=b),xs(this.layoutVertexArray,v.x,v.y,_.x,_.y,0,1,m);var x=h.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+l>ao.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray)),"Polygon"===_s[t.type]){for(var w=[],T=[],E=h.vertexLength,S=0,A=s;S<A.length;S+=1){var C=A[S];if(0!==C.length){C!==s[0]&&T.push(w.length/2);for(var P=0;P<C.length;P++){var I=C[P];xs(this.layoutVertexArray,I.x,I.y,0,0,1,1,0),w.push(I.x),w.push(I.y)}}}for(var M=Ea(w,T),k=0;k<M.length;k+=3)this.indexArray.emplaceBack(E+M[k],E+M[k+2],E+M[k+1]);h.primitiveLength+=M.length/3,h.vertexLength+=l}}var D;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)},zr("FillExtrusionBucket",ws,{omit:["layers","features"]});var Es={paint:new bn({"fill-extrusion-opacity":new mn(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gn(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mn(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mn(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yn(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gn(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gn(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mn(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ss=function(t){function e(e){t.call(this,e,Es)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new ws(t)},e.prototype.queryRadius=function(){return ta(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,i,r,o,a,s,l){var u=ea(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),p=function(t,e,i,r){for(var o=[],a=0,s=t;a<s.length;a+=1){var l=s[a],u=[l.x,l.y,0,1];ua(u,u,e),o.push(new n(u[0]/u[3],u[1]/u[3]))}return o}(u,l),d=function(t,e,i,r){for(var o=[],a=[],s=r[8]*e,l=r[9]*e,u=r[10]*e,c=r[11]*e,h=r[8]*i,p=r[9]*i,d=r[10]*i,f=r[11]*i,m=0,g=t;m<g.length;m+=1){for(var y=[],v=[],_=0,b=g[m];_<b.length;_+=1){var x=b[_],w=x.x,T=x.y,E=r[0]*w+r[4]*T+r[12],S=r[1]*w+r[5]*T+r[13],A=r[2]*w+r[6]*T+r[14],C=r[3]*w+r[7]*T+r[15],P=A+u,I=C+c,M=E+h,k=S+p,D=A+d,L=C+f,O=new n((E+s)/I,(S+l)/I);O.z=P/I,y.push(O);var R=new n(M/L,k/L);R.z=D/L,v.push(R)}o.push(y),a.push(v)}return[o,a]}(r,h,c,l);return function(t,e,i){var r=1/0;qo(i,e)&&(r=Cs(i,e[0]));for(var n=0;n<e.length;n++)for(var o=e[n],a=t[n],s=0;s<o.length-1;s++){var l=o[s],u=[l,o[s+1],a[s+1],a[s],l];Vo(i,u)&&(r=Math.min(r,Cs(i,u)))}return r!==1/0&&r}(d[0],d[1],p)},e}(xn);function As(t,e){return t.x*e.x+t.y*e.y}function Cs(t,e){if(1===t.length){for(var i,r=0,n=e[r++];!i||n.equals(i);)if(!(i=e[r++]))return 1/0;for(;r<e.length;r++){var o=e[r],a=t[0],s=i.sub(n),l=o.sub(n),u=a.sub(n),c=As(s,s),h=As(s,l),p=As(l,l),d=As(u,s),f=As(u,l),m=c*p-h*h,g=(p*d-h*f)/m,y=(c*f-h*d)/m,v=n.z*(1-g-y)+i.z*g+o.z*y;if(isFinite(v))return v}return 1/0}for(var _=1/0,b=0,x=e;b<x.length;b+=1)_=Math.min(_,x[b].z);return _}var Ps=Sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Is=Sn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ms=vs.VectorTileFeature.types,ks=Math.cos(Math.PI/180*37.5),Ds=Math.pow(2,14)/.5,Ls=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Mn,this.layoutVertexArray2=new kn,this.indexArray=new jn,this.programConfigurations=new Oo(t.layers,t.zoom),this.segments=new ao,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ls.prototype.populate=function(t,e,i){this.hasPattern=rs("line",this.layers,e);for(var r=this.layers[0].layout.get("line-sort-key"),n=[],o=0,a=t;o<a.length;o+=1){var s=a[o],l=s.feature,u=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d={type:l.type,id:u,properties:l.properties,geometry:p?No(l):[]};if(this.layers[0]._featureFilter.filter(new an(this.zoom),d,i)){p||(d.geometry=No(l));var f=r?r.evaluate(d,{},i):void 0;n.push({id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:d.geometry,patterns:{},sortKey:f})}}r&&n.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,g=n;m<g.length;m+=1){var y=g[m],v=y.geometry,_=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var x=ns("line",this.layers,y,this.zoom,e);this.patternFeatures.push(x)}else this.addFeature(y,v,_,i,{});e.featureIndex.insert(t[_].feature,v,_,b,this.index)}},Ls.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},Ls.prototype.addFeatures=function(t,e,i){for(var r=0,n=this.patternFeatures;r<n.length;r+=1){var o=n[r];this.addFeature(o,o.geometry,o.index,e,i)}},Ls.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ls.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ls.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Is)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ps),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ls.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ls.prototype.addFeature=function(t,e,i,r,n){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),l=o.get("line-miter-limit"),u=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,h=e;c<h.length;c+=1)this.addLine(h[c],t,a,s,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)},Ls.prototype.addLine=function(t,e,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Ms[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var u=0;u<l-1&&t[u].equals(t[u+1]);)u++;if(!(l<(s?3:2))){"bevel"===i&&(n=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),d=void 0,f=void 0,m=void 0,g=void 0;this.e1=this.e2=-1,s&&(g=t[u].sub(c=t[l-2])._unit()._perp());for(var y=u;y<l;y++)if(!(f=y===l-1?s?t[u+1]:void 0:t[y+1])||!t[y].equals(f)){g&&(m=g),c&&(d=c),c=t[y],g=f?f.sub(c)._unit()._perp():m;var v=(m=m||g).add(g);0===v.x&&0===v.y||v._unit();var _=m.x*g.x+m.y*g.y,b=v.x*g.x+v.y*g.y,x=0!==b?1/b:1/0,w=2*Math.sqrt(2-2*b),T=b<ks&&d&&f,E=m.x*g.y-m.y*g.x>0;if(T&&y>u){var S=c.dist(d);if(S>2*h){var A=c.sub(c.sub(d)._mult(h/S)._round());this.updateDistance(d,A),this.addCurrentVertex(A,m,0,0,p),d=A}}var C=d&&f,P=C?i:s?"butt":r;if(C&&"round"===P&&(x<o?P="miter":x<=2&&(P="fakeround")),"miter"===P&&x>n&&(P="bevel"),"bevel"===P&&(x>2&&(P="flipbevel"),x<n&&(P="miter")),d&&this.updateDistance(d,c),"miter"===P)v._mult(x),this.addCurrentVertex(c,v,0,0,p);else if("flipbevel"===P){if(x>100)v=g.mult(-1);else{var I=x*m.add(g).mag()/m.sub(g).mag();v._perp()._mult(I*(E?-1:1))}this.addCurrentVertex(c,v,0,0,p),this.addCurrentVertex(c,v.mult(-1),0,0,p)}else if("bevel"===P||"fakeround"===P){var M=-Math.sqrt(x*x-1),k=E?M:0,D=E?0:M;if(d&&this.addCurrentVertex(c,m,k,D,p),"fakeround"===P)for(var L=Math.round(180*w/Math.PI/20),O=1;O<L;O++){var R=O/L;if(.5!==R){var z=R-.5;R+=R*z*(R-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*z*z+(.848013+_*(.215638*_-1.06021)))}var F=g.sub(m)._mult(R)._add(m)._unit()._mult(E?-1:1);this.addHalfVertex(c,F.x,F.y,!1,E,0,p)}f&&this.addCurrentVertex(c,g,-k,-D,p)}else if("butt"===P)this.addCurrentVertex(c,v,0,0,p);else if("square"===P){var B=d?1:-1;this.addCurrentVertex(c,v,B,B,p)}else"round"===P&&(d&&(this.addCurrentVertex(c,m,0,0,p),this.addCurrentVertex(c,m,1,1,p,!0)),f&&(this.addCurrentVertex(c,g,-1,-1,p,!0),this.addCurrentVertex(c,g,0,0,p)));if(T&&y<l-1){var N=c.dist(f);if(N>2*h){var j=c.add(f.sub(c)._mult(h/N)._round());this.updateDistance(c,j),this.addCurrentVertex(j,g,0,0,p),c=j}}}}},Ls.prototype.addCurrentVertex=function(t,e,i,r,n,o){void 0===o&&(o=!1);var a=e.y*r-e.x,s=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,n),this.addHalfVertex(t,a,s,o,!0,-r,n),this.distance>Ds/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,i,r,n,o))},Ls.prototype.addHalfVertex=function(t,e,i,r,n,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Ds-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(r?1:0),(t.y<<1)+(n?1:0),Math.round(63*e)+128,Math.round(63*i)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),n?this.e2=l:this.e1=l},Ls.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ls.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},zr("LineBucket",Ls,{omit:["layers","patternFeatures"]});var Os=new bn({"line-cap":new mn(Pt.layout_line["line-cap"]),"line-join":new gn(Pt.layout_line["line-join"]),"line-miter-limit":new mn(Pt.layout_line["line-miter-limit"]),"line-round-limit":new mn(Pt.layout_line["line-round-limit"]),"line-sort-key":new gn(Pt.layout_line["line-sort-key"])}),Rs={paint:new bn({"line-opacity":new gn(Pt.paint_line["line-opacity"]),"line-color":new gn(Pt.paint_line["line-color"]),"line-translate":new mn(Pt.paint_line["line-translate"]),"line-translate-anchor":new mn(Pt.paint_line["line-translate-anchor"]),"line-width":new gn(Pt.paint_line["line-width"]),"line-gap-width":new gn(Pt.paint_line["line-gap-width"]),"line-offset":new gn(Pt.paint_line["line-offset"]),"line-blur":new gn(Pt.paint_line["line-blur"]),"line-dasharray":new vn(Pt.paint_line["line-dasharray"]),"line-pattern":new yn(Pt.paint_line["line-pattern"]),"line-gradient":new _n(Pt.paint_line["line-gradient"])}),layout:Os},zs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new an(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r,n){return i=p({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r,n)},e}(gn))(Rs.paint.properties["line-width"].specification);zs.useIntegerZoom=!0;var Fs=function(t){function e(e){t.call(this,e,Rs),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ve,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,i){t.prototype.recalculate.call(this,e,i),this.paint._values["line-floorwidth"]=zs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ls(t)},e.prototype.queryRadius=function(t){var e=t,i=Bs($o("line-width",this,e),$o("line-gap-width",this,e)),r=$o("line-offset",this,e);return i/2+Math.abs(r)+ta(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,o,a,s){var l=ea(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),u=s/2*Bs(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),c=this.paint.get("line-offset").evaluate(e,i);return c&&(r=function(t,e){for(var i=[],r=new n(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],l=0;l<a.length;l++){var u=a[l],c=a[l+1],h=0===l?r:u.sub(a[l-1])._unit()._perp(),p=l===a.length-1?r:c.sub(u)._unit()._perp(),d=h._add(p)._unit();d._mult(1/(d.x*p.x+d.y*p.y)),s.push(d._mult(e)._add(u))}i.push(s)}return i}(r,c*s)),function(t,e,i){for(var r=0;r<e.length;r++){var n=e[r];if(t.length>=3)for(var o=0;o<n.length;o++)if(Jo(t,n[o]))return!0;if(Wo(t,n,i))return!0}return!1}(l,r,u)},e.prototype.isTileClipped=function(){return!0},e}(xn);function Bs(t,e){return e>0?e+2*t:t}var Ns=Sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),js=Sn([{name:"a_projected_pos",components:3,type:"Float32"}],4),Us=(Sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Vs=(Sn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Gs=Sn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function qs(t,e,i){return t.sections.forEach((function(t){t.text=function(t,e,i){var r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),on.applyArabicShaping&&(t=on.applyArabicShaping(t)),t}(t.text,e,i)})),t}Sn([{name:"triangle",components:3,type:"Uint16"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Sn([{type:"Float32",name:"offsetX"}]),Sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ws={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Hs=function(t,e,i,r,n){var o,a,s=8*n-r-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?n-1:0,p=i?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),o-=u}return(d?-1:1)*a*Math.pow(2,o-r)},Zs=function(t,e,i,r,n,o){var a,s,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,n),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;t[i+d]=255&s,d+=f,s/=256,n-=8);for(a=a<<n|s,u+=n;u>0;t[i+d]=255&a,d+=f,a/=256,u-=8);t[i+d-f]|=128*m},Xs=Ys;function Ys(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ys.Varint=0,Ys.Fixed64=1,Ys.Bytes=2,Ys.Fixed32=5;var Ks="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Js(t){return t.type===Ys.Bytes?t.readVarint()+t.pos:t.pos+1}function Qs(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function $s(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function tl(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function el(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function il(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function rl(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function nl(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function ol(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function al(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function sl(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function ll(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function ul(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function cl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function hl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function pl(t,e,i){1===t&&i.readMessage(dl,e)}function dl(t,e,i){if(3===t){var r=i.readMessage(fl,{}),n=r.width,o=r.height,a=r.left,s=r.top,l=r.advance;e.push({id:r.id,bitmap:new ga({width:n+6,height:o+6},r.bitmap),metrics:{width:n,height:o,left:a,top:s,advance:l}})}}function fl(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function ml(t){for(var e=0,i=0,r=0,n=t;r<n.length;r+=1){var o=n[r];e+=o.w*o.h,i=Math.max(i,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],s=0,l=0,u=0,c=t;u<c.length;u+=1)for(var h=c[u],p=a.length-1;p>=0;p--){var d=a[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,l=Math.max(l,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===d.w&&h.h===d.h){var f=a.pop();p<a.length&&(a[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(a.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}Ys.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ul(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=hl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ul(this.buf,this.pos)+4294967296*ul(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=ul(this.buf,this.pos)+4294967296*hl(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Hs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Hs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return Qs(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return Qs(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return Qs(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return Qs(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return Qs(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return Qs(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Ks?function(t,e,i){return Ks.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,a,s,l=t[n],u=null,c=l>239?4:l>223?3:l>191?2:1;if(n+c>i)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[n+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(a=t[n+2],128==(192&(o=t[n+1]))&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(a=t[n+2],s=t[n+3],128==(192&(o=t[n+1]))&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),n+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ys.Bytes)return t.push(this.readVarint(e));var i=Js(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ys.Bytes)return t.push(this.readSVarint());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ys.Bytes)return t.push(this.readBoolean());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ys.Bytes)return t.push(this.readFloat());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ys.Bytes)return t.push(this.readDouble());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ys.Bytes)return t.push(this.readFixed32());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ys.Bytes)return t.push(this.readSFixed32());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ys.Bytes)return t.push(this.readFixed64());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ys.Bytes)return t.push(this.readSFixed64());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ys.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ys.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ys.Fixed32)this.pos+=4;else{if(e!==Ys.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),cl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),cl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),cl(this.buf,-1&t,this.pos),cl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),cl(this.buf,-1&t,this.pos),cl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&$s(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Zs(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Zs(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&$s(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Ys.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,tl,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,el,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,nl,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,il,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,rl,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,ol,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,al,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,sl,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,ll,e)},writeBytesField:function(t,e){this.writeTag(t,Ys.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ys.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ys.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ys.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ys.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ys.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ys.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ys.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ys.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ys.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var gl=function(t,e){var i=e.pixelRatio,r=e.version,n=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=i,this.stretchX=n,this.stretchY=o,this.content=a,this.version=r},yl={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};yl.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},yl.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},yl.tlbr.get=function(){return this.tl.concat(this.br)},yl.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(gl.prototype,yl);var vl=function(t,e){var i={},r={};this.haveRenderCallbacks=[];var n=[];this.addImages(t,i,n),this.addImages(e,r,n);var o=ml(n),a=new ya({width:o.w||1,height:o.h||1});for(var s in t){var l=t[s],u=i[s].paddedRect;ya.copy(l.data,a,{x:0,y:0},{x:u.x+1,y:u.y+1},l.data)}for(var c in e){var h=e[c],p=r[c].paddedRect,d=p.x+1,f=p.y+1,m=h.data.width,g=h.data.height;ya.copy(h.data,a,{x:0,y:0},{x:d,y:f},h.data),ya.copy(h.data,a,{x:0,y:g-1},{x:d,y:f-1},{width:m,height:1}),ya.copy(h.data,a,{x:0,y:0},{x:d,y:f+g},{width:m,height:1}),ya.copy(h.data,a,{x:m-1,y:0},{x:d-1,y:f},{width:1,height:g}),ya.copy(h.data,a,{x:0,y:0},{x:d+m,y:f},{width:1,height:g})}this.image=a,this.iconPositions=i,this.patternPositions=r};vl.prototype.addImages=function(t,e,i){for(var r in t){var n=t[r],o={x:0,y:0,w:n.data.width+2,h:n.data.height+2};i.push(o),e[r]=new gl(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},vl.prototype.patchUpdatedImages=function(t,e){for(var i in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)},vl.prototype.patchUpdatedImage=function(t,e,i){if(t&&e&&t.version!==e.version){t.version=e.version;var r=t.tl;i.update(e.data,void 0,{x:r[0],y:r[1]})}},zr("ImagePosition",gl),zr("ImageAtlas",vl);var _l={horizontal:1,vertical:2,horizontalOnly:3},bl=function(){this.scale=1,this.fontStack="",this.imageName=null};bl.forText=function(t,e){var i=new bl;return i.scale=t||1,i.fontStack=e,i},bl.forImage=function(t){var e=new bl;return e.imageName=t,e};var xl=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function wl(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m){var g,y=xl.fromFeature(t,n);h===_l.vertical&&y.verticalizePunctuation();var v=on.processBidirectionalText,_=on.processStyledBidirectionalText;if(v&&1===y.sections.length){g=[];for(var b=0,x=v(y.toString(),Il(y,u,o,e,r,d,f));b<x.length;b+=1){var w=x[b],T=new xl;T.text=w,T.sections=y.sections;for(var E=0;E<w.length;E++)T.sectionIndex.push(0);g.push(T)}}else if(_){g=[];for(var S=0,A=_(y.text,y.sectionIndex,Il(y,u,o,e,r,d,f));S<A.length;S+=1){var C=A[S],P=new xl;P.text=C[0],P.sectionIndex=C[1],P.sections=y.sections,g.push(P)}}else g=function(t,e){for(var i=[],r=t.text,n=0,o=0,a=e;o<a.length;o+=1){var s=a[o];i.push(t.substring(n,s)),n=s}return n<r.length&&i.push(t.substring(n,r.length)),i}(y,Il(y,u,o,e,r,d,f));var I=[],M={positionedLines:I,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,i,r,n,o,a,s,l,u,c,h){for(var p=0,d=-17,f=0,m=0,g="right"===s?1:"left"===s?0:.5,y=0,v=0,_=n;v<_.length;v+=1){var b=_[v];b.trim();var x=b.getMaxScale(),w=24*(x-1),T={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=T;var E=T.positionedGlyphs,S=0;if(b.length()){for(var A=0;A<b.length();A++){var C=b.getSection(A),P=b.getSectionIndex(A),I=b.getCharCode(A),M=0,k=null,D=null,L=null,O=24,R=!(l===_l.horizontal||!c&&!Wr(I)||c&&(Tl[I]||(q=I,Gr.Arabic(q)||Gr["Arabic Supplement"](q)||Gr["Arabic Extended-A"](q)||Gr["Arabic Presentation Forms-A"](q)||Gr["Arabic Presentation Forms-B"](q))));if(C.imageName){var z=r[C.imageName];if(!z)continue;L=C.imageName,t.iconsInText=t.iconsInText||!0,D=z.paddedRect;var F=z.displaySize;C.scale=24*C.scale/h,M=w+(24-F[1]*C.scale),O=(k={width:F[0],height:F[1],left:1,top:-3,advance:R?F[1]:F[0]}).advance;var B=R?F[0]*C.scale-24*x:F[1]*C.scale-24*x;B>0&&B>S&&(S=B)}else{var N=i[C.fontStack],j=N&&N[I];if(j&&j.rect)D=j.rect,k=j.metrics;else{var U=e[C.fontStack],V=U&&U[I];if(!V)continue;k=V.metrics}M=24*(x-C.scale)}R?(t.verticalizable=!0,E.push({glyph:I,imageName:L,x:p,y:d+M,vertical:R,scale:C.scale,fontStack:C.fontStack,sectionIndex:P,metrics:k,rect:D}),p+=O*C.scale+u):(E.push({glyph:I,imageName:L,x:p,y:d+M,vertical:R,scale:C.scale,fontStack:C.fontStack,sectionIndex:P,metrics:k,rect:D}),p+=k.advance*C.scale+u)}0!==E.length&&(f=Math.max(p-u,f),kl(E,0,E.length-1,g,S)),p=0;var G=o*x+S;T.lineOffset=Math.max(S,w),d+=G,m=Math.max(G,m),++y}else d+=o,++y}var q,W=d- -17,H=Ml(a),Z=H.horizontalAlign,X=H.verticalAlign;(function(t,e,i,r,n,o,a,s,l){var u,c=(e-i)*n;u=o!==a?-s*r- -17:(-r*l+.5)*a;for(var h=0,p=t;h<p.length;h+=1)for(var d=0,f=p[h].positionedGlyphs;d<f.length;d+=1){var m=f[d];m.x+=c,m.y+=u}})(t.positionedLines,g,Z,X,f,m,o,W,n.length),t.top+=-X*W,t.bottom=t.top+W,t.left+=-Z*f,t.right=t.left+f}(M,e,i,r,g,a,s,l,h,u,p,m),!function(t){for(var e=0,i=t;e<i.length;e+=1)if(0!==i[e].positionedGlyphs.length)return!1;return!0}(I)&&M}xl.fromFeature=function(t,e){for(var i=new xl,r=0;r<t.sections.length;r++){var n=t.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,e)}return i},xl.prototype.length=function(){return this.text.length},xl.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},xl.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},xl.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},xl.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",i=0;i<t.length;i++){var r=t.charCodeAt(i+1)||null,n=t.charCodeAt(i-1)||null;e+=r&&Hr(r)&&!Ws[t[i+1]]||n&&Hr(n)&&!Ws[t[i-1]]||!Ws[t[i]]?t[i]:Ws[t[i]]}return e}(this.text)},xl.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Tl[this.text.charCodeAt(e)];e++)t++;for(var i=this.text.length,r=this.text.length-1;r>=0&&r>=t&&Tl[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)},xl.prototype.substring=function(t,e){var i=new xl;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i},xl.prototype.toString=function(){return this.text},xl.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,i){return Math.max(e,t.sections[i].scale)}),0)},xl.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(bl.forText(t.scale,t.fontStack||e));for(var i=this.sections.length-1,r=0;r<t.text.length;++r)this.sectionIndex.push(i)},xl.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(bl.forImage(e)),this.sectionIndex.push(this.sections.length-1)):T("Reached maximum number of images 6401")}else T("Can't add FormattedSection with an empty image.")},xl.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},El={};function Sl(t,e,i,r,n,o){if(e.imageName){var a=r[e.imageName];return a?a.displaySize[0]*e.scale*24/o+n:0}var s=i[e.fontStack],l=s&&s[t];return l?l.metrics.advance*e.scale+n:0}function Al(t,e,i,r){var n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function Cl(t,e,i){var r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Pl(t,e,i,r,n,o){for(var a=null,s=Al(e,i,n,o),l=0,u=r;l<u.length;l+=1){var c=u[l],h=Al(e-c.x,i,n,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Il(t,e,i,r,n,o,a){if("point"!==o)return[];if(!t)return[];for(var s,l=[],u=function(t,e,i,r,n,o){for(var a=0,s=0;s<t.length();s++){var l=t.getSection(s);a+=Sl(t.getCharCode(s),l,r,n,e,o)}return a/Math.max(1,Math.ceil(a/i))}(t,e,i,r,n,a),c=t.text.indexOf("")>=0,h=0,p=0;p<t.length();p++){var d=t.getSection(p),f=t.getCharCode(p);if(Tl[f]||(h+=Sl(f,d,r,n,e,a)),p<t.length()-1){var m=!((s=f)<11904||!(Gr["Bopomofo Extended"](s)||Gr.Bopomofo(s)||Gr["CJK Compatibility Forms"](s)||Gr["CJK Compatibility Ideographs"](s)||Gr["CJK Compatibility"](s)||Gr["CJK Radicals Supplement"](s)||Gr["CJK Strokes"](s)||Gr["CJK Symbols and Punctuation"](s)||Gr["CJK Unified Ideographs Extension A"](s)||Gr["CJK Unified Ideographs"](s)||Gr["Enclosed CJK Letters and Months"](s)||Gr["Halfwidth and Fullwidth Forms"](s)||Gr.Hiragana(s)||Gr["Ideographic Description Characters"](s)||Gr["Kangxi Radicals"](s)||Gr["Katakana Phonetic Extensions"](s)||Gr.Katakana(s)||Gr["Vertical Forms"](s)||Gr["Yi Radicals"](s)||Gr["Yi Syllables"](s)));(El[f]||m||d.imageName)&&l.push(Pl(p+1,h,u,l,Cl(f,t.getCharCode(p+1),m&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Pl(t.length(),h,u,l,0,!0))}function Ml(t){var e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function kl(t,e,i,r,n){if(r||n)for(var o=t[i],a=(t[i].x+o.metrics.advance*o.scale)*r,s=e;s<=i;s++)t[s].x-=a,t[s].y+=n}function Dl(t,e,i,r,n,o){var a,s=t.image;if(s.content){var l=s.content,u=s.pixelRatio||1;a=[l[0]/u,l[1]/u,s.displaySize[0]-l[2]/u,s.displaySize[1]-l[3]/u]}var c,h,p,d,f=e.left*o,m=e.right*o;"width"===i||"both"===i?(d=n[0]+f-r[3],h=n[0]+m+r[1]):h=(d=n[0]+(f+m-s.displaySize[0])/2)+s.displaySize[0];var g=e.top*o,y=e.bottom*o;return"height"===i||"both"===i?(c=n[1]+g-r[0],p=n[1]+y+r[2]):p=(c=n[1]+(g+y-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:p,left:d,collisionPadding:a}}El[10]=!0,El[32]=!0,El[38]=!0,El[40]=!0,El[41]=!0,El[43]=!0,El[45]=!0,El[47]=!0,El[173]=!0,El[183]=!0,El[8203]=!0,El[8208]=!0,El[8211]=!0,El[8231]=!0;var Ll=function(t){function e(e,i,r,n){t.call(this,e,i),this.angle=r,void 0!==n&&(this.segment=n)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(n);function Ol(t,e){var i=e.expression;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new an(t+1))};if("source"===i.kind)return{kind:"source"};for(var r=i.zoomStops,n=i.interpolationType,o=0;o<r.length&&r[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);var s=r[o],l=r[a];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:l,minSize:i.evaluate(new an(s)),maxSize:i.evaluate(new an(l)),interpolationType:n}}function Rl(t,e,i){var r=e.uSize,n=i.lowerSize;return"source"===t.kind?n/128:"composite"===t.kind?Ge(n/128,i.upperSize/128,e.uSizeT):r}function zl(t,e){var i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){var n=t.interpolationType,o=n?c(ni.interpolationFactor(n,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?r=Ge(t.minSize,t.maxSize,o):i=o}return{uSizeT:i,uSize:r}}zr("Anchor",Ll);var Fl=Object.freeze({__proto__:null,getSizeData:Ol,evaluateSizeForFeature:Rl,evaluateSizeForZoom:zl,SIZE_PACK_FACTOR:128});function Bl(t,e,i,r,n){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-i/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<i/2;){var c=t[a],h=t[a+1];if(!h)return!1;var p=t[a-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:p}),u+=p;s-l[0].distance>r;)u-=l.shift().angleDelta;if(u>n)return!1;a++,s+=c.dist(h)}return!0}function Nl(t){for(var e=0,i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function jl(t,e,i){return t?.6*e*i:0}function Ul(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Vl(t,e,i,r,n,o){for(var a=jl(i,n,o),s=Ul(i,r)*o,l=0,u=Nl(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],d=h.dist(p);if(l+d>u){var f=(u-l)/d,m=Ge(h.x,p.x,f),g=Ge(h.y,p.y,f),y=new Ll(m,g,p.angleTo(h),c);return y._round(),!a||Bl(t,y,s,a,e)?y:void 0}l+=d}}function Gl(t,e,i,r,n,o,a,s,l){var u=jl(r,o,a),c=Ul(r,n),h=c*a,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),function t(e,i,r,n,o,a,s,l,u){for(var c=a/2,h=Nl(e),p=0,d=i-r,f=[],m=0;m<e.length-1;m++){for(var g=e[m],y=e[m+1],v=g.dist(y),_=y.angleTo(g);d+r<p+v;){var b=((d+=r)-p)/v,x=Ge(g.x,y.x,b),w=Ge(g.y,y.y,b);if(x>=0&&x<u&&w>=0&&w<u&&d-c>=0&&d+c<=h){var T=new Ll(x,w,_,m);T._round(),n&&!Bl(e,T,a,n,o)||f.push(T)}}p+=v}return l||f.length||s||(f=t(e,p/2,r,n,o,a,s,!0,u)),f}(t,p?e/2*s%e:(c/2+2*o)*a*s%e,e,u,i,h,p,!1,l)}function ql(t,e,i,r,o){for(var a=[],s=0;s<t.length;s++)for(var l=t[s],u=void 0,c=0;c<l.length-1;c++){var h=l[c],p=l[c+1];h.x<e&&p.x<e||(h.x<e?h=new n(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<e&&(p=new n(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<i&&p.y<i||(h.y<i?h=new n(h.x+(i-h.y)/(p.y-h.y)*(p.x-h.x),i)._round():p.y<i&&(p=new n(h.x+(i-h.y)/(p.y-h.y)*(p.x-h.x),i)._round()),h.x>=r&&p.x>=r||(h.x>=r?h=new n(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=r&&(p=new n(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new n(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round():p.y>=o&&(p=new n(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round()),u&&h.equals(u[u.length-1])||a.push(u=[h]),u.push(p)))))}return a}function Wl(t,e,i,r){var o=[],a=t.image,s=a.pixelRatio,l=a.paddedRect.w-2,u=a.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,p=a.stretchX||[[0,l]],d=a.stretchY||[[0,u]],f=function(t,e){return t+e[1]-e[0]},m=p.reduce(f,0),g=d.reduce(f,0),y=l-m,v=u-g,_=0,b=m,x=0,w=g,T=0,E=y,S=0,A=v;if(a.content&&r){var C=a.content;_=Hl(p,0,C[0]),x=Hl(d,0,C[1]),b=Hl(p,C[0],C[2]),w=Hl(d,C[1],C[3]),T=C[0]-_,S=C[1]-x,E=C[2]-C[0]-b,A=C[3]-C[1]-w}var P=function(r,o,l,u){var p=Xl(r.stretch-_,b,c,t.left),d=Yl(r.fixed-T,E,r.stretch,m),f=Xl(o.stretch-x,w,h,t.top),y=Yl(o.fixed-S,A,o.stretch,g),v=Xl(l.stretch-_,b,c,t.left),C=Yl(l.fixed-T,E,l.stretch,m),P=Xl(u.stretch-x,w,h,t.top),I=Yl(u.fixed-S,A,u.stretch,g),M=new n(p,f),k=new n(v,f),D=new n(v,P),L=new n(p,P),O=new n(d/s,y/s),R=new n(C/s,I/s),z=e*Math.PI/180;if(z){var F=Math.sin(z),B=Math.cos(z),N=[B,-F,F,B];M._matMult(N),k._matMult(N),L._matMult(N),D._matMult(N)}var j=r.stretch+r.fixed,U=o.stretch+o.fixed;return{tl:M,tr:k,bl:L,br:D,tex:{x:a.paddedRect.x+1+j,y:a.paddedRect.y+1+U,w:l.stretch+l.fixed-j,h:u.stretch+u.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:R,minFontScaleX:E/s/c,minFontScaleY:A/s/h,isSDF:i}};if(r&&(a.stretchX||a.stretchY))for(var I=Zl(p,y,m),M=Zl(d,v,g),k=0;k<I.length-1;k++)for(var D=I[k],L=I[k+1],O=0;O<M.length-1;O++)o.push(P(D,M[O],L,M[O+1]));else o.push(P({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return o}function Hl(t,e,i){for(var r=0,n=0,o=t;n<o.length;n+=1){var a=o[n];r+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]))}return r}function Zl(t,e,i){for(var r=[{fixed:-1,stretch:0}],n=0,o=t;n<o.length;n+=1){var a=o[n],s=a[0],l=a[1],u=r[r.length-1];r.push({fixed:s-u.stretch,stretch:u.stretch}),r.push({fixed:s-u.stretch,stretch:u.stretch+(l-s)})}return r.push({fixed:e+1,stretch:i}),r}function Xl(t,e,i,r){return t/e*i+r}function Yl(t,e,i,r){return t-e*i/r}var Kl=function(t,e,i,r,o,a,s,l,u,c){if(this.boxStartIndex=t.length,u){var h=a.top,p=a.bottom,d=a.collisionPadding;d&&(h-=d[1],p+=d[3]);var f=p-h;f>0&&(f=Math.max(10,f),this.circleDiameter=f)}else{var m=a.top*s-l,g=a.bottom*s+l,y=a.left*s-l,v=a.right*s+l,_=a.collisionPadding;if(_&&(y-=_[0]*s,m-=_[1]*s,v+=_[2]*s,g+=_[3]*s),c){var b=new n(y,m),x=new n(v,m),w=new n(y,g),T=new n(v,g),E=c*Math.PI/180;b._rotate(E),x._rotate(E),w._rotate(E),T._rotate(E),y=Math.min(b.x,x.x,w.x,T.x),v=Math.max(b.x,x.x,w.x,T.x),m=Math.min(b.y,x.y,w.y,T.y),g=Math.max(b.y,x.y,w.y,T.y)}t.emplaceBack(e.x,e.y,y,m,v,g,i,r,o)}this.boxEndIndex=t.length},Jl=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=Ql),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function Ql(t,e){return t<e?-1:t>e?1:0}function $l(t,e,i){void 0===e&&(e=1),void 0===i&&(i=!1);for(var r=1/0,o=1/0,a=-1/0,s=-1/0,l=t[0],u=0;u<l.length;u++){var c=l[u];(!u||c.x<r)&&(r=c.x),(!u||c.y<o)&&(o=c.y),(!u||c.x>a)&&(a=c.x),(!u||c.y>s)&&(s=c.y)}var h=Math.min(a-r,s-o),p=h/2,d=new Jl([],tu);if(0===h)return new n(r,o);for(var f=r;f<a;f+=h)for(var m=o;m<s;m+=h)d.push(new eu(f+p,m+p,p,t));for(var g=function(t){for(var e=0,i=0,r=0,n=t[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],u=n[s],c=l.x*u.y-u.x*l.y;i+=(l.x+u.x)*c,r+=(l.y+u.y)*c,e+=3*c}return new eu(i/e,r/e,0,t)}(t),y=d.length;d.length;){var v=d.pop();(v.d>g.d||!g.d)&&(g=v,i&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,y)),v.max-g.d<=e||(d.push(new eu(v.p.x-(p=v.h/2),v.p.y-p,p,t)),d.push(new eu(v.p.x+p,v.p.y-p,p,t)),d.push(new eu(v.p.x-p,v.p.y+p,p,t)),d.push(new eu(v.p.x+p,v.p.y+p,p,t)),y+=4)}return i&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),g.p}function tu(t,e){return e.max-t.max}function eu(t,e,i,r){this.p=new n(t,e),this.h=i,this.d=function(t,e){for(var i=!1,r=1/0,n=0;n<e.length;n++)for(var o=e[n],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l];u.y>t.y!=c.y>t.y&&t.x<(c.x-u.x)*(t.y-u.y)/(c.y-u.y)+u.x&&(i=!i),r=Math.min(r,Yo(t,u,c))}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}Jl.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Jl.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},Jl.prototype.peek=function(){return this.data[0]},Jl.prototype._up=function(t){for(var e=this.data,i=this.compare,r=e[t];t>0;){var n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r},Jl.prototype._down=function(t){for(var e=this.data,i=this.compare,r=this.length>>1,n=e[t];t<r;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&i(e[s],a)<0&&(o=s,a=e[s]),i(a,n)>=0)break;e[t]=a,t=o}e[t]=n};var iu=Number.POSITIVE_INFINITY;function ru(t,e){return e[1]!==iu?function(t,e,i){var r=0,n=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,n]}(t,e[0],e[1]):function(t,e){var i=0,r=0;e<0&&(e=0);var n=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=n-7;break;case"bottom-right":case"bottom-left":r=7-n;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=e;break;case"right":i=-e}return[i,r]}(t,e[0])}function nu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ou(t,e,i,r,o,a,s,l,u,c,h,p,d,f,m){var g=function(t,e,i,r,o,a,s,l){for(var u=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=[],h=0,p=e.positionedLines;h<p.length;h+=1)for(var d=p[h],f=0,m=d.positionedGlyphs;f<m.length;f+=1){var g=m[f];if(g.rect){var y=g.rect||{},v=4,_=!0,b=1,x=0,w=(o||l)&&g.vertical,T=g.metrics.advance*g.scale/2;if(l&&e.verticalizable&&(x=d.lineOffset/2-(g.imageName?-(24-g.metrics.width*g.scale)/2:24*(g.scale-1))),g.imageName){var E=s[g.imageName];_=E.sdf,v=1/(b=E.pixelRatio)}var S=o?[g.x+T,g.y]:[0,0],A=o?[0,0]:[g.x+T+i[0],g.y+i[1]-x],C=[0,0];w&&(C=A,A=[0,0]);var P=(g.metrics.left-v)*g.scale-T+A[0],I=(-g.metrics.top-v)*g.scale+A[1],M=P+y.w*g.scale/b,k=I+y.h*g.scale/b,D=new n(P,I),L=new n(M,I),O=new n(P,k),R=new n(M,k);if(w){var z=new n(-T,T- -17),F=-Math.PI/2,B=12-T,N=new n(22-B,-(g.imageName?B:0)),j=new(Function.prototype.bind.apply(n,[null].concat(C)));D._rotateAround(F,z)._add(N)._add(j),L._rotateAround(F,z)._add(N)._add(j),O._rotateAround(F,z)._add(N)._add(j),R._rotateAround(F,z)._add(N)._add(j)}if(u){var U=Math.sin(u),V=Math.cos(u),G=[V,-U,U,V];D._matMult(G),L._matMult(G),O._matMult(G),R._matMult(G)}var q=new n(0,0),W=new n(0,0);c.push({tl:D,tr:L,bl:O,br:R,tex:y,writingMode:e.writingMode,glyphOffset:S,sectionIndex:g.sectionIndex,isSDF:_,pixelOffsetTL:q,pixelOffsetBR:W,minFontScaleX:0,minFontScaleY:0})}}return c}(0,i,l,o,a,s,r,t.allowVerticalPlacement),y=t.textSizeData,v=null;"source"===y.kind?(v=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&T(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===y.kind&&((v=[128*f.compositeTextSizes[0].evaluate(s,{},m),128*f.compositeTextSizes[1].evaluate(s,{},m)])[0]>32640||v[1]>32640)&&T(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,g,v,l,a,s,c,e,u.lineStartIndex,u.lineLength,d,m);for(var _=0,b=h;_<b.length;_+=1)p[b[_]]=t.text.placedSymbolArray.length-1;return 4*g.length}function au(t){for(var e in t)return t[e];return null}function su(t,e,i,r){var n=t.compareText;if(e in n){for(var o=n[e],a=o.length-1;a>=0;a--)if(r.dist(o[a])<i)return!0}else n[e]=[];return n[e].push(r),!1}var lu=vs.VectorTileFeature.types,uu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cu(t,e,i,r,n,o,a,s,l,u,c,h,p){var d=s?Math.min(32640,Math.round(s[0])):0,f=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),o,a,(d<<1)+(l?1:0),f,16*u,16*c,256*h,256*p)}function hu(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function pu(t){for(var e=0,i=t.sections;e<i.length;e+=1)if(Yr(i[e].text))return!0;return!1}var du=function(t){this.layoutVertexArray=new Ln,this.indexArray=new jn,this.programConfigurations=t,this.segments=new ao,this.dynamicLayoutVertexArray=new On,this.opacityVertexArray=new Rn,this.placedSymbolArray=new Qn};du.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},du.prototype.upload=function(t,e,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ns.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,js.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,uu,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t))},du.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},zr("SymbolBuffers",du);var fu=function(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new ao,this.collisionVertexArray=new Nn};fu.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Us.members,!0)},fu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},zr("CollisionBuffers",fu);var mu=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oa([]),this.placementViewportMatrix=oa([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ol(this.zoom,e["text-size"]),this.iconSizeData=Ol(this.zoom,e["icon-size"]);var i=this.layers[0].layout,r=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&(i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement")),"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map((function(t){return _l[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};mu.prototype.createArrays=function(){this.text=new du(new Oo(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new du(new Oo(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new eo,this.lineVertexArray=new io,this.symbolInstances=new to},mu.prototype.calculateGlyphDependencies=function(t,e,i,r,n){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(i||r)&&n){var a=Ws[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},mu.prototype.populate=function(t,e,i){var r=this.layers[0],n=r.layout,o=n.get("text-font"),a=n.get("text-field"),s=n.get("icon-image"),l=("constant"!==a.value.kind||a.value.value instanceof ie&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),u="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=n.get("symbol-sort-key");if(this.features=[],l||u){for(var h=e.iconDependencies,p=e.glyphDependencies,d=e.availableImages,f=new an(this.zoom),m=0,g=t;m<g.length;m+=1){var y=g[m],v=y.feature,_=y.id,b=y.index,x=y.sourceLayerIndex,w=r._featureFilter.needGeometry,T={type:v.type,id:_,properties:v.properties,geometry:w?No(v):[]};if(r._featureFilter.filter(f,T,i)){w||(T.geometry=No(v));var E=void 0;if(l){var S=r.getValueAndResolveTokens("text-field",T,i,d),A=ie.factory(S);pu(A)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===rn()||this.hasRTLText&&on.isParsed())&&(E=qs(A,r,T))}var C=void 0;if(u){var P=r.getValueAndResolveTokens("icon-image",T,i,d);C=P instanceof re?P:re.fromString(P)}if(E||C){var I=this.sortFeaturesByKey?c.evaluate(T,{},i):void 0,M={id:_,text:E,icon:C,index:b,sourceLayerIndex:x,geometry:No(v),properties:v.properties,type:lu[v.type],sortKey:I};if(this.features.push(M),C&&(h[C.name]=!0),E){var k=o.evaluate(T,{},i).join(","),D="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_l.vertical)>=0;for(var L=0,O=E.sections;L<O.length;L+=1){var R=O[L];if(R.image)h[R.image.name]=!0;else{var z=qr(E.toString()),F=R.fontStack||k,B=p[F]=p[F]||{};this.calculateGlyphDependencies(R.text,B,D,this.allowVerticalPlacement,z)}}}}}}"line"===n.get("symbol-placement")&&(this.features=function(t){var e={},i={},r=[],n=0;function o(e){r.push(t[e]),n++}function a(t,e,n){var o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function s(t,i,n){var o=e[i];return delete e[i],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(t,e,i){var r=i?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.text?c.text.toString():null;if(p){var d=l(p,h),f=l(p,h,!0);if(d in i&&f in e&&i[d]!==e[f]){var m=s(d,f,h),g=a(d,f,r[m].geometry);delete e[d],delete i[f],i[l(p,r[g].geometry,!0)]=g,r[m].geometry=null}else d in i?a(d,f,h):f in e?s(d,f,h):(o(u),e[d]=n-1,i[f]=n-1)}else o(u)}return r.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},mu.prototype.update=function(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))},mu.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},mu.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},mu.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},mu.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},mu.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},mu.prototype.addToLineVertexArray=function(t,e){var i=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:r},a<e.length-1&&(r+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var u=o[l];this.lineVertexArray.emplaceBack(u.x,u.y,u.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},mu.prototype.addSymbols=function(t,e,i,r,n,o,a,s,l,u,c,h){for(var p=t.indexArray,d=t.layoutVertexArray,f=t.segments.prepareSegment(4*e.length,d,p,o.sortKey),m=this.glyphOffsetArray.length,g=f.vertexLength,y=this.allowVerticalPlacement&&a===_l.vertical?Math.PI/2:0,v=o.text&&o.text.sections,_=0;_<e.length;_++){var b=e[_],x=b.tl,w=b.tr,T=b.bl,E=b.br,S=b.tex,A=b.pixelOffsetTL,C=b.pixelOffsetBR,P=b.minFontScaleX,I=b.minFontScaleY,M=b.glyphOffset,k=b.isSDF,D=b.sectionIndex,L=f.vertexLength,O=M[1];cu(d,s.x,s.y,x.x,O+x.y,S.x,S.y,i,k,A.x,A.y,P,I),cu(d,s.x,s.y,w.x,O+w.y,S.x+S.w,S.y,i,k,C.x,A.y,P,I),cu(d,s.x,s.y,T.x,O+T.y,S.x,S.y+S.h,i,k,A.x,C.y,P,I),cu(d,s.x,s.y,E.x,O+E.y,S.x+S.w,S.y+S.h,i,k,C.x,C.y,P,I),hu(t.dynamicLayoutVertexArray,s,y),p.emplaceBack(L,L+1,L+2),p.emplaceBack(L+1,L+2,L+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),_!==e.length-1&&D===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(d.length,o,o.index,{},h,v&&v[D])}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,l,u,s.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],a,0,!1,0,c)},mu.prototype._addCollisionDebugVertex=function(t,e,i,r,n,o){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,r,n,Math.round(o.x),Math.round(o.y))},mu.prototype.addCollisionDebugVertices=function(t,e,i,r,o,a,s){var l=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),u=l.vertexLength,c=o.layoutVertexArray,h=o.collisionVertexArray,p=s.anchorX,d=s.anchorY;this._addCollisionDebugVertex(c,h,a,p,d,new n(t,e)),this._addCollisionDebugVertex(c,h,a,p,d,new n(i,e)),this._addCollisionDebugVertex(c,h,a,p,d,new n(i,r)),this._addCollisionDebugVertex(c,h,a,p,d,new n(t,r)),l.vertexLength+=4;var f=o.indexArray;f.emplaceBack(u,u+1),f.emplaceBack(u+1,u+2),f.emplaceBack(u+2,u+3),f.emplaceBack(u+3,u),l.primitiveLength+=4},mu.prototype.addDebugCollisionBoxes=function(t,e,i,r){for(var n=t;n<e;n++){var o=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,r?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,i)}},mu.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fu(Fn,Vs.members,Hn),this.iconCollisionBox=new fu(Fn,Vs.members,Hn);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},mu.prototype._deserializeCollisionBoxesForSymbol=function(t,e,i,r,n,o,a,s,l){for(var u={},c=e;c<i;c++){var h=t.get(c);u.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},u.textFeatureIndex=h.featureIndex;break}for(var p=r;p<n;p++){var d=t.get(p);u.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},u.verticalTextFeatureIndex=d.featureIndex;break}for(var f=o;f<a;f++){var m=t.get(f);u.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},u.iconFeatureIndex=m.featureIndex;break}for(var g=s;g<l;g++){var y=t.get(g);u.verticalIconBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY},u.verticalIconFeatureIndex=y.featureIndex;break}return u},mu.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}},mu.prototype.hasTextData=function(){return this.text.segments.get().length>0},mu.prototype.hasIconData=function(){return this.icon.segments.get().length>0},mu.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},mu.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},mu.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},mu.prototype.addIndicesForPlacedSymbol=function(t,e){for(var i=t.placedSymbolArray.get(e),r=i.vertexStartIndex+4*i.numGlyphs,n=i.vertexStartIndex;n<r;n+=4)t.indexArray.emplaceBack(n,n+1,n+2),t.indexArray.emplaceBack(n+1,n+2,n+3)},mu.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),i=Math.cos(t),r=[],n=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);r.push(0|Math.round(e*s.anchorX+i*s.anchorY)),n.push(s.featureIndex)}return o.sort((function(t,e){return r[t]-r[e]||n[e]-n[t]})),o},mu.prototype.addToSortKeyRanges=function(t,e){var i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},mu.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var i=0,r=this.symbolInstanceIndexes;i<r.length;i+=1){var n=this.symbolInstances.get(r[i]);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((function(t,i,r){t>=0&&r.indexOf(t)===i&&e.addIndicesForPlacedSymbol(e.text,t)})),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},zr("SymbolBucket",mu,{omit:["layers","collisionBoxArray","features","compareText"]}),mu.MAX_GLYPHS=65535,mu.addDynamicAttributes=hu;var gu=new bn({"symbol-placement":new mn(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new mn(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mn(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gn(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mn(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mn(Pt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new mn(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new mn(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mn(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new gn(Pt.layout_symbol["icon-size"]),"icon-text-fit":new mn(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mn(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new gn(Pt.layout_symbol["icon-image"]),"icon-rotate":new gn(Pt.layout_symbol["icon-rotate"]),"icon-padding":new mn(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new mn(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new gn(Pt.layout_symbol["icon-offset"]),"icon-anchor":new gn(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mn(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mn(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mn(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new gn(Pt.layout_symbol["text-field"]),"text-font":new gn(Pt.layout_symbol["text-font"]),"text-size":new gn(Pt.layout_symbol["text-size"]),"text-max-width":new gn(Pt.layout_symbol["text-max-width"]),"text-line-height":new mn(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new gn(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new gn(Pt.layout_symbol["text-justify"]),"text-radial-offset":new gn(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mn(Pt.layout_symbol["text-variable-anchor"]),"text-anchor":new gn(Pt.layout_symbol["text-anchor"]),"text-max-angle":new mn(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new mn(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new gn(Pt.layout_symbol["text-rotate"]),"text-padding":new mn(Pt.layout_symbol["text-padding"]),"text-keep-upright":new mn(Pt.layout_symbol["text-keep-upright"]),"text-transform":new gn(Pt.layout_symbol["text-transform"]),"text-offset":new gn(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new mn(Pt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new mn(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new mn(Pt.layout_symbol["text-optional"])}),yu={paint:new bn({"icon-opacity":new gn(Pt.paint_symbol["icon-opacity"]),"icon-color":new gn(Pt.paint_symbol["icon-color"]),"icon-halo-color":new gn(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new gn(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gn(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new mn(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new mn(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new gn(Pt.paint_symbol["text-opacity"]),"text-color":new gn(Pt.paint_symbol["text-color"],{runtimeType:jt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new gn(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new gn(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new gn(Pt.paint_symbol["text-halo-blur"]),"text-translate":new mn(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new mn(Pt.paint_symbol["text-translate-anchor"])}),layout:gu},vu=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:zt,this.defaultValue=t};vu.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},vu.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},vu.prototype.outputDefined=function(){return!1},vu.prototype.serialize=function(){return null},zr("FormatSectionOverride",vu,{omit:["defaultValue"]});var _u=function(t){function e(e){t.call(this,e,yu)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,i){if(t.prototype.recalculate.call(this,e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var n=[],o=0,a=r;o<a.length;o+=1){var s=a[o];n.indexOf(s)<0&&n.push(s)}this.layout._values["text-writing-mode"]=n}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,i,r){var n=this.layout.get(t).evaluate(e,{},i,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||qi(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,i){return i in t?String(t[i]):""}))}(e.properties,n)},e.prototype.createBucket=function(t){return new mu(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,i=yu.paint.overridableProperties;t<i.length;t+=1){var r=i[t];if(e.hasPaintOverride(this.layout,r)){var n,o=this.paint.get(r),a=new vu(o),s=new Gi(a,o.property.specification);n="constant"===o.value.kind||"source"===o.value.kind?new Hi("source",s):new Zi("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new dn(o.property,n,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var i=t.get("text-field"),r=yu.paint.properties[e],n=!1,o=function(t){for(var e=0,i=t;e<i.length;e+=1)if(r.overrides&&r.overrides.hasOverride(i[e]))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof ie)o(i.value.value.sections);else if("source"===i.value.kind){var a=function(t){n||(t instanceof le&&ae(t.value)===qt?o(t.value.sections):t instanceof pe?o(t.sections):t.eachChild(a))},s=i.value;s._styleExpression&&a(s._styleExpression.expression)}return n},e}(xn),bu={paint:new bn({"background-color":new mn(Pt.paint_background["background-color"]),"background-pattern":new vn(Pt.paint_background["background-pattern"]),"background-opacity":new mn(Pt.paint_background["background-opacity"])})},xu=function(t){function e(e){t.call(this,e,bu)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(xn),wu={paint:new bn({"raster-opacity":new mn(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new mn(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mn(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mn(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new mn(Pt.paint_raster["raster-saturation"]),"raster-contrast":new mn(Pt.paint_raster["raster-contrast"]),"raster-resampling":new mn(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new mn(Pt.paint_raster["raster-fade-duration"])})},Tu=function(t){function e(e){t.call(this,e,wu)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(xn),Eu=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(xn),Su={circle:ca,heatmap:ba,hillshade:wa,fill:ls,"fill-extrusion":Ss,line:Fs,symbol:_u,background:xu,raster:Tu},Au=a.HTMLImageElement,Cu=a.HTMLCanvasElement,Pu=a.HTMLVideoElement,Iu=a.ImageData,Mu=a.ImageBitmap,ku=function(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,r)};ku.prototype.update=function(t,e,i){var r=t.width,n=t.height,o=!(this.size&&this.size[0]===r&&this.size[1]===n||i),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,n],t instanceof Au||t instanceof Cu||t instanceof Pu||t instanceof Iu||Mu&&t instanceof Mu?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,n,0,this.format,s.UNSIGNED_BYTE,t.data);else{var l=i||{x:0,y:0},u=l.x,c=l.y;t instanceof Au||t instanceof Cu||t instanceof Pu||t instanceof Iu||Mu&&t instanceof Mu?s.texSubImage2D(s.TEXTURE_2D,0,u,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,u,c,r,n,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},ku.prototype.bind=function(t,e,i){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),i!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},ku.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ku.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Du=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Du.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Du.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Lu=function(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},y(["receive","process"],this),this.invoker=new Du(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=A()?t:a};function Ou(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}Lu.prototype.send=function(t,e,i,r,n){var o=this;void 0===n&&(n=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[a]=i);var s=I(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:jr(e,s)},s),{cancel:function(){i&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:o.mapId})}}},Lu.prototype.receive=function(t){var e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[i];var r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r()}else A()||e.mustQueue?(this.tasks[i]=e,this.taskQueue.push(i),this.invoker.trigger()):this.processTask(i,e)},Lu.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Lu.prototype.processTask=function(t,e){var i=this;if("<response>"===e.type){var r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Ur(e.error)):r(null,Ur(e.data)))}else{var n=!1,o=I(this.globalScope)?void 0:[],a=e.hasCallback?function(e,r){n=!0,delete i.cancelCallbacks[t],i.target.postMessage({id:t,type:"<response>",sourceMapId:i.mapId,error:e?jr(e):null,data:jr(r,o)},o)}:function(t){n=!0},s=null,l=Ur(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,l,a);else if(this.parent.getWorkerSource){var u=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,a)}else a(new Error("Could not find function "+e.type));!n&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Lu.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ru=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ru.prototype.setNorthEast=function(t){return this._ne=t instanceof zu?new zu(t.lng,t.lat):zu.convert(t),this},Ru.prototype.setSouthWest=function(t){return this._sw=t instanceof zu?new zu(t.lng,t.lat):zu.convert(t),this},Ru.prototype.extend=function(t){var e,i,r=this._sw,n=this._ne;if(t instanceof zu)e=t,i=t;else{if(!(t instanceof Ru))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ru.convert(t)):this.extend(zu.convert(t)):this;if(i=t._ne,!(e=t._sw)||!i)return this}return r||n?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),n.lng=Math.max(i.lng,n.lng),n.lat=Math.max(i.lat,n.lat)):(this._sw=new zu(e.lng,e.lat),this._ne=new zu(i.lng,i.lat)),this},Ru.prototype.getCenter=function(){return new zu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ru.prototype.getSouthWest=function(){return this._sw},Ru.prototype.getNorthEast=function(){return this._ne},Ru.prototype.getNorthWest=function(){return new zu(this.getWest(),this.getNorth())},Ru.prototype.getSouthEast=function(){return new zu(this.getEast(),this.getSouth())},Ru.prototype.getWest=function(){return this._sw.lng},Ru.prototype.getSouth=function(){return this._sw.lat},Ru.prototype.getEast=function(){return this._ne.lng},Ru.prototype.getNorth=function(){return this._ne.lat},Ru.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ru.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ru.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ru.prototype.contains=function(t){var e=zu.convert(t),i=e.lng,r=e.lat,n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n},Ru.convert=function(t){return!t||t instanceof Ru?t:new Ru(t)};var zu=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};zu.prototype.wrap=function(){return new zu(h(this.lng,-180,180),this.lat)},zu.prototype.toArray=function(){return[this.lng,this.lat]},zu.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},zu.prototype.distanceTo=function(t){var e=Math.PI/180,i=this.lat*e,r=t.lat*e,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(n,1))},zu.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new Ru(new zu(this.lng-i,this.lat-e),new zu(this.lng+i,this.lat+e))},zu.convert=function(t){if(t instanceof zu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new zu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new zu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Fu=2*Math.PI*6371008.8;function Bu(t){return Fu*Math.cos(t*Math.PI/180)}function Nu(t){return(180+t)/360}function ju(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Uu(t,e){return t/Bu(e)}function Vu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Gu=function(t,e,i){void 0===i&&(i=0),this.x=+t,this.y=+e,this.z=+i};Gu.fromLngLat=function(t,e){void 0===e&&(e=0);var i=zu.convert(t);return new Gu(Nu(i.lng),ju(i.lat),Uu(e,i.lat))},Gu.prototype.toLngLat=function(){return new zu(360*this.x-180,Vu(this.y))},Gu.prototype.toAltitude=function(){return this.z*Bu(Vu(this.y))},Gu.prototype.meterInMercatorCoordinateUnits=function(){return 1/Fu*(t=Vu(this.y),1/Math.cos(t*Math.PI/180));var t};var qu=function(t,e,i){this.z=t,this.x=e,this.y=i,this.key=Zu(0,t,t,e,i)};qu.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},qu.prototype.url=function(t,e){var i,r,n,o,a,s=(r=this.y,n=this.z,o=Ou(256*(i=this.x),256*(r=Math.pow(2,n)-r-1),n),a=Ou(256*(i+1),256*(r+1),n),o[0]+","+o[1]+","+a[0]+","+a[1]),l=function(t,e,i){for(var r,n="",o=t;o>0;o--)n+=(e&(r=1<<o-1)?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)},qu.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new n(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},qu.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Wu=function(t,e){this.wrap=t,this.canonical=e,this.key=Zu(t,e.z,e.z,e.x,e.y)},Hu=function(t,e,i,r,n){this.overscaledZ=t,this.wrap=e,this.canonical=new qu(i,+r,+n),this.key=Zu(e,t,i,r,n)};function Zu(t,e,i,r,n){(t*=2)<0&&(t=-1*t-1);var o=1<<i;return(o*o*t+o*n+r).toString(36)+i.toString(36)+e.toString(36)}Hu.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Hu.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Hu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Hu.prototype.calculateScaledKey=function(t,e){var i=this.canonical.z-t;return t>this.canonical.z?Zu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Zu(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)},Hu.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Hu.prototype.children=function(t){if(this.overscaledZ>=t)return[new Hu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new Hu(e,this.wrap,e,i,r),new Hu(e,this.wrap,e,i+1,r),new Hu(e,this.wrap,e,i,r+1),new Hu(e,this.wrap,e,i+1,r+1)]},Hu.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Hu.prototype.wrapped=function(){return new Hu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Hu.prototype.unwrapTo=function(t){return new Hu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Hu.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Hu.prototype.toUnwrapped=function(){return new Wu(this.wrap,this.canonical)},Hu.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Hu.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Gu(t.x-this.wrap,t.y))},zr("CanonicalTileID",qu),zr("OverscaledTileID",Hu,{omit:["posMatrix"]});var Xu=function(t,e,i){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return T('"'+i+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var r=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=i||"mapbox";for(var n=0;n<r;n++)this.data[this._idx(-1,n)]=this.data[this._idx(0,n)],this.data[this._idx(r,n)]=this.data[this._idx(r-1,n)],this.data[this._idx(n,-1)]=this.data[this._idx(n,0)],this.data[this._idx(n,r)]=this.data[this._idx(n,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Xu.prototype.get=function(t,e){var i=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[r],i[r+1],i[r+2])},Xu.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Xu.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Xu.prototype._unpackMapbox=function(t,e,i){return(256*t*256+256*e+i)/10-1e4},Xu.prototype._unpackTerrarium=function(t,e,i){return 256*t+e+i/256-32768},Xu.prototype.getPixels=function(){return new ya({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Xu.prototype.backfillBorder=function(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var r=e*this.dim,n=e*this.dim+this.dim,o=i*this.dim,a=i*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,l=-i*this.dim,u=o;u<a;u++)for(var c=r;c<n;c++)this.data[this._idx(c,u)]=t.data[this._idx(c+s,u+l)]},zr("DEMData",Xu);var Yu=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}};Yu.prototype.encode=function(t){return this._stringToNumber[t]},Yu.prototype.decode=function(t){return this._numberToString[t]};var Ku=function(t,e,i,r,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=r,this.properties=t.properties,this.id=n},Ju={geometry:{configurable:!0}};Ju.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ju.geometry.set=function(t){this._geometry=t},Ku.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Ku.prototype,Ju);var Qu=function(){this.state={},this.stateChanges={},this.deletedStates={}};Qu.prototype.updateState=function(t,e,i){var r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},p(this.stateChanges[t][r],i),null===this.deletedStates[t])for(var n in this.deletedStates[t]={},this.state[t])n!==r&&(this.deletedStates[t][n]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][r])for(var o in this.deletedStates[t][r]={},this.state[t][r])i[o]||(this.deletedStates[t][r][o]=null);else for(var a in i)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][a]&&delete this.deletedStates[t][r][a]},Qu.prototype.removeFeatureState=function(t,e,i){if(null!==this.deletedStates[t]){var r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(i in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][i]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}},Qu.prototype.getState=function(t,e){var i=String(e),r=p({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var n=this.deletedStates[t][e];if(null===n)return{};for(var o in n)delete r[o]}return r},Qu.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Qu.prototype.coalesceChanges=function(t,e){var i={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var n={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),p(this.state[r][o],this.stateChanges[r][o]),n[o]=this.state[r][o];i[r]=n}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var l in this.state[a])s[l]={},this.state[a][l]={};else for(var u in this.deletedStates[a]){if(null===this.deletedStates[a][u])this.state[a][u]={};else for(var c=0,h=Object.keys(this.deletedStates[a][u]);c<h.length;c+=1)delete this.state[a][u][h[c]];s[u]=this.state[a][u]}i[a]=i[a]||{},p(i[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(var d in t)t[d].setFeatureState(i,e)};var $u=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new kr(8192,16,0),this.grid3D=new kr(8192,16,0),this.featureIndexArray=new no,this.promoteId=e};function tc(t,e,i,r,n){return _(t,(function(t,o){var a=e instanceof fn?e.get(o):null;return a&&a.evaluate?a.evaluate(i,r,n):a}))}function ec(t){for(var e=1/0,i=1/0,r=-1/0,n=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),i=Math.min(i,s.y),r=Math.max(r,s.x),n=Math.max(n,s.y)}return{minX:e,minY:i,maxX:r,maxY:n}}function ic(t,e){return e-t}$u.prototype.insert=function(t,e,i,r,n,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);for(var s=o?this.grid3D:this.grid,l=0;l<e.length;l++){for(var u=e[l],c=[1/0,1/0,-1/0,-1/0],h=0;h<u.length;h++){var p=u[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},$u.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new vs.VectorTile(new Xs(this.rawTileData)).layers,this.sourceLayerCoder=new Yu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},$u.prototype.query=function(t,e,i,r){var o=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,l=nr(a.filter),u=t.queryGeometry,c=t.queryPadding*s,h=ec(u),p=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),d=ec(t.cameraQueryGeometry),f=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,(function(e,i,r,o){return function(t,e,i,r,o){for(var a=0,s=t;a<s.length;a+=1){var l=s[a];if(e<=l.x&&i<=l.y&&r>=l.x&&o>=l.y)return!0}var u=[new n(e,i),new n(e,o),new n(r,o),new n(r,i)];if(t.length>2)for(var c=0,h=u;c<h.length;c+=1)if(Jo(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(Qo(t[p],t[p+1],u))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,r+c,o+c)})),m=0,g=f;m<g.length;m+=1)p.push(g[m]);p.sort(ic);for(var y,v={},_=function(n){var c=p[n];if(c!==y){y=c;var h=o.featureIndexArray.get(c),d=null;o.loadMatchingFeature(v,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,l,a.layers,a.availableImages,e,i,r,(function(e,i,r){return d||(d=No(e)),i.queryIntersectsFeature(u,e,r,d,o.z,t.transform,s,t.pixelPosMatrix)}))}},b=0;b<p.length;b++)_(b);return v},$u.prototype.loadMatchingFeature=function(t,e,i,r,n,o,a,s,l,u,c){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(o,h)){var p=this.sourceLayerCoder.decode(i),d=this.vtLayers[p].feature(r);if(n.filter(new an(this.tileID.overscaledZ),d))for(var f=this.getId(d,p),m=0;m<h.length;m++){var g=h[m];if(!(o&&o.indexOf(g)<0)){var y=s[g];if(y){var v={};void 0!==f&&u&&(v=u.getState(y.sourceLayer||"_geojsonTileLayer",f));var _=l[g];_.paint=tc(_.paint,y.paint,d,v,a),_.layout=tc(_.layout,y.layout,d,v,a);var b=!c||c(d,y,v);if(b){var x=new Ku(d,this.z,this.x,this.y,f);x.layer=_;var w=t[g];void 0===w&&(w=t[g]=[]),w.push({featureIndex:r,feature:x,intersectionZ:b})}}}}}},$u.prototype.lookupSymbolFeatures=function(t,e,i,r,n,o,a,s){var l={};this.loadVTLayers();for(var u=nr(n),c=0,h=t;c<h.length;c+=1)this.loadMatchingFeature(l,i,r,h[c],u,o,a,s,e);return l},$u.prototype.hasLayer=function(t){for(var e=0,i=this.bucketLayerIDs;e<i.length;e+=1)for(var r=0,n=i[e];r<n.length;r+=1)if(t===n[r])return!0;return!1},$u.prototype.getId=function(t,e){var i=t.id;return this.promoteId&&"boolean"==typeof(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(i=Number(i)),i},zr("FeatureIndex",$u,{omit:["rawTileData","sourceLayerCoder"]});var rc=function(t,e){this.tileID=t,this.uid=f(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};rc.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<B.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},rc.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},rc.prototype.loadVectorData=function(t,e,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var r in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var i={};if(!e)return i;for(var r=function(){var t=o[n],r=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return r.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=r;a<s.length;a+=1)i[s[a].id]=t}},n=0,o=t;n<o.length;n+=1)r();return i}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var n=this.buckets[r];if(n instanceof mu){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof mu&&a.hasRTLText){this.hasRTLText=!0,on.isLoading()||on.isLoaded()||"deferred"!==rn()||nn();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(l))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Kn},rc.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},rc.prototype.getBucket=function(t){return this.buckets[t.id]},rc.prototype.upload=function(t){for(var e in this.buckets){var i=this.buckets[e];i.uploadPending()&&i.upload(t)}var r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ku(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ku(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},rc.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},rc.prototype.queryRenderedFeatures=function(t,e,i,r,n,o,a,s,l,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:o,tileSize:this.tileSize,pixelPosMatrix:u,transform:s,params:a,queryPadding:this.queryPadding*l},t,e,i):{}},rc.prototype.querySourceFeatures=function(t,e){var i=this.latestFeatureIndex;if(i&&i.rawTileData){var r=i.loadVTLayers(),n=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[n];if(o)for(var a=nr(e&&e.filter),s=this.tileID.canonical,l=s.z,u=s.x,c=s.y,h={z:l,x:u,y:c},p=0;p<o.length;p++){var d=o.feature(p);if(a.filter(new an(this.tileID.overscaledZ),d)){var f=i.getId(d,n),m=new Ku(d,l,u,c,f);m.tile=h,t.push(m)}}}},rc.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},rc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},rc.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var i=C(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),n=!1;if(this.expirationTime>r)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{var o=this.expirationTime-e;o?this.expirationTime=r+Math.max(o,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},rc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},rc.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var i=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(e.style.hasLayer(r)){var n=this.buckets[r],o=n.layers[0].sourceLayer||"_geojsonTileLayer",a=i[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){n.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var l=e&&e.style&&e.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}}},rc.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},rc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()},rc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},rc.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=B.now()+t},rc.prototype.setDependencies=function(t,e){for(var i={},r=0,n=e;r<n.length;r+=1)i[n[r]]=!0;this.dependencies[t]=i},rc.prototype.hasDependency=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var n=this.dependencies[r[i]];if(n)for(var o=0,a=e;o<a.length;o+=1)if(n[a[o]])return!0}return!1};var nc=a.performance,oc=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},nc.mark(this._marks.start)};oc.prototype.finish=function(){nc.mark(this._marks.end);var t=nc.getEntriesByName(this._marks.measure);return 0===t.length&&(nc.measure(this._marks.measure,this._marks.start,this._marks.end),t=nc.getEntriesByName(this._marks.measure),nc.clearMarks(this._marks.start),nc.clearMarks(this._marks.end),nc.clearMeasures(this._marks.measure)),t},t.Actor=Lu,t.AlphaImage=ga,t.CanonicalTileID=qu,t.CollisionBoxArray=Kn,t.Color=$t,t.DEMData=Xu,t.DataConstantProperty=mn,t.DictionaryCoder=Yu,t.EXTENT=8192,t.ErrorEvent=At,t.EvaluationParameters=an,t.Event=St,t.Evented=Ct,t.FeatureIndex=$u,t.FillBucket=os,t.FillExtrusionBucket=ws,t.ImageAtlas=vl,t.ImagePosition=gl,t.LineBucket=Ls,t.LngLat=zu,t.LngLatBounds=Ru,t.MercatorCoordinate=Gu,t.ONE_EM=24,t.OverscaledTileID=Hu,t.Point=n,t.Point$1=n,t.Properties=bn,t.Protobuf=Xs,t.RGBAImage=ya,t.RequestManager=W,t.RequestPerformance=oc,t.ResourceType=ft,t.SegmentVector=ao,t.SourceFeatureState=Qu,t.StructArrayLayout1ui2=Zn,t.StructArrayLayout2f1f2i16=Bn,t.StructArrayLayout2i4=Cn,t.StructArrayLayout3ui6=jn,t.StructArrayLayout4i8=Pn,t.SymbolBucket=mu,t.Texture=ku,t.Tile=rc,t.Transitionable=un,t.Uniform1f=bo,t.Uniform1i=_o,t.Uniform2f=xo,t.Uniform3f=wo,t.Uniform4f=To,t.UniformColor=Eo,t.UniformMatrix4f=Ao,t.UnwrappedTileID=Wu,t.ValidationError=It,t.WritingMode=_l,t.ZoomHistory=Vr,t.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},t.addDynamicAttributes=hu,t.asyncAll=function(t,e,i){if(!t.length)return i(null,[]);var r=t.length,n=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),n[a]=e,0==--r&&i(o,n)}))}))},t.bezier=l,t.bindAll=y,t.browser=B,t.cacheEntryPossiblyAdded=function(t){++pt>lt&&(t.getActor().send("enforceCacheSizeLimit",st),pt=0)},t.clamp=c,t.clearTileCache=function(t){var e=a.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=ql,t.clone=function(t){var e=new na(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=x,t.clone$2=function(t){var e=new na(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Gs,t.config=N,t.create=function(){var t=new na(16);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new na(9);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new na(4);return na!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Wi,t.createLayout=Sn,t.createStyleLayer=function(t){return"custom"===t.type?new Eu(t):new Su[t.type](t)},t.cross=function(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[0],s=i[1],l=i[2];return t[0]=n*l-o*s,t[1]=o*a-r*l,t[2]=r*s-n*a,t},t.deepEqual=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var n in e)if(!t(e[n],i[n]))return!1;return!0}return e===i},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=u,t.emitValidationErrors=Mr,t.endsWith=v,t.enforceCacheSizeLimit=function(t){ut(),tt&&tt.then((function(e){e.keys().then((function(i){for(var r=0;r<i.length-t;r++)e.delete(i[r])}))}))},t.evaluateSizeForFeature=Rl,t.evaluateSizeForZoom=zl,t.evaluateVariableOffset=ru,t.evented=en,t.extend=p,t.featureFilter=nr,t.filterObject=b,t.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Ml,t.getAnchorJustification=nu,t.getArrayBuffer=bt,t.getImage=wt,t.getJSON=function(t,e){return _t(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=rn,t.getReferrer=vt,t.getVideo=function(t,e){var i,r,n=a.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(var o=0;o<t.length;o++){var s=a.document.createElement("source");i=t[o],r=void 0,(r=a.document.createElement("a")).href=i,(r.protocol!==a.document.location.protocol||r.host!==a.document.location.host)&&(n.crossOrigin="Anonymous"),s.src=t[o],n.appendChild(s)}return{cancel:function(){}}},t.identity=oa,t.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=i*s-r*a,_=i*l-n*a,b=i*u-o*a,x=r*l-n*s,w=r*u-o*s,T=n*u-o*l,E=c*m-h*f,S=c*g-p*f,A=c*y-d*f,C=h*g-p*m,P=h*y-d*m,I=p*y-d*g,M=v*I-_*P+b*C+x*A-w*S+T*E;return M?(t[0]=(s*I-l*P+u*C)*(M=1/M),t[1]=(n*P-r*I-o*C)*M,t[2]=(m*T-g*w+y*x)*M,t[3]=(p*w-h*T-d*x)*M,t[4]=(l*A-a*I-u*S)*M,t[5]=(i*I-n*A+o*S)*M,t[6]=(g*b-f*T-y*_)*M,t[7]=(c*T-p*b+d*_)*M,t[8]=(a*P-s*A+u*E)*M,t[9]=(r*A-i*P-o*E)*M,t[10]=(f*w-m*b+y*v)*M,t[11]=(h*b-c*w-d*v)*M,t[12]=(s*S-a*C-l*E)*M,t[13]=(i*C-r*S+n*E)*M,t[14]=(m*_-f*x-g*v)*M,t[15]=(c*x-h*_+p*v)*M,t):null},t.isChar=Gr,t.isMapboxURL=H,t.keysDifference=function(t,e){var i=[];for(var r in t)r in e||i.push(r);return i},t.makeRequest=_t,t.mapObject=_,t.mercatorXfromLng=Nu,t.mercatorYfromLat=ju,t.mercatorZfromAltitude=Uu,t.mul=la,t.multiply=aa,t.mvt=vs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=Ge,t.offscreenCanvasSupported=dt,t.ortho=function(t,e,i,r,n,o,a){var s=1/(e-i),l=1/(r-n),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*s,t[13]=(n+r)*l,t[14]=(a+o)*u,t[15]=1,t},t.parseGlyphPBF=function(t){return new Xs(t).readFields(pl,[])},t.pbf=Xs,t.performSymbolLayout=function(t,e,i,r,n,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;u.compositeTextSizes=[l["text-size"].possiblyEvaluate(new an(c.minZoom),a),l["text-size"].possiblyEvaluate(new an(h),a)]}if("composite"===t.iconSizeData.kind){var p=t.iconSizeData,d=p.maxZoom;u.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new an(p.minZoom),a),l["icon-size"].possiblyEvaluate(new an(d),a)]}u.layoutTextSize=l["text-size"].possiblyEvaluate(new an(t.zoom+1),a),u.layoutIconSize=l["icon-size"].possiblyEvaluate(new an(t.zoom+1),a),u.textMaxSize=l["text-size"].possiblyEvaluate(new an(18));for(var f=24*s.get("text-line-height"),m="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),g=s.get("text-keep-upright"),y=s.get("text-size"),v=function(){var o=b[_],l=s.get("text-font").evaluate(o,{},a).join(","),c=y.evaluate(o,{},a),h=u.layoutTextSize.evaluate(o,{},a),p=u.layoutIconSize.evaluate(o,{},a),d={horizontal:{},vertical:void 0},v=o.text,x=[0,0];if(v){var w=v.toString(),E=24*s.get("text-letter-spacing").evaluate(o,{},a),S=function(t){for(var e=0,i=t;e<i.length;e+=1)if(r=i[e].charCodeAt(0),Gr.Arabic(r)||Gr["Arabic Supplement"](r)||Gr["Arabic Extended-A"](r)||Gr["Arabic Presentation Forms-A"](r)||Gr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(w)?E:0,A=s.get("text-anchor").evaluate(o,{},a),C=s.get("text-variable-anchor");if(!C){var P=s.get("text-radial-offset").evaluate(o,{},a);x=P?ru(A,[24*P,iu]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var I=m?"center":s.get("text-justify").evaluate(o,{},a),M=s.get("symbol-placement"),k="point"===M?24*s.get("text-max-width").evaluate(o,{},a):0,D=function(){t.allowVerticalPlacement&&qr(w)&&(d.vertical=wl(v,e,i,n,l,k,f,A,"left",S,x,_l.vertical,!0,M,h,c))};if(!m&&C){for(var L="auto"===I?C.map((function(t){return nu(t)})):[I],O=!1,R=0;R<L.length;R++){var z=L[R];if(!d.horizontal[z])if(O)d.horizontal[z]=d.horizontal[0];else{var F=wl(v,e,i,n,l,k,f,"center",z,S,x,_l.horizontal,!1,M,h,c);F&&(d.horizontal[z]=F,O=1===F.positionedLines.length)}}D()}else{"auto"===I&&(I=nu(A));var B=wl(v,e,i,n,l,k,f,A,I,S,x,_l.horizontal,!1,M,h,c);B&&(d.horizontal[I]=B),D(),qr(w)&&m&&g&&(d.vertical=wl(v,e,i,n,l,k,f,A,I,S,x,_l.vertical,!1,M,h,c))}}var N=void 0,j=!1;if(o.icon&&o.icon.name){var U=r[o.icon.name];U&&(N=function(t,e,i){var r=Ml(i),n=e[0]-t.displaySize[0]*r.horizontalAlign,o=e[1]-t.displaySize[1]*r.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:n,right:n+t.displaySize[0]}}(n[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),j=U.sdf,void 0===t.sdfIcons?t.sdfIcons=U.sdf:t.sdfIcons!==U.sdf&&T("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var V=au(d.horizontal)||d.vertical;t.iconsInText=!!V&&V.iconsInText,(V||N)&&function(t,e,i,r,n,o,a,s,l,u,c){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=a);var p,d=t.layers[0].layout,f=d.get("icon-offset").evaluate(e,{},c),m=au(i.horizontal),g=a/24,y=t.tilePixelRatio*g,v=t.tilePixelRatio*h/24,_=t.tilePixelRatio*s,b=t.tilePixelRatio*d.get("symbol-spacing"),x=d.get("text-padding")*t.tilePixelRatio,w=d.get("icon-padding")*t.tilePixelRatio,E=d.get("text-max-angle")/180*Math.PI,S="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),A="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),C=d.get("symbol-placement"),P=b/2,I=d.get("icon-text-fit");r&&"none"!==I&&(t.allowVerticalPlacement&&i.vertical&&(p=Dl(r,i.vertical,I,d.get("icon-text-fit-padding"),f,g)),m&&(r=Dl(r,m,I,d.get("icon-text-fit-padding"),f,g)));var M=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m,g,y,v,_,b,x,w,E,S){var A,C,P,I,M,k=t.addToLineVertexArray(e,i),D=0,L=0,O=0,R=0,z=-1,F=-1,B={},N=ho(""),j=0,U=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(j=(A=s.layout.get("text-offset").evaluate(b,{},E).map((function(t){return 24*t})))[0],U=A[1]):(j=24*s.layout.get("text-radial-offset").evaluate(b,{},E),U=iu),t.allowVerticalPlacement&&r.vertical){var V=s.layout.get("text-rotate").evaluate(b,{},E)+90;I=new Kl(l,e,u,c,h,r.vertical,p,d,f,V),a&&(M=new Kl(l,e,u,c,h,a,g,y,f,V))}if(n){var G=s.layout.get("icon-rotate").evaluate(b,{}),q="none"!==s.layout.get("icon-text-fit"),W=Wl(n,G,w,q),H=a?Wl(a,G,w,q):void 0;P=new Kl(l,e,u,c,h,n,g,y,!1,G),D=4*W.length;var Z=t.iconSizeData,X=null;"source"===Z.kind?(X=[128*s.layout.get("icon-size").evaluate(b,{})])[0]>32640&&T(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===Z.kind&&((X=[128*x.compositeIconSizes[0].evaluate(b,{},E),128*x.compositeIconSizes[1].evaluate(b,{},E)])[0]>32640||X[1]>32640)&&T(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,W,X,_,v,b,!1,e,k.lineStartIndex,k.lineLength,-1,E),z=t.icon.placedSymbolArray.length-1,H&&(L=4*H.length,t.addSymbols(t.icon,H,X,_,v,b,_l.vertical,e,k.lineStartIndex,k.lineLength,-1,E),F=t.icon.placedSymbolArray.length-1)}for(var Y in r.horizontal){var K=r.horizontal[Y];if(!C){N=ho(K.text);var J=s.layout.get("text-rotate").evaluate(b,{},E);C=new Kl(l,e,u,c,h,K,p,d,f,J)}var Q=1===K.positionedLines.length;if(O+=ou(t,e,K,o,s,f,b,m,k,r.vertical?_l.horizontal:_l.horizontalOnly,Q?Object.keys(r.horizontal):[Y],B,z,x,E),Q)break}r.vertical&&(R+=ou(t,e,r.vertical,o,s,f,b,m,k,_l.vertical,["vertical"],B,F,x,E));var $=C?C.boxStartIndex:t.collisionBoxArray.length,tt=C?C.boxEndIndex:t.collisionBoxArray.length,et=I?I.boxStartIndex:t.collisionBoxArray.length,it=I?I.boxEndIndex:t.collisionBoxArray.length,rt=P?P.boxStartIndex:t.collisionBoxArray.length,nt=P?P.boxEndIndex:t.collisionBoxArray.length,ot=M?M.boxStartIndex:t.collisionBoxArray.length,at=M?M.boxEndIndex:t.collisionBoxArray.length,st=-1,lt=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=lt(C,st),st=lt(I,st),st=lt(P,st);var ut=(st=lt(M,st))>-1?1:0;ut&&(st*=S/24),t.glyphOffsetArray.length>=mu.MAX_GLYPHS&&T("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,B.right>=0?B.right:-1,B.center>=0?B.center:-1,B.left>=0?B.left:-1,B.vertical||-1,z,F,N,$,tt,et,it,rt,nt,ot,at,u,O,R,D,L,ut,0,p,j,U,st)}(t,h,s,i,r,n,p,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,y,x,S,l,_,w,A,f,e,o,u,c,a)};if("line"===C)for(var k=0,D=ql(e.geometry,0,0,8192,8192);k<D.length;k+=1)for(var L=D[k],O=0,R=Gl(L,b,E,i.vertical||m,r,24,v,t.overscaling,8192);O<R.length;O+=1){var z=R[O];m&&su(t,m.text,P,z)||M(L,z)}else if("line-center"===C)for(var F=0,B=e.geometry;F<B.length;F+=1){var N=B[F];if(N.length>1){var j=Vl(N,E,i.vertical||m,r,24,v);j&&M(N,j)}}else if("Polygon"===e.type)for(var U=0,V=es(e.geometry,0);U<V.length;U+=1){var G=V[U],q=$l(G,16);M(G[0],new Ll(q.x,q.y,0))}else if("LineString"===e.type)for(var W=0,H=e.geometry;W<H.length;W+=1){var Z=H[W];M(Z,new Ll(Z[0].x,Z[0].y,0))}else if("Point"===e.type)for(var X=0,Y=e.geometry;X<Y.length;X+=1)for(var K=0,J=Y[X];K<J.length;K+=1){var Q=J[K];M([Q],new Ll(Q.x,Q.y,0))}}(t,o,d,N,r,u,h,p,x,j,a)},_=0,b=t.features;_<b.length;_+=1)v();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,i,r,n){var o,a=1/Math.tan(e/2);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+r)*(o=1/(r-n)),t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){for(var i={},r=0;r<e.length;r++){var n=e[r];n in t&&(i[n]=t[n])}return i},t.plugin=on,t.polygonIntersectsPolygon=Vo,t.postMapLoadEvent=at,t.postTurnstileEvent=nt,t.potpack=ml,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=zr,t.registerForPluginStateChange=function(t){return t({pluginStatus:Jr,pluginURL:Qr}),en.on("pluginStateChange",t),t},t.renderColorRamp=_a,t.rotate=function(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*s,t[1]=n*l+a*s,t[2]=r*-s+o*l,t[3]=n*-s+a*l,t},t.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+u*r,t[5]=a*n+c*r,t[6]=s*n+h*r,t[7]=l*n+p*r,t[8]=u*n-o*r,t[9]=c*n-a*r,t[10]=h*n-s*r,t[11]=p*n-l*r,t},t.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+u*r,t[1]=a*n+c*r,t[2]=s*n+h*r,t[3]=l*n+p*r,t[4]=u*n-o*r,t[5]=c*n-a*r,t[6]=h*n-s*r,t[7]=p*n-l*r,t},t.scale=function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},t.scale$2=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},t.setCacheLimits=function(t,e){st=t,lt=e},t.setRTLTextPlugin=function(t,e,i){if(void 0===i&&(i=!1),"deferred"===Jr||"loading"===Jr||"loaded"===Jr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qr=B.resolveURL(t),Jr="deferred",Kr=e,tn(),i||nn()},t.sphericalToCartesian=function(t){var e=t[0],i=t[1],r=t[2];return i+=90,i*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(i)*Math.sin(r),y:e*Math.sin(i)*Math.sin(r),z:e*Math.cos(r)}},t.sqrLen=function(t){var e=t[0],i=t[1];return e*e+i*i},t.styleSpec=Pt,t.sub=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},t.symbolSize=Fl,t.transformMat3=function(t,e,i){var r=e[0],n=e[1],o=e[2];return t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8],t},t.transformMat4=ua,t.translate=function(t,e,i){var r,n,o,a,s,l,u,c,h,p,d,f,m=i[0],g=i[1],y=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=r=e[0],t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=r*m+s*g+h*y+e[12],t[13]=n*m+l*g+p*y+e[13],t[14]=o*m+u*g+d*y+e[14],t[15]=a*m+c*g+f*y+e[15]),t},t.triggerPluginCompletionEvent=$r,t.uniqueId=f,t.validateCustomStyleLayer=function(t){var e=[],i=t.id;return void 0===i&&e.push({message:"layers."+i+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+i+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+i+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Cr,t.validateStyle=Ar,t.values=function(t){var e=[];for(var i in t)e.push(t[i]);return e},t.vectorTile=vs,t.version="1.12.0",t.warnOnce=T,t.webpSupported=j,t.window=a,t.wrap=h})),r(["./shared"],(function(t){function e(t){var i=typeof t;if("number"===i||"boolean"===i||"string"===i||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",n=0,o=t;n<o.length;n+=1)r+=e(o[n])+",";return r+"]"}for(var a=Object.keys(t).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+e(t[a[l]])+",";return s+"}"}function i(i){for(var r="",n=0,o=t.refProperties;n<o.length;n+=1)r+="/"+e(i[o[n]]);return r}var r=function(t){this.keyCache={},t&&this.replace(t)};r.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},r.prototype.update=function(e,r){for(var n=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var l=this._layers[s.id]=t.createStyleLayer(s);l._featureFilter=t.featureFilter(l.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var u=0,c=r;u<c.length;u+=1){var h=c[u];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,d=function(t,e){for(var r={},n=0;n<t.length;n++){var o=e&&e[t[n].id]||i(t[n]);e&&(e[t[n].id]=o);var a=r[o];a||(a=r[o]=[]),a.push(t[n])}var s=[];for(var l in r)s.push(r[l]);return s}(t.values(this._layerConfigs),this.keyCache);p<d.length;p+=1){var f=d[p].map((function(t){return n._layers[t.id]})),m=f[0];if("none"!==m.visibility){var g=m.source||"",y=this.familiesBySource[g];y||(y=this.familiesBySource[g]={});var v=m.sourceLayer||"_geojsonTileLayer",_=y[v];_||(_=y[v]=[]),_.push(f)}}};var n=function(e){var i={},r=[];for(var n in e){var o=e[n],a=i[n]={};for(var s in o){var l=o[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};r.push(u),a[s]={rect:u,metrics:l.metrics}}}}var c=t.potpack(r),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var p in e){var d=e[p];for(var f in d){var m=d[+f];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var g=i[p][f].rect;t.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:g.x+1,y:g.y+1},m.bitmap)}}}this.image=h,this.positions=i};t.register("GlyphAtlas",n);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function a(e,i,r){for(var n=new t.EvaluationParameters(i),o=0,a=e;o<a.length;o+=1)a[o].recalculate(n,r)}function s(e,i){var r=t.getArrayBuffer(e.request,(function(e,r,n,o){e?i(e):r&&i(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(r)),rawData:r,cacheControl:n,expires:o})}));return function(){r.cancel(),i()}}o.prototype.parse=function(e,i,r,o,s){var l=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var u=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,p,d,f,m={},g={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},y=i.familiesBySource[this.source];for(var v in y){var _=e.layers[v];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+v+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var b=u.encode(v),x=[],w=0;w<_.length;w++){var T=_.feature(w),E=c.getId(T,v);x.push({feature:T,id:E,index:w,sourceLayerIndex:b})}for(var S=0,A=y[v];S<A.length;S+=1){var C=A[S],P=C[0];P.minzoom&&this.zoom<Math.floor(P.minzoom)||P.maxzoom&&this.zoom>=P.maxzoom||"none"!==P.visibility&&(a(C,this.zoom,r),(m[P.id]=P.createBucket({index:c.bucketLayerIDs.length,layers:C,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:b,sourceID:this.source})).populate(x,g,this.tileID.canonical),c.bucketLayerIDs.push(C.map((function(t){return t.id}))))}}}var I=t.mapObject(g.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(I).length?o.send("getGlyphs",{uid:this.uid,stacks:I},(function(t,e){h||(h=t,p=e,D.call(l))})):p={};var M=Object.keys(g.iconDependencies);M.length?o.send("getImages",{icons:M,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,d=e,D.call(l))})):d={};var k=Object.keys(g.patternDependencies);function D(){if(h)return s(h);if(p&&d&&f){var e=new n(p),i=new t.ImageAtlas(d,f);for(var o in m){var l=m[o];l instanceof t.SymbolBucket?(a(l.layers,this.zoom,r),t.performSymbolLayout(l,p,e.positions,d,i.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):l.hasPattern&&(l instanceof t.LineBucket||l instanceof t.FillBucket||l instanceof t.FillExtrusionBucket)&&(a(l.layers,this.zoom,r),l.addFeatures(g,this.tileID.canonical,i.patternPositions))}this.status="done",s(null,{buckets:t.values(m).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:i,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?e.positions:null})}}k.length?o.send("getImages",{icons:k,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,f=e,D.call(l))})):f={},D.call(this)};var l=function(t,e,i,r){this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=r||s,this.loading={},this.loaded={}};l.prototype.loadTile=function(e,i){var r=this,n=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[n]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete r.loading[n],e||!o)return s.status="done",r.loaded[n]=s,i(e);var l=o.rawData,u={};o.expires&&(u.expires=o.expires),o.cacheControl&&(u.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(e,r){if(e||!r)return i(e);i(null,t.extend({rawTileData:l.slice(0)},r,u,c))})),r.loaded=r.loaded||{},r.loaded[n]=s}))},l.prototype.reloadTile=function(t,e){var i=this,r=this.loaded,n=t.uid,o=this;if(r&&r[n]){var a=r[n];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,r){var n=a.reloadCallback;n&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,i.availableImages,o.actor,n)),e(t,r)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},l.prototype.abortTile=function(t,e){var i=this.loading,r=t.uid;i&&i[r]&&i[r].abort&&(i[r].abort(),delete i[r]),e()},l.prototype.removeTile=function(t,e){var i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()};var u=t.window.ImageBitmap,c=function(){this.loaded={}};function h(t,e){if(0!==t.length){p(t[0],e);for(var i=1;i<t.length;i++)p(t[i],!e)}}function p(t,e){for(var i=0,r=0,n=t.length,o=n-1;r<n;o=r++)i+=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]);i>=0!=!!e&&t.reverse()}c.prototype.loadTile=function(e,i){var r=e.uid,n=e.encoding,o=e.rawImageData,a=u&&o instanceof u?this.getImageData(o):o,s=new t.DEMData(r,a,n);this.loaded=this.loaded||{},this.loaded[r]=s,i(null,s)},c.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var i=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:i.width,height:i.height},i.data)},c.prototype.removeTile=function(t){var e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]};var d=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,f=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};f.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],i=0,r=this._feature.geometry;i<r.length;i+=1){var n=r[i];e.push([new t.Point$1(n[0],n[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],u=0,c=s[a];u<c.length;u+=1){var h=c[u];l.push(new t.Point$1(h[0],h[1]))}o.push(l)}return o},f.prototype.toGeoJSON=function(t,e,i){return d.call(this,t,e,i)};var m=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};m.prototype.feature=function(t){return new f(this._features[t])};var g=t.vectorTile.VectorTileFeature,y=v;function v(t,e){this.options=e||{},this.features=t,this.length=t.length}function _(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}v.prototype.feature=function(t){return new _(this.features[t],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var r=e[i],n=[],o=0;o<r.length;o++)n.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(n)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[e,r,i,n]},_.prototype.toGeoJSON=g.prototype.toGeoJSON;var b=w,x=y;function w(e){var i=new t.pbf;return function(t,e){for(var i in t.layers)e.writeMessage(3,T,t.layers[i])}(e,i),i.finish()}function T(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)r.feature=t.feature(i),e.writeMessage(2,E,r);var n=r.keys;for(i=0;i<n.length;i++)e.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)e.writeMessage(4,I,o[i])}function E(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,S,t),e.writeVarintField(3,i.type),e.writeMessage(4,P,i)}function S(t,e){var i=t.feature,r=t.keys,n=t.values,o=t.keycache,a=t.valuecache;for(var s in i.properties){var l=o[s];void 0===l&&(r.push(s),o[s]=l=r.length-1),e.writeVarint(l);var u=i.properties[s],c=typeof u;"string"!==c&&"boolean"!==c&&"number"!==c&&(u=JSON.stringify(u));var h=c+":"+u,p=a[h];void 0===p&&(n.push(u),a[h]=p=n.length-1),e.writeVarint(p)}}function A(t,e){return(e<<3)+(7&t)}function C(t){return t<<1^t>>31}function P(t,e){for(var i=t.loadGeometry(),r=t.type,n=0,o=0,a=i.length,s=0;s<a;s++){var l=i[s],u=1;1===r&&(u=l.length),e.writeVarint(A(1,u));for(var c=3===r?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==r&&e.writeVarint(A(2,c-1));var p=l[h].x-n,d=l[h].y-o;e.writeVarint(C(p)),e.writeVarint(C(d)),n+=p,o+=d}3===r&&e.writeVarint(A(7,1))}}function I(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function M(t,e,i,r){k(t,i,r),k(e,2*i,2*r),k(e,2*i+1,2*r+1)}function k(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function D(t,e,i,r){var n=t-i,o=e-r;return n*n+o*o}b.fromVectorTileJs=w,b.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var r in t)i[r]=new y(t[r].features,e),i[r].name=r,i[r].version=e.version,i[r].extent=e.extent;return w({layers:i})},b.GeoJSONWrapper=x;var L=function(t){return t[0]},O=function(t){return t[1]},R=function(t,e,i,r,n){void 0===e&&(e=L),void 0===i&&(i=O),void 0===r&&(r=64),void 0===n&&(n=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new n(2*t.length),l=0;l<t.length;l++)a[l]=l,s[2*l]=e(t[l]),s[2*l+1]=i(t[l]);!function t(e,i,r,n,o,a){if(!(o-n<=r)){var s=n+o>>1;!function t(e,i,r,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,l=r-n+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,i,r,Math.max(n,Math.floor(r-l*c/s+h)),Math.min(o,Math.floor(r+(s-l)*c/s+h)),a)}var p=i[2*r+a],d=n,f=o;for(M(e,i,n,r),i[2*o+a]>p&&M(e,i,n,o);d<f;){for(M(e,i,d,f),d++,f--;i[2*d+a]<p;)d++;for(;i[2*f+a]>p;)f--}i[2*n+a]===p?M(e,i,n,f):M(e,i,++f,o),f<=r&&(n=f+1),r<=f&&(o=f-1)}}(e,i,s,n,o,a%2),t(e,i,r,n,s-1,a+1),t(e,i,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};R.prototype.range=function(t,e,i,r){return function(t,e,i,r,n,o,a){for(var s,l,u=[0,t.length-1,0],c=[];u.length;){var h=u.pop(),p=u.pop(),d=u.pop();if(p-d<=a)for(var f=d;f<=p;f++)l=e[2*f+1],(s=e[2*f])>=i&&s<=n&&l>=r&&l<=o&&c.push(t[f]);else{var m=Math.floor((d+p)/2);l=e[2*m+1],(s=e[2*m])>=i&&s<=n&&l>=r&&l<=o&&c.push(t[m]);var g=(h+1)%2;(0===h?i<=s:r<=l)&&(u.push(d),u.push(m-1),u.push(g)),(0===h?n>=s:o>=l)&&(u.push(m+1),u.push(p),u.push(g))}}return c}(this.ids,this.coords,t,e,i,r,this.nodeSize)},R.prototype.within=function(t,e,i){return function(t,e,i,r,n,o){for(var a=[0,t.length-1,0],s=[],l=n*n;a.length;){var u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)D(e[2*p],e[2*p+1],i,r)<=l&&s.push(t[p]);else{var d=Math.floor((h+c)/2),f=e[2*d],m=e[2*d+1];D(f,m,i,r)<=l&&s.push(t[d]);var g=(u+1)%2;(0===u?i-n<=f:r-n<=m)&&(a.push(h),a.push(d-1),a.push(g)),(0===u?i+n>=f:r+n>=m)&&(a.push(d+1),a.push(c),a.push(g))}}return s}(this.ids,this.coords,t,e,i,this.nodeSize)};var z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},F=function(t){this.options=q(Object.create(z),t),this.trees=new Array(this.options.maxZoom+1)};function B(t,e,i,r,n){return{x:t,y:e,zoom:1/0,id:i,parentId:-1,numPoints:r,properties:n}}function N(t,e){var i=t.geometry.coordinates,r=i[1];return{x:V(i[0]),y:G(r),zoom:1/0,index:e,parentId:-1}}function j(t){return{type:"Feature",id:t.id,properties:U(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,i=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(i))/Math.PI-90)]}};var e,i,r}function U(t){var e=t.numPoints,i=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return q(q({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function V(t){return t/360+.5}function G(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function q(t,e){for(var i in e)t[i]=e[i];return t}function W(t){return t.x}function H(t){return t.y}function Z(t,e,i,r,n,o){var a=n-i,s=o-r;if(0!==a||0!==s){var l=((t-i)*a+(e-r)*s)/(a*a+s*s);l>1?(i=n,r=o):l>0&&(i+=a*l,r+=s*l)}return(a=t-i)*a+(s=e-r)*s}function X(t,e,i,r){var n={id:void 0===t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Y(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<e.length;r++)Y(t,e[r]);else if("MultiPolygon"===i)for(r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)Y(t,e[r][n])}(n),n}function Y(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function K(t,e,i,r){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),s=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)J(n,s);else if("MultiPoint"===o)for(var u=0;u<n.length;u++)J(n[u],s);else if("LineString"===o)Q(n,s,a,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(u=0;u<n.length;u++)Q(n[u],s=[],a,!1),t.push(X(l,"LineString",s,e.properties));return}$(n,s,a,!1)}else if("Polygon"===o)$(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)K(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<n.length;u++){var c=[];$(n[u],c,a,!0),s.push(c)}}t.push(X(l,o,s,e.properties))}}function J(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function Q(t,e,i,r){for(var n,o,a=0,s=0;s<t.length;s++){var l=tt(t[s][0]),u=et(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=r?(n*u-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(u-o,2))),n=l,o=u}var c=e.length-3;e[2]=1,function t(e,i,r,n){for(var o,a=n,s=r-i>>1,l=r-i,u=e[i],c=e[i+1],h=e[r],p=e[r+1],d=i+3;d<r;d+=3){var f=Z(e[d],e[d+1],u,c,h,p);if(f>a)o=d,a=f;else if(f===a){var m=Math.abs(d-s);m<l&&(o=d,l=m)}}a>n&&(o-i>3&&t(e,i,o,n),e[o+2]=a,r-o>3&&t(e,o,r,n))}(e,0,c,i),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function $(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];Q(t[n],o,i,r),e.push(o)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function it(t,e,i,r,n,o,a,s){if(r/=e,o>=(i/=e)&&a<r)return t;if(a<i||o>=r)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,d=0===n?c.minX:c.minY,f=0===n?c.maxX:c.maxY;if(d>=i&&f<r)l.push(c);else if(!(f<i||d>=r)){var m=[];if("Point"===p||"MultiPoint"===p)rt(h,m,i,r,n);else if("LineString"===p)nt(h,m,i,r,n,!1,s.lineMetrics);else if("MultiLineString"===p)at(h,m,i,r,n,!1);else if("Polygon"===p)at(h,m,i,r,n,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];at(h[g],y,i,r,n,!0),y.length&&m.push(y)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(X(c.id,p,m[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(X(c.id,p,m,c.tags))}}}return l.length?l:null}function rt(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var a=t[o+n];a>=i&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function nt(t,e,i,r,n,o,a){for(var s,l,u=ot(t),c=0===n?lt:ut,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],v=0===n?d:f,_=0===n?g:y,b=!1;a&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-y,2))),v<i?_>i&&(l=c(u,d,f,g,y,i),a&&(u.start=h+s*l)):v>r?_<r&&(l=c(u,d,f,g,y,r),a&&(u.start=h+s*l)):st(u,d,f,m),_<i&&v>=i&&(l=c(u,d,f,g,y,i),b=!0),_>r&&v<=r&&(l=c(u,d,f,g,y,r),b=!0),!o&&b&&(a&&(u.end=h+s*l),e.push(u),u=ot(t)),a&&(h+=s)}var x=t.length-3;d=t[x],f=t[x+1],m=t[x+2],(v=0===n?d:f)>=i&&v<=r&&st(u,d,f,m),x=u.length-3,o&&x>=3&&(u[x]!==u[0]||u[x+1]!==u[1])&&st(u,u[0],u[1],u[2]),u.length&&e.push(u)}function ot(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,i,r,n,o){for(var a=0;a<t.length;a++)nt(t[a],e,i,r,n,o,!1)}function st(t,e,i,r){t.push(e),t.push(i),t.push(r)}function lt(t,e,i,r,n,o){var a=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*a),t.push(1),a}function ut(t,e,i,r,n,o){var a=(o-i)/(n-i);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function ct(t,e){for(var i=[],r=0;r<t.length;r++){var n,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)n=ht(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){n=[];for(var s=0;s<o.geometry.length;s++)n.push(ht(o.geometry[s],e))}else if("MultiPolygon"===a)for(n=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(ht(o.geometry[s][u],e));n.push(l)}i.push(X(o.id,a,n,o.tags))}return i}function ht(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function pt(t,e){if(t.transformed)return t;var i,r,n,o=1<<t.z,a=t.x,s=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(r=0;r<u.length;r+=2)l.geometry.push(dt(u[r],u[r+1],e,o,a,s));else for(r=0;r<u.length;r++){var h=[];for(n=0;n<u[r].length;n+=2)h.push(dt(u[r][n],u[r][n+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function dt(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function ft(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,mt(a,t[s],o,n);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function mt(t,e,i,r){var n=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)gt(a,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)gt(a,n[s],t,i,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(s=0;s<u.length;s++)gt(a,u[s],t,i,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function gt(t,e,i,r,n,o){var a=r*r;if(r>0&&e.size<(n?a:r))i.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>a)&&(i.numSimplified++,s.push(e[l]),s.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(i>0===e)for(r=0,n=t.length;r<n/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=a,t[n-1-r]=s}}(s,o),t.push(s)}}function yt(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)K(i,t.features[r],e,r);else K(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var i=e.buffer/e.extent,r=t,n=it(t,1,-1-i,i,0,-1,2,e),o=it(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=it(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=ct(n,1).concat(r)),o&&(r=r.concat(ct(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(t,e,i){return 32*((1<<t)*i+e)+t}function _t(t,e){var i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return e(null,null);var n=new m(r.features),o=b(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:n,rawData:o.buffer})}F.prototype.load=function(t){var e=this.options,i=e.log,r=e.minZoom,n=e.maxZoom,o=e.nodeSize;i&&console.time("total time");var a="prepare "+t.length+" points";i&&console.time(a),this.points=t;for(var s=[],l=0;l<t.length;l++)t[l].geometry&&s.push(N(t[l],l));this.trees[n+1]=new R(s,W,H,o,Float32Array),i&&console.timeEnd(a);for(var u=n;u>=r;u--){var c=+Date.now();s=this._cluster(s,u),this.trees[u]=new R(s,W,H,o,Float32Array),i&&console.log("z%d: %d clusters in %dms",u,s.length,+Date.now()-c)}return i&&console.timeEnd("total time"),this},F.prototype.getClusters=function(t,e){var i=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),n=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){var a=this.getClusters([i,r,180,o],e),s=this.getClusters([-180,r,n,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],u=[],c=0,h=l.range(V(i),G(o),V(n),G(r));c<h.length;c+=1){var p=l.points[h[c]];u.push(p.numPoints?j(p):this.points[p.index])}return u},F.prototype.getChildren=function(t){var e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);var o=n.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=[],l=0,u=n.within(o.x,o.y,a);l<u.length;l+=1){var c=n.points[u[l]];c.parentId===t&&s.push(c.numPoints?j(c):this.points[c.index])}if(0===s.length)throw new Error(r);return s},F.prototype.getLeaves=function(t,e,i){var r=[];return this._appendLeaves(r,t,e=e||10,i=i||0,0),r},F.prototype.getTile=function(t,e,i){var r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(i-a)/n,l=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((e-a)/n,s,(e+1+a)/n,l),r.points,e,i,n,u),0===e&&this._addTileFeatures(r.range(1-a/n,s,1,l),r.points,n,i,n,u),e===n-1&&this._addTileFeatures(r.range(0,s,a/n,l),r.points,-1,i,n,u),u.features.length?u:null},F.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e},F.prototype._appendLeaves=function(t,e,i,r,n){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],l=s.properties;if(l&&l.cluster?n+l.point_count<=r?n+=l.point_count:n=this._appendLeaves(t,l.cluster_id,i,r,n):n<r?n++:t.push(s),t.length===i)break}return n},F.prototype._addTileFeatures=function(t,e,i,r,n,o){for(var a=0,s=t;a<s.length;a+=1){var l=e[s[a]],u=l.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(l.x*n-i)),Math.round(this.options.extent*(l.y*n-r))]],tags:u?U(l):this.points[l.index].properties},h=void 0;u?h=l.id:this.options.generateId?h=l.index:this.points[l.index].id&&(h=this.points[l.index].id),void 0!==h&&(c.id=h),o.features.push(c)}},F.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},F.prototype._cluster=function(t,e){for(var i=[],r=this.options,n=r.reduce,o=r.minPoints,a=r.radius/(r.extent*Math.pow(2,e)),s=0;s<t.length;s++){var l=t[s];if(!(l.zoom<=e)){l.zoom=e;for(var u=this.trees[e+1],c=u.within(l.x,l.y,a),h=l.numPoints||1,p=h,d=0,f=c;d<f.length;d+=1){var m=u.points[f[d]];m.zoom>e&&(p+=m.numPoints||1)}if(p>=o){for(var g=l.x*h,y=l.y*h,v=n&&h>1?this._map(l,!0):null,_=(s<<5)+(e+1)+this.points.length,b=0,x=c;b<x.length;b+=1){var w=u.points[x[b]];if(!(w.zoom<=e)){w.zoom=e;var T=w.numPoints||1;g+=w.x*T,y+=w.y*T,w.parentId=_,n&&(v||(v=this._map(l,!0)),n(v,this._map(w)))}}l.parentId=_,i.push(B(g/p,y/p,_,p,v))}else if(i.push(l),p>1)for(var E=0,S=c;E<S.length;E+=1){var A=u.points[S[E]];A.zoom<=e||(A.zoom=e,i.push(A))}}}return i},F.prototype._getOriginId=function(t){return t-this.points.length>>5},F.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},F.prototype._map=function(t,e){if(t.numPoints)return e?q({},t.properties):t.properties;var i=this.points[t.index].properties,r=this.options.map(i);return e&&r===i?q({},r):r},yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(t,e,i,r,n,o,a){for(var s=[t,e,i,r],l=this.options,u=l.debug;s.length;){r=s.pop(),i=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=vt(e,i,r),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=ft(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,n){if(e===l.maxZoom||e===n)continue;var f=1<<n-e;if(i!==Math.floor(o/f)||r!==Math.floor(a/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var m,g,y,v,_,b,x=.5*l.buffer/l.extent,w=.5-x,T=.5+x,E=1+x;m=g=y=v=null,_=it(t,c,i-x,i+T,0,p.minX,p.maxX,l),b=it(t,c,i+w,i+E,0,p.minX,p.maxX,l),t=null,_&&(m=it(_,c,r-x,r+T,1,p.minY,p.maxY,l),g=it(_,c,r+w,r+E,1,p.minY,p.maxY,l),_=null),b&&(y=it(b,c,r-x,r+T,1,p.minY,p.maxY,l),v=it(b,c,r+w,r+E,1,p.minY,p.maxY,l),b=null),u>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*i,2*r),s.push(g||[],e+1,2*i,2*r+1),s.push(y||[],e+1,2*i+1,2*r),s.push(v||[],e+1,2*i+1,2*r+1)}}},yt.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=vt(t,e=(e%a+a)%a,i);if(this.tiles[s])return pt(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,u=t,c=e,h=i;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[vt(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[s]?pt(this.tiles[s],n):null):null};var bt=function(e){function i(t,i,r,n){e.call(this,t,i,r,_t),n&&(this.loadGeoJSON=n)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},i.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var i=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var n=!!(r&&r.request&&r.request.collectResourceTiming)&&new t.RequestPerformance(r.request);this.loadGeoJSON(r,(function(o,a){if(o||!a)return i(o);if("object"!=typeof a)return i(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function t(e,i){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)t(e.features[r],i);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],i);else if("Feature"===n)t(e.geometry,i);else if("Polygon"===n)h(e.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)h(e.coordinates[r],i);return e}(a,!0);try{if(r.filter){var s=t.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var l=a.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));a={type:"FeatureCollection",features:l}}e._geoJSONIndex=r.cluster?new F(function(e){var i=e.superclusterOptions,r=e.clusterProperties;if(!r||!i)return i;for(var n={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(r),u=0,c=l;u<c.length;u+=1){var h=c[u],p=r[h],d=p[0],f=t.createExpression(p[1]),m=t.createExpression("string"==typeof d?[d,["accumulated"],["get",h]]:d);n[h]=f.value,o[h]=m.value}return i.map=function(t){s.properties=t;for(var e={},i=0,r=l;i<r.length;i+=1){var o=r[i];e[o]=n[o].evaluate(a,s)}return e},i.reduce=function(t,e){s.properties=e;for(var i=0,r=l;i<r.length;i+=1){var n=r[i];a.accumulated=t[n],t[n]=o[n].evaluate(a,s)}},i}(r)).load(a.features):function(t,e){return new yt(t,e)}(a,r.geojsonVtOptions)}catch(o){return i(o)}e.loaded={};var u={};if(n){var c=n.finish();c&&(u.resourceTiming={},u.resourceTiming[r.source]=JSON.parse(JSON.stringify(c)))}i(null,u)}))}},i.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},i.prototype.reloadTile=function(t,i){var r=this.loaded;return r&&r[t.uid]?e.prototype.reloadTile.call(this,t,i):this.loadTile(t,i)},i.prototype.loadGeoJSON=function(e,i){if(e.request)t.getJSON(e.request,i);else{if("string"!=typeof e.data)return i(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},i.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},i.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},i.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},i.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},i}(l),xt=function(e){var i=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(i.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');i.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return xt.prototype.setReferrer=function(t,e){this.referrer=e},xt.prototype.setImages=function(t,e,i){for(var r in this.availableImages[t]=e,this.workerSources[t]){var n=this.workerSources[t][r];for(var o in n)n[o].availableImages=e}i()},xt.prototype.setLayers=function(t,e,i){this.getLayerIndex(t).replace(e),i()},xt.prototype.updateLayers=function(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()},xt.prototype.loadTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).loadTile(e,i)},xt.prototype.loadDEMTile=function(t,e,i){this.getDEMWorkerSource(t,e.source).loadTile(e,i)},xt.prototype.reloadTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).reloadTile(e,i)},xt.prototype.abortTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)},xt.prototype.removeTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)},xt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},xt.prototype.removeSource=function(t,e,i){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,i):i()}},xt.prototype.loadWorkerSource=function(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}},xt.prototype.syncRTLPluginState=function(e,i,r){try{t.plugin.setState(i);var n=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=n){this.self.importScripts(n);var o=t.plugin.isParsed();r(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+n),o)}}catch(t){r(t.toString())}},xt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},xt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},xt.prototype.getWorkerSource=function(t,e,i){var r=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][i]||(this.workerSources[t][e][i]=new this.workerSourceTypes[e]({send:function(e,i,n){r.actor.send(e,i,n,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][i]},xt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]},xt.prototype.enforceCacheSizeLimit=function(e,i){t.enforceCacheSizeLimit(i)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xt(self)),xt})),r(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!i(t)}function i(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===r[i=t&&t.failIfMajorPerformanceCaveat]&&(r[i]=function(t){var i=function(t){var i=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,i.probablySupportsContext?i.probablySupportsContext("webgl",r)||i.probablySupportsContext("experimental-webgl",r):i.supportsContext?i.supportsContext("webgl",r)||i.supportsContext("experimental-webgl",r):i.getContext("webgl",r)||i.getContext("experimental-webgl",r)}(t);if(!i)return!1;var r=i.createShader(i.VERTEX_SHADER);return!(!r||i.isContextLost())&&(i.shaderSource(r,"void main() {}"),i.compileShader(r),!0===i.getShaderParameter(r,i.COMPILE_STATUS))}(i)),r[i]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=i);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),i={create:function(e,i,r){var n=t.window.document.createElement(e);return void 0!==i&&(n.className=i),r&&r.appendChild(n),n},createNS:function(e,i){return t.window.document.createElementNS(e,i)}},r=t.window.document&&t.window.document.documentElement.style;function n(t){if(!r)return t[0];for(var e=0;e<t.length;e++)if(t[e]in r)return t[e];return t[0]}var o,a=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){r&&a&&(o=r[a],r[a]="none")},i.enableDrag=function(){r&&a&&(r[a]=o)};var s=n(["transform","WebkitTransform"]);i.setTransform=function(t,e){t.style[s]=e};var l=!1;try{var u=Object.defineProperty({},"passive",{get:function(){l=!0}});t.window.addEventListener("test",u,u),t.window.removeEventListener("test",u,u)}catch(t){l=!1}i.addEventListener=function(t,e,i,r){void 0===r&&(r={}),t.addEventListener(e,i,"passive"in r&&l?r:r.capture)},i.removeEventListener=function(t,e,i,r){void 0===r&&(r={}),t.removeEventListener(e,i,"passive"in r&&l?r:r.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}i.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},i.mousePos=function(e,i){var r=e.getBoundingClientRect();return new t.Point(i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop)},i.touchPos=function(e,i){for(var r=e.getBoundingClientRect(),n=[],o=0;o<i.length;o++)n.push(new t.Point(i[o].clientX-r.left-e.clientLeft,i[o].clientY-r.top-e.clientTop));return n},i.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},i.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function i(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.isLoaded=function(){return this.loaded},i.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,i=this.requestors;e<i.length;e+=1){var r=i[e];this._notify(r.ids,r.callback)}this.requestors=[]}},i.prototype.getImage=function(t){return this.images[t]},i.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},i.prototype._validate=function(e,i){var r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),r=!1),this._validateContent(i.content,i)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),r=!1),r},i.prototype._validateStretch=function(t,e){if(!t)return!0;for(var i=0,r=0,n=t;r<n.length;r+=1){var o=n[r];if(o[0]<i||o[1]<o[0]||e<o[1])return!1;i=o[1]}return!0},i.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},i.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},i.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},i.prototype.listImages=function(){return Object.keys(this.images)},i.prototype.getImages=function(t,e){var i=!0;if(!this.isLoaded())for(var r=0,n=t;r<n.length;r+=1)this.images[n[r]]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})},i.prototype._notify=function(e,i){for(var r={},n=0,o=e;n<o.length;n+=1){var a=o[n];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}i(null,r)},i.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},i.prototype.getPattern=function(e){var i=this.patterns[e],r=this.getImage(e);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{var n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.ImagePosition(n,r);this.patterns[e]={bin:n,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},i.prototype.bind=function(e){var i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)},i.prototype._updatePatternAtlas=function(){var e=[];for(var i in this.patterns)e.push(this.patterns[i].bin);var r=t.potpack(e),n=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:n||1,height:o||1}),this.patterns){var l=this.patterns[s].bin,u=l.x+1,c=l.y+1,h=this.images[s].data,p=h.width,d=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:u,y:c},{width:p,height:d}),t.RGBAImage.copy(h,a,{x:0,y:d-1},{x:u,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:u,y:c+d},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:u-1,y:c},{width:1,height:d}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:u+p,y:c},{width:1,height:d})}this.dirty=!0},i.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},i.prototype.dispatchRenderCallbacks=function(t){for(var e=0,i=t;e<i.length;e+=1){var r=i[e];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var n=this.images[r];h(n)&&this.updateImage(r,n)}}},i}(t.Evented),d=g,f=g,m=1e20;function g(t,e,i,r,n,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=n||"sans-serif",this.fontWeight=o||"normal",this.radius=i||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function y(t,e,i,r,n,o,a){for(var s=0;s<e;s++){for(var l=0;l<i;l++)r[l]=t[l*e+s];for(v(r,n,o,a,i),l=0;l<i;l++)t[l*e+s]=n[l]}for(l=0;l<i;l++){for(s=0;s<e;s++)r[s]=t[l*e+s];for(v(r,n,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(n[s])}}function v(t,e,i,r,n){i[0]=0,r[0]=-m,r[1]=+m;for(var o=1,a=0;o<n;o++){for(var s=(t[o]+o*o-(t[i[a]]+i[a]*i[a]))/(2*o-2*i[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[i[a]]+i[a]*i[a]))/(2*o-2*i[a]);i[++a]=o,r[a]=s,r[a+1]=+m}for(o=0,a=0;o<n;o++){for(;r[a+1]<o;)a++;e[o]=(o-i[a])*(o-i[a])+t[i[a]]}}g.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var n=e.data[4*r+3]/255;this.gridOuter[r]=1===n?0:0===n?m:Math.pow(Math.max(0,.5-n),2),this.gridInner[r]=1===n?m:0===n?0:Math.pow(Math.max(0,n-.5),2)}for(y(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),y(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)i[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return i},d.default=f;var _=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};_.prototype.setURL=function(t){this.url=t},_.prototype.getGlyphs=function(e,i){var r=this,n=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)n.push({stack:o,id:s[a]});t.asyncAll(n,(function(t,e){var i=t.stack,n=t.id,o=r.entries[i];o||(o=r.entries[i]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[n];if(void 0===a){if(a=r._tinySDF(o,i,n))return o.glyphs[n]=a,void e(null,{stack:i,id:n,glyph:a});var s=Math.floor(n/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:i,id:n,glyph:a});else{var l=o.requests[s];l||(l=o.requests[s]=[],_.loadGlyphRange(i,s,r.url,r.requestManager,(function(t,e){if(e){for(var i in e)r._doesCharSupportLocalGlyph(+i)||(o.glyphs[+i]=e[+i]);o.ranges[s]=!0}for(var n=0,a=l;n<a.length;n+=1)(0,a[n])(t,e);delete o.requests[s]}))),l.push((function(t,r){t?e(t):r&&e(null,{stack:i,id:n,glyph:r[n]||null})}))}}else e(null,{stack:i,id:n,glyph:a})}),(function(t,e){if(t)i(t);else if(e){for(var r={},n=0,o=e;n<o.length;n+=1){var a=o[n],s=a.stack,l=a.id,u=a.glyph;(r[s]||(r[s]={}))[l]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics}}i(null,r)}}))},_.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},_.prototype._tinySDF=function(e,i,r){var n=this.localIdeographFontFamily;if(n&&this._doesCharSupportLocalGlyph(r)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(i)?a="900":/medium/i.test(i)?a="500":/light/i.test(i)&&(a="200"),o=e.tinySDF=new _.TinySDF(24,3,8,.25,n,a)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(e,i,r,n,o){var a=256*i,s=a+255,l=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(l,(function(e,i){if(e)o(e);else if(i){for(var r={},n=0,a=t.parseGlyphPBF(i);n<a.length;n+=1){var s=a[n];r[s.id]=s}o(null,r)}}))},_.TinySDF=d;var b=function(){this.specification=t.styleSpec.light.position};b.prototype.possiblyEvaluate=function(e,i){return t.sphericalToCartesian(e.expression.evaluate(i))},b.prototype.interpolate=function(e,i,r){return{x:t.number(e.x,i.x,r),y:t.number(e.y,i.y,r),z:t.number(e.z,i.z,r)}};var x=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new b,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function i(i){e.call(this),this._transitionable=new t.Transitionable(x),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(e,i){if(void 0===i&&(i={}),!this._validate(t.validateLight,e,i))for(var r in e){var n=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),n):this._transitionable.setValue(r,n)}},i.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},i.prototype._validate=function(e,i,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},i}(t.Evented),T=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};T.prototype.getDash=function(t,e){var i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]},T.prototype.getDashRanges=function(t,e,i){var r=[],n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,a=!0;r.push({left:n,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],l=1;l<t.length;l++){var u=t[l];r.push({left:n=s*i,right:o=(s+=u)*i,isDash:a=!a,zeroLength:0===u})}return r},T.prototype.addRoundDash=function(t,e,i){for(var r=e/2,n=-i;n<=i;n++)for(var o=this.width*(this.nextRow+i+n),a=0,s=t[a],l=0;l<this.width;l++){l/s.right>1&&(s=t[++a]);var u=Math.abs(l-s.left),c=Math.abs(l-s.right),h=Math.min(u,c),p=void 0,d=n/i*(r+1);if(s.isDash){var f=r-Math.abs(d);p=Math.sqrt(h*h+f*f)}else p=r-Math.sqrt(h*h+d*d);this.data[o+l]=Math.max(0,Math.min(255,p+128))}},T.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var i=t[e],r=t[e+1];i.zeroLength?t.splice(e,1):r&&r.isDash===i.isDash&&(r.left=i.left,t.splice(e,1))}var n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);for(var a=this.width*this.nextRow,s=0,l=t[s],u=0;u<this.width;u++){u/l.right>1&&(l=t[++s]);var c=Math.abs(u-l.left),h=Math.abs(u-l.right),p=Math.min(c,h);this.data[a+u]=Math.max(0,Math.min(255,(l.isDash?p:-p)+128))}},T.prototype.addDash=function(e,i){var r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,l=this.getDashRanges(e,this.width,s);i?this.addRoundDash(l,s,r):this.addRegularDash(l)}var u={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=n,this.dirty=!0,u},T.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var E=function e(i,r){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var n=this.workerPool.acquire(this.id),o=0;o<n.length;o++){var a=new e.Actor(n[o],r,this.id);a.name="Worker "+o,this.actors.push(a)}};function S(e,i,r){var n=function(n,o){if(n)return r(n);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=i.canonicalizeTileset(a,e.url),r(null,a)}};return e.url?t.getJSON(i.transformRequest(i.normalizeSourceURL(e.url),t.ResourceType.Source),n):t.browser.frame((function(){return n(null,e)}))}E.prototype.broadcast=function(e,i,r){t.asyncAll(this.actors,(function(t,r){t.send(e,i,r)}),r=r||function(){})},E.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},E.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},E.Actor=t.Actor;var A=function(e,i,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=r||24};A.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},A.prototype.contains=function(e){var i=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*i),n=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*i),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*i);return e.x>=r&&e.x<o&&e.y>=n&&e.y<a};var C=function(e){function i(i,r,n,o){if(e.call(this),this.id=i,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(r,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=S(this._options,this.map._requestManager,(function(i,r){e._tileJSONRequest=null,e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},i.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},i.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.loadTile=function(e,i){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(r,n){return delete e.request,e.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}n.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",n,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",n,o.bind(this)))},i.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},i.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},i.prototype.hasTransition=function(){return!1},i}(t.Evented),P=function(e){function i(i,r,n,o){e.call(this),this.id=i,this.dispatcher=n,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=S(this._options,this.map._requestManager,(function(i,r){e._tileJSONRequest=null,e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.loadTile=function(e,i){var r=this,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),(function(n,o){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(o){r.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;e.texture=r.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(r.dispatcher),i(null)}}))},i.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},i.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},i.prototype.hasTransition=function(){return!1},i}(t.Evented),I=function(e){function i(i,r,n,o){e.call(this,i,r,n,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},i.prototype.loadTile=function(e,i){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function n(t,r){t&&(e.state="errored",i(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.state="loaded",i(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,n.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},i.prototype._getNeighboringTiles=function(e){var i=e.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?e.wrap-1:e.wrap,a=(i.x+1+r)%r,s=i.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,a,i.y).key]={backfilled:!1},i.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,a,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new t.OverscaledTileID(e.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,a,i.y+1).key]={backfilled:!1}),l},i.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},i}(P),M=function(e){function i(i,r,n,o){e.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(o),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(r.clusterRadius||50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(i){if(i)e.fire(new t.ErrorEvent(i));else{var r={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(r.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",r))}}))},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setData=function(e){var i=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)i.fire(new t.ErrorEvent(e));else{var r={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(r.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new t.Event("data",r))}})),this},i.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},i.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},i.prototype.getClusterLeaves=function(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},r),this},i.prototype._updateWorkerData=function(e){var i=this;this._loaded=!1;var r=t.extend({},this.workerOptions),n=this._data;"string"==typeof n?(r.request=this.map._requestManager.transformRequest(t.browser.resolveURL(n),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(n),this.actor.send(this.type+".loadData",r,(function(t,n){i._removed||n&&n.abandoned||(i._loaded=!0,n&&n.resourceTiming&&n.resourceTiming[i.id]&&(i._resourceTiming=n.resourceTiming[i.id].slice(0)),i.actor.send(i.type+".coalesce",{source:r.source},null),e(t))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.loadTile=function(e,i){var r=this,n=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(n,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?i(null):t?i(t):(e.loadVectorData(o,r.map.painter,"reloadTile"===n),i(null))}))},i.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},i.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},i.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},i.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},i.prototype.hasTransition=function(){return!1},i}(t.Evented),k=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),D=function(e){function i(t,i,r,n){e.call(this),this.id=t,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=i}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(e,i){var r=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(n,o){r._loaded=!0,n?r.fire(new t.ErrorEvent(n)):o&&(r.image=o,e&&(r.coordinates=e),i&&i(),r._finishLoading())}))},i.prototype.loaded=function(){return this._loaded},i.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},i.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setCoordinates=function(e){var i=this;this.coordinates=e;var r=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var i=1/0,r=1/0,n=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var l=s[a];i=Math.min(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.x),o=Math.max(o,l.y)}var u=Math.max(n-i,o-r),c=Math.max(0,Math.floor(-Math.log(u)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((i+n)/2*h),Math.floor((r+o)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var n=r.map((function(t){return i.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(n[0].x,n[0].y,0,0),this._boundsArray.emplaceBack(n[1].x,n[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(n[3].x,n[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(n[2].x,n[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},i.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,i=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,k.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[r];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},i.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},i.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return!1},i}(t.Evented),L=function(e){function i(t,i,r,n){e.call(this,t,i,r,n),this.roundZoom=!0,this.type="video",this.options=i}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1;var i=this.options;this.urls=[];for(var r=0,n=i.urls;r<n.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(n[r],t.ResourceType.Source).url);t.getVideo(this.urls,(function(i,r){e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):r&&(e.video=r,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},i.prototype.pause=function(){this.video&&this.video.pause()},i.prototype.play=function(){this.video&&this.video.play()},i.prototype.seek=function(e){if(this.video){var i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+i.start(0)+" and "+i.end(0)+"-second mark."))):this.video.currentTime=e}},i.prototype.getVideo=function(){return this.video},i.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},i.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,i=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,k.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[r];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this.video&&!this.video.paused},i}(D),O=function(e){function i(i,r,n,o){e.call(this,i,r,n,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},i.prototype.onRemove=function(){this.pause()},i.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var i=this.map.painter.context,r=i.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,k.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(i,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[n];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this._playing},i.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},i}(D),R={vector:C,raster:P,"raster-dem":I,geojson:M,video:L,image:D,canvas:O};function z(e,i){var r=t.identity([]);return t.translate(r,r,[1,1,0]),t.scale(r,r,[.5*e.width,.5*e.height,1]),t.multiply(r,r,e.calculatePosMatrix(i.toUnwrapped()))}function F(t,e,i,r,n,o){var a=function(t,e,i){if(t)for(var r=0,n=t;r<n.length;r+=1){var o=e[n[r]];if(o&&o.source===i&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===i&&"fill-extrusion"===s.type)return!0}return!1}(n&&n.layers,e,t.id),s=o.maxPitchScaleFactor(),l=t.tilesIn(r,s,a);l.sort(B);for(var u=[],c=0,h=l;c<h.length;c+=1){var p=h[c];u.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(e,i,t._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,n,o,s,z(t.transform,p.tileID))})}var d=function(t){for(var e={},i={},r=0,n=t;r<n.length;r+=1){var o=n[r],a=o.queryResults,s=o.wrappedTileID,l=i[s]=i[s]||{};for(var u in a)for(var c=a[u],h=l[u]=l[u]||{},p=e[u]=e[u]||[],d=0,f=c;d<f.length;d+=1){var m=f[d];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m))}}return e}(u);for(var f in d)d[f].forEach((function(e){var i=e.feature,r=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return d}function B(t,e){var i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}var N=function(t,e){this.max=t,this.onRemove=e,this.reset()};N.prototype.reset=function(){for(var t in this.data)for(var e=0,i=this.data[t];e<i.length;e+=1){var r=i[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},N.prototype.add=function(t,e,i){var r=this,n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);var o={value:e,timeout:void 0};if(void 0!==i&&(o.timeout=setTimeout((function(){r.remove(t,o)}),i)),this.data[n].push(o),this.order.push(n),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},N.prototype.has=function(t){return t.wrapped().key in this.data},N.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},N.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},N.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},N.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},N.prototype.remove=function(t,e){if(!this.has(t))return this;var i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this},N.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},N.prototype.filter=function(t){var e=[];for(var i in this.data)for(var r=0,n=this.data[i];r<n.length;r+=1){var o=n[r];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var l=s[a];this.remove(l.value.tileID,l)}};var j=function(t,e,i){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var U={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},V=function(t,e,i,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};V.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},V.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},V.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var r=e.attributes[this.attributes[i].name];void 0!==r&&t.enableVertexAttribArray(r)}},V.prototype.setVertexAttribPointers=function(t,e,i){for(var r=0;r<this.attributes.length;r++){var n=this.attributes[r],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[U[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};G.prototype.get=function(){return this.current},G.prototype.set=function(t){},G.prototype.getDefault=function(){return this.default},G.prototype.setDefault=function(){this.set(this.default)};var q=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getDefault=function(){return t.Color.transparent},i.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},i}(G),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(G),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(G),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(G),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(G),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(G),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(G),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(G),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(G),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(G),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(G),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),nt=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getDefault=function(){return t.Color.transparent},i.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},i}(G),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(G),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(G),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(G),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(G),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(G),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(G),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(G),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(G),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(G),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(G),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(G),yt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(G),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(G),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),xt=function(t){function e(e,i){t.call(this,e),this.context=e,this.parent=i}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(G),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(xt),Tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(xt),Et=function(t,e,i,r){this.context=t,this.width=e,this.height=i;var n=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,n),r&&(this.depthAttachment=new Tt(t,n))};Et.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}t.deleteFramebuffer(this.framebuffer)};var St=function(t,e,i){this.func=t,this.mask=e,this.range=i};St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);var At=function(t,e,i,r,n,o){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o};At.disabled=new At({func:519,mask:0},0,0,7680,7680,7680);var Ct=function(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i};Ct.disabled=new Ct(Ct.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Ct.unblended=new Ct(Ct.Replace,t.Color.transparent,[!0,!0,!0,!0]),Ct.alphaBlended=new Ct([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Pt=function(t,e,i){this.enable=t,this.mode=e,this.frontFace=i};Pt.disabled=new Pt(!1,1029,2305),Pt.backCCW=new Pt(!0,1029,2305);var It=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new q(this),this.clearDepth=new W(this),this.clearStencil=new H(this),this.colorMask=new Z(this),this.depthMask=new X(this),this.stencilMask=new Y(this),this.stencilFunc=new K(this),this.stencilOp=new J(this),this.stencilTest=new Q(this),this.depthRange=new $(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new it(this),this.blendFunc=new rt(this),this.blendColor=new nt(this),this.blendEquation=new ot(this),this.cullFace=new at(this),this.cullFaceSide=new st(this),this.frontFace=new lt(this),this.program=new ut(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new vt(this),this.pixelStoreUnpackPremultiplyAlpha=new _t(this),this.pixelStoreUnpackFlipY=new bt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};It.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},It.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},It.prototype.createIndexBuffer=function(t,e){return new j(this,t,e)},It.prototype.createVertexBuffer=function(t,e,i){return new V(this,t,e,i)},It.prototype.createRenderbuffer=function(t,e,i){var r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),n},It.prototype.createFramebuffer=function(t,e,i){return new Et(this,t,e,i)},It.prototype.clear=function(t){var e=t.color,i=t.depth,r=this.gl,n=0;e&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),r.clear(n)},It.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},It.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},It.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},It.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Ct.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},It.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Mt=function(e){function i(i,r,n){var o=this;e.call(this),this.id=i,this.dispatcher=n,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,i,r,n){var o=new R[i.type](e,i,r,n);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(i,r,n,this),this._tiles={},this._cache=new N(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},i.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},i.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},i.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},i.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},i.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}},i.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(kt).map((function(t){return t.key}))},i.prototype.getRenderableIds=function(e){var i=this,r=[];for(var n in this._tiles)this._isIdRenderable(n,e)&&r.push(this._tiles[n]);return e?r.sort((function(e,r){var n=e.tileID,o=r.tileID,a=new t.Point(n.canonical.x,n.canonical.y)._rotate(i.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(i.transform.angle);return n.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):r.map((function(t){return t.tileID})).sort(kt).map((function(t){return t.key}))},i.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},i.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},i.prototype._reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))},i.prototype._tileLoaded=function(e,i,r,n){if(n)return e.state="errored",void(404!==n.status?this._source.fire(new t.ErrorEvent(n,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},i.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),i=0;i<e.length;i++){var r=e[i];if(t.neighboringTiles&&t.neighboringTiles[r]){var n=this.getTileByID(r);o(t,n),o(n,t)}}function o(t,e){t.needsHillshadePrepare=!0;var i=e.tileID.canonical.x-t.tileID.canonical.x,r=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},i.prototype.getTile=function(t){return this.getTileByID(t.key)},i.prototype.getTileByID=function(t){return this._tiles[t]},i.prototype._retainLoadedChildren=function(t,e,i,r){for(var n in this._tiles){var o=this._tiles[n];if(!(r[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var l=a;l.overscaledZ>e;)if(t[(l=l.scaledTo(l.overscaledZ-1)).key]){r[a.key]=a;break}}}},i.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(var r=t.overscaledZ-1;r>=e;r--){var n=t.scaledTo(r),o=this._getLoadedTile(n);if(o)return o}},i.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},i.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,i=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(e*i*5),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(n)},i.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var i={};for(var r in this._tiles){var n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),i[n.tileID.key]=n}for(var o in this._tiles=i,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},i.prototype.update=function(e){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var n;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter((function(t){return r._source.hasTile(t)})))):n=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-i.maxOverzooming,this._source.minzoom),s=Math.max(o+i.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(n,o);if(Dt(this._source.type)){for(var u={},c={},h=0,p=Object.keys(l);h<p.length;h+=1){var d=p[h],f=l[d],m=this._tiles[d];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=t.browser.now())){var g=this.findLoadedParent(f,a);g&&(this._addTile(g.tileID),u[g.tileID.key]=g.tileID),c[d]=f}}for(var y in this._retainLoadedChildren(c,o,s,l),u)l[y]||(this._coveredTiles[y]=!0,l[y]=u[y])}for(var v in l)this._tiles[v].clearFadeHold();for(var _=0,b=t.keysDifference(this._tiles,l);_<b.length;_+=1){var x=b[_],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}},i.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},i.prototype._updateRetainedTiles=function(t,e){for(var r={},n={},o=Math.max(e-i.maxOverzooming,this._source.minzoom),a=Math.max(e+i.maxUnderzooming,this._source.minzoom),s={},l=0,u=t;l<u.length;l+=1){var c=u[l],h=this._addTile(c);r[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,r);for(var p=0,d=t;p<d.length;p+=1){var f=d[p],m=this._tiles[f.key];if(!m.hasData()){if(e+1>this._source.maxzoom){var g=f.children(this._source.maxzoom)[0],y=this.getTile(g);if(y&&y.hasData()){r[g.key]=g;continue}}else{var v=f.children(this._source.maxzoom);if(r[v[0].key]&&r[v[1].key]&&r[v[2].key]&&r[v[3].key])continue}for(var _=m.wasRequested(),b=f.overscaledZ-1;b>=o;--b){var x=f.scaledTo(b);if(n[x.key])break;if(n[x.key]=!0,!(m=this.getTile(x))&&_&&(m=this._addTile(x)),m&&(r[x.key]=x,_=m.wasRequested(),m.hasData()))break}}}return r},i.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],i=void 0,r=this._tiles[t].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}e.push(r.key);var n=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(n))break;r=n}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=i}},i.prototype._addTile=function(e){var i=this._tiles[e.key];if(i)return i;(i=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));var r=Boolean(i);return r||(i=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))),i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new t.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null},i.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((function(){i._reloadTile(t,"expired"),delete i._timers[t]}),r))},i.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},i.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},i.prototype.tilesIn=function(e,i,r){var n=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(e):e,l=e.map((function(t){return a.pointCoordinate(t)})),u=s.map((function(t){return a.pointCoordinate(t)})),c=this.getIds(),h=1/0,p=1/0,d=-1/0,f=-1/0,m=0,g=u;m<g.length;m+=1){var y=g[m];h=Math.min(h,y.x),p=Math.min(p,y.y),d=Math.max(d,y.x),f=Math.max(f,y.y)}for(var v=function(e){var r=n._tiles[c[e]];if(!r.holdingForFade()){var s=r.tileID,m=Math.pow(2,a.zoom-r.tileID.overscaledZ),g=i*r.queryPadding*t.EXTENT/r.tileSize/m,y=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(d,f))];if(y[0].x-g<t.EXTENT&&y[0].y-g<t.EXTENT&&y[1].x+g>=0&&y[1].y+g>=0){var v=l.map((function(t){return s.getTilePoint(t)})),_=u.map((function(t){return s.getTilePoint(t)}));o.push({tile:r,tileID:s,queryGeometry:v,cameraQueryGeometry:_,scale:m})}}},_=0;_<c.length;_++)v(_);return o},i.prototype.getVisibleCoordinates=function(t){for(var e=this,i=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),r=0,n=i;r<n.length;r+=1){var o=n[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return i},i.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Dt(this._source.type))for(var e in this._tiles){var i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=t.browser.now())return!0}return!1},i.prototype.setFeatureState=function(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)},i.prototype.removeFeatureState=function(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)},i.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},i.prototype.setDependencies=function(t,e,i){var r=this._tiles[t];r&&r.setDependencies(e,i)},i.prototype.reloadTilesForDependencies=function(t,e){for(var i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((function(i){return!i.hasDependency(t,e)}))},i}(t.Evented);function kt(t,e){var i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Dt(t){return"raster"===t||"image"===t||"video"===t}function Lt(){return new t.window.Worker(Xn.workerUrl)}Mt.maxOverzooming=10,Mt.maxUnderzooming=3;var Ot="mapboxgl_preloaded_worker_pool",Rt=function(){this.active={}};Rt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Rt.workerCount;)this.workers.push(new Lt);return this.active[t]=!0,this.workers.slice()},Rt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Rt.prototype.isPreloaded=function(){return!!this.active[Ot]},Rt.prototype.numActive=function(){return Object.keys(this.active).length};var zt,Ft=Math.floor(t.browser.hardwareConcurrency/2);function Bt(){return zt||(zt=new Rt),zt}function Nt(e,i){var r={};for(var n in e)"ref"!==n&&(r[n]=e[n]);return t.refProperties.forEach((function(t){t in i&&(r[t]=i[t])})),r}function jt(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Nt(t[r],e[t[r].ref]));return t}Rt.workerCount=Math.max(Math.min(Ft,6),1);var Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vt(t,e,i){i.push({command:Ut.addSource,args:[t,e[t]]})}function Gt(t,e,i){e.push({command:Ut.removeSource,args:[t]}),i[t]=!0}function qt(t,e,i,r){Gt(t,i,r),Vt(t,e,i)}function Wt(e,i,r){var n;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!t.deepEqual(e[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!t.deepEqual(e[r][n],i[r][n]))return!1;return!0}function Ht(e,i,r,n,o,a){var s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],i[s])||r.push({command:a,args:[n,s,i[s],o]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],i[s])||r.push({command:a,args:[n,s,i[s],o]}))}function Zt(t){return t.id}function Xt(t,e){return t[e.id]=e,t}var Yt=function(t,e){this.reset(t,e)};Yt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Yt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var i=1,r=this._distances[i],n=e*this.paddedLength+this.padding;r<n&&i<this._distances.length;)r=this._distances[++i];var o=i-1,a=this._distances[o],s=r-a,l=s>0?(n-a)/s:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))};var Kt=function(t,e,i){var r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Jt(e,i,r,n,o){var a=t.create();return i?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,n.angle)):t.multiply(a,n.labelPlaneMatrix,e),a}function Qt(e,i,r,n,o){if(i){var a=t.clone(e);return t.scale(a,a,[o,o,1]),r||t.rotateZ(a,a,-n.angle),a}return n.glCoordMatrix}function $t(e,i){var r=[e.x,e.y,0,1];ce(r,r,i);var n=r[3];return{point:new t.Point(r[0]/n,r[1]/n),signedDistanceFromCamera:n}}function te(t,e){return.5+t/e*.5}function ee(t,e){var i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function ie(e,i,r,n,o,a,s,l){var u=n?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(u,r.transform.zoom),h=[256/r.width*2+1,256/r.height*2+1],p=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var d=e.lineVertexArray,f=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=r.transform.width/r.transform.height,g=!1,y=0;y<f.length;y++){var v=f.get(y);if(v.hidden||v.writingMode===t.WritingMode.vertical&&!g)ue(v.numGlyphs,p);else{g=!1;var _=[v.anchorX,v.anchorY,0,1];if(t.transformMat4(_,_,i),ee(_,h)){var b=te(r.transform.cameraToCenterDistance,_[3]),x=t.evaluateSizeForFeature(u,c,v),w=s?x/b:x*b,T=new t.Point(v.anchorX,v.anchorY),E=$t(T,o).point,S={},A=oe(v,w,!1,l,i,o,a,e.glyphOffsetArray,d,p,E,T,S,m);g=A.useVertical,(A.notEnoughRoom||g||A.needsFlipping&&oe(v,w,!0,l,i,o,a,e.glyphOffsetArray,d,p,E,T,S,m).notEnoughRoom)&&ue(v.numGlyphs,p)}else ue(v.numGlyphs,p)}}n?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function re(t,e,i,r,n,o,a,s,l,u,c){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,f=e.getoffsetX(s.glyphStartIndex),m=e.getoffsetX(h-1),g=se(t*f,i,r,n,o,a,s.segment,p,d,l,u,c);if(!g)return null;var y=se(t*m,i,r,n,o,a,s.segment,p,d,l,u,c);return y?{first:g,last:y}:null}function ne(e,i,r,n){return e===t.WritingMode.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(e===t.WritingMode.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function oe(e,i,r,n,o,a,s,l,u,c,h,p,d,f){var m,g=i/24,y=e.lineOffsetX*g,v=e.lineOffsetY*g;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,b=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=re(g,l,y,v,r,h,p,e,u,a,d);if(!w)return{notEnoughRoom:!0};var T=$t(w.first.point,s).point,E=$t(w.last.point,s).point;if(n&&!r){var S=ne(e.writingMode,T,E,f);if(S)return S}m=[w.first];for(var A=e.glyphStartIndex+1;A<_-1;A++)m.push(se(g*l.getoffsetX(A),y,v,r,h,p,e.segment,b,x,u,a,d));m.push(w.last)}else{if(n&&!r){var C=$t(p,o).point,P=e.lineStartIndex+e.segment+1,I=new t.Point(u.getx(P),u.gety(P)),M=$t(I,o),k=M.signedDistanceFromCamera>0?M.point:ae(p,I,C,1,o),D=ne(e.writingMode,C,k,f);if(D)return D}var L=se(g*l.getoffsetX(e.glyphStartIndex),y,v,r,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,a,d);if(!L)return{notEnoughRoom:!0};m=[L]}for(var O=0,R=m;O<R.length;O+=1){var z=R[O];t.addDynamicAttributes(c,z.point,z.angle)}return{}}function ae(t,e,i,r,n){var o=$t(t.add(t.sub(e)._unit()),n).point,a=i.sub(o);return i.add(a._mult(r/a.mag()))}function se(e,i,r,n,o,a,s,l,u,c,h,p){var d=n?e-i:e+i,f=d>0?1:-1,m=0;n&&(f*=-1,m=Math.PI),f<0&&(m+=Math.PI);for(var g=f>0?l+s:l+s+1,y=o,v=o,_=0,b=0,x=Math.abs(d),w=[];_+b<=x;){if((g+=f)<l||g>=u)return null;if(v=y,w.push(y),void 0===(y=p[g])){var T=new t.Point(c.getx(g),c.gety(g)),E=$t(T,h);if(E.signedDistanceFromCamera>0)y=p[g]=E.point;else{var S=g-f;y=ae(0===_?a:new t.Point(c.getx(S),c.gety(S)),T,v,x-_+1,h)}}_+=b,b=v.dist(y)}var A=(x-_)/b,C=y.sub(v),P=C.mult(A)._add(v);P._add(C._unit()._perp()._mult(r*f));var I=m+Math.atan2(y.y-v.y,y.x-v.x);return w.push(P),{point:P,angle:I,path:w}}Kt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Kt.prototype.insert=function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},Kt.prototype.insertCircle=function(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)},Kt.prototype._insertBoxCell=function(t,e,i,r,n,o){this.boxCells[n].push(o)},Kt.prototype._insertCircleCell=function(t,e,i,r,n,o){this.circleCells[n].push(o)},Kt.prototype._query=function(t,e,i,r,n,o){if(i<0||t>this.width||r<0||e>this.height)return!n&&[];var a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(t,e,i,r,this._queryCell,a,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?a.length>0:a},Kt.prototype._queryCircle=function(t,e,i,r,n){var o=t-i,a=t+i,s=e-i,l=e+i;if(a<0||o>this.width||l<0||s>this.height)return!r&&[];var u=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,u,{hitTest:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},n),r?u.length>0:u},Kt.prototype.query=function(t,e,i,r,n){return this._query(t,e,i,r,!1,n)},Kt.prototype.hitTest=function(t,e,i,r,n){return this._query(t,e,i,r,!0,n)},Kt.prototype.hitTestCircle=function(t,e,i,r){return this._queryCircle(t,e,i,!0,r)},Kt.prototype._queryCell=function(t,e,i,r,n,o,a,s){var l=a.seenUids,u=this.boxCells[n];if(null!==u)for(var c=this.bboxes,h=0,p=u;h<p.length;h+=1){var d=p[h];if(!l.box[d]){l.box[d]=!0;var f=4*d;if(t<=c[f+2]&&e<=c[f+3]&&i>=c[f+0]&&r>=c[f+1]&&(!s||s(this.boxKeys[d]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:c[f],y1:c[f+1],x2:c[f+2],y2:c[f+3]})}}}var m=this.circleCells[n];if(null!==m)for(var g=this.circles,y=0,v=m;y<v.length;y+=1){var _=v[y];if(!l.circle[_]){l.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(g[b],g[b+1],g[b+2],t,e,i,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var x=g[b],w=g[b+1],T=g[b+2];o.push({key:this.circleKeys[_],x1:x-T,y1:w-T,x2:x+T,y2:w+T})}}}},Kt.prototype._queryCellCircle=function(t,e,i,r,n,o,a,s){var l=a.circle,u=a.seenUids,c=this.boxCells[n];if(null!==c)for(var h=this.bboxes,p=0,d=c;p<d.length;p+=1){var f=d[p];if(!u.box[f]){u.box[f]=!0;var m=4*f;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[f])))return o.push(!0),!0}}var g=this.circleCells[n];if(null!==g)for(var y=this.circles,v=0,_=g;v<_.length;v+=1){var b=_[v];if(!u.circle[b]){u.circle[b]=!0;var x=3*b;if(this._circlesCollide(y[x],y[x+1],y[x+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[b])))return o.push(!0),!0}}},Kt.prototype._forEachCell=function(t,e,i,r,n,o,a,s){for(var l=this._convertToXCellCoord(t),u=this._convertToYCellCoord(e),c=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r),p=l;p<=c;p++)for(var d=u;d<=h;d++)if(n.call(this,t,e,i,r,this.xCellCount*d+p,o,a,s))return},Kt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Kt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Kt.prototype._circlesCollide=function(t,e,i,r,n,o){var a=r-t,s=n-e,l=i+o;return l*l>a*a+s*s},Kt.prototype._circleAndRectCollide=function(t,e,i,r,n,o,a){var s=(o-r)/2,l=Math.abs(t-(r+s));if(l>s+i)return!1;var u=(a-n)/2,c=Math.abs(e-(n+u));if(c>u+i)return!1;if(l<=s||c<=u)return!0;var h=l-s,p=c-u;return h*h+p*p<=i*i};var le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ue(t,e){for(var i=0;i<t;i++){var r=e.length;e.resize(r+4),e.float32.set(le,3*r)}}function ce(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}var he=function(t,e,i){void 0===e&&(e=new Kt(t.width+200,t.height+200,25)),void 0===i&&(i=new Kt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function pe(e,i,r){return i*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,i,r,n){var o=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY),a=i*o.perspectiveRatio,s=t.x1*a+o.point.x,l=t.y1*a+o.point.y,u=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,l,u,c)||!e&&this.grid.hitTest(s,l,u,c,n)?{box:[],offscreen:!1}:{box:[s,l,u,c],offscreen:this.isOffscreen(s,l,u,c)}},he.prototype.placeCollisionCircles=function(e,i,r,n,o,a,s,l,u,c,h,p,d){var f=[],m=new t.Point(i.anchorX,i.anchorY),g=$t(m,a),y=te(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),v=(c?o/y:o*y)/t.ONE_EM,_=$t(m,s).point,b=re(v,n,i.lineOffsetX*v,i.lineOffsetY*v,!1,_,m,i,r,s,{}),x=!1,w=!1,T=!0;if(b){for(var E=.5*p*y+d,S=new t.Point(-100,-100),A=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),C=new Yt,P=b.first,I=b.last,M=[],k=P.path.length-1;k>=1;k--)M.push(P.path[k]);for(var D=1;D<I.path.length;D++)M.push(I.path[D]);var L=2.5*E;if(l){var O=M.map((function(t){return $t(t,l)}));M=O.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:O.map((function(t){return t.point}))}var R=[];if(M.length>0){for(var z=M[0].clone(),F=M[0].clone(),B=1;B<M.length;B++)z.x=Math.min(z.x,M[B].x),z.y=Math.min(z.y,M[B].y),F.x=Math.max(F.x,M[B].x),F.y=Math.max(F.y,M[B].y);R=z.x>=S.x&&F.x<=A.x&&z.y>=S.y&&F.y<=A.y?[M]:F.x<S.x||z.x>A.x||F.y<S.y||z.y>A.y?[]:t.clipLine([M],S.x,S.y,A.x,A.y)}for(var N=0,j=R;N<j.length;N+=1){var U;C.reset(j[N],.25*E),U=C.length<=.5*E?1:Math.ceil(C.paddedLength/L)+1;for(var V=0;V<U;V++){var G=V/Math.max(U-1,1),q=C.lerp(G),W=q.x+100,H=q.y+100;f.push(W,H,E,0);var Z=W-E,X=H-E,Y=W+E,K=H+E;if(T=T&&this.isOffscreen(Z,X,Y,K),w=w||this.isInsideGrid(Z,X,Y,K),!e&&this.grid.hitTestCircle(W,H,E,h)&&(x=!0,!u))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!u&&x||!w?[]:f,offscreen:T,collisionDetected:x}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var i=[],r=1/0,n=1/0,o=-1/0,a=-1/0,s=0,l=e;s<l.length;s+=1){var u=l[s],c=new t.Point(u.x+100,u.y+100);r=Math.min(r,c.x),n=Math.min(n,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),i.push(c)}for(var h={},p={},d=0,f=this.grid.query(r,n,o,a).concat(this.ignoredGrid.query(r,n,o,a));d<f.length;d+=1){var m=f[d],g=m.key;if(void 0===h[g.bucketInstanceId]&&(h[g.bucketInstanceId]={}),!h[g.bucketInstanceId][g.featureIndex]){var y=[new t.Point(m.x1,m.y1),new t.Point(m.x2,m.y1),new t.Point(m.x2,m.y2),new t.Point(m.x1,m.y2)];t.polygonIntersectsPolygon(i,y)&&(h[g.bucketInstanceId][g.featureIndex]=!0,void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]=[]),p[g.bucketInstanceId].push(g.featureIndex))}}return p},he.prototype.insertCollisionBox=function(t,e,i,r,n){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,i,r,n){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:r,collisionGroupID:n},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,i,r){var n=[i,r,0,1];return ce(n,n,e),{point:new t.Point((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},he.prototype.isOffscreen=function(t,e,i,r){return i<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,i,r){return i>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var de=function(t,e,i,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&i?1:0,this.placed=i};de.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var fe=function(t,e,i,r,n){this.text=new de(t?t.text:null,e,i,n),this.icon=new de(t?t.icon:null,e,r,n)};fe.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var me=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i},ge=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ye=function(t,e,i,r,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n},ve=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function _e(e,i,r,n,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*i,l=-(a.verticalAlign-.5)*r,u=t.evaluateVariableOffset(e,n);return new t.Point(s+u[0]*o,l+u[1]*o)}function be(e,i,r,n,o,a){var s=e.x1,l=e.x2,u=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,d=new t.Point(i,r);return n&&d._rotate(o?a:-a),{x1:s+d.x,y1:u+d.y,x2:l+d.x,y2:c+d.y,anchorPointX:h,anchorPointY:p}}ve.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var xe=function(t,e,i,r){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ve(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function we(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}xe.prototype.getBucketParts=function(e,i,r,n){var o=r.getBucket(i),a=r.latestFeatureIndex;if(o&&a&&i.id===o.layerIds[0]){var s=r.collisionBoxArray,l=o.layers[0].layout,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p="map"===l.get("text-pitch-alignment"),d="map"===l.get("text-rotation-alignment"),f=pe(r,1,this.transform.zoom),m=Jt(h,p,d,this.transform,f),g=null;if(p){var y=Qt(h,p,d,this.transform,f);g=t.multiply([],this.transform.labelPlaneMatrix,y)}this.retainedQueryData[o.bucketInstanceId]=new ye(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);var v={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:u,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(var _=0,b=o.sortKeyRanges;_<b.length;_+=1){var x=b[_];e.push({sortKey:x.sortKey,symbolInstanceStart:x.symbolInstanceStart,symbolInstanceEnd:x.symbolInstanceEnd,parameters:v})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:v})}},xe.prototype.attemptAnchorPlacement=function(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f){var m,g=[h.textOffset0,h.textOffset1],y=_e(t,i,r,g,n),v=this.collisionIndex.placeCollisionBox(be(e,y.x,y.y,o,a,this.transform.angle),c,s,l,u.predicate);if(!f||0!==this.collisionIndex.placeCollisionBox(be(f,y.x,y.y,o,a,this.transform.angle),c,s,l,u.predicate).box.length)return v.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(m=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:g,width:i,height:r,anchor:t,textBoxScale:n,prevAnchor:m},this.markUsedJustification(p,t,h,d),p.allowVerticalPlacement&&(this.markUsedOrientation(p,d,h),this.placedOrientations[h.crossTileID]=d),{shift:y,placedGlyphBoxes:v}):void 0},xe.prototype.placeLayerBucketPart=function(e,i,r){var n=this,o=e.parameters,a=o.bucket,s=o.layout,l=o.posMatrix,u=o.textLabelPlaneMatrix,c=o.labelToScreenMatrix,h=o.textPixelRatio,p=o.holdingForFade,d=o.collisionBoxArray,f=o.partiallyEvaluatedTextSize,m=o.collisionGroup,g=s.get("text-optional"),y=s.get("icon-optional"),v=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),x="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),T="viewport-y"===s.get("symbol-z-order"),E=v&&(_||!a.hasIconData()||y),S=_&&(v||!a.hasTextData()||g);!a.collisionArrays&&d&&a.deserializeCollisionBoxes(d);var A=function(e,o){if(!i[e.crossTileID])if(p)n.placements[e.crossTileID]=new me(!1,!1,!1);else{var d,T=!1,A=!1,C=!0,P=null,I={box:null,offscreen:null},M={box:null,offscreen:null},k=null,D=null,L=0,O=0,R=0;o.textFeatureIndex?L=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(L=e.featureIndex),o.verticalTextFeatureIndex&&(O=o.verticalTextFeatureIndex);var z=o.textBox;if(z){var F=function(i){var r=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!i&&n.prevPlacement){var o=n.prevPlacement.placedOrientations[e.crossTileID];o&&(n.placedOrientations[e.crossTileID]=o,n.markUsedOrientation(a,r=o,e))}return r},B=function(i,r){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var n=0,s=a.writingModes;n<s.length&&(s[n]===t.WritingMode.vertical?(I=r(),M=I):I=i(),!(I&&I.box&&I.box.length));n+=1);else I=i()};if(s.get("text-variable-anchor")){var N=s.get("text-variable-anchor");if(n.prevPlacement&&n.prevPlacement.variableOffsets[e.crossTileID]){var j=n.prevPlacement.variableOffsets[e.crossTileID];N.indexOf(j.anchor)>0&&(N=N.filter((function(t){return t!==j.anchor}))).unshift(j.anchor)}var U=function(t,i,r){for(var o=t.x2-t.x1,s=t.y2-t.y1,u=e.textBoxScale,c=w&&!_?i:null,p={box:[],offscreen:!1},d=v?2*N.length:N.length,f=0;f<d;++f){var g=n.attemptAnchorPlacement(N[f%N.length],t,o,s,u,b,x,h,l,m,f>=N.length,e,a,r,c);if(g&&(p=g.placedGlyphBoxes)&&p.box&&p.box.length){T=!0,P=g.shift;break}}return p};B((function(){return U(z,o.iconBox,t.WritingMode.horizontal)}),(function(){var i=o.verticalTextBox;return a.allowVerticalPlacement&&!(I&&I.box&&I.box.length)&&e.numVerticalGlyphVertices>0&&i?U(i,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),I&&(T=I.box,C=I.offscreen);var V=F(I&&I.box);if(!T&&n.prevPlacement){var G=n.prevPlacement.variableOffsets[e.crossTileID];G&&(n.variableOffsets[e.crossTileID]=G,n.markUsedJustification(a,G.anchor,e,V))}}else{var q=function(t,i){var r=n.collisionIndex.placeCollisionBox(t,v,h,l,m.predicate);return r&&r.box&&r.box.length&&(n.markUsedOrientation(a,i,e),n.placedOrientations[e.crossTileID]=i),r};B((function(){return q(z,t.WritingMode.horizontal)}),(function(){var i=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?q(i,t.WritingMode.vertical):{box:null,offscreen:null}})),F(I&&I.box&&I.box.length)}}if(T=(d=I)&&d.box&&d.box.length>0,C=d&&d.offscreen,e.useRuntimeCollisionCircles){var W=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),H=t.evaluateSizeForFeature(a.textSizeData,f,W),Z=s.get("text-padding");k=n.collisionIndex.placeCollisionCircles(v,W,a.lineVertexArray,a.glyphOffsetArray,H,l,u,c,r,x,m.predicate,e.collisionCircleDiameter,Z),T=v||k.circles.length>0&&!k.collisionDetected,C=C&&k.offscreen}if(o.iconFeatureIndex&&(R=o.iconFeatureIndex),o.iconBox){var X=function(t){var e=w&&P?be(t,P.x,P.y,b,x,n.transform.angle):t;return n.collisionIndex.placeCollisionBox(e,_,h,l,m.predicate)};A=M&&M.box&&M.box.length&&o.verticalIconBox?(D=X(o.verticalIconBox)).box.length>0:(D=X(o.iconBox)).box.length>0,C=C&&D.offscreen}var Y=g||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,K=y||0===e.numIconVertices;if(Y||K?K?Y||(A=A&&T):T=A&&T:A=T=A&&T,T&&d&&d.box&&n.collisionIndex.insertCollisionBox(d.box,s.get("text-ignore-placement"),a.bucketInstanceId,M&&M.box&&O?O:L,m.ID),A&&D&&n.collisionIndex.insertCollisionBox(D.box,s.get("icon-ignore-placement"),a.bucketInstanceId,R,m.ID),k&&(T&&n.collisionIndex.insertCollisionCircles(k.circles,s.get("text-ignore-placement"),a.bucketInstanceId,L,m.ID),r)){var J=a.bucketInstanceId,Q=n.collisionCircleArrays[J];void 0===Q&&(Q=n.collisionCircleArrays[J]=new ge);for(var $=0;$<k.circles.length;$+=4)Q.circles.push(k.circles[$+0]),Q.circles.push(k.circles[$+1]),Q.circles.push(k.circles[$+2]),Q.circles.push(k.collisionDetected?1:0)}n.placements[e.crossTileID]=new me(T||E,A||S,C||a.justReloaded),i[e.crossTileID]=!0}};if(T)for(var C=a.getSortedSymbolIndexes(this.transform.angle),P=C.length-1;P>=0;--P){var I=C[P];A(a.symbolInstances.get(I),a.collisionArrays[I])}else for(var M=e.symbolInstanceStart;M<e.symbolInstanceEnd;M++)A(a.symbolInstances.get(M),a.collisionArrays[M]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){var k=this.collisionCircleArrays[a.bucketInstanceId];t.invert(k.invProjMatrix,l),k.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},xe.prototype.markUsedJustification=function(e,i,r,n){var o;o=n===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(i)];for(var a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var l=s[a];l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=o>=0&&l!==o?0:r.crossTileID)}},xe.prototype.markUsedOrientation=function(e,i,r){for(var n=i===t.WritingMode.horizontal||i===t.WritingMode.horizontalOnly?i:0,o=i===t.WritingMode.vertical?i:0,a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)},xe.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var r=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],u=n[s];u?(this.opacities[s]=new fe(u,r,l.text,l.icon),i=i||l.text!==u.text.placed||l.icon!==u.icon.placed):(this.opacities[s]=new fe(null,r,l.text,l.icon,l.skipFade),i=i||l.text||l.icon)}for(var c in n){var h=n[c];if(!this.opacities[c]){var p=new fe(h,r,!1,!1);p.isHidden()||(this.opacities[c]=p,i=i||h.text.placed||h.icon.placed)}}for(var d in o)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=o[d]);for(var f in a)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=a[f]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},xe.prototype.updateLayerOpacities=function(t,e){for(var i={},r=0,n=e;r<n.length;r+=1){var o=n[r],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,i,o.collisionBoxArray)}},xe.prototype.updateBucketOpacities=function(e,i,r){var n=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new fe(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),l=o.get("icon-allow-overlap"),u=o.get("text-variable-anchor"),c="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),d=new fe(null,0,s&&(l||!e.hasIconData()||o.get("icon-optional")),l&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);for(var f=function(t,e,i){for(var r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(i)},m=function(r){var o=e.symbolInstances.get(r),s=o.numHorizontalGlyphVertices,l=o.numVerticalGlyphVertices,m=o.crossTileID,g=n.opacities[m];i[m]?g=a:g||(n.opacities[m]=g=d),i[m]=!0;var y=o.numIconVertices>0,v=n.placedOrientations[o.crossTileID],_=v===t.WritingMode.vertical,b=v===t.WritingMode.horizontal||v===t.WritingMode.horizontalOnly;if(s>0||l>0){var x=Me(g.text);f(e.text,s,_?ke:x),f(e.text,l,b?ke:x);var w=g.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=w||b?1:0);var T=n.variableOffsets[o.crossTileID];T&&n.markUsedJustification(e,T.anchor,o,v);var E=n.placedOrientations[o.crossTileID];E&&(n.markUsedJustification(e,"left",o,E),n.markUsedOrientation(e,E,o))}if(y){var S=Me(g.icon),A=!(p&&o.verticalPlacedIconSymbolIndex&&_);o.placedIconSymbolIndex>=0&&(f(e.icon,o.numIconVertices,A?S:ke),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=g.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(f(e.icon,o.numVerticalIconVertices,A?ke:S),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var C=e.collisionArrays[r];if(C){var P=new t.Point(0,0);if(C.textBox||C.verticalTextBox){var I=!0;if(u){var M=n.variableOffsets[m];M?(P=_e(M.anchor,M.width,M.height,M.textOffset,M.textBoxScale),c&&P._rotate(h?n.transform.angle:-n.transform.angle)):I=!1}C.textBox&&we(e.textCollisionBox.collisionVertexArray,g.text.placed,!I||_,P.x,P.y),C.verticalTextBox&&we(e.textCollisionBox.collisionVertexArray,g.text.placed,!I||b,P.x,P.y)}var k=Boolean(!b&&C.verticalIconBox);C.iconBox&&we(e.iconCollisionBox.collisionVertexArray,g.icon.placed,k,p?P.x:0,p?P.y:0),C.verticalIconBox&&we(e.iconCollisionBox.collisionVertexArray,g.icon.placed,!k,p?P.x:0,p?P.y:0)}}},g=0;g<e.symbolInstances.length;g++)m(g);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=y.invProjMatrix,e.placementViewportMatrix=y.viewportMatrix,e.collisionCircleArray=y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},xe.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},xe.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},xe.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},xe.prototype.stillRecent=function(t,e){var i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t},xe.prototype.setStale=function(){this.stale=!0};var Te=Math.pow(2,25),Ee=Math.pow(2,24),Se=Math.pow(2,17),Ae=Math.pow(2,16),Ce=Math.pow(2,9),Pe=Math.pow(2,8),Ie=Math.pow(2,1);function Me(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Te+e*Ee+i*Se+e*Ae+i*Ce+e*Pe+i*Ie+e}var ke=0,De=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};De.prototype.continuePlacement=function(t,e,i,r,n){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1};var Le=function(t,e,i,r,n,o,a){this.placement=new xe(t,n,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1};Le.prototype.isDone=function(){return this._done},Le.prototype.continuePlacement=function(e,i,r){for(var n=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!n._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=i[e[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new De(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Le.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Oe=512/t.EXTENT/2,Re=function(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var r=0;r<e.length;r++){var n=e.get(r),o=n.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}};Re.prototype.getScaledCoordinates=function(e,i){var r=Oe/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((i.canonical.y*t.EXTENT+e.anchorY)*r)}},Re.prototype.findMatches=function(t,e,i){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),n=0;n<t.length;n++){var o=t.get(n);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),l=0,u=a;l<u.length;l+=1){var c=u[l];if(Math.abs(c.coord.x-s.x)<=r&&Math.abs(c.coord.y-s.y)<=r&&!i[c.crossTileID]){i[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var ze=function(){this.maxCrossTileID=0};ze.prototype.generate=function(){return++this.maxCrossTileID};var Fe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var i in this.indexes){var r=this.indexes[i],n={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),n[a.tileID.key]=a}this.indexes[i]=n}this.lng=t},Fe.prototype.addBucket=function(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var n=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var l=a[s];l.tileID.isChildOf(t)&&l.findMatches(e.symbolInstances,t,n)}else{var u=a[t.scaledTo(Number(o)).key];u&&u.findMatches(e.symbolInstances,t,n)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=i.generate(),n[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Re(t,e.symbolInstances,e.bucketInstanceId),!0},Fe.prototype.removeBucketCrossTileIDs=function(t,e){for(var i in e.indexedSymbolInstances)for(var r=0,n=e.indexedSymbolInstances[i];r<n.length;r+=1)delete this.usedCrossTileIDs[t][n[r].crossTileID]},Fe.prototype.removeStaleBuckets=function(t){var e=!1;for(var i in this.indexes){var r=this.indexes[i];for(var n in r)t[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],e=!0)}return e};var Be=function(){this.layerIndexes={},this.crossTileIDs=new ze,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Be.prototype.addLayer=function(t,e,i){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Fe);var n=!1,o={};r.handleWrapJump(i);for(var a=0,s=e;a<s.length;a+=1){var l=s[a],u=l.getBucket(t);u&&t.id===u.layerIds[0]&&(u.bucketInstanceId||(u.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(l.tileID,u,this.crossTileIDs)&&(n=!0),o[u.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(n=!0),n},Be.prototype.pruneUnusedLayers=function(t){var e={};for(var i in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[i]||delete this.layerIndexes[i]};var Ne=function(e,i){return t.emitValidationErrors(e,i&&i.filter((function(t){return"source.canvas"!==t.identifier})))},je=t.pick(Ut,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ue=t.pick(Ut,["setCenter","setZoom","setBearing","setPitch"]),Ve=function(){var e={},i=t.styleSpec.$version;for(var r in t.styleSpec.$root){var n,o=t.styleSpec.$root[r];o.required&&null!=(n="version"===r?i:"array"===o.type?[]:{})&&(e[r]=n)}return e}(),Ge=function(e){function i(r,n){var o=this;void 0===n&&(n={}),e.call(this),this.map=r,this.dispatcher=new E(Bt(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new _(r._requestManager,n.localIdeographFontFamily),this.lineAtlas=new T(256,512),this.crossTileSymbolIndex=new Be,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=i.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,i){if(t.triggerPluginCompletionEvent(e),i&&i.every((function(t){return t})))for(var r in a.sourceCaches)a.sourceCaches[r].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var i=e.getSource();if(i&&i.vectorLayerIds)for(var r in o._layers){var n=o._layers[r];n.source===i.id&&o._validateLayer(n)}}}}))}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.loadURL=function(e,i){var r=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var n="boolean"==typeof i.validate?i.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,i){r._request=null,e?r.fire(new t.ErrorEvent(e)):i&&r._load(i,n)}))},i.prototype.loadJSON=function(e,i){var r=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){r._request=null,r._load(e,!1!==i.validate)}))},i.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ve,!1)},i.prototype._load=function(e,i){if(!i||!Ne(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var n=jt(this.stylesheet.layers);this._order=n.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=n;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},i.prototype._loadSprite=function(e){var i=this;this._spriteRequest=function(e,i,r){var n,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",l=t.getJSON(i.transformRequest(i.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){l=null,a||(a=t,n=e,c())})),u=t.getImage(i.transformRequest(i.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){u=null,a||(a=t,o=e,c())}));function c(){if(a)r(a);else if(n&&o){var e=t.browser.getImageData(o),i={};for(var s in n){var l=n[s],u=l.width,c=l.height,h=l.x,p=l.y,d=l.sdf,f=l.pixelRatio,m=l.stretchX,g=l.stretchY,y=l.content,v=new t.RGBAImage({width:u,height:c});t.RGBAImage.copy(e,v,{x:h,y:p},{x:0,y:0},{width:u,height:c}),i[s]={data:v,pixelRatio:f,sdf:d,stretchX:m,stretchY:g,content:y}}r(null,i)}}return{cancel:function(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null)}}}(e,this.map._requestManager,(function(e,r){if(i._spriteRequest=null,e)i.fire(new t.ErrorEvent(e));else if(r)for(var n in r)i.imageManager.addImage(n,r[n]);i.imageManager.setLoaded(!0),i._availableImages=i.imageManager.listImages(),i.dispatcher.broadcast("setImages",i._availableImages),i.fire(new t.Event("data",{dataType:"style"}))}))},i.prototype._validateLayer=function(e){var i=this.sourceCaches[e.source];if(i){var r=e.sourceLayer;if(r){var n=i.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+n.id+'" as specified by style layer "'+e.id+'"')))}}},i.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},i.prototype._serializeLayers=function(t){for(var e=[],i=0,r=t;i<r.length;i+=1){var n=this._layers[r[i]];"custom"!==n.type&&e.push(n.serialize())}return e},i.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},i.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},i.prototype.update=function(e){if(this._loaded){var i=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(var o in(r.length||n.length)&&this._updateWorkerLayers(r,n),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}for(var l in this.sourceCaches)this.sourceCaches[l].used=!1;for(var u=0,c=this._order;u<c.length;u+=1){var h=this._layers[c[u]];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}this.light.recalculate(e),this.z=e.zoom,i&&this.fire(new t.Event("data",{dataType:"style"}))}},i.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},i.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},i.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},i.prototype.setState=function(e){var i=this;if(this._checkLoaded(),Ne(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=jt(e.layers);var r=function(e,i){if(!e)return[{command:Ut.setStyle,args:[i]}];var r=[];try{if(!t.deepEqual(e.version,i.version))return[{command:Ut.setStyle,args:[i]}];t.deepEqual(e.center,i.center)||r.push({command:Ut.setCenter,args:[i.center]}),t.deepEqual(e.zoom,i.zoom)||r.push({command:Ut.setZoom,args:[i.zoom]}),t.deepEqual(e.bearing,i.bearing)||r.push({command:Ut.setBearing,args:[i.bearing]}),t.deepEqual(e.pitch,i.pitch)||r.push({command:Ut.setPitch,args:[i.pitch]}),t.deepEqual(e.sprite,i.sprite)||r.push({command:Ut.setSprite,args:[i.sprite]}),t.deepEqual(e.glyphs,i.glyphs)||r.push({command:Ut.setGlyphs,args:[i.glyphs]}),t.deepEqual(e.transition,i.transition)||r.push({command:Ut.setTransition,args:[i.transition]}),t.deepEqual(e.light,i.light)||r.push({command:Ut.setLight,args:[i.light]});var n={},o=[];!function(e,i,r,n){var o;for(o in i=i||{},e=e||{})e.hasOwnProperty(o)&&(i.hasOwnProperty(o)||Gt(o,r,n));for(o in i)i.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],i[o])||("geojson"===e[o].type&&"geojson"===i[o].type&&Wt(e,i,o)?r.push({command:Ut.setGeoJSONSourceData,args:[o,i[o].data]}):qt(o,i,r,n)):Vt(o,i,r))}(e.sources,i.sources,o,n);var a=[];e.layers&&e.layers.forEach((function(t){n[t.source]?r.push({command:Ut.removeLayer,args:[t.id]}):a.push(t)})),r=r.concat(o),function(e,i,r){i=i||[];var n,o,a,s,l,u,c,h=(e=e||[]).map(Zt),p=i.map(Zt),d=e.reduce(Xt,{}),f=i.reduce(Xt,{}),m=h.slice(),g=Object.create(null);for(n=0,o=0;n<h.length;n++)f.hasOwnProperty(a=h[n])?o++:(r.push({command:Ut.removeLayer,args:[a]}),m.splice(m.indexOf(a,o),1));for(n=0,o=0;n<p.length;n++)m[m.length-1-n]!==(a=p[p.length-1-n])&&(d.hasOwnProperty(a)?(r.push({command:Ut.removeLayer,args:[a]}),m.splice(m.lastIndexOf(a,m.length-o),1)):o++,r.push({command:Ut.addLayer,args:[f[a],u=m[m.length-n]]}),m.splice(m.length-n,0,a),g[a]=!0);for(n=0;n<p.length;n++)if(s=d[a=p[n]],l=f[a],!g[a]&&!t.deepEqual(s,l))if(t.deepEqual(s.source,l.source)&&t.deepEqual(s["source-layer"],l["source-layer"])&&t.deepEqual(s.type,l.type)){for(c in Ht(s.layout,l.layout,r,a,null,Ut.setLayoutProperty),Ht(s.paint,l.paint,r,a,null,Ut.setPaintProperty),t.deepEqual(s.filter,l.filter)||r.push({command:Ut.setFilter,args:[a,l.filter]}),t.deepEqual(s.minzoom,l.minzoom)&&t.deepEqual(s.maxzoom,l.maxzoom)||r.push({command:Ut.setLayerZoomRange,args:[a,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Ht(s[c],l[c],r,a,c.slice(6),Ut.setPaintProperty):t.deepEqual(s[c],l[c])||r.push({command:Ut.setLayerProperty,args:[a,c,l[c]]}));for(c in l)l.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Ht(s[c],l[c],r,a,c.slice(6),Ut.setPaintProperty):t.deepEqual(s[c],l[c])||r.push({command:Ut.setLayerProperty,args:[a,c,l[c]]}))}else r.push({command:Ut.removeLayer,args:[a]}),u=m[m.lastIndexOf(a)+1],r.push({command:Ut.addLayer,args:[l,u]})}(a,i.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:Ut.setStyle,args:[i]}]}return r}(this.serialize(),e).filter((function(t){return!(t.command in Ue)}));if(0===r.length)return!1;var n=r.filter((function(t){return!(t.command in je)}));if(n.length>0)throw new Error("Unimplemented: "+n.map((function(t){return t.command})).join(", ")+".");return r.forEach((function(t){"setTransition"!==t.command&&i[t.command].apply(i,t.args)})),this.stylesheet=e,!0},i.prototype.addImage=function(e,i){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,i),this._afterImageUpdated(e)},i.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},i.prototype.getImage=function(t){return this.imageManager.getImage(t)},i.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},i.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},i.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},i.prototype.addSource=function(e,i,r){var n=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!i.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(i).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,i,null,r))){this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Mt(e,i,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:n.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},i.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+i+'" is using it.')));var r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},i.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},i.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},i.prototype.addLayer=function(e,i,r){void 0===r&&(r={}),this._checkLoaded();var n=e.id;if(this.getLayer(n))this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" already exists on this map')));else{var o;if("custom"===e.type){if(Ne(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(n,e.source),e=t.clone$1(e),e=t.extend(e,{source:n})),this._validate(t.validateStyle.layer,"layers."+n,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize()}var a=i?this._order.indexOf(i):this._order.length;if(i&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.')));else{if(this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=o,this._removedLayers[n]&&o.source&&"custom"!==o.type){var s=this._removedLayers[n];delete this._removedLayers[n],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},i.prototype.moveLayer=function(e,i){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==i){var r=this._order.indexOf(e);this._order.splice(r,1);var n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.'))):(this._order.splice(n,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},i.prototype.removeLayer=function(e){this._checkLoaded();var i=this._layers[e];if(i){i.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},i.prototype.getLayer=function(t){return this._layers[t]},i.prototype.hasLayer=function(t){return t in this._layers},i.prototype.setLayerZoomRange=function(e,i,r){this._checkLoaded();var n=this.getLayer(e);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},i.prototype.setFilter=function(e,i,r){void 0===r&&(r={}),this._checkLoaded();var n=this.getLayer(e);if(n){if(!t.deepEqual(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.validateStyle.filter,"layers."+n.id+".filter",i,null,r)||(n.filter=t.clone$1(i),this._updateLayer(n)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},i.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},i.prototype.setLayoutProperty=function(e,i,r,n){void 0===n&&(n={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(i),r)||(o.setLayoutProperty(i,r,n),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getLayoutProperty=function(e,i){var r=this.getLayer(e);if(r)return r.getLayoutProperty(i);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},i.prototype.setPaintProperty=function(e,i,r,n){void 0===n&&(n={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(i),r)||(o.setPaintProperty(i,r,n)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},i.prototype.setFeatureState=function(e,i){this._checkLoaded();var r=e.source,n=e.sourceLayer,o=this.sourceCaches[r];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&n?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||n?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(n,e.id,i)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},i.prototype.removeFeatureState=function(e,i){this._checkLoaded();var r=e.source,n=this.sourceCaches[r];if(void 0!==n){var o=n.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?i&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(a,e.id,i):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},i.prototype.getFeatureState=function(e){this._checkLoaded();var i=e.source,r=e.sourceLayer,n=this.sourceCaches[i];if(void 0!==n){if("vector"!==n.getSource().type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},i.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},i.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},i.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},i.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,i=function(t){return"fill-extrusion"===e._layers[t].type},r={},n=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(i(a)){r[a]=o;for(var s=0,l=t;s<l.length;s+=1){var u=l[s][a];if(u)for(var c=0,h=u;c<h.length;c+=1)n.push(h[c])}}}n.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var p=[],d=this._order.length-1;d>=0;d--){var f=this._order[d];if(i(f))for(var m=n.length-1;m>=0;m--){var g=n[m].feature;if(r[g.layer.id]<d)break;p.push(g),n.pop()}else for(var y=0,v=t;y<v.length;y+=1){var _=v[y][f];if(_)for(var b=0,x=_;b<x.length;b+=1)p.push(x[b].feature)}}return p},i.prototype.queryRenderedFeatures=function(e,i,r){i&&i.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",i.filter,null,i);var n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=i.layers;o<a.length;o+=1){var s=a[o],l=this._layers[s];if(!l)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];n[l.source]=!0}}var u=[];for(var c in i.availableImages=this._availableImages,this.sourceCaches)i.layers&&!n[c]||u.push(F(this.sourceCaches[c],this._layers,this._serializedLayers,e,i,r));return this.placement&&u.push(function(t,e,i,r,n,o,a){for(var s={},l=o.queryRenderedSymbols(r),u=[],c=0,h=Object.keys(l).map(Number);c<h.length;c+=1)u.push(a[h[c]]);u.sort(B);for(var p=function(){var i=f[d],r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(var o in r){var a=s[o]=s[o]||[],u=r[o];u.sort((function(t,e){var r=i.featureSortOrder;if(r){var n=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-n}return e.featureIndex-t.featureIndex}));for(var c=0,h=u;c<h.length;c+=1)a.push(h[c])}},d=0,f=u;d<f.length;d+=1)p();var m=function(e){s[e].forEach((function(r){var n=r.feature,o=i[t[e].source].getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}))};for(var g in s)m(g);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)},i.prototype.querySourceFeatures=function(e,i){i&&i.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",i.filter,null,i);var r=this.sourceCaches[e];return r?function(t,e){for(var i=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),r=[],n={},o=0;o<i.length;o++){var a=i[o],s=a.tileID.canonical.key;n[s]||(n[s]=!0,a.querySourceFeatures(r,e))}return r}(r,i):[]},i.prototype.addSourceType=function(t,e,r){return i.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(i.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},i.prototype.getLight=function(){return this.light.getLight()},i.prototype.setLight=function(e,i){void 0===i&&(i={}),this._checkLoaded();var r=this.light.getLight(),n=!1;for(var o in e)if(!t.deepEqual(e[o],r[o])){n=!0;break}if(n){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(a)}},i.prototype._validate=function(e,i,r,n,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Ne(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:r,styleSpec:t.styleSpec},n)))},i.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var i in this.sourceCaches)this.sourceCaches[i].clearTiles(),this.sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},i.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},i.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},i.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},i.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},i.prototype._updatePlacement=function(e,i,r,n,o){void 0===o&&(o=!1);for(var a=!1,s=!1,l={},u=0,c=this._order;u<c.length;u+=1){var h=this._layers[c[u]];if("symbol"===h.type){if(!l[h.source]){var p=this.sourceCaches[h.source];l[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var d=this.crossTileSymbolIndex.addLayer(h,l[h.source],e.center.lng);a=a||d}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Le(e,this._order,o,i,r,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var f=0,m=this._order;f<m.length;f+=1){var g=this._layers[m[f]];"symbol"===g.type&&this.placement.updateLayerOpacities(g,l[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},i.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},i.prototype.getImages=function(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();var r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)},i.prototype.getGlyphs=function(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)},i.prototype.getResource=function(e,i,r){return t.makeRequest(i,r)},i}(t.Evented);Ge.getSourceType=function(t){return R[t]},Ge.setSourceType=function(t,e){R[t]=e},Ge.registerForPluginStateChange=t.registerForPluginStateChange;var qe=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),We=yi("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),He=yi("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ze=yi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Xe=yi("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ye=yi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=yi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Je=yi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Qe=yi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),$e=yi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ti=yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),ei=yi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),ii=yi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ri=yi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ni=yi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),oi=yi("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),ai=yi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),si=yi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),li=yi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ui=yi("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),ci=yi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hi=yi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),pi=yi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),di=yi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),fi=yi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mi=yi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gi=yi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function yi(t,e){var i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),n=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(n):n,s={};return{fragmentSource:t=t.replace(i,(function(t,e,i,r,n){return s[n]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nvarying "+i+" "+r+" "+n+";\n#else\nuniform "+i+" "+r+" u_"+n+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+n+"\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n"})),vertexSource:e=e.replace(i,(function(t,e,i,r,n){var o="float"===r?"vec2":"vec4",a=n.match(/color/)?"color":o;return s[n]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float u_"+n+"_t;\nattribute "+i+" "+o+" a_"+n+";\nvarying "+i+" "+r+" "+n+";\n#else\nuniform "+i+" "+r+" u_"+n+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+n+" = a_"+n+";\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+n+" = unpack_mix_"+a+"(a_"+n+", u_"+n+"_t);\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float u_"+n+"_t;\nattribute "+i+" "+o+" a_"+n+";\n#else\nuniform "+i+" "+r+" u_"+n+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+i+" "+r+" "+n+" = a_"+n+";\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+i+" "+r+" "+n+" = unpack_mix_"+a+"(a_"+n+", u_"+n+"_t);\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n"})),staticAttributes:r,staticUniforms:a}}var vi=Object.freeze({__proto__:null,prelude:We,background:He,backgroundPattern:Ze,circle:Xe,clippingMask:Ye,heatmap:Ke,heatmapTexture:Je,collisionBox:Qe,collisionCircle:$e,debug:ti,fill:ei,fillOutline:ii,fillOutlinePattern:ri,fillPattern:ni,fillExtrusion:oi,fillExtrusionPattern:ai,hillshadePrepare:si,hillshade:li,line:ui,lineGradient:ci,linePattern:hi,lineSDF:pi,raster:di,symbolIcon:fi,symbolSDF:mi,symbolTextAndIcon:gi}),_i=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function bi(t){for(var e=[],i=0;i<t.length;i++)if(null!==t[i]){var r=t[i].split(" ");e.push(r.pop())}return e}_i.prototype.bind=function(t,e,i,r,n,o,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==r.length,u=0;!l&&u<r.length;u++)this.boundPaintVertexBuffers[u]!==r[u]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===n&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),n&&n.dynamicDraw&&n.bind(),s&&s.bind()):this.freshBind(e,i,r,n,o,a,s)},_i.prototype.freshBind=function(t,e,i,r,n,o,a){var s,l=t.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=u.currentNumAttributes||0;for(var h=l;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,d=i;p<d.length;p+=1)d[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(var f=0,m=i;f<m.length;f+=1){var g=m[f];g.bind(),g.setVertexAttribPointers(c,t,n)}o&&(o.bind(),o.setVertexAttribPointers(c,t,n)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,n)),u.currentNumAttributes=l},_i.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var xi=function(t,e,i,r,n,o){var a=t.gl;this.program=a.createProgram();for(var s=bi(i.staticAttributes),l=r?r.getBinderAttributes():[],u=s.concat(l),c=i.staticUniforms?bi(i.staticUniforms):[],h=r?r.getBinderUniforms():[],p=[],d=0,f=c.concat(h);d<f.length;d+=1){var m=f[d];p.indexOf(m)<0&&p.push(m)}var g=r?r.defines():[];o&&g.push("#define OVERDRAW_INSPECTOR;");var y=g.concat(We.fragmentSource,i.fragmentSource).join("\n"),v=g.concat(We.vertexSource,i.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(_,y),a.compileShader(_),a.attachShader(this.program,_);var b=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(b,v),a.compileShader(b),a.attachShader(this.program,b),this.attributes={};var x={};this.numAttributes=u.length;for(var w=0;w<this.numAttributes;w++)u[w]&&(a.bindAttribLocation(this.program,w,u[w]),this.attributes[u[w]]=w);a.linkProgram(this.program),a.deleteShader(b),a.deleteShader(_);for(var T=0;T<p.length;T++){var E=p[T];if(E&&!x[E]){var S=a.getUniformLocation(this.program,E);S&&(x[E]=S)}}this.fixedUniforms=n(t,x),this.binderUniforms=r?r.getUniforms(t,x):[]}}};function wi(t,e,i){var r=1/pe(i,1,e.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,e.transform.tileZoom)/n,a=o*(i.tileID.canonical.x+i.tileID.wrap*n),s=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}xi.prototype.draw=function(t,e,i,r,n,o,a,s,l,u,c,h,p,d,f,m){var g,y=t.gl;if(!this.failedToCreate){for(var v in t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(r),t.setColorMode(n),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[v].set(a[v]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var _=(g={},g[y.LINES]=2,g[y.TRIANGLES]=3,g[y.LINE_STRIP]=1,g)[e],b=0,x=c.get();b<x.length;b+=1){var w=x[b],T=w.vaos||(w.vaos={});(T[s]||(T[s]=new _i)).bind(t,this,l,d?d.getPaintVertexBuffers():[],u,w.vertexOffset,f,m),y.drawElements(e,w.primitiveLength*_,y.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var Ti=function(e,i,r,n){var o=i.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],l=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(l,-i.transform.angle),t.transformMat3(s,s,l);var u=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+r,u_opacity:n}},Ei=function(e,i,r,n,o,a,s){return t.extend(Ti(e,i,r,n),wi(a,i,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},Si=function(t){return{u_matrix:t}},Ai=function(e,i,r,n){return t.extend(Si(e),wi(r,i,n))},Ci=function(t,e){return{u_matrix:t,u_world:e}},Pi=function(e,i,r,n,o){return t.extend(Ai(e,i,r,n),{u_world:o})},Ii=function(e,i,r,n){var o,a,s=e.transform;if("map"===n.paint.get("circle-pitch-alignment")){var l=pe(r,1,s.zoom);o=!0,a=[l,l]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===n.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(i.posMatrix,r,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},Mi=function(t,e,i){var r=pe(i,1,e.zoom),n=Math.pow(2,e.zoom-i.tileID.overscaledZ),o=i.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*n),e.pixelsToGLUnits[1]/(r*n)],u_overscale_factor:o}},ki=function(t,e,i){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:i.cameraToCenterDistance,u_viewport_size:[i.width,i.height]}},Di=function(t,e,i){return void 0===i&&(i=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}},Li=function(t){return{u_matrix:t}},Oi=function(t,e,i,r){return{u_matrix:t,u_extrude_scale:pe(e,1,i),u_intensity:r}},Ri=function(e,i,r){var n=e.transform;return{u_matrix:ji(e,i,r),u_ratio:1/pe(i,1,n.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},zi=function(e,i,r,n){return t.extend(Ri(e,i,r),{u_image:0,u_image_height:n})},Fi=function(e,i,r,n){var o=e.transform,a=Ni(i,o);return{u_matrix:ji(e,i,r),u_texsize:i.imageAtlasTexture.size,u_ratio:1/pe(i,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Bi=function(e,i,r,n,o){var a=e.lineAtlas,s=Ni(i,e.transform),l="round"===r.layout.get("line-cap"),u=a.getDash(n.from,l),c=a.getDash(n.to,l),h=u.width*o.fromScale,p=c.width*o.toScale;return t.extend(Ri(e,i,r),{u_patternscale_a:[s/h,-u.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:c.y,u_mix:o.t})};function Ni(t,e){return 1/pe(t,1,e.tileZoom)}function ji(t,e,i){return t.translatePosMatrix(e.tileID.posMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}var Ui=function(t,e,i,r,n){return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(a=n.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=n.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Vi(n.paint.get("raster-hue-rotate"))};var o,a};function Vi(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}var Gi,qi=function(t,e,i,r,n,o,a,s,l,u){var c=n.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:c.width/c.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+r,u_texsize:u,u_texture:0}},Wi=function(e,i,r,n,o,a,s,l,u,c,h){var p=o.transform;return t.extend(qi(e,i,r,n,o,a,s,l,u,c),{u_gamma_scale:n?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Hi=function(e,i,r,n,o,a,s,l,u,c){return t.extend(Wi(e,i,r,n,o,a,s,l,!0,u,!0),{u_texsize_icon:c,u_texture_icon:1})},Zi=function(t,e,i){return{u_matrix:t,u_opacity:e,u_color:i}},Xi=function(e,i,r,n,o,a){return t.extend(function(t,e,i,r){var n=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),a=i.imageManager.getPixelSize(),s=a.width,l=a.height,u=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,i.transform.tileZoom)/u,h=c*(r.tileID.canonical.x+r.tileID.wrap*u),p=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,l],u_mix:e.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/pe(r,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(n,a,r,o),{u_matrix:e,u_opacity:i})},Yi={fillExtrusion:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_opacity:new t.Uniform1f(e,i.u_opacity)}},fillExtrusionPattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,i.u_height_factor),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade),u_opacity:new t.Uniform1f(e,i.u_opacity)}},fill:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},fillPattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},fillOutline:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world)}},fillOutlinePattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},circle:function(e,i){return{u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,i.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},collisionBox:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,i.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,i.u_overscale_factor)}},collisionCircle:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,i.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,i.u_viewport_size)}},debug:function(e,i){return{u_color:new t.UniformColor(e,i.u_color),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_overlay:new t.Uniform1i(e,i.u_overlay),u_overlay_scale:new t.Uniform1f(e,i.u_overlay_scale)}},clippingMask:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},heatmap:function(e,i){return{u_extrude_scale:new t.Uniform1f(e,i.u_extrude_scale),u_intensity:new t.Uniform1f(e,i.u_intensity),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},heatmapTexture:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_color_ramp:new t.Uniform1i(e,i.u_color_ramp),u_opacity:new t.Uniform1f(e,i.u_opacity)}},hillshade:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_latrange:new t.Uniform2f(e,i.u_latrange),u_light:new t.Uniform2f(e,i.u_light),u_shadow:new t.UniformColor(e,i.u_shadow),u_highlight:new t.UniformColor(e,i.u_highlight),u_accent:new t.UniformColor(e,i.u_accent)}},hillshadePrepare:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_dimension:new t.Uniform2f(e,i.u_dimension),u_zoom:new t.Uniform1f(e,i.u_zoom),u_unpack:new t.Uniform4f(e,i.u_unpack)}},line:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels)}},lineGradient:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_image:new t.Uniform1i(e,i.u_image),u_image_height:new t.Uniform1f(e,i.u_image_height)}},linePattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_texsize:new t.Uniform2f(e,i.u_texsize),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_image:new t.Uniform1i(e,i.u_image),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},lineSDF:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,i.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,i.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,i.u_sdfgamma),u_image:new t.Uniform1i(e,i.u_image),u_tex_y_a:new t.Uniform1f(e,i.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,i.u_tex_y_b),u_mix:new t.Uniform1f(e,i.u_mix)}},raster:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_tl_parent:new t.Uniform2f(e,i.u_tl_parent),u_scale_parent:new t.Uniform1f(e,i.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,i.u_buffer_scale),u_fade_t:new t.Uniform1f(e,i.u_fade_t),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image0:new t.Uniform1i(e,i.u_image0),u_image1:new t.Uniform1i(e,i.u_image1),u_brightness_low:new t.Uniform1f(e,i.u_brightness_low),u_brightness_high:new t.Uniform1f(e,i.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,i.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,i.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,i.u_spin_weights)}},symbolIcon:function(e,i){return{u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture)}},symbolSDF:function(e,i){return{u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}},symbolTextAndIcon:function(e,i){return{u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texsize_icon:new t.Uniform2f(e,i.u_texsize_icon),u_texture:new t.Uniform1i(e,i.u_texture),u_texture_icon:new t.Uniform1i(e,i.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}},background:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_color:new t.UniformColor(e,i.u_color)}},backgroundPattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image:new t.Uniform1i(e,i.u_image),u_pattern_tl_a:new t.Uniform2f(e,i.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,i.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,i.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,i.u_pattern_br_b),u_texsize:new t.Uniform2f(e,i.u_texsize),u_mix:new t.Uniform1f(e,i.u_mix),u_pattern_size_a:new t.Uniform2f(e,i.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,i.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,i.u_scale_a),u_scale_b:new t.Uniform1f(e,i.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,i.u_tile_units_to_pixels)}}};function Ki(e,i,r,n,o,a,s){for(var l=e.context,u=l.gl,c=e.useProgram("collisionBox"),h=[],p=0,d=0,f=0;f<n.length;f++){var m=n[f],g=i.getTile(m),y=g.getBucket(r);if(y){var v=m.posMatrix;0===o[0]&&0===o[1]||(v=e.translatePosMatrix(m.posMatrix,g,o,a));var _=s?y.textCollisionBox:y.iconCollisionBox,b=y.collisionCircleArray;if(b.length>0){var x=t.create(),w=v;t.mul(x,y.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(x,x,y.placementViewportMatrix),h.push({circleArray:b,circleOffset:d,transform:w,invTransform:x}),d=p+=b.length/4}_&&c.draw(l,u.LINES,St.disabled,At.disabled,e.colorModeForRenderPass(),Pt.disabled,Mi(v,e.transform,g),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var T=e.useProgram("collisionCircle"),E=new t.StructArrayLayout2f1f2i16;E.resize(4*p),E._trim();for(var S=0,A=0,C=h;A<C.length;A+=1)for(var P=C[A],I=0;I<P.circleArray.length/4;I++){var M=4*I,k=P.circleArray[M+0],D=P.circleArray[M+1],L=P.circleArray[M+2],O=P.circleArray[M+3];E.emplace(S++,k,D,L,O,0),E.emplace(S++,k,D,L,O,1),E.emplace(S++,k,D,L,O,2),E.emplace(S++,k,D,L,O,3)}(!Gi||Gi.length<2*p)&&(Gi=function(e){var i=2*e,r=new t.StructArrayLayout3ui6;r.resize(i),r._trim();for(var n=0;n<i;n++){var o=6*n;r.uint16[o+0]=4*n+0,r.uint16[o+1]=4*n+1,r.uint16[o+2]=4*n+2,r.uint16[o+3]=4*n+2,r.uint16[o+4]=4*n+3,r.uint16[o+5]=4*n+0}return r}(p));for(var R=l.createIndexBuffer(Gi,!0),z=l.createVertexBuffer(E,t.collisionCircleLayout.members,!0),F=0,B=h;F<B.length;F+=1){var N=B[F],j=ki(N.transform,N.invTransform,e.transform);T.draw(l,u.TRIANGLES,St.disabled,At.disabled,e.colorModeForRenderPass(),Pt.disabled,j,r.id,z,R,t.SegmentVector.simpleSegment(0,2*N.circleOffset,N.circleArray.length,N.circleArray.length/2),null,e.transform.zoom,null,null,null)}z.destroy(),R.destroy()}}var Ji=t.identity(new Float32Array(16));function Qi(e,i,r,n,o,a){var s=t.getAnchorAlignment(e),l=-(s.horizontalAlign-.5)*i,u=-(s.verticalAlign-.5)*r,c=t.evaluateVariableOffset(e,n);return new t.Point((l/o+c[0])*a,(u/o+c[1])*a)}function $i(e,i,r,n,o,a,s,l,u,c,h){var p=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,m={};d.clear();for(var g=0;g<p.length;g++){var y=p.get(g),v=y.hidden||!y.crossTileID||e.allowVerticalPlacement&&!y.placedOrientation?null:n[y.crossTileID];if(v){var _=new t.Point(y.anchorX,y.anchorY),b=$t(_,r?l:s),x=te(a.cameraToCenterDistance,b.signedDistanceFromCamera),w=o.evaluateSizeForFeature(e.textSizeData,c,y)*x/t.ONE_EM;r&&(w*=e.tilePixelRatio/u);for(var T=Qi(v.anchor,v.width,v.height,v.textOffset,v.textBoxScale,w),E=r?$t(_.add(T),s).point:b.point.add(i?T.rotate(-a.angle):T),S=e.allowVerticalPlacement&&y.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,A=0;A<y.numGlyphs;A++)t.addDynamicAttributes(d,E,S);h&&y.associatedIconIndex>=0&&(m[y.associatedIconIndex]={shiftedAnchor:E,angle:S})}else ue(y.numGlyphs,d)}if(h){f.clear();for(var C=e.icon.placedSymbolArray,P=0;P<C.length;P++){var I=C.get(P);if(I.hidden)ue(I.numGlyphs,f);else{var M=m[P];if(M)for(var k=0;k<I.numGlyphs;k++)t.addDynamicAttributes(f,M.shiftedAnchor,M.angle);else ue(I.numGlyphs,f)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function tr(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function er(e,i,r,n,o,a,s,l,u,c,h,p){for(var d=e.context,f=d.gl,m=e.transform,g="map"===l,y="map"===u,v=g&&"point"!==r.layout.get("symbol-placement"),_=g&&!y&&!v,b=void 0!==r.layout.get("symbol-sort-key").constantOr(1),x=e.depthModeForSublayer(0,St.ReadOnly),w=r.layout.get("text-variable-anchor"),T=[],E=0,S=n;E<S.length;E+=1){var A=S[E],C=i.getTile(A),P=C.getBucket(r);if(P){var I=o?P.text:P.icon;if(I&&I.segments.get().length){var M=I.programConfigurations.get(r.id),k=o||P.sdfIcons,D=o?P.textSizeData:P.iconSizeData,L=y||0!==m.pitch,O=e.useProgram(tr(k,o,P),M),R=t.evaluateSizeForZoom(D,m.zoom),z=void 0,F=[0,0],B=void 0,N=void 0,j=null,U=void 0;if(o)B=C.glyphAtlasTexture,N=f.LINEAR,z=C.glyphAtlasTexture.size,P.iconsInText&&(F=C.imageAtlasTexture.size,j=C.imageAtlasTexture,U=L||e.options.rotating||e.options.zooming||"composite"===D.kind||"camera"===D.kind?f.LINEAR:f.NEAREST);else{var V=1!==r.layout.get("icon-size").constantOr(0)||P.iconsNeedLinear;B=C.imageAtlasTexture,N=k||e.options.rotating||e.options.zooming||V||L?f.LINEAR:f.NEAREST,z=C.imageAtlasTexture.size}var G=pe(C,1,e.transform.zoom),q=Jt(A.posMatrix,y,g,e.transform,G),W=Qt(A.posMatrix,y,g,e.transform,G),H=w&&P.hasTextData(),Z="none"!==r.layout.get("icon-text-fit")&&H&&P.hasIconData();v&&ie(P,A.posMatrix,e,o,q,W,y,c);var X=e.translatePosMatrix(A.posMatrix,C,a,s),Y=v||o&&w||Z?Ji:q,K=e.translatePosMatrix(W,C,a,s,!0),J=k&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:O,buffers:I,uniformValues:k?P.iconsInText?Hi(D.kind,R,_,y,e,X,Y,K,z,F):Wi(D.kind,R,_,y,e,X,Y,K,o,z,!0):qi(D.kind,R,_,y,e,X,Y,K,o,z),atlasTexture:B,atlasTextureIcon:j,atlasInterpolation:N,atlasInterpolationIcon:U,isSDF:k,hasHalo:J};if(b)for(var $=0,tt=I.segments.get();$<tt.length;$+=1){var et=tt[$];T.push({segments:new t.SegmentVector([et]),sortKey:et.sortKey,state:Q})}else T.push({segments:I.segments,sortKey:0,state:Q})}}}b&&T.sort((function(t,e){return t.sortKey-e.sortKey}));for(var it=0,rt=T;it<rt.length;it+=1){var nt=rt[it],ot=nt.state;if(d.activeTexture.set(f.TEXTURE0),ot.atlasTexture.bind(ot.atlasInterpolation,f.CLAMP_TO_EDGE),ot.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),ot.isSDF){var at=ot.uniformValues;ot.hasHalo&&(at.u_is_halo=1,ir(ot.buffers,nt.segments,r,e,ot.program,x,h,p,at)),at.u_is_halo=0}ir(ot.buffers,nt.segments,r,e,ot.program,x,h,p,ot.uniformValues)}}function ir(t,e,i,r,n,o,a,s,l){var u=r.context;n.draw(u,u.gl.TRIANGLES,o,a,s,Pt.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function rr(t,e,i,r,n,o,a){var s,l,u,c,h,p=t.context.gl,d=i.paint.get("fill-pattern"),f=d&&d.constantOr(1),m=i.getCrossfadeParameters();a?(l=f&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(l=f?"fillPattern":"fill",s=p.TRIANGLES);for(var g=0,y=r;g<y.length;g+=1){var v=y[g],_=e.getTile(v);if(!f||_.patternsLoaded()){var b=_.getBucket(i);if(b){var x=b.programConfigurations.get(i.id),w=t.useProgram(l,x);f&&(t.context.activeTexture.set(p.TEXTURE0),_.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),x.updatePaintBuffers(m));var T=d.constantOr(null);if(T&&_.imageAtlas){var E=_.imageAtlas,S=E.patternPositions[T.to.toString()],A=E.patternPositions[T.from.toString()];S&&A&&x.setConstantPatternPositions(S,A)}var C=t.translatePosMatrix(v.posMatrix,_,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(a){c=b.indexBuffer2,h=b.segments2;var P=[p.drawingBufferWidth,p.drawingBufferHeight];u="fillOutlinePattern"===l&&f?Pi(C,t,m,_,P):Ci(C,P)}else c=b.indexBuffer,h=b.segments,u=f?Ai(C,t,m,_):Si(C);w.draw(t.context,s,n,t.stencilModeForClipping(v),o,Pt.disabled,u,i.id,b.layoutVertexBuffer,c,h,i.paint,t.transform.zoom,x)}}}}function nr(t,e,i,r,n,o,a){for(var s=t.context,l=s.gl,u=i.paint.get("fill-extrusion-pattern"),c=u.constantOr(1),h=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity"),d=0,f=r;d<f.length;d+=1){var m=f[d],g=e.getTile(m),y=g.getBucket(i);if(y){var v=y.programConfigurations.get(i.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",v);c&&(t.context.activeTexture.set(l.TEXTURE0),g.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));var b=u.constantOr(null);if(b&&g.imageAtlas){var x=g.imageAtlas,w=x.patternPositions[b.to.toString()],T=x.patternPositions[b.from.toString()];w&&T&&v.setConstantPatternPositions(w,T)}var E=t.translatePosMatrix(m.posMatrix,g,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),S=i.paint.get("fill-extrusion-vertical-gradient"),A=c?Ei(E,t,S,p,m,h,g):Ti(E,t,S,p);_.draw(s,s.gl.TRIANGLES,n,o,a,Pt.backCCW,A,i.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,i.paint,t.transform.zoom,v)}}}function or(e,i,r,n,o,a){var s=e.context,l=s.gl,u=i.fbo;if(u){var c=e.useProgram("hillshade");s.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,u.colorAttachment.get());var h=function(e,i,r){var n=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l,u,c,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(i.tileID.toUnwrapped(),h),u_image:0,u_latrange:(l=i.tileID,u=Math.pow(2,l.canonical.z),c=l.canonical.y,[new t.MercatorCoordinate(0,c/u).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/u).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:n,u_highlight:o,u_accent:a}}(e,i,r);c.draw(s,l.TRIANGLES,n,o,a,Pt.disabled,h,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function ar(e,i,r,n,o,a){var s=e.context,l=s.gl,u=i.dem;if(u&&u.data){var c=u.dim,h=u.stride,p=u.getPixels();if(s.activeTexture.set(l.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(h),i.demTexture){var d=i.demTexture;d.update(p,{premultiply:!1}),d.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new t.Texture(s,p,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);s.activeTexture.set(l.TEXTURE0);var f=i.fbo;if(!f){var m=new t.Texture(s,{width:c,height:c,data:null},l.RGBA);m.bind(l.LINEAR,l.CLAMP_TO_EDGE),(f=i.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(m.texture)}s.bindFramebuffer.set(f.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,n,o,a,Pt.disabled,function(e,i){var r=i.stride,n=t.create();return t.ortho(n,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(n,n,[0,-t.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:i.getUnpackVector()}}(i.tileID,u),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function sr(e,i,r,n,o){var a=n.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),l=(s-e.timeAdded)/a,u=i?(s-i.timeAdded)/a:-1,c=r.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),d=p&&e.refreshedUponExpiration?1:t.clamp(p?l:1-u,0,1);return e.refreshedUponExpiration&&l>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var lr=new t.Color(1,0,0,1),ur=new t.Color(0,1,0,1),cr=new t.Color(0,0,1,1),hr=new t.Color(1,0,1,1),pr=new t.Color(0,1,1,1);function dr(t,e,i,r){mr(t,0,e+i/2,t.transform.width,i,r)}function fr(t,e,i,r){mr(t,e-i/2,0,i,t.transform.height,r)}function mr(e,i,r,n,o,a){var s=e.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,n*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}function gr(e,i,r){var n=e.context,o=n.gl,a=r.posMatrix,s=e.useProgram("debug"),l=St.disabled,u=At.disabled,c=e.colorModeForRenderPass();n.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(n,o.LINE_STRIP,l,u,c,Pt.disabled,Di(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=i.getTileByID(r.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),d=i.getTile(r).tileSize,f=512/Math.min(d,512)*(r.overscaledZ/e.transform.zoom)*.5,m=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(m+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var i=t.debugOverlayCanvas,r=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,m+" "+p+"kb"),s.draw(n,o.TRIANGLES,l,u,Ct.alphaBlended,Pt.disabled,Di(a,t.Color.transparent,f),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var yr={symbol:function(e,i,r,n,o){if("translucent"===e.renderPass){var a=At.disabled,s=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,i,r,n,o,a,s){for(var l=i.transform,u="map"===o,c="map"===a,h=0,p=e;h<p.length;h+=1){var d=p[h],f=n.getTile(d),m=f.getBucket(r);if(m&&m.text&&m.text.segments.get().length){var g=t.evaluateSizeForZoom(m.textSizeData,l.zoom),y=pe(f,1,i.transform.zoom),v=Jt(d.posMatrix,c,u,i.transform,y),_="none"!==r.layout.get("icon-text-fit")&&m.hasIconData();if(g){var b=Math.pow(2,l.zoom-f.tileID.overscaledZ);$i(m,u,c,s,t.symbolSize,l,v,d.posMatrix,b,g,_)}}}}(n,e,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&er(e,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&er(e,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),i.map.showCollisionBoxes&&(Ki(e,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Ki(e,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(e,i,r,n){if("translucent"===e.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var u=e.context,c=u.gl,h=e.depthModeForSublayer(0,St.ReadOnly),p=At.disabled,d=e.colorModeForRenderPass(),f=[],m=0;m<n.length;m++){var g=n[m],y=i.getTile(g),v=y.getBucket(r);if(v){var _=v.programConfigurations.get(r.id),b={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:v.layoutVertexBuffer,indexBuffer:v.indexBuffer,uniformValues:Ii(e,g,y,r)};if(l)for(var x=0,w=v.segments.get();x<w.length;x+=1){var T=w[x];f.push({segments:new t.SegmentVector([T]),sortKey:T.sortKey,state:b})}else f.push({segments:v.segments,sortKey:0,state:b})}}l&&f.sort((function(t,e){return t.sortKey-e.sortKey}));for(var E=0,S=f;E<S.length;E+=1){var A=S[E],C=A.state;C.program.draw(u,c.TRIANGLES,h,p,d,Pt.disabled,C.uniformValues,r.id,C.layoutVertexBuffer,C.indexBuffer,A.segments,r.paint,e.transform.zoom,C.programConfiguration)}}}},heatmap:function(e,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=At.disabled,l=new Ct([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,i){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var n=i.heatmapFbo;if(n)r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),t.bindFramebuffer.set(n.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),n=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,i,r){var n=t.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width/4,e.height/4,0,n.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:n.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(t,e,o,n)}}(o,e,r),o.clear({color:t.Color.transparent});for(var u=0;u<n.length;u++){var c=n[u];if(!i.hasRenderableParent(c)){var h=i.getTile(c),p=h.getBucket(r);if(p){var d=p.programConfigurations.get(r.id);e.useProgram("heatmap",d).draw(o,a.TRIANGLES,St.disabled,s,l,Pt.disabled,Oi(c.posMatrix,h,e.transform.zoom,r.paint.get("heatmap-intensity")),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,e.transform.zoom,d)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){var r=e.context,n=r.gl,o=i.heatmapFbo;if(o){r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);var a=i.colorRampTexture;a||(a=i.colorRampTexture=new t.Texture(r,i.colorRamp,n.RGBA)),a.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,n.TRIANGLES,St.disabled,At.disabled,e.colorModeForRenderPass(),Pt.disabled,function(e,i,r,n){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}}(e,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}}(e,r))},line:function(e,i,r,n){if("translucent"===e.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,St.ReadOnly),l=e.colorModeForRenderPass(),u=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),h=c.constantOr(1),p=r.paint.get("line-gradient"),d=r.getCrossfadeParameters(),f=h?"linePattern":u?"lineSDF":p?"lineGradient":"line",m=e.context,g=m.gl,y=!0,v=0,_=n;v<_.length;v+=1){var b=_[v],x=i.getTile(b);if(!h||x.patternsLoaded()){var w=x.getBucket(r);if(w){var T=w.programConfigurations.get(r.id),E=e.context.program.get(),S=e.useProgram(f,T),A=y||S.program!==E,C=c.constantOr(null);if(C&&x.imageAtlas){var P=x.imageAtlas,I=P.patternPositions[C.to.toString()],M=P.patternPositions[C.from.toString()];I&&M&&T.setConstantPatternPositions(I,M)}var k=h?Fi(e,x,r,d):u?Bi(e,x,r,u,d):p?zi(e,x,r,w.lineClipsArray.length):Ri(e,x,r);if(h)m.activeTexture.set(g.TEXTURE0),x.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.updatePaintBuffers(d);else if(u&&(A||e.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(m);else if(p){var D=w.gradients[r.id],L=D.texture;if(r.gradientVersion!==D.version){var O=256;if(r.stepInterpolant){var R=i.getSource().maxzoom,z=b.canonical.z===R?Math.ceil(1<<e.transform.maxZoom-b.canonical.z):1;O=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*z),256,m.maxTextureSize)}D.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:O,image:D.gradient||void 0,clips:w.lineClipsArray}),D.texture?D.texture.update(D.gradient):D.texture=new t.Texture(m,D.gradient,g.RGBA),D.version=r.gradientVersion,L=D.texture}m.activeTexture.set(g.TEXTURE0),L.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}S.draw(m,g.TRIANGLES,s,e.stencilModeForClipping(b),l,Pt.disabled,k,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,e.transform.zoom,T,w.layoutVertexBuffer2),y=!1}}}}},fill:function(e,i,r,n){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?St.ReadWrite:St.ReadOnly);rr(e,i,r,n,c,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){var h=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);rr(e,i,r,n,h,s,!0)}}},"fill-extrusion":function(t,e,i,r){var n=i.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===t.renderPass){var o=new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D);if(1!==n||i.paint.get("fill-extrusion-pattern").constantOr(1))nr(t,e,i,r,o,At.disabled,Ct.disabled),nr(t,e,i,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();nr(t,e,i,r,o,At.disabled,a)}}},hillshade:function(t,e,i,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var n=t.context,o=t.depthModeForSublayer(0,St.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r],l=s[0],u=0,c=s[1];u<c.length;u+=1){var h=c[u],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?ar(t,p,i,o,At.disabled,a):"translucent"===t.renderPass&&or(t,p,i,o,l[h.overscaledZ],a)}n.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,i,r){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")&&r.length)for(var n=t.context,o=n.gl,a=e.getSource(),s=t.useProgram("raster"),l=t.colorModeForRenderPass(),u=a instanceof D?[{},r]:t.stencilConfigForOverlap(r),c=u[0],h=u[1],p=h[h.length-1].overscaledZ,d=!t.options.moving,f=0,m=h;f<m.length;f+=1){var g=m[f],y=t.depthModeForSublayer(g.overscaledZ-p,1===i.paint.get("raster-opacity")?St.ReadWrite:St.ReadOnly,o.LESS),v=e.getTile(g),_=t.transform.calculatePosMatrix(g.toUnwrapped(),d);v.registerFadeDuration(i.paint.get("raster-fade-duration"));var b=e.findLoadedParent(g,0),x=sr(v,b,e,i,t.transform),w=void 0,T=void 0,E="nearest"===i.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;n.activeTexture.set(o.TEXTURE0),v.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(o.TEXTURE1),b?(b.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,b.tileID.overscaledZ-v.tileID.overscaledZ),T=[v.tileID.canonical.x*w%1,v.tileID.canonical.y*w%1]):v.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var S=Ui(_,T||[0,0],w||1,x,i);a instanceof D?s.draw(n,o.TRIANGLES,y,At.disabled,l,Pt.disabled,S,i.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(n,o.TRIANGLES,y,c[g.overscaledZ],l,Pt.disabled,S,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,i){var r=i.paint.get("background-color"),n=i.paint.get("background-opacity");if(0!==n){var o=t.context,a=o.gl,s=t.transform,l=s.tileSize,u=i.paint.get("background-pattern");if(!t.isPatternMissing(u)){var c=!u&&1===r.a&&1===n&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=At.disabled,p=t.depthModeForSublayer(0,"opaque"===c?St.ReadWrite:St.ReadOnly),d=t.colorModeForRenderPass(),f=t.useProgram(u?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:l});u&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var g=i.getCrossfadeParameters(),y=0,v=m;y<v.length;y+=1){var _=v[y],b=t.transform.calculatePosMatrix(_.toUnwrapped()),x=u?Xi(b,n,t,u,{tileID:_,tileSize:l},g):Zi(b,n,r);f.draw(o,a.TRIANGLES,p,h,d,Pt.disabled,x,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,i){for(var r=0;r<i.length;r++)gr(t,e,i[r])},custom:function(t,e,i){var r=t.context,n=i.implementation;if("offscreen"===t.renderPass){var o=n.prerender;o&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),o.call(n,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(At.disabled);var a="3d"===n.renderingMode?new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,St.ReadOnly);r.setDepthMode(a),n.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}},vr=function(t,e){this.context=new It(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Mt.maxUnderzooming+Mt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Be,this.gpuTimers={}};vr.prototype.resize=function(e,i){if(this.width=e*t.browser.devicePixelRatio,this.height=i*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,n=this.style._order;r<n.length;r+=1)this.style._layers[n[r]].resize()},vr.prototype.setup=function(){var e=this.context,i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(i,qe.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,qe.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var n=new t.StructArrayLayout4i8;n.emplaceBack(0,0,0,0),n.emplaceBack(t.EXTENT,0,t.EXTENT,0),n.emplaceBack(0,t.EXTENT,0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(n,k.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,qe.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var l=this.context.gl;this.stencilClearMode=new At({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)},vr.prototype.clearStencil=function(){var e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,i.TRIANGLES,St.disabled,this.stencilClearMode,Ct.disabled,Pt.disabled,Li(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},vr.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var i=this.context,r=i.gl;this.nextStencilID+e.length>256&&this.clearStencil(),i.setColorMode(Ct.disabled),i.setDepthMode(St.disabled);var n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],l=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;n.draw(i,r.TRIANGLES,St.disabled,new At({func:r.ALWAYS,mask:0},l,255,r.KEEP,r.KEEP,r.REPLACE),Ct.disabled,Pt.disabled,Li(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},vr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new At({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},vr.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new At({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},vr.prototype.stencilConfigForOverlap=function(t){var e,i=this.context.gl,r=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),n=r[r.length-1].overscaledZ,o=r[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+n]=new At({func:i.GEQUAL,mask:255},s+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[a,r]}return[(e={},e[n]=At.disabled,e),r]},vr.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Ct([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ct.unblended:Ct.alphaBlended},vr.prototype.depthModeForSublayer=function(t,e,i){if(!this.opaquePassEnabledForLayer())return St.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(i||this.context.gl.LEQUAL,e,[r,r])},vr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},vr.prototype.render=function(e,i){var r=this;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var n=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var l,u,c={},h={},p={};for(var d in o){var f=o[d];c[d]=f.getVisibleCoordinates(),h[d]=c[d].slice().reverse(),p[d]=f.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var m=0;m<n.length;m++)if(this.style._layers[n[m]].is3D()){this.opaquePassCutoff=m;break}this.renderPass="offscreen";for(var g=0,y=n;g<y.length;g+=1){var v=this.style._layers[y[g]];if(v.hasOffscreenPass()&&!v.isHidden(this.transform.zoom)){var _=h[v.source];("custom"===v.type||_.length)&&this.renderLayer(this,o[v.source],v,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){var b=this.style._layers[n[this.currentLayer]],x=o[b.source],w=c[b.source];this._renderTileClippingMasks(b,w),this.renderLayer(this,x,b,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){var T=this.style._layers[n[this.currentLayer]],E=o[T.source],S=("symbol"===T.type?p:h)[T.source];this._renderTileClippingMasks(T,c[T.source]),this.renderLayer(this,E,T,S)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(r.transform.zoom)&&(t.source!==(u&&u.id)&&(u=r.style.sourceCaches[t.source]),(!l||l.getSource().maxzoom<u.getSource().maxzoom)&&(l=u))})),l&&yr.debug(this,l,l.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;dr(t,t.transform.height-(e.top||0),3,lr),dr(t,e.bottom||0,3,ur),fr(t,e.left||0,3,cr),fr(t,t.transform.width-(e.right||0),3,hr);var i=t.transform.centerPoint;!function(t,e,i,r){mr(t,e-1,i-10,2,20,r),mr(t,e-10,i-1,20,2,r)}(t,i.x,t.transform.height-i.y,pr)}(this),this.context.setDefault()},vr.prototype.renderLayer=function(t,e,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||r.length)&&(this.id=i.id,this.gpuTimingStart(i),yr[i.type](t,e,i,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},vr.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),i.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,i.query)}},vr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},vr.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},vr.prototype.queryGpuTimers=function(t){var e={};for(var i in t){var r=t[i],n=this.context.extTimerQuery,o=n.getQueryObjectEXT(r.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r.query),e[i]=o}return e},vr.prototype.translatePosMatrix=function(e,i,r,n,o){if(!r[0]&&!r[1])return e;var a=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(a){var s=Math.sin(a),l=Math.cos(a);r=[r[0]*l-r[1]*s,r[0]*s+r[1]*l]}var u=[o?r[0]:pe(i,r[0],this.transform.zoom),o?r[1]:pe(i,r[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,u),c},vr.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},vr.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},vr.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i},vr.prototype.useProgram=function(t,e){this.cache=this.cache||{};var i=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new xi(this.context,t,vi[t],e,Yi[t],this._showOverdrawInspector)),this.cache[i]},vr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},vr.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},vr.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},vr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var _r=function(t,e){this.points=t,this.planes=e};_r.fromInvProjectionMatrix=function(e,i,r){var n=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(i){return t.transformMat4([],i,e)})).map((function(e){return t.scale$1([],e,1/e[3]/i*n)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var i=t.sub([],o[e[0]],o[e[1]]),r=t.sub([],o[e[2]],o[e[1]]),n=t.normalize([],t.cross([],i,r)),a=-t.dot(n,o[e[1]]);return n.concat(a)}));return new _r(o,a)};var br=function(e,i){this.min=e,this.max=i,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};br.prototype.quadrant=function(e){for(var i=[e%2==0,e<2],r=t.clone$2(this.min),n=t.clone$2(this.max),o=0;o<i.length;o++)r[o]=i[o]?this.min[o]:this.center[o],n[o]=i[o]?this.center[o]:this.max[o];return n[2]=this.max[2],new br(r,n)},br.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},br.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},br.prototype.intersects=function(e){for(var i=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,n=0;n<e.planes.length;n++){for(var o=e.planes[n],a=0,s=0;s<i.length;s++)a+=t.dot$1(o,i[s])>=0;if(0===a)return 0;a!==i.length&&(r=!1)}if(r)return 2;for(var l=0;l<3;l++){for(var u=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var p=e.points[h][l]-this.min[l];u=Math.min(u,p),c=Math.max(c,p)}if(c<0||u>this.max[l]-this.min[l])return 0}return 1};var xr=function(t,e,i,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=r};xr.prototype.interpolate=function(e,i,r){return null!=i.top&&null!=e.top&&(this.top=t.number(e.top,i.top,r)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,i.bottom,r)),null!=i.left&&null!=e.left&&(this.left=t.number(e.left,i.left,r)),null!=i.right&&null!=e.right&&(this.right=t.number(e.right,i.right,r)),this},xr.prototype.getCenter=function(e,i){var r=t.clamp((this.left+e-this.right)/2,0,e),n=t.clamp((this.top+i-this.bottom)/2,0,i);return new t.Point(r,n)},xr.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},xr.prototype.clone=function(){return new xr(this.top,this.bottom,this.left,this.right)},xr.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var wr=function(e,i,r,n,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new xr,this._posMatrixCache={},this._alignedPosMatrixCache={}},Tr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};wr.prototype.clone=function(){var t=new wr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Tr.minZoom.get=function(){return this._minZoom},Tr.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Tr.maxZoom.get=function(){return this._maxZoom},Tr.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Tr.minPitch.get=function(){return this._minPitch},Tr.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Tr.maxPitch.get=function(){return this._maxPitch},Tr.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Tr.renderWorldCopies.get=function(){return this._renderWorldCopies},Tr.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Tr.worldSize.get=function(){return this.tileSize*this.scale},Tr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Tr.size.get=function(){return new t.Point(this.width,this.height)},Tr.bearing.get=function(){return-this.angle/Math.PI*180},Tr.bearing.set=function(e){var i=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Tr.pitch.get=function(){return this._pitch/Math.PI*180},Tr.pitch.set=function(e){var i=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())},Tr.fov.get=function(){return this._fov/Math.PI*180},Tr.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Tr.zoom.get=function(){return this._zoom},Tr.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Tr.center.get=function(){return this._center},Tr.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Tr.padding.get=function(){return this._edgeInsets.toJSON()},Tr.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Tr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},wr.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},wr.prototype.interpolatePadding=function(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()},wr.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},wr.prototype.getVisibleUnwrappedCoordinates=function(e){var i=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new t.Point(0,0)),n=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,n.x,o.x,a.x)),l=Math.floor(Math.max(r.x,n.x,o.x,a.x)),u=s-1;u<=l+1;u++)0!==u&&i.push(new t.UnwrappedTileID(u,e));return i},wr.prototype.coveringTiles=function(e){var i=this.coveringZoomLevel(e),r=i;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);var n=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,i),a=[o*n.x,o*n.y,0],s=_r.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i),l=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(l=i);var u=function(t){return{aabb:new br([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},c=[],h=[],p=i,d=e.reparseOverscaled?r:i;if(this._renderWorldCopies)for(var f=1;f<=3;f++)c.push(u(-f)),c.push(u(f));for(c.push(u(0));c.length>0;){var m=c.pop(),g=m.x,y=m.y,v=m.fullyVisible;if(!v){var _=m.aabb.intersects(s);if(0===_)continue;v=2===_}var b=m.aabb.distanceX(a),x=m.aabb.distanceY(a),w=Math.max(Math.abs(b),Math.abs(x));if(m.zoom===p||w>3+(1<<p-m.zoom)-2&&m.zoom>=l)h.push({tileID:new t.OverscaledTileID(m.zoom===p?d:m.zoom,m.wrap,m.zoom,g,y),distanceSq:t.sqrLen([a[0]-.5-g,a[1]-.5-y])});else for(var T=0;T<4;T++){var E=(g<<1)+T%2,S=(y<<1)+(T>>1);c.push({aabb:m.aabb.quadrant(T),zoom:m.zoom+1,x:E,y:S,wrap:m.wrap,fullyVisible:v})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},wr.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Tr.unmodified.get=function(){return this._unmodified},wr.prototype.zoomScale=function(t){return Math.pow(2,t)},wr.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},wr.prototype.project=function(e){var i=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(i)*this.worldSize)},wr.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Tr.point.get=function(){return this.project(this.center)},wr.prototype.setLocationAtPoint=function(e,i){var r=this.pointCoordinate(i),n=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-n.x),o.y-(r.y-n.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},wr.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},wr.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},wr.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},wr.prototype.coordinateLocation=function(t){return t.toLngLat()},wr.prototype.pointCoordinate=function(e){var i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.transformMat4(i,i,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse);var n=i[3],o=r[3],a=i[1]/n,s=r[1]/o,l=i[2]/n,u=r[2]/o,c=l===u?0:(0-l)/(u-l);return new t.MercatorCoordinate(t.number(i[0]/n,r[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},wr.prototype.coordinatePoint=function(e){var i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(i,i,this.pixelMatrix),new t.Point(i[0]/i[3],i[1]/i[3])},wr.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},wr.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},wr.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},wr.prototype.calculatePosMatrix=function(e,i){void 0===i&&(i=!1);var r=e.key,n=i?this._alignedPosMatrixCache:this._posMatrixCache;if(n[r])return n[r];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[s*a,o.y*a,0]),t.scale(l,l,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(l,i?this.alignedProjMatrix:this.projMatrix,l),n[r]=new Float32Array(l),n[r]},wr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},wr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,i,r,n,o=-90,a=90,s=-180,l=180,u=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<u.y?u.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,i=(l=t.mercatorXfromLng(p[1])*this.worldSize)-s<u.x?u.x/(l-s):0}var d=this.point,f=Math.max(i||0,e||0);if(f)return this.center=this.unproject(new t.Point(i?(l+s)/2:d.x,e?(a+o)/2:d.y)),this.zoom+=this.scaleZoom(f),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var m=d.y,g=u.y/2;m-g<o&&(n=o+g),m+g>a&&(n=a-g)}if(this.lngRange){var y=d.x,v=u.x/2;y-v<s&&(r=s+v),y+v>l&&(r=l-v)}void 0===r&&void 0===n||(this.center=this.unproject(new t.Point(void 0!==r?r:d.x,void 0!==n?n:d.y))),this._unmodified=c,this._constraining=!1}},wr.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var i=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),n=Math.sin(r)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-i-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,l=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),u=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,u,l),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-a,-s,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,d=Math.cos(this.angle),f=Math.sin(this.angle),m=a-Math.round(a)+d*h+f*p,g=s-Math.round(s)+d*p+f*h,y=new Float64Array(c);if(t.translate(y,y,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=y,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},wr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance},wr.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},wr.prototype.getCameraQueryGeometry=function(e){var i=this.getCameraPoint();if(1===e.length)return[e[0],i];for(var r=i.x,n=i.y,o=i.x,a=i.y,s=0,l=e;s<l.length;s+=1){var u=l[s];r=Math.min(r,u.x),n=Math.min(n,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}return[new t.Point(r,n),new t.Point(o,n),new t.Point(o,a),new t.Point(r,a),new t.Point(r,n)]},Object.defineProperties(wr.prototype,Tr);var Er=function(e){var i,r,n,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(i=this._updateHashUnthrottled.bind(this),r=!1,n=null,o=function(){n=null,r&&(i(),n=setTimeout(o,300),r=!1)},function(){return r=!0,n||o(),n})};Er.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Er.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Er.prototype.getHashString=function(e){var i=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),a=Math.round(i.lng*o)/o,s=Math.round(i.lat*o)/o,l=this._map.getBearing(),u=this._map.getPitch(),c="";if(c+=e?"/"+a+"/"+s+"/"+r:r+"/"+s+"/"+a,(l||u)&&(c+="/"+Math.round(10*l)/10),u&&(c+="/"+Math.round(u)),this._hashName){var h=this._hashName,p=!1,d=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+c):t})).filter((function(t){return t}));return p||d.push(h+"="+c),"#"+d.join("&")}return"#"+c},Er.prototype._getCurrentHash=function(){var e,i=this,r=t.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===i._hashName&&(e=t)})),(e&&e[1]||"").split("/")):r.split("/")},Er.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Er.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e)}catch(t){}};var Sr={linearity:.3,easing:t.bezier(0,0,.3,1)},Ar=t.extend({deceleration:2500,maxSpeed:1400},Sr),Cr=t.extend({deceleration:20,maxSpeed:1400},Sr),Pr=t.extend({deceleration:1e3,maxSpeed:360},Sr),Ir=t.extend({deceleration:1e3,maxSpeed:90},Sr),Mr=function(t){this._map=t,this.clear()};function kr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Dr(e,i,r){var n=r.maxSpeed,o=r.linearity,a=r.deceleration,s=t.clamp(e*o/(i/1e3),-n,n),l=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}Mr.prototype.clear=function(){this._inertiaBuffer=[]},Mr.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Mr.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,i=t.browser.now();e.length>0&&i-e[0].time>160;)e.shift()},Mr.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var i={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},r=0,n=this._inertiaBuffer;r<n.length;r+=1){var o=n[r].settings;i.zoom+=o.zoomDelta||0,i.bearing+=o.bearingDelta||0,i.pitch+=o.pitchDelta||0,o.panDelta&&i.pan._add(o.panDelta),o.around&&(i.around=o.around),o.pinchAround&&(i.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(i.pan.mag()){var l=Dr(i.pan.mag(),a,t.extend({},Ar,e||{}));s.offset=i.pan.mult(l.amount/i.pan.mag()),s.center=this._map.transform.center,kr(s,l)}if(i.zoom){var u=Dr(i.zoom,a,Cr);s.zoom=this._map.transform.zoom+u.amount,kr(s,u)}if(i.bearing){var c=Dr(i.bearing,a,Pr);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),kr(s,c)}if(i.pitch){var h=Dr(i.pitch,a,Ir);s.pitch=this._map.transform.pitch+h.amount,kr(s,h)}if(s.zoom||s.bearing){var p=void 0===i.pinchAround?i.around:i.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Lr=function(e){function r(r,n,o,a){void 0===a&&(a={});var s=i.mousePos(n.getCanvasContainer(),o),l=n.unproject(s);e.call(this,r,t.extend({point:s,lngLat:l,originalEvent:o},a)),this._defaultPrevented=!1,this.target=n}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var n={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,n),r}(t.Event),Or=function(e){function r(r,n,o){var a="touchend"===r?o.changedTouches:o.touches,s=i.touchPos(n.getCanvasContainer(),a),l=s.map((function(t){return n.unproject(t)})),u=s.reduce((function(t,e,i,r){return t.add(e.div(r.length))}),new t.Point(0,0)),c=n.unproject(u);e.call(this,r,{points:s,point:u,lngLats:l,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var n={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,n),r}(t.Event),Rr=function(t){function e(e,i,r){t.call(this,e,{originalEvent:r}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,i),e}(t.Event),zr=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};zr.prototype.reset=function(){delete this._mousedownPos},zr.prototype.wheel=function(t){return this._firePreventable(new Rr(t.type,this._map,t))},zr.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Lr(t.type,this._map,t))},zr.prototype.mouseup=function(t){this._map.fire(new Lr(t.type,this._map,t))},zr.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Lr(t.type,this._map,t))},zr.prototype.dblclick=function(t){return this._firePreventable(new Lr(t.type,this._map,t))},zr.prototype.mouseover=function(t){this._map.fire(new Lr(t.type,this._map,t))},zr.prototype.mouseout=function(t){this._map.fire(new Lr(t.type,this._map,t))},zr.prototype.touchstart=function(t){return this._firePreventable(new Or(t.type,this._map,t))},zr.prototype.touchmove=function(t){this._map.fire(new Or(t.type,this._map,t))},zr.prototype.touchend=function(t){this._map.fire(new Or(t.type,this._map,t))},zr.prototype.touchcancel=function(t){this._map.fire(new Or(t.type,this._map,t))},zr.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},zr.prototype.isEnabled=function(){return!0},zr.prototype.isActive=function(){return!1},zr.prototype.enable=function(){},zr.prototype.disable=function(){};var Fr=function(t){this._map=t};Fr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fr.prototype.mousemove=function(t){this._map.fire(new Lr(t.type,this._map,t))},Fr.prototype.mousedown=function(){this._delayContextMenu=!0},Fr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fr.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Lr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},Fr.prototype.isEnabled=function(){return!0},Fr.prototype.isActive=function(){return!1},Fr.prototype.enable=function(){},Fr.prototype.disable=function(){};var Br=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function Nr(t,e){for(var i={},r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}Br.prototype.isEnabled=function(){return!!this._enabled},Br.prototype.isActive=function(){return!!this._active},Br.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Br.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Br.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(i.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Br.prototype.mousemoveWindow=function(t,e){if(this._active){var r=e;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var n=this._startPos;this._lastPos=r,this._box||(this._box=i.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(n.x,r.x),a=Math.max(n.x,r.x),s=Math.min(n.y,r.y),l=Math.max(n.y,r.y);i.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=l-s+"px"}}},Br.prototype.mouseupWindow=function(e,r){var n=this;if(this._active&&0===e.button){var o=this._startPos,a=r;if(this.reset(),i.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,n._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Br.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Br.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(i.remove(this._box),this._box=null),i.enableDrag(),delete this._startPos,delete this._lastPos},Br.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))};var jr=function(t){this.reset(),this.numTouches=t.numTouches};jr.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},jr.prototype.touchstart=function(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){for(var i=new t.Point(0,0),r=0,n=e;r<n.length;r+=1)i._add(n[r]);return i.div(e.length)}(i),this.touches=Nr(r,i)))},jr.prototype.touchmove=function(t,e,i){if(!this.aborted&&this.centroid){var r=Nr(i,e);for(var n in this.touches){var o=r[n];(!o||o.dist(this.touches[n])>30)&&(this.aborted=!0)}}},jr.prototype.touchend=function(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Ur=function(t){this.singleTap=new jr(t),this.numTaps=t.numTaps,this.reset()};Ur.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ur.prototype.touchstart=function(t,e,i){this.singleTap.touchstart(t,e,i)},Ur.prototype.touchmove=function(t,e,i){this.singleTap.touchmove(t,e,i)},Ur.prototype.touchend=function(t,e,i){var r=this.singleTap.touchend(t,e,i);if(r){var n=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(n&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Vr=function(){this._zoomIn=new Ur({numTouches:1,numTaps:2}),this._zoomOut=new Ur({numTouches:2,numTaps:1}),this.reset()};Vr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Vr.prototype.touchstart=function(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)},Vr.prototype.touchmove=function(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)},Vr.prototype.touchend=function(t,e,i){var r=this,n=this._zoomIn.touchend(t,e,i),o=this._zoomOut.touchend(t,e,i);return n?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Vr.prototype.touchcancel=function(){this.reset()},Vr.prototype.enable=function(){this._enabled=!0},Vr.prototype.disable=function(){this._enabled=!1,this.reset()},Vr.prototype.isEnabled=function(){return this._enabled},Vr.prototype.isActive=function(){return this._active};var Gr={0:1,2:2},qr=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(t,e){return!1},qr.prototype._move=function(t,e){return{}},qr.prototype.mousedown=function(t,e){if(!this._lastPoint){var r=i.mouseButton(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}},qr.prototype.mousemoveWindow=function(t,e){var i=this._lastPoint;if(i)if(t.preventDefault(),function(t,e){var i=Gr[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)},qr.prototype.mouseupWindow=function(t){this._lastPoint&&i.mouseButton(t)===this._eventButton&&(this._moved&&i.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var Wr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,i){t.prototype.mousedown.call(this,e,i),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(qr),Hr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(qr),Zr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(qr),Xr=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Xr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Xr.prototype.touchstart=function(t,e,i){return this._calculateTransform(t,e,i)},Xr.prototype.touchmove=function(t,e,i){if(this._active&&!(i.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,i)},Xr.prototype.touchend=function(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()},Xr.prototype.touchcancel=function(){this.reset()},Xr.prototype._calculateTransform=function(e,i,r){r.length>0&&(this._active=!0);var n=Nr(r,i),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var l in n){var u=n[l],c=this._touches[l];c&&(o._add(u),a._add(u.sub(c)),s++,n[l]=u)}if(this._touches=n,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},Xr.prototype.enable=function(){this._enabled=!0},Xr.prototype.disable=function(){this._enabled=!1,this.reset()},Xr.prototype.isEnabled=function(){return this._enabled},Xr.prototype.isActive=function(){return this._active};var Yr=function(){this.reset()};function Kr(t,e,i){for(var r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function Jr(t,e){return Math.log(t/e)/Math.LN2}Yr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Yr.prototype._start=function(t){},Yr.prototype._move=function(t,e,i){return{}},Yr.prototype.touchstart=function(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))},Yr.prototype.touchmove=function(t,e,i){if(this._firstTwoTouches){t.preventDefault();var r=this._firstTwoTouches,n=r[1],o=Kr(i,e,r[0]),a=Kr(i,e,n);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Yr.prototype.touchend=function(t,e,r){if(this._firstTwoTouches){var n=this._firstTwoTouches,o=n[1],a=Kr(r,e,n[0]),s=Kr(r,e,o);a&&s||(this._active&&i.suppressClick(),this.reset())}},Yr.prototype.touchcancel=function(){this.reset()},Yr.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Yr.prototype.disable=function(){this._enabled=!1,this.reset()},Yr.prototype.isEnabled=function(){return this._enabled},Yr.prototype.isActive=function(){return this._active};var Qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jr(this._distance,i),pinchAround:e}},e}(Yr);function $r(t,e){return 180*t.angleWith(e)/Math.PI}var tn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$r(this._vector,i),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,i=$r(t,this._startVector);return Math.abs(i)<e},e}(Yr);function en(t){return Math.abs(t.y)>Math.abs(t.x)}var rn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,en(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,i){var r=t[0].sub(this._lastPoints[0]),n=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,i){if(void 0!==this._valid)return this._valid;var r=t.mag()>=2,n=e.mag()>=2;if(r||n){if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return en(t)&&en(e)&&o}},e}(Yr),nn={panStep:100,bearingStep:15,pitchStep:10},on=function(){var t=nn;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep};function an(t){return t*(2-t)}on.prototype.reset=function(){this._active=!1},on.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=0,r=0,n=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:an,zoom:i?Math.round(l)+i*(t.shiftKey?2:1):l,bearing:s.getBearing()+r*e._bearingStep,pitch:s.getPitch()+n*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},on.prototype.enable=function(){this._enabled=!0},on.prototype.disable=function(){this._enabled=!1,this.reset()},on.prototype.isEnabled=function(){return this._enabled},on.prototype.isActive=function(){return this._active};var sn=function(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};sn.prototype.setZoomRate=function(t){this._defaultZoomRate=t},sn.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},sn.prototype.isEnabled=function(){return!!this._enabled},sn.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},sn.prototype.isZooming=function(){return!!this._zooming},sn.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},sn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},sn.prototype.wheel=function(e){if(this.isEnabled()){var i=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,r=t.browser.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}},sn.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},sn.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=i.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},sn.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var i=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==n&&(n=1/n);var o="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(o*n))),"wheel"===this._type&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:i.zoom,l=this._startZoom,u=this._easing,c=!1;if("wheel"===this._type&&l&&u){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),p=u(h);a=t.number(l,s,p),h<1?this._frameId||(this._frameId=!0):c=!0}else a=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:a-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},sn.prototype._smoothOutEasing=function(e){var i=t.ease;if(this._prevEase){var r=this._prevEase,n=(t.browser.now()-r.start)/r.duration,o=r.easing(n+.01)-r.easing(n),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);i=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:i},i},sn.prototype.reset=function(){this._active=!1};var ln=function(t,e){this._clickZoom=t,this._tapZoom=e};ln.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ln.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ln.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ln.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var un=function(){this.reset()};un.prototype.reset=function(){this._active=!1},un.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(i){i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}},un.prototype.enable=function(){this._enabled=!0},un.prototype.disable=function(){this._enabled=!1,this.reset()},un.prototype.isEnabled=function(){return this._enabled},un.prototype.isActive=function(){return this._active};var cn=function(){this._tap=new Ur({numTouches:1,numTaps:1}),this.reset()};cn.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},cn.prototype.touchstart=function(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))},cn.prototype.touchmove=function(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;var r=e[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,i)},cn.prototype.touchend=function(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)},cn.prototype.touchcancel=function(){this.reset()},cn.prototype.enable=function(){this._enabled=!0},cn.prototype.disable=function(){this._enabled=!1,this.reset()},cn.prototype.isEnabled=function(){return this._enabled},cn.prototype.isActive=function(){return this._active};var hn=function(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i};hn.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hn.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hn.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hn.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pn=function(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i};pn.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pn.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pn.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pn.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var dn=function(t,e,i,r){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};dn.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},dn.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},dn.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},dn.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},dn.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},dn.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var fn=function(t){return t.zoom||t.drag||t.pitch||t.rotate},mn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function gn(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var yn=function(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mr(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),t.bindAll(["handleEvent","handleWindowEvent"],this);var n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],l=s[0];i.addEventListener(l,s[1],l===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};yn.prototype.destroy=function(){for(var e=0,r=this._listeners;e<r.length;e+=1){var n=r[e],o=n[0];i.removeEventListener(o,n[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,n[2])}},yn.prototype._addDefaultHandlers=function(t){var e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new zr(e,t));var r=e.boxZoom=new Br(e,t);this._add("boxZoom",r);var n=new Vr,o=new un;e.doubleClickZoom=new ln(o,n),this._add("tapZoom",n),this._add("clickZoom",o);var a=new cn;this._add("tapDragZoom",a);var s=e.touchPitch=new rn;this._add("touchPitch",s);var l=new Hr(t),u=new Zr(t);e.dragRotate=new pn(t,l,u),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);var c=new Wr(t),h=new Xr(t);e.dragPan=new hn(i,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new tn,d=new Qr;e.touchZoomRotate=new dn(i,d,p,a),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]);var f=e.scrollZoom=new sn(e,this);this._add("scrollZoom",f,["mousePan"]);var m=e.keyboard=new on;this._add("keyboard",m),this._add("blockableMapEvent",new Fr(e));for(var g=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<y.length;g+=1){var v=y[g];t.interactive&&t[v]&&e[v].enable(t[v])}},yn.prototype._add=function(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e},yn.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,i=this._handlers;e<i.length;e+=1)i[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},yn.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},yn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},yn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},yn.prototype.isMoving=function(){return Boolean(fn(this._eventsInProgress))||this.isZooming()},yn.prototype._blockedByActive=function(t,e,i){for(var r in t)if(r!==i&&(!e||e.indexOf(r)<0))return!0;return!1},yn.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},yn.prototype._getMapTouches=function(t){for(var e=[],i=0,r=t;i<r.length;i+=1){var n=r[i];this._el.contains(n.target)&&e.push(n)}return e},yn.prototype.handleEvent=function(t,e){if("blur"!==t.type){this._updatingCamera=!0;for(var r="renderFrame"===t.type?void 0:t,n={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,l=s?i.touchPos(this._el,s):i.mousePos(this._el,t),u=0,c=this._handlers;u<c.length;u+=1){var h=c[u],p=h.handlerName,d=h.handler,f=h.allowed;if(d.isEnabled()){var m=void 0;this._blockedByActive(a,f,p)?d.reset():d[e||t.type]&&(m=d[e||t.type](t,l,s),this.mergeHandlerResult(n,o,m,p,r),m&&m.needsRenderFrame&&this._triggerRenderFrame()),(m||d.isActive())&&(a[p]=d)}}var g={};for(var y in this._previousActiveHandlers)a[y]||(g[y]=r);this._previousActiveHandlers=a,(Object.keys(g).length||gn(n))&&(this._changes.push([n,o,g]),this._triggerRenderFrame()),(Object.keys(a).length||gn(n))&&this._map._stop(!0),this._updatingCamera=!1;var v=n.cameraAnimation;v&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],v(this._map))}else this.stop(!0)},yn.prototype.mergeHandlerResult=function(e,i,r,n,o){if(r){t.extend(e,r);var a={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=a),void 0!==r.panDelta&&(i.drag=a),void 0!==r.pitchDelta&&(i.pitch=a),void 0!==r.bearingDelta&&(i.rotate=a)}},yn.prototype._applyChanges=function(){for(var e={},i={},r={},n=0,o=this._changes;n<o.length;n+=1){var a=o[n],s=a[0],l=a[1],u=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(i,l),t.extend(r,u)}this._updateMapTransform(e,i,r),this._changes=[]},yn.prototype._updateMapTransform=function(t,e,i){var r=this._map,n=r.transform;if(!gn(t))return this._fireEvents(e,i,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,l=t.pitchDelta,u=t.around,c=t.pinchAround;void 0!==c&&(u=c),r._stop(!0),u=u||r.transform.centerPoint;var h=n.pointLocation(o?u.sub(o):u);s&&(n.bearing+=s),l&&(n.pitch+=l),a&&(n.zoom+=a),n.setLocationAtPoint(h,u),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)},yn.prototype._fireEvents=function(e,i,r){var n=this,o=fn(this._eventsInProgress),a=fn(e),s={};for(var l in e)this._eventsInProgress[l]||(s[l+"start"]=e[l].originalEvent),this._eventsInProgress[l]=e[l];for(var u in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(u,s[u]);for(var c in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var h,p={};for(var d in this._eventsInProgress){var f=this._eventsInProgress[d],m=f.handlerName,g=f.originalEvent;this._handlersById[m].isActive()||(delete this._eventsInProgress[d],p[d+"end"]=h=i[m]||g)}for(var y in p)this._fireEvent(y,p[y]);var v=fn(this._eventsInProgress);if(r&&(o||a)&&!v){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=function(t){return 0!==t&&-n._bearingSnap<t&&t<n._bearingSnap};_?(b(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),b(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},yn.prototype._fireEvent=function(e,i){this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},yn.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new mn("renderFrame",{timeStamp:e})),t._applyChanges()}))},yn.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var vn=function(e){function i(i,r){e.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},i.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},i.prototype.panBy=function(e,i,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),r)},i.prototype.panTo=function(e,i,r){return this.easeTo(t.extend({center:e},i),r)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},i.prototype.zoomTo=function(e,i,r){return this.easeTo(t.extend({zoom:e},i),r)},i.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},i.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},i.prototype.getPadding=function(){return this.transform.padding},i.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},i.prototype.rotateTo=function(e,i,r){return this.easeTo(t.extend({bearing:e},i),r)},i.prototype.resetNorth=function(e,i){return this.rotateTo(0,t.extend({duration:1e3},e),i),this},i.prototype.resetNorthPitch=function(e,i){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),i),this},i.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},i.prototype.cameraForBounds=function(e,i){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,i)},i.prototype._cameraForBoxAndBearing=function(e,i,r,n){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){var a=n.padding;n.padding={top:a,bottom:a,right:a,left:a}}n.padding=t.extend(o,n.padding);var s=this.transform,l=s.padding,u=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(i)),h=u.rotate(-r*Math.PI/180),p=c.rotate(-r*Math.PI/180),d=new t.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),f=new t.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),m=d.sub(f),g=(s.width-(l.left+l.right+n.padding.left+n.padding.right))/m.x,y=(s.height-(l.top+l.bottom+n.padding.top+n.padding.bottom))/m.y;if(!(y<0||g<0)){var v=Math.min(s.scaleZoom(s.scale*Math.min(g,y)),n.maxZoom),_=t.Point.convert(n.offset),b=new t.Point(_.x+(n.padding.left-n.padding.right)/2,_.y+(n.padding.top-n.padding.bottom)/2).mult(s.scale/s.zoomScale(v));return{center:s.unproject(u.add(c).div(2).sub(b)),zoom:v,bearing:r}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},i.prototype.fitBounds=function(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)},i.prototype.fitScreenCoordinates=function(e,i,r,n,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(i)),r,n),n,o)},i.prototype._fitInternal=function(e,i,r){return e?(delete(i=t.extend(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this},i.prototype.jumpTo=function(e,i){this.stop();var r=this.transform,n=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),n&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),o&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),a&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i))},i.prototype.easeTo=function(e,i){var r=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var n=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="zoom"in e?+e.zoom:o,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:s,p="padding"in e?e.padding:n.padding,d=t.Point.convert(e.offset),f=n.centerPoint.add(d),m=n.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);var y,v,_=n.project(m),b=n.project(g).sub(_),x=n.zoomScale(u-o);e.around&&(y=t.LngLat.convert(e.around),v=n.locationPoint(y));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||u!==o,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||h!==s,this._padding=!n.isPaddingEqual(p),this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,w),this._ease((function(e){if(r._zooming&&(n.zoom=t.number(o,u,e)),r._rotating&&(n.bearing=t.number(a,c,e)),r._pitching&&(n.pitch=t.number(s,h,e)),r._padding&&(n.interpolatePadding(l,p,e),f=n.centerPoint.add(d)),y)n.setLocationAtPoint(y,v);else{var m=n.zoomScale(n.zoom-o),g=u>o?Math.min(2,x):Math.max(.5,x),w=Math.pow(g,1-e),T=n.unproject(_.add(b.mult(e*w)).mult(m));n.setLocationAtPoint(n.renderWorldCopies?T.wrap():T,f)}r._fireMoveEvents(i)}),(function(t){r._afterEase(i,t)}),e),this},i.prototype._prepareEase=function(e,i,r){void 0===r&&(r={}),this._moving=!0,i||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))},i.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},i.prototype._afterEase=function(e,i){if(!this._easeId||!i||this._easeId!==i){delete this._easeId;var r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),n&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},i.prototype.flyTo=function(e,i){var r=this;if(!e.essential&&t.browser.prefersReducedMotion){var n=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),l=this.getPitch(),u=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,p="pitch"in e?+e.pitch:l,d="padding"in e?e.padding:o.padding,f=o.zoomScale(c-a),m=t.Point.convert(e.offset),g=o.centerPoint.add(m),y=o.pointLocation(g),v=t.LngLat.convert(e.center||y);this._normalizeCenter(v);var _=o.project(y),b=o.project(v).sub(_),x=e.curve,w=Math.max(o.width,o.height),T=w/f,E=b.mag();if("minZoom"in e){var S=t.clamp(Math.min(e.minZoom,a,c),o.minZoom,o.maxZoom),A=w/o.zoomScale(S-a);x=Math.sqrt(A/E*2)}var C=x*x;function P(t){var e=(T*T-w*w+(t?-1:1)*C*C*E*E)/(2*(t?T:w)*C*E);return Math.log(Math.sqrt(e*e+1)-e)}function I(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}var k=P(0),D=function(t){return M(k)/M(k+x*t)},L=function(t){return w*((M(k)*(I(e=k+x*t)/M(e))-I(k))/C)/E;var e},O=(P(1)-k)/x;if(Math.abs(E)<1e-6||!isFinite(O)){if(Math.abs(w-T)<1e-6)return this.easeTo(e,i);var R=T<w?-1:1;O=Math.abs(Math.log(T/w))/x,L=function(){return 0},D=function(t){return Math.exp(R*x*t)}}return e.duration="duration"in e?+e.duration:1e3*O/("screenSpeed"in e?+e.screenSpeed/x:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==l,this._padding=!o.isPaddingEqual(d),this._prepareEase(i,!1),this._ease((function(e){var n=e*O,f=1/D(n);o.zoom=1===e?c:a+o.scaleZoom(f),r._rotating&&(o.bearing=t.number(s,h,e)),r._pitching&&(o.pitch=t.number(l,p,e)),r._padding&&(o.interpolatePadding(u,d,e),g=o.centerPoint.add(m));var y=1===e?v:o.unproject(_.add(b.mult(L(n))).mult(f));o.setLocationAtPoint(o.renderWorldCopies?y.wrap():y,g),r._fireMoveEvents(i)}),(function(){return r._afterEase(i)}),e),this},i.prototype.isEasing=function(){return!!this._easeFrameId},i.prototype.stop=function(){return this._stop()},i.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var i=this._onEaseEnd;delete this._onEaseEnd,i.call(this,e)}if(!t){var r=this.handlers;r&&r.stop(!1)}return this},i.prototype._ease=function(e,i,r){!1===r.animate||0===r.duration?(e(1),i()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},i.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},i.prototype._normalizeBearing=function(e,i){e=t.wrap(e,-180,180);var r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e},i.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}},i}(t.Evented),_n=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};_n.prototype.getDefaultPosition=function(){return"bottom-right"},_n.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=i.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},_n.prototype.onRemove=function(){i.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},_n.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var r=i.reduce((function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<i.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow"}},_n.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},_n.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var i=this._map.style.sourceCaches;for(var r in i){var n=i[r];if(n.used){var o=n.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,i){for(var r=i+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},_n.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var bn=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};bn.prototype.onAdd=function(t){this._map=t,this._container=i.create("div","mapboxgl-ctrl");var e=i.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bn.prototype.onRemove=function(){i.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bn.prototype.getDefaultPosition=function(){return"bottom-left"},bn.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},bn.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},bn.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var xn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};xn.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},xn.prototype.remove=function(t){for(var e=this._currentlyRunning,i=0,r=e?this._queue.concat(e):this._queue;i<r.length;i+=1){var n=r[i];if(n.id===t)return void(n.cancelled=!0)}},xn.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var i=0,r=e;i<r.length;i+=1){var n=r[i];if(!n.cancelled&&(n.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},xn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wn={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Tn=t.window.HTMLImageElement,En=t.window.HTMLElement,Sn=t.window.ImageBitmap,An={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Cn=function(r){function n(e){var i=this;if(null!=(e=t.extend({},An,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var n=new wr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(r.call(this,n,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new xn,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},wn,e.locale),this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof En))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return i._update(!1)})),this.on("moveend",(function(){return i._update(!1)})),this.on("zoom",(function(){return i._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yn(this,e),this._hash=e.hash&&new Er("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new _n({customAttribution:e.customAttribution})),this.addControl(new bn,e.logoPosition),this.on("style.load",(function(){i.transform.unmodified&&i.jumpTo(i.style.stylesheet)})),this.on("data",(function(e){i._update("style"===e.dataType),i.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){i.fire(new t.Event(e.dataType+"dataloading",e))}))}r&&(n.__proto__=r),(n.prototype=Object.create(r&&r.prototype)).constructor=n;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return n.prototype._getMapId=function(){return this._mapId},n.prototype.addControl=function(e,i){if(void 0===i&&e.getDefaultPosition&&(i=e.getDefaultPosition()),void 0===i&&(i="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);var n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this},n.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this},n.prototype.resize=function(e){var i=this._containerDimensions(),r=i[0],n=i[1];this._resizeCanvas(r,n),this.transform.resize(r,n),this.painter.resize(r,n);var o=!this._moving;return o&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},n.prototype.getBounds=function(){return this.transform.getBounds()},n.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},n.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},n.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},n.prototype.getMinZoom=function(){return this.transform.minZoom},n.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},n.prototype.getMaxZoom=function(){return this.transform.maxZoom},n.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},n.prototype.getMinPitch=function(){return this.transform.minPitch},n.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},n.prototype.getMaxPitch=function(){return this.transform.maxPitch},n.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},n.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},n.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},n.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},n.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},n.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},n.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},n.prototype._createDelegatedListener=function(t,e,i){var r,n=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:i,delegates:{mousemove:function(r){var a=n.getLayer(e)?n.queryRenderedFeatures(r.point,{layers:[e]}):[];a.length?o||(o=!0,i.call(n,new Lr(t,n,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:i,delegates:{mousemove:function(r){(n.getLayer(e)?n.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,i.call(n,new Lr(t,n,r.originalEvent)))},mouseout:function(e){a&&(a=!1,i.call(n,new Lr(t,n,e.originalEvent)))}}}}return{layer:e,listener:i,delegates:(r={},r[t]=function(t){var r=n.getLayer(e)?n.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,i.call(n,t),delete t.features)},r)}},n.prototype.on=function(t,e,i){if(void 0===i)return r.prototype.on.call(this,t,e);var n=this._createDelegatedListener(t,e,i);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n),n.delegates)this.on(o,n.delegates[o]);return this},n.prototype.once=function(t,e,i){if(void 0===i)return r.prototype.once.call(this,t,e);var n=this._createDelegatedListener(t,e,i);for(var o in n.delegates)this.once(o,n.delegates[o]);return this},n.prototype.off=function(t,e,i){var n=this;return void 0===i?r.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(r){for(var o=r[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===i){for(var l in s.delegates)n.off(l,s.delegates[l]);return o.splice(a,1),n}}}(this._delegatedListeners),this)},n.prototype.queryRenderedFeatures=function(e,i){if(!this.style)return[];var r;if(void 0!==i||void 0===e||e instanceof t.Point||Array.isArray(e)||(i=e,e=void 0),i=i||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])r=[t.Point.convert(e)];else{var n=t.Point.convert(e[0]),o=t.Point.convert(e[1]);r=[n,new t.Point(o.x,n.y),o,new t.Point(n.x,o.y),n]}return this.style.queryRenderedFeatures(r,i,this.transform)},n.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},n.prototype.setStyle=function(e,i){return!1!==(i=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(e,i))},n.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},n.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ge(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},n.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ge(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},n.prototype._diffStyle=function(e,i){var r=this;if("string"==typeof e){var n=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(n,t.ResourceType.Style);t.getJSON(o,(function(e,n){e?r.fire(new t.ErrorEvent(e)):n&&r._updateDiff(n,i)}))}else"object"==typeof e&&this._updateDiff(e,i)},n.prototype._updateDiff=function(e,i){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(e,i)}},n.prototype.getStyle=function(){if(this.style)return this.style.serialize()},n.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},n.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},n.prototype.isSourceLoaded=function(e){var i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},n.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var i=t[e]._tiles;for(var r in i){var n=i[r];if("loaded"!==n.state&&"errored"!==n.state)return!1}}return!0},n.prototype.addSourceType=function(t,e,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)},n.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},n.prototype.getSource=function(t){return this.style.getSource(t)},n.prototype.addImage=function(e,i,r){void 0===r&&(r={});var n=r.pixelRatio;void 0===n&&(n=1);var o=r.sdf;void 0===o&&(o=!1);var a=r.stretchX,s=r.stretchY,l=r.content;if(this._lazyInitEmptyStyle(),i instanceof Tn||Sn&&i instanceof Sn){var u=t.browser.getImageData(i);this.style.addImage(e,{data:new t.RGBAImage({width:u.width,height:u.height},u.data),pixelRatio:n,stretchX:a,stretchY:s,content:l,sdf:o,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=i;this.style.addImage(e,{data:new t.RGBAImage({width:i.width,height:i.height},new Uint8Array(i.data)),pixelRatio:n,stretchX:a,stretchY:s,content:l,sdf:o,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},n.prototype.updateImage=function(e,i){var r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var n=i instanceof Tn||Sn&&i instanceof Sn?t.browser.getImageData(i):i,o=n.width,a=n.height,s=n.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(i instanceof Tn||Sn&&i instanceof Sn)),void this.style.updateImage(e,r))},n.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},n.prototype.removeImage=function(t){this.style.removeImage(t)},n.prototype.loadImage=function(e,i){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),i)},n.prototype.listImages=function(){return this.style.listImages()},n.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},n.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},n.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},n.prototype.getLayer=function(t){return this.style.getLayer(t)},n.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)},n.prototype.setFilter=function(t,e,i){return void 0===i&&(i={}),this.style.setFilter(t,e,i),this._update(!0)},n.prototype.getFilter=function(t){return this.style.getFilter(t)},n.prototype.setPaintProperty=function(t,e,i,r){return void 0===r&&(r={}),this.style.setPaintProperty(t,e,i,r),this._update(!0)},n.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},n.prototype.setLayoutProperty=function(t,e,i,r){return void 0===r&&(r={}),this.style.setLayoutProperty(t,e,i,r),this._update(!0)},n.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},n.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},n.prototype.getLight=function(){return this.style.getLight()},n.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},n.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},n.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},n.prototype.getContainer=function(){return this._container},n.prototype.getCanvasContainer=function(){return this._canvasContainer},n.prototype.getCanvas=function(){return this._canvas},n.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},n.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},n.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=i.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=i.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=i.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var n=this._controlContainer=i.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=i.create("div","mapboxgl-ctrl-"+t,n)}))},n.prototype._resizeCanvas=function(e,i){var r=t.browser.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*i,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px"},n.prototype._setupPainter=function(){var i=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);r?(this.painter=new vr(r,this.transform),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},n.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},n.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},n.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},n.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},n.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},n.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},n.prototype._render=function(e){var i,r=this,n=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(i=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),n=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,l=t.browser.now();this.style.zoomHistory.update(s,l);var u=new t.EvaluationParameters(s,{now:l,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=u.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(u)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-n;o.endQueryEXT(o.TIME_ELAPSED_EXT,i),setTimeout((function(){var e=o.getQueryObjectEXT(i,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(i),r.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var e=r.painter.queryGpuTimers(p);r.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0),this}},n.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,i=this._controls;e<i.length;e+=1)i[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),Pn(this._canvasContainer),Pn(this._controlContainer),Pn(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},n.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},n.prototype._onWindowOnline=function(){this._update()},n.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},n.prototype._setCacheLimits=function(e,i){t.setCacheLimits(e,i)},o.version.get=function(){return t.version},Object.defineProperties(n.prototype,o),n}(vn);function Pn(t){t.parentNode&&t.parentNode.removeChild(t)}var In={showCompass:!0,showZoom:!0,visualizePitch:!1},Mn=function(e){var r=this;this.options=t.extend({},In,e),this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return r._map.zoomIn({},{originalEvent:t})})),i.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return r._map.zoomOut({},{originalEvent:t})})),i.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:t}):r._map.resetNorth({},{originalEvent:t})})),this._compassIcon=i.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Mn.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.disabled=t===this._map.getMaxZoom(),this._zoomOutButton.disabled=t===this._map.getMinZoom()},Mn.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Mn.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new kn(this._map,this._compass,this.options.visualizePitch)),this._container},Mn.prototype.onRemove=function(){i.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Mn.prototype._createButton=function(t,e){var r=i.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r},Mn.prototype._setButtonTitle=function(t,e){var i=this._map._getUIString("NavigationControl."+e);t.title=i,t.setAttribute("aria-label",i)};var kn=function(e,r,n){void 0===n&&(n=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new Hr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new Zr({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener(r,"mousedown",this.mousedown),i.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),i.addEventListener(r,"touchmove",this.touchmove),i.addEventListener(r,"touchend",this.touchend),i.addEventListener(r,"touchcancel",this.reset)};function Dn(e,i,r){if(e=new t.LngLat(e.lng,e.lat),i){var n=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=r.locationPoint(e).distSqr(i);r.locationPoint(n).distSqr(i)<a?e=n:r.locationPoint(o).distSqr(i)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){var s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}kn.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),i.disableDrag()},kn.prototype.move=function(t,e){var i=this.map,r=this.mouseRotate.mousemoveWindow(t,e);if(r&&r.bearingDelta&&i.setBearing(i.getBearing()+r.bearingDelta),this.mousePitch){var n=this.mousePitch.mousemoveWindow(t,e);n&&n.pitchDelta&&i.setPitch(i.getPitch()+n.pitchDelta)}},kn.prototype.off=function(){var t=this.element;i.removeEventListener(t,"mousedown",this.mousedown),i.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),i.removeEventListener(t,"touchmove",this.touchmove),i.removeEventListener(t,"touchend",this.touchend),i.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},kn.prototype.offTemp=function(){i.enableDrag(),i.removeEventListener(t.window,"mousemove",this.mousemove),i.removeEventListener(t.window,"mouseup",this.mouseup)},kn.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),i.mousePos(this.element,e)),i.addEventListener(t.window,"mousemove",this.mousemove),i.addEventListener(t.window,"mouseup",this.mouseup)},kn.prototype.mousemove=function(t){this.move(t,i.mousePos(this.element,t))},kn.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},kn.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},kn.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},kn.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},kn.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ln={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function On(t,e,i){var r=t.classList;for(var n in Ln)r.remove("mapboxgl-"+i+"-anchor-"+n);r.add("mapboxgl-"+i+"-anchor-"+e)}var Rn,zn=function(e){function r(r,n){var o=this;if(e.call(this),(r instanceof t.window.HTMLElement||n)&&(r=t.extend({element:r},n)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=i.create("div"),this._element.setAttribute("aria-label","Map marker");var a=i.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var s=i.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");var l=i.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"fill-rule","nonzero");var u=i.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var c=0,h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];c<h.length;c+=1){var p=h[c],d=i.createNS("http://www.w3.org/2000/svg","ellipse");d.setAttributeNS(null,"opacity","0.04"),d.setAttributeNS(null,"cx","10.5"),d.setAttributeNS(null,"cy","5.80029008"),d.setAttributeNS(null,"rx",p.rx),d.setAttributeNS(null,"ry",p.ry),u.appendChild(d)}var f=i.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var m=i.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(m);var g=i.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"fill","#000000");var y=i.createNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),g.appendChild(y);var v=i.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(6.0, 7.0)"),v.setAttributeNS(null,"fill","#FFFFFF");var _=i.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(8.0, 8.0)");var b=i.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#000000"),b.setAttributeNS(null,"opacity","0.25"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962");var x=i.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),_.appendChild(b),_.appendChild(x),l.appendChild(u),l.appendChild(f),l.appendChild(g),l.appendChild(v),l.appendChild(_),a.appendChild(l),a.setAttributeNS(null,"height",41*this._scale+"px"),a.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(a),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),this._element.addEventListener("focus",(function(){var t=o._map.getContainer();t.scrollTop=0,t.scrollLeft=0})),On(this._element,this._anchor,"marker"),this._popup=null}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),i.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(t){var e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()},r.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},r.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Dn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),i.setTransform(this._element,Ln[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+e)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},r.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(t.Evented),Fn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Bn=0,Nn=!1,jn=function(e){function r(i){e.call(this),this.options=t.extend({},Fn,i),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(e){var r;return this._map=e,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Rn?r(Rn):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){r(Rn="denied"!==t.state)})):r(Rn=!!t.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),i.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Bn=0,Nn=!1},r.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},r.prototype._updateCamera=function(e){var i=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=this._map.getBearing(),o=t.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(e){if(e){var i=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),i=this._map.unproject([1,t]),r=e.distanceTo(i),n=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=n+"px",this._circleElement.style.height=n+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Nn)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(e){var r=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=i.create("button","mapboxgl-ctrl-geolocate",this._container),i.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new zn(this._dotElement),this._circleElement=i.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==r._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new t.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Bn--,Nn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Bn>1?(e={maximumAge:6e5,timeout:0},Nn=!0):(e=this.options.positionOptions,Nn=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(t.Evented),Un={maxWidth:100,unit:"metric"},Vn=function(e){this.options=t.extend({},Un,e),t.bindAll(["_onMove","setUnit"],this)};function Gn(t,e,i){var r=i&&i.maxWidth||100,n=t._container.clientHeight/2,o=t.unproject([0,n]),a=t.unproject([r,n]),s=o.distanceTo(a);if(i&&"imperial"===i.unit){var l=3.2808*s;l>5280?qn(e,r,l/5280,t._getUIString("ScaleControl.Miles")):qn(e,r,l,t._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?qn(e,r,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?qn(e,r,s/1e3,t._getUIString("ScaleControl.Kilometers")):qn(e,r,s,t._getUIString("ScaleControl.Meters"))}function qn(t,e,i,r){var n,o,a,s=(n=i,(o=Math.pow(10,(""+Math.floor(n)).length-1))*(a=(a=n/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a)));t.style.width=e*(s/i)+"px",t.innerHTML=s+"&nbsp;"+r}Vn.prototype.getDefaultPosition=function(){return"bottom-left"},Vn.prototype._onMove=function(){Gn(this._map,this._container,this.options)},Vn.prototype.onAdd=function(t){return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Vn.prototype.onRemove=function(){i.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Vn.prototype.setUnit=function(t){this.options.unit=t,Gn(this._map,this._container,this.options)};var Wn=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Wn.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Wn.prototype.onRemove=function(){i.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Wn.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Wn.prototype._setupUI=function(){var e=this._fullscreenButton=i.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);i.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Wn.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Wn.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Wn.prototype._isFullscreen=function(){return this._fullscreen},Wn.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Wn.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Hn={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Zn=function(e){function r(i){e.call(this),this.options=t.extend(Object.create(Hn),i),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&i.remove(this._content),this._container&&(i.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},r.prototype.setHTML=function(e){var i,r=t.window.document.createDocumentFragment(),n=t.window.document.createElement("body");for(n.innerHTML=e;i=n.firstChild;)r.appendChild(i);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},r.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},r.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},r.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},r.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},r.prototype._createContent=function(){this._content&&i.remove(this._content),this._content=i.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=i.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(t){this._update(t.point)},r.prototype._onMouseMove=function(t){this._update(t.point)},r.prototype._onDrag=function(t){this._update(t.point)},r.prototype._update=function(e){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=i.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=i.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return r._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Dn(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var n=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(i){if(i){if("number"==typeof i){var r=Math.round(Math.sqrt(.5*Math.pow(i,2)));return{center:new t.Point(0,0),top:new t.Point(0,i),"top-left":new t.Point(r,r),"top-right":new t.Point(-r,r),bottom:new t.Point(0,-i),"bottom-left":new t.Point(r,-r),"bottom-right":new t.Point(-r,-r),left:new t.Point(i,0),right:new t.Point(-i,0)}}if(i instanceof t.Point||Array.isArray(i)){var n=t.Point.convert(i);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.Point.convert(i.center||[0,0]),top:t.Point.convert(i.top||[0,0]),"top-left":t.Point.convert(i["top-left"]||[0,0]),"top-right":t.Point.convert(i["top-right"]||[0,0]),bottom:t.Point.convert(i.bottom||[0,0]),"bottom-left":t.Point.convert(i["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(i["bottom-right"]||[0,0]),left:t.Point.convert(i.left||[0,0]),right:t.Point.convert(i.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,l=this._container.offsetWidth,u=this._container.offsetHeight;s=n.y+a.bottom.y<u?["top"]:n.y>this._map.transform.height-u?["bottom"]:[],n.x<l/2?s.push("left"):n.x>this._map.transform.width-l/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=n.add(a[o]).round();i.setTransform(this._container,Ln[o]+" translate("+c.x+"px,"+c.y+"px)"),On(this._container,o,"popup")}},r.prototype._onClose=function(){this.remove()},r}(t.Evented),Xn={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Cn,NavigationControl:Mn,GeolocateControl:jn,AttributionControl:_n,ScaleControl:Vn,FullscreenControl:Wn,Popup:Zn,Marker:zn,Style:Ge,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){Bt().acquire(Ot)},clearPrewarmedResources:function(){var t=zt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Ot),zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Rt.workerCount},set workerCount(t){Rt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Xn})),i}))},e1f9:function(t,e,i){"use strict";i.d(e,"a",(function(){return c})),i.d(e,"b",(function(){return g})),i.d(e,"c",(function(){return A}));var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"s-container",attrs:{id:t.sId+"Container"}},[i("section",{staticClass:"s-wrapper",attrs:{id:t.sId+"Wrapper"}},[i("table",{staticClass:"s",attrs:{id:t.sId+"Table"}},[i("thead",{staticClass:"s-head"},[i("tr",{staticClass:"s-head-row"},t._l(t.proxy.headers,(function(e,r){return i("th",{key:"s-head-row-item-"+r,class:"s-head-row-item "+(e.sort?"cursor-pointer":""),attrs:{width:e.width}},[t._v(" "+t._s(e.text)+" ")])})),0)]),i("tbody",{staticClass:"s-body"},[t._t("default")],2)])])])},n=[],o=i("1da1"),a=(i("96cf"),i("a9e3"),i("d81d"),i("4e82"),{name:"STable",props:{sId:{type:[String,Number],required:!0},headers:{type:Array}},components:{},data:function(){return{proxy:{headers:[]}}},computed:{},created:function(){return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},mounted:function(){},watch:{headers:{immediate:!0,deep:!0,handler:function(t){Array.isArray(t)&&(this.proxy.headers=this.getMappedHeaders(t))}}},methods:{getMappedHeaders:function(t){return t.map((function(t){return{text:t.text,sort:t.sort,width:t.width,order:null}}))}}}),s=a,l=(i("62b7"),i("2877")),u=Object(l["a"])(s,r,n,!1,null,"2c915452",null),c=u.exports,h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("tr",{class:t.className?t.className:"s-row"},[t._t("default")],2)},p=[],d={name:"STableRow",props:{className:{type:[String,Object],required:!1,default:null},textFallbackAlways:{type:Boolean,required:!1,default:!1},textFallbackAlwaysAs:{type:String,required:!1,default:"--"}},provide:function(){return{$textFallbackAlways:this.textFallbackAlways,$textFallbackAlwaysAs:this.textFallbackAlwaysAs}}},f=d,m=(i("7212"),i("1566"),Object(l["a"])(f,h,p,!1,null,"59562074",null)),g=m.exports,y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("td",{staticClass:"s-row-item"},[t._t("default",(function(){return[t.to?i("router-link",t._b({class:"text-blue-600 "+t.className,attrs:{to:t.to,target:"_blank"},on:{click:function(e){return t.$emit("click")}}},"router-link",t.$attrs,!1),[t._v(" "+t._s(t.getText)+" ")]):i("div",t._b({class:""+t.className,on:{click:function(e){return t.$emit("click")}}},"div",t.$attrs,!1),[t._v(" "+t._s(t.getText)+" ")])]}),null,{text:t.getText,to:t.to,className:t.className})],2)},v=[],_=i("5530"),b=(i("99af"),i("2f62")),x=i("4a6d"),w=i("ed08"),T={name:"STableRowItem",inheritAttrs:!1,props:{text:{type:[String,Number,Object],required:!1,default:void 0},textFallback:{type:String,required:!1,default:void 0},to:{type:[String,Object],required:!1,default:void 0},truncate:{type:Number,required:!1,default:void 0},truncatePrepend:{type:[String,Number],required:!1,default:null},truncateAppend:{type:[String,Number],required:!1,default:null},date:{type:Boolean,required:!1,default:!1},dateFormat:{type:String,required:!1,default:"DD MMM, YYYY hh:mm:ss a"},className:{type:String,required:!1,default:""},asCurrency:{type:Boolean,required:!1,default:!1}},inject:["$textFallbackAlways","$textFallbackAlwaysAs"],computed:Object(_["a"])(Object(_["a"])({},Object(b["c"])({organizationCurrencyState:function(t){return t.fsTable.organizationCurrency},currencyState:function(t){return t.fsTable.currency},attributesRoot:function(t){return t.fsTable.currency.attributes.root},attributesActual:function(t){return t.fsTable.currency.attributes.actual},attributesDefault:function(t){return t.fsTable.currency.attributes.default}})),{},{getText:function(){if(!this.text)return this.fallbackText();if(this.date)return this.$dayjs().isValid(this.text)?this.$UTCAwareTime(this.text,this.format):this.textFallback?this.textFallback:this.$textFallbackAlways?this.$textFallbackAlwaysAs:"";if(this.asCurrency){var t="actual"===this.currencyState.selected?this.attributesActual.currencySymbol:this.attributesDefault.currencySymbol,e=this.attributesRoot?this.attributesRoot+"."+t:t,i="actual"===this.currencyState.selected?this.attributesActual.amount:this.attributesDefault.amount,r=this.attributesRoot?this.attributesRoot+"."+i:i;console.log(e,r);var n=Object(w["u"])(e,this.text),o=Object(w["u"])(r,this.text);return n&&o?"".concat(n," ").concat(o):(console.warn("could not resolve currency props ".concat(r,", ").concat(e," on this object"),this.text),this.fallbackText())}return Object(x["a"])(this.text,this.truncate,this.truncatePrepend,this.truncateAppend)}}),methods:{fallbackText:function(){return this.textFallback?this.textFallback:this.$textFallbackAlways?this.$textFallbackAlwaysAs:""}}},E=T,S=(i("eff4"),Object(l["a"])(E,y,v,!1,null,"90824bc4",null)),A=S.exports},e8f7:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("vl-calendar",{ref:"calendar",attrs:{"is-selected":t.isSelected,"is-disabled":t.calculateDisabled,"custom-classes":t.customClasses,"show-weeks-number":t.showWeeksNumber,"default-date":t.defaultDate,"single-month":t.singleMonth,"first-day-of-week":t.firstDayOfWeek},on:{input:function(e){return t.emitDate(e)}}})},n=[],o=(i("caad"),i("2532"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"vl-calendar"},[i("span",{staticClass:"vl-calendar__arrow vl-calendar__arrow--back",on:{click:function(e){return t.moveBack()}}}),i("span",{staticClass:"vl-calendar__arrow vl-calendar__arrow--forward",on:{click:function(e){return t.moveForward()}}}),i("vl-calendar-month",{staticClass:"vl-calendar__month",attrs:{month:t.currentMonthMonth,year:t.currentMonthYear,"is-selected":t.isSelected,"is-disabled":t.isDisabled,"custom-classes":t.customClasses,"show-weeks-number":t.showWeeksNumber,"first-day-of-week":t.firstDayOfWeek},on:{input:function(e){return t.$emit("input",e)}}}),t.singleMonth?t._e():i("vl-calendar-month",{staticClass:"vl-calendar__month",attrs:{month:t.nextMonthMonth,year:t.nextMonthYear,"is-selected":t.isSelected,"is-disabled":t.isDisabled,"custom-classes":t.customClasses,"show-weeks-number":t.showWeeksNumber,"first-day-of-week":t.firstDayOfWeek},on:{input:function(e){return t.$emit("input",e)}}})],1)}),a=[],s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"vl-calendar-month"},[i("div",{staticClass:"vl-calendar-month__title"},[t._v(t._s(t.monthName)+" "+t._s(t.year))]),i("div",{staticClass:"vl-flex"},[t.showWeeksNumber?i("div",{staticClass:"vl-calendar-month__week-numbers-column"},t._l(t.weekNumbers,(function(e){return i("div",{key:e,staticClass:"vl-calendar-month__week-number"},[t._v(" "+t._s(e)+" ")])})),0):t._e(),i("div",[i("div",{staticClass:"vl-flex"},t._l(t.daysNames,(function(e){return i("span",{key:e,staticClass:"vl-calendar-month__week-day"},[t._v(t._s(e))])})),0),i("div",{staticClass:"vl-flex vl-flex-wrap"},t._l(t.days,(function(e){return i("span",{key:e,staticClass:"vl-calendar-month__day",class:t.calculateClasses(e),attrs:{"data-day":e,"data-month":t.month,"data-year":t.year},on:{click:function(i){t.$emit("input",t.getDate(e))}}},[t._v(" "+t._s(e)+" ")])})),0)])])])},l=[],u=(i("a9e3"),i("159b"),i("b64b"),i("2d2d")),c=i("7d1d"),h=["sun","mon","tue","wed","thu","fri","sat"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d={name:"VlCalendarMonth",props:{showWeeksNumber:Boolean,month:Number,year:Number,isSelected:Function,isDisabled:Function,customClasses:Object,firstDayOfWeek:{type:String,validator:function(t){return h.includes(t)},default:"mon"}},computed:{monthName:function(){return Object(c["c"])(this.month)},days:function(){return Object(u["b"])(1,Object(c["a"])(this.month,this.year))},daysNames:function(){return Object(u["c"])(p,this.daysOffset)},daysOffset:function(){return h.indexOf(this.firstDayOfWeek)},weekNumbers:function(){return Object(c["e"])(this.month,this.year)}},methods:{getDate:function(t){return Object(c["b"])(t,this.month,this.year)},calculateClasses:function(t){var e=this,i=[];if(1===t){var r=(new Date(this.year,this.month,1).getDay()+7-this.daysOffset)%7;r>0&&i.push("vl-calendar-month__day--offset-".concat(r))}var n=this.getDate(t);return this.isSelected&&this.isSelected(n)&&(i.push("selected"),this.isSelected(this.getDate(t-1))||i.push("selected--first"),this.isSelected(this.getDate(t+1))||i.push("selected--last")),this.isDisabled&&this.isDisabled(n)&&(i.push("disabled"),this.isDisabled(this.getDate(t-1))||i.push("disabled--first"),this.isDisabled(this.getDate(t+1))||i.push("disabled--last")),Object.keys(this.customClasses||{}).forEach((function(t){var r=e.customClasses[t];r(n)&&i.push(t)})),i}}},f=d,m=i("2877"),g=Object(m["a"])(f,s,l,!1,null,null,null),y=g.exports,v={name:"VlCalendar",components:{VlCalendarMonth:y},props:{isSelected:Function,isDisabled:Function,customClasses:Object,showWeeksNumber:Boolean,singleMonth:Boolean,defaultDate:String,firstDayOfWeek:{type:String,validator:function(t){return h.includes(t)},default:"mon"}},data:function(){var t=this.defaultDate?c["g"](this.defaultDate):c["d"]();return{currentMonthMonth:t.getMonth(),currentMonthYear:t.getFullYear()}},computed:{nextMonthMonth:function(){return 11===this.currentMonthMonth?0:this.currentMonthMonth+1},nextMonthYear:function(){return 11===this.currentMonthMonth?this.currentMonthYear+1:this.currentMonthYear}},methods:{moveBack:function(){0===this.currentMonthMonth?(this.currentMonthMonth=11,this.currentMonthYear--):this.currentMonthMonth--},moveForward:function(){11===this.currentMonthMonth?(this.currentMonthMonth=0,this.currentMonthYear++):this.currentMonthMonth++}}},_=v,b=Object(m["a"])(_,o,a,!1,null,null,null),x=b.exports,w={name:"VlRangeSelector",components:{VlCalendar:x},props:{startDate:String,endDate:String,customClasses:Object,showWeeksNumber:Boolean,defaultDate:String,blockStartDate:Boolean,disabled:Boolean,disabledDates:Object,isDisabled:Function,singleMonth:Boolean,enableSingleDate:Boolean,firstDayOfWeek:{type:String,validator:function(t){return h.includes(t)},default:"mon"}},methods:{emitDate:function(t){this.blockStartDate||this.startDate&&!this.endDate&&t>=this.startDate?this.$emit("update:endDate",t):(this.$emit("update:startDate",t),this.endDate&&this.$emit("update:endDate",null)),this.$emit("focus")},isSelected:function(t){return!(!this.startDate&&!this.endDate)&&(this.endDate?t>=this.startDate&&t<=this.endDate:this.startDate===t)},calculateDisabled:function(t){var e=this.isDisabled||function(){return!1};return!!this.disabled||(this.startDate&&!this.endDate?e(t)||!this.enableSingleDate&&t===this.startDate:this.disabledDates?this.disabledDates.from?t>=this.disabledDates.from:this.disabledDates.to?t<=this.disabledDates.to:void 0:e(t))}}},T=w,E=Object(m["a"])(T,r,n,!1,null,null,null);e["a"]=E.exports},eff4:function(t,e,i){"use strict";i("2869")},f016:function(t,e,i){(function(){var e,r;e=i("065e"),r=i("578f"),t.exports=class extends r{constructor(t,i,r){if(super(t),null==i)throw new Error("Missing instruction target. "+this.debugInfo());this.type=e.ProcessingInstruction,this.target=this.stringify.insTarget(i),this.name=this.target,r&&(this.value=this.stringify.insValue(r))}clone(){return Object.create(this)}toString(t){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(t))}isEqualNode(t){return!!super.isEqualNode(t)&&t.target===this.target}}}).call(this)},f135:function(t,e,i){"use strict";i("195b")},f432:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.isPopShow,expression:"isPopShow"}],staticClass:" fixed inset-x-0 bottom-0 z-50 flex  bg-gray-50 shadow-2xl rounded-t-md ",class:(t.isFullView?"max-h-90vh":"h-10")+" "+(t.getSmallScreenStatus?"mx-5 w-auto":"ml-16 w-96")},[i("div",{staticClass:"w-full"},[t.isFullView?t._e():i("loading",{class:"outline-none",attrs:{active:t.isLoading,height:25,opacity:0,color:"#fff",loader:"bars","is-full-page":!1}}),i("div",{staticClass:"h-10 bg-gray-900 rounded-t-md flex justify-between items-center px-4"},[i("div",{staticClass:"text-oWhite font-medium"},[i("p",[t._v(" "+t._s(t.getPopupHeadline)+" ("+t._s(t.getCompletedSuggestionsCount)+"/"+t._s(t.getSuggestions.length)+") ")])]),i("div",{staticClass:"flex gap-4 items-center justify-center"},[i("div",{staticClass:"cursor-pointer",on:{click:t.handleReload}},[i("i",{staticClass:"text-base fas text-oWhite fa-rotate-right"})]),i("div",{staticClass:"cursor-pointer",on:{click:t.toggleView}},[i("i",{staticClass:"text-base fas text-oWhite",class:t.isFullView?"fa-down-left-and-up-right-to-center":"fa-up-right-and-down-left-from-center"})]),i("div",{staticClass:"cursor-pointer",on:{click:t.handlePopClose}},[i("i",{staticClass:"text-base fas text-oWhite fa-xmark"})])])]),i("div",{staticClass:"px-2 relative"},[t.isFullView?i("loading",{class:"outline-none",attrs:{active:t.isLoading,height:25,opacity:.8,color:"#000",loader:"bars","is-full-page":!1}}):t._e(),i("div",{staticClass:" mt-2  flex items-center gap-2"},t._l(t.getSuggestions,(function(t,e){return i("div",{key:t.id+"-"+e,staticClass:"border-2 border-t-2  w-full rounded",class:t.isCompleted?"border-green-500":""})})),0),i("div",{staticClass:"py-2 overflow-auto max-h-88vh"},t._l(t.getSuggestions,(function(e,r){return i("div",{key:e.id,staticClass:"flex gap-3 py-2"},[i("div",{staticClass:"relative"},[i("div",{staticClass:"top-0 left-0 flex items-center justify-center bg-gray-200 rounded-full w-8 h-8"},[e.isCompleted?i("i",{staticClass:"fa fa-check-circle text-green-600"}):i("span",{staticClass:"bg-gray-900 badge"},[t._v(t._s(r+1))])])]),i("div",{staticClass:"w-full"},[i("div",{staticClass:"flex gap-4 justify-between"},[i("p",{staticClass:"font-medium"},[t._v(t._s(e.title))]),i("div",{staticClass:"mr-2"},[i("router-link",{attrs:{to:e.path,target:"_blank"}},[i("i",{staticClass:"fas fa-arrow-up-right-from-square text-blue-600 text-sm cursor-pointer"})])],1)]),i("p",{staticClass:"text-sm text-gray-500 text-justify mr-2"},[t._v(" "+t._s(e.subtitle)+" ")])])])})),0)],1)],1)])},n=[],o={name:"PopSuggestion",data:function(){return{}},computed:{isLoading:function(){return this.$store.getters["suggestiveStep/getReqStatus"]},isFullView:{get:function(){return this.$store.getters["suggestiveStep/getFullViewStatus"]},set:function(t){this.$store.commit("suggestiveStep/SET_FULL_VIEW_STATUS",t)}},isPopShow:{get:function(){return this.$store.getters["suggestiveStep/getPopViewStatus"]},set:function(t){this.$store.commit("suggestiveStep/SET_POPUP_VIEW_STATUS",t)}},getPopupHeadline:function(){return this.$store.getters["suggestiveStep/getHeadline"]},getSuggestions:function(){return this.$store.getters["suggestiveStep/getSuggestions"]},getCompletedSuggestionsCount:function(){return this.$store.getters["suggestiveStep/getCompletedSuggestions"].length},getSmallScreenStatus:function(){return this.$store.getters["screen/getSmallScreenStatus"]}},methods:{toggleView:function(){this.isFullView=!this.isFullView},handlePopClose:function(){this.isPopShow=!1},handleReload:function(){this.$store.dispatch("suggestiveStep/fetchData")}}},a=o,s=(i("2dd8"),i("2877")),l=Object(s["a"])(a,r,n,!1,null,null,null);e["a"]=l.exports},f5f4:function(t,e,i){"use strict";(function(t,r){i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return a}));const n={self:"undefined"!==typeof self&&self,window:"undefined"!==typeof window&&window,global:"undefined"!==typeof t&&t,document:"undefined"!==typeof document&&document},o=(n.self||n.window||n.global,n.window||n.self||n.global,n.global||n.self||n.window,n.document,"object"!==typeof r||"[object process]"!==String(r)||r.browser),a="undefined"!==typeof window&&"undefined"!==typeof window.orientation,s="undefined"!==typeof r&&r.version&&/v([0-9]*)/.exec(r.version);s&&parseFloat(s[1])}).call(this,i("c8ba"),i("4362"))},f625:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"w-full bg-white rounded-md",class:""+t.getSpacing},[t._t("default")],2)},n=[],o={name:"ContentSection",props:{spacing:{type:Boolean,default:!0}},computed:{getSpacing:function(){return this.spacing?"px-6 py-3 mt-2":""}}},a=o,s=i("2877"),l=Object(s["a"])(a,r,n,!1,null,null,null);e["default"]=l.exports},f7fe:function(t,e,i){(function(e){var i="Expected a function",r=NaN,n="[object Symbol]",o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt,c="object"==typeof e&&e&&e.Object===Object&&e,h="object"==typeof self&&self&&self.Object===Object&&self,p=c||h||Function("return this")(),d=Object.prototype,f=d.toString,m=Math.max,g=Math.min,y=function(){return p.Date.now()};function v(t,e,r){var n,o,a,s,l,u,c=0,h=!1,p=!1,d=!0;if("function"!=typeof t)throw new TypeError(i);function f(e){var i=n,r=o;return n=o=void 0,c=e,s=t.apply(r,i),s}function v(t){return c=t,l=setTimeout(T,e),h?f(t):s}function b(t){var i=t-u,r=t-c,n=e-i;return p?g(n,a-r):n}function x(t){var i=t-u,r=t-c;return void 0===u||i>=e||i<0||p&&r>=a}function T(){var t=y();if(x(t))return E(t);l=setTimeout(T,b(t))}function E(t){return l=void 0,d&&n?f(t):(n=o=void 0,s)}function S(){void 0!==l&&clearTimeout(l),c=0,n=u=o=l=void 0}function A(){return void 0===l?s:E(y())}function C(){var t=y(),i=x(t);if(n=arguments,o=this,u=t,i){if(void 0===l)return v(u);if(p)return l=setTimeout(T,e),f(u)}return void 0===l&&(l=setTimeout(T,e)),s}return e=w(e)||0,_(r)&&(h=!!r.leading,p="maxWait"in r,a=p?m(w(r.maxWait)||0,e):a,d="trailing"in r?!!r.trailing:d),C.cancel=S,C.flush=A,C}function _(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function b(t){return!!t&&"object"==typeof t}function x(t){return"symbol"==typeof t||b(t)&&f.call(t)==n}function w(t){if("number"==typeof t)return t;if(x(t))return r;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var i=s.test(t);return i||l.test(t)?u(t.slice(2),i?2:8):a.test(t)?r:+t}t.exports=v}).call(this,i("c8ba"))},f864:function(t,e,i){},f900:function(t,e,i){}}]);
//# sourceMappingURL=dashboard-demand-heatmap.54faf0c2.js.map