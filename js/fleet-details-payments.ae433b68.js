(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["fleet-details-payments"],{6093:function(t,e,n){"use strict";n("6973")},6973:function(t,e,n){},"902f":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("PaymentIndex",{attrs:{qso:t.qso,pageTitle:t.$t("components.fleetDetailsManagement.diveIntoTab.payments.headline"),endpoint:t.endpoint,filterItems:t.filterOptions}})},o=[],i=n("9c62"),s=n("c820"),r={name:"ViewFleetPayments",components:{PaymentIndex:i["a"]},data:function(){return{qso:{append:"",prepend:""},endpoint:null,filterOptions:[{key:"payment_type",type:"checkbox",input:[{text:"Topup",value:"Topup"},{text:"Agent Topup",value:"Agent Topup"},{text:"Initial Balance",value:"Initial Balance"},{text:"Invitee Invitation Amount",value:"Invitee Invitation Amount"},{text:"Inviter Invitation Amount",value:"Inviter Invitation Amount"},{text:"Rider Balance Adjust",value:"Rider Balance Adjust"}],title:"Payment Type"},{key:"refund_status",type:"checkbox",input:[{text:"Refunded",value:"refunded"},{text:"Not Refunded",value:"not-refunded"}],title:"Refund Status"}]}},created:function(){this.generateEndPoint()},methods:{generateEndPoint:function(){this.endpoint=s["c"].invoice.indexOfPayment()+"fleet=".concat(this.$route.params.id,"&")}}},c=r,l=n("2877"),d=Object(l["a"])(c,a,o,!1,null,null,null);e["default"]=d.exports},"9c62":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("PaymentDetailsModal"),n("content-section",{attrs:{spacing:!1}},[n("div",{staticClass:"content-spacing"},[n("div",{staticClass:"grid grid-cols-1 mb-10 md:grid-cols-2"},[n("div",{},[n("title-plus",{attrs:{title:t.pageTitle,"hide-plus":!0}})],1),n("div",{staticClass:"flex md:justify-end"},[n("date-range-picker",{on:{"apply-date":t.onApplyFilterDateRange,"cancel-date":t.onApplyFilterDateRange}})],1)]),n("div",{staticClass:"flex flex-col gap-4 mt-4 mb-10 md:items-center md:flex-row"},[n("SummaryCard",{attrs:{title:t.$t("components.paymentManagement.summary.totalPayment"),value:t.indexMetaData.summary.currency.symbol+" "+t.indexMetaData.summary.total_credit,variant:"gray"}}),n("SummaryCard",{attrs:{title:t.$t("components.paymentManagement.summary.avgPaymentPerDay"),value:t.indexMetaData.summary.currency.symbol+" "+t.indexMetaData.summary.avg_credit_per_day,variant:"gray"}})],1)]),t.$acl.canView("transaction")?[n("FSTable",{attrs:{qso:t.qso,"fst-id":t.fstId,headers:t.getTableHeaders,exportType:t.exportKey.PAYMENT,exportFromURL:!0,endpoint:t.endpoint,"currency-enabled":!0,"currency-attributes":t.getCurrencyAttributes},on:{meta:function(e){return t.indexMetaData=e}},scopedSlots:t._u([{key:"topLeft",fn:function(e){var a=e.slotWidth;return[n("keep-alive",[n("FSTableFilter",{attrs:{"fst-id":t.fstId,"slot-width":a,options:t.getFilteredItems}})],1)]}},{key:"default",fn:function(e){var a=e.data;return[t._l(a,(function(e,a){return["full"===t.getTableMode?[n("FSTableRow",{key:a},[n("FSTableRowItem",[n("div",{staticClass:"font-bold text-blue-600 cursor-pointer",on:{click:function(n){return t.popup(e)}}},[t._v(" "+t._s(t._f("onlyLastFive")(e.id))+" ")])]),n("FSTableRowItem",[e.user?n("router-link",{staticClass:"font-extrabold text-blue-600 capitalize",attrs:{to:{name:"ViewRiderUserProfile",params:{id:e.user.id}},target:"_blank"}},[t._v(" "+t._s(e.user.full_name)+" ")]):n("span",[t._v(" -- ")])],1),n("FSTableRowItem",{attrs:{text:e.date,date:""}}),e.payment_method_details?t._e():n("FSTableRowItem",{attrs:{text:e.payment_method}}),e.payment_method_details?n("FSTableRowItem",[e.payment_method&&"--"!==e.payment_method?n("i",{class:t.getPaymentCardIconClass(e.payment_method_details)}):t._e(),e.payment_method&&"--"!==e.payment_method?n("span",[t._v("  ")]):t._e(),t._v(" "+t._s(e.payment_method)+" ")]):t._e(),n("FSTableRowItem",{attrs:{text:e.payment_reference_id,"text-fallback":"--"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.text;return[n("span","--"===a?[t._v("--")]:["Stripe"===t.paymentMethod?n("span",{staticClass:"text-blue-500"},[n("a",{attrs:{target:"_blank",href:"https://dashboard.stripe.com/payments/"+a}},[t._v(t._s(t.truncate(a,-5,"")))]),n("span",{staticClass:"cursor-pointer text-gray-500",on:{click:function(e){return t.copyTextToClipboard("https://dashboard.stripe.com/payments/"+a)}}},[n("i",{staticClass:"ml-2 far fa-copy"})])]):n("span",[t._v(t._s(t.truncate(a,-5,"")))])])]}}],null,!0)}),n("FSTableRowItem",{attrs:{text:t.getPaymentForText(e.payment_for)}}),n("FSTableRowItem",[n("p",[t._v(" "+t._s(e.currency.symbol)+t._s(e.amount)+" "),e.riding_time_balance?n("span",[t._v("("+t._s(t.convertSecondsToMinutesAndSeconds(e.riding_time_balance))+")")]):t._e()]),e.tax_amount?n("p",{staticClass:"text-xs"},[t._v(" ( VAT "+t._s(e.currency.symbol)+t._s(e.tax_amount)+") ")]):t._e()]),n("FSTableRowItem",{attrs:{text:e.finalized_refund_amount?e.currency.symbol+" "+e.finalized_refund_amount:"--"}}),n("FSTableRowItem",[n("OtoEyeIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"View Invoice",expression:"'View Invoice'",modifiers:{bottom:!0}}],on:{click:function(n){return t.popup(e)}}})],1),n("FSTableRowItem",{staticClass:"flex gap-1"},[n("div",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:t.getRefundTooltip(e),expression:"getRefundTooltip(item)",modifiers:{bottom:!0}}],staticClass:"refund-action",class:e.is_refunded?"refunded":e.is_source_refundable?"refund":"disabled",on:{click:function(n){return t.showRefundPopup(e)}}},[t._v(" "+t._s(e.is_refunded?t.$t("components.paymentManagement.actions.refunded"):t.$t("components.paymentManagement.actions.refund"))+" ")]),n("MoreActionsDropdown",{key:"more-actions-"+a,attrs:{id:"more-actions-"+a,data:e},on:{delete:function(e){return t.$store.dispatch("fsTable/fetchData")}}})],1)],1)]:t._e(),"responsive"===t.getTableMode?[n("FSTableRow",{key:"fs-table-row-"+a,attrs:{"text-fallback-always":""},on:{meta:function(e){return t.indexMetaData=e}}},[n("FSTableRowItem",[n("div",{staticClass:"col-span-1 focus:text-gray-400",on:{click:function(e){return t.toggle(a)}}},[t.opened.includes(a)?n("i",{staticClass:"fas fa-minus-circle",staticStyle:{color:"#d90a20"}}):n("i",{staticClass:"fas fa-plus-circle"})])]),n("FSTableRowItem",[n("div",{staticClass:"font-bold text-blue-600 capitalize cursor-pointer",on:{click:function(n){return t.popup(e)}}},[t._v(" #"+t._s(t._f("onlyLastFive")(e.id))+" ")])]),e.payment_method_details?t._e():n("FSTableRowItem",{attrs:{text:e.payment_method}}),e.payment_method_details?n("FSTableRowItem",[e.payment_method&&"--"!==e.payment_method?n("i",{class:t.getPaymentCardIconClass(e.payment_method_details)}):t._e(),e.payment_method&&"--"!==e.payment_method?n("span",[t._v("  ")]):t._e(),t._v(" "+t._s(e.payment_method)+" ")]):t._e(),n("FSTableRowItem",{attrs:{text:e,"as-currency":""}})],1),t.opened.includes(a)?n("FSTableRow",{key:a},[n("td",{attrs:{colspan:"10"}},[n("div",{staticClass:"grid grid-cols-10 items-center w-full expand-item"},[n("div",{staticClass:"col-span-5 left-text"},[t._v(" "+t._s(t.$t("components.paymentManagement.table.columns.payerName"))+" ")]),n("div",{staticClass:"col-span-5 right-text"},[e.user?n("router-link",{staticClass:"font-extrabold text-blue-600 capitalize",attrs:{to:{name:"ViewRiderUserProfile",params:{id:e.user.id}},target:"_blank"}},[t._v(" "+t._s(e.user.full_name)+" ")]):n("span",[t._v(" -- ")])],1)]),n("div",{staticClass:"grid grid-cols-10 items-center w-full expand-item"},[n("div",{staticClass:"col-span-5 left-text"},[t._v(" "+t._s(t.$t("components.paymentManagement.table.columns.transactionTime"))+" ")]),n("div",{staticClass:"col-span-5 right-text"},[t._v(" "+t._s(t.getFormattedDateTime(e.date,"D MMM, YY hh:mm:ss a")||"--")+" ")])]),n("div",{staticClass:"grid grid-cols-10 items-center w-full expand-item"},[n("div",{staticClass:"col-span-5 left-text"},[t._v(" "+t._s(t.$t("components.paymentManagement.table.columns.paymentRef"))+" ")]),n("div",{staticClass:"col-span-5 right-text"},[e.payment_reference_id?n("span",["Stripe"===t.paymentMethod?n("span",{staticClass:"text-blue-500"},[n("a",{attrs:{target:"_blank",href:"https://dashboard.stripe.com/payments/"+e.payment_reference_id}},[t._v(t._s(t.truncate(e.payment_reference_id,-5,"")))]),n("span",{staticClass:"cursor-pointer text-gray-500",on:{click:function(n){return t.copyTextToClipboard("https://dashboard.stripe.com/payments/"+e.payment_reference_id)}}},[n("i",{staticClass:"ml-2 far fa-copy"})])]):n("span",[t._v(t._s(t.truncate(e.payment_reference_id,-5,"")))])]):n("span",[t._v("--")])])]),n("div",{staticClass:"grid grid-cols-10 items-center w-full expand-item"},[n("div",{staticClass:"col-span-5 left-text"},[t._v(" "+t._s(t.$t("components.paymentManagement.table.columns.paymentFor"))+" ")]),n("div",{staticClass:"col-span-5 right-text"},[t._v(" "+t._s(t.getPaymentForText(e.payment_for)||"--")+" ")])]),n("div",{staticClass:"grid grid-cols-10 items-center w-full expand-item"},[n("div",{staticClass:"col-span-5 left-text"},[t._v(" "+t._s(t.$t("components.paymentManagement.table.columns.invoice"))+" ")]),n("div",{staticClass:"col-span-5 right-text"},[n("OtoEyeIcon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"View Invoice",expression:"'View Invoice'",modifiers:{bottom:!0}}],on:{click:function(n){return t.popup(e)}}})],1)]),n("div",{staticClass:"grid grid-cols-10 items-center w-full expand-item"},[n("div",{staticClass:"col-span-5 left-text"},[t._v(" "+t._s(t.$t("components.paymentManagement.table.columns.actions"))+" ")]),n("div",{staticClass:"col-span-5 right-text"},[n("div",{staticClass:"flex gap-1"},[n("div",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:t.getRefundTooltip(e),expression:"getRefundTooltip(item)",modifiers:{bottom:!0}}],staticClass:"refund-action",class:e.is_refunded?"refunded":e.is_source_refundable?"refund":"disabled",on:{click:function(n){return t.showRefundPopup(e)}}},[t._v(" "+t._s(e.is_refunded?t.$t("components.paymentManagement.actions.refunded"):t.$t("components.paymentManagement.actions.refund"))+" ")]),n("MoreActionsDropdown",{key:"more-actions-"+a,attrs:{id:"more-actions-"+a,data:e},on:{delete:function(e){return t.$store.dispatch("fsTable/fetchData")}}})],1)])])])]):t._e()]:t._e()]}))]}}],null,!1,3825670073)})]:n("div",{staticClass:"py-5 font-bold text-center text-gray-600"},[t._v(" "+t._s(t.$t("components.acl.doNotHavePermission"))+" ")])],2),n("RefundModal",{on:{refunded:t.onRefunded}})],1)},o=[],i=n("1da1"),s=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("7db0"),n("b0c0"),n("a434"),n("99af"),n("b680"),n("159b"),n("4de4"),n("4a9d")),r=n("47d7"),c=n("ca65"),l=n("4138"),d=n("c820"),u=n("6930"),m=n("4a6d"),p=n("214d"),f=n("ea91"),y={name:"PaymentIndex",props:{pageTitle:{type:String,default:"Payment"},fstId:{type:String,default:"payments"},endpoint:{type:String,default:d["c"].invoice.indexOfPayment()},qso:{type:Object,default:function(){return{append:"",prepend:""}}},filterItems:{type:Array,default:function(){return[]}}},components:{ContentSection:function(){return n.e("chunk-2d22cfc9").then(n.bind(null,"f625"))},TitlePlus:function(){return n.e("chunk-4d9af094").then(n.bind(null,"bcf7"))},OtoEyeIcon:function(){return n.e("chunk-2d2105ec").then(n.bind(null,"b833"))},DateRangePicker:function(){return Promise.all([n.e("chunk-93f91af4"),n.e("chunk-86a01c7a")]).then(n.bind(null,"d519"))},SummaryCard:function(){return n.e("chunk-560dab74").then(n.bind(null,"5ce4"))},PaymentDetailsModal:function(){return n.e("chunk-26430e5a").then(n.bind(null,"1495"))},MoreActionsDropdown:p["a"],FSTable:l["a"],FSTableRow:l["d"],FSTableRowItem:l["e"],FSTableFilter:l["b"],RefundModal:function(){return n.e("chunk-092d4b04").then(n.bind(null,"6cbf"))}},data:function(){return{exportKey:f["a"],windowWidth:window.innerWidth,symbol:"$",indexMetaData:{summary:{currency:{symbol:""},total_credit:"0.00",avg_credit_per_day:"0.00",total_debit:"0.00",avg_debit_per_day:"0.00"},count:{total:0}},tableHeaders:[{text:this.$t("components.paymentManagement.table.columns.invoiceID"),width:"10%",sort:"id"},{text:this.$t("components.paymentManagement.table.columns.payerName"),width:"14%",sort:"user"},{text:this.$t("components.paymentManagement.table.columns.transactionTime"),width:"15%",sort:"date"},{text:this.$t("components.paymentManagement.table.columns.paymentMethod"),width:"15%",sort:"payment"},{text:this.$t("components.paymentManagement.table.columns.paymentRef"),width:"10%",sort:null},{text:this.$t("components.paymentManagement.table.columns.paymentFor"),width:"17%",sort:"payment_for"},{text:this.$t("components.paymentManagement.table.columns.amount"),width:"7%",sort:"amount"},{text:this.$t("components.paymentManagement.table.columns.refund"),width:"7%",sort:"amount"},{text:this.$t("components.paymentManagement.table.columns.invoice"),width:"5%",sort:null},{text:this.$t("components.paymentManagement.table.columns.actions"),width:"8%",sort:null}],resTableHeaders:[{text:"",width:"10%",sort:null},{text:this.$t("components.paymentManagement.table.columns.invoiceID"),width:"25%",sort:"id"},{text:this.$t("components.paymentManagement.table.columns.paymentMethod"),width:"35%",sort:"payment"},{text:this.$t("components.paymentManagement.table.columns.amount"),width:"30%",sort:"amount"}],opened:[],filterOptions:[],paymentMethod:""}},created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,o,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.symbol=(null===(n=t.$org)||void 0===n||null===(a=n.default_currency)||void 0===a?void 0:a.symbol)||"$",e.next=3,t.generateFilterOptions();case 3:return e.next=5,t.$http.get(d["c"].dropdown.paymentGateways()).then((function(t){return t.data.data})).catch((function(t){return console.log("paymentGatewayErr",t)}));case 5:o=e.sent,i=o.find((function(t){return t.id===JSON.parse(localStorage.getItem("organization")).default_payment_gateway_config.payment_gateway})),t.paymentMethod=i.name;case 8:case"end":return e.stop()}}),e)})))()},mounted:function(){var t=this;this.$nextTick((function(){window.addEventListener("resize",t.onResize)}))},beforeDestroy:function(){window.removeEventListener("resize",this.onResize)},computed:{getTableHeaders:function(){return this.windowWidth<=930?this.resTableHeaders:this.tableHeaders},getTableMode:function(){return this.windowWidth<=930?"responsive":"full"},getCurrencyAttributes:function(){return Object(l["f"])({root:"",def:{amount:"amount",currencyName:"currency.name",currencySymbol:"currency.symbol"},actual:{amount:"amount",currencyName:"currency.name",currencySymbol:"currency.symbol"}})},getFilteredItems:function(){if(this.filterItems.length){if(this.filterItems.length===this.filterOptions.length){var t=this.filterItems;return t.push({}),t}return this.filterItems}return this.filterOptions}},methods:{onApplyFilterDateRange:l["g"],getRefundTooltip:u["a"],getFormattedDateTime:c["c"],truncate:m["a"],convertSecondsToMinutesAndSeconds:c["a"],onResize:function(){this.windowWidth=window.innerWidth},copyTextToClipboard:function(t){var e=document.createElement("textarea");e.value=t,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-99999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.$notify({group:"generic",type:"success",title:"Payment Reference link Copied",text:"The Payment Reference link has been copied to your clipboard"},2e3)},toggle:function(t){var e=this.opened.indexOf(t);e>-1?this.opened.splice(e,1):this.opened.push(t)},onFilter:function(t,e){this.$store.commit("fsTable/addQsa",{id:t,payload:e})},onFilterClear:function(t){this.$store.commit("fsTable/clearQsa",{id:t})},popup:function(t){s["a"].$emit(r["a"].events.viewingData,t),this.$modal.show(r["a"].events.viewingData)},printAmount:function(t,e){var n="Card"===t?"text-oGreen":"";return'<span class="'.concat(n,'">').concat(this.symbol," ").concat(e?parseFloat(e).toFixed(2):"0.00","</span>")},generateFilterOptions:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=[{key:"payment_type",type:"checkbox",input:[{text:"Card Topup",value:"Topup"},{text:"Agent Topup",value:"Agent Topup"},{text:"Signup Bonus",value:"Initial Balance"},{text:"Referral Bonus by Invitee",value:"Invitee Invitation Amount"},{text:"Referral Bonus by Inviter",value:"Inviter Invitation Amount"},{text:"Balance Transfer by Admin",value:"Rider Balance Adjust"},{text:"Charged for Pass Subscription",value:"Charged for Pass Subscription"},{text:"Pass Subscription using eWallet",value:"Pass Subscription using eWallet"}],title:"Payment Type"},{key:"refund_status",type:"checkbox",input:[{text:"Refunded",value:"refunded"}],title:"Refund Status"}],!t.$acl.canView("fleets")){e.next=9;break}return a=[],e.next=5,t.$http.get("/dashboard/fleets/").then((function(t){var e=t.data;e.data.length&&e.data.forEach((function(t){a.push({text:t.name,value:t.id})}))}));case 5:n.unshift({key:"fleet",type:"checkbox",input:a,title:"Fleet"}),t.filterOptions=n,e.next=10;break;case 9:t.filterOptions=n;case 10:case"end":return e.stop()}}),e)})))()},getPaymentCardIconClass:function(t){var e,n=(null===t||void 0===t||null===(e=t.brand)||void 0===e?void 0:e.toLowerCase())||"",a="fab ";switch(null===n||void 0===n?void 0:n.toLowerCase()){case"visa":a+="fa-cc-visa";break;case"mastercard":a+="fa-cc-mastercard";break;case"americanexpress":a+="fa-cc-amex";break;case"discover":a+="fa-cc-discover";break;case"jcb":a+="fa-cc-jcb";break;case"dinersclub":a+="fa-cc-diners-club";break;default:a="fas fa-wallet";break}return a},getPaymentForText:function(t){if(t.isArray)return t;var e=[{text:"Card Topup",value:"Topup"},{text:"Agent Topup",value:"Agent Topup"},{text:"Signup Bonus",value:"Initial Balance"},{text:"Referral Bonus by Invitee",value:"Invitee Invitation Amount"},{text:"Referral Bonus by Inviter",value:"Inviter Invitation Amount"},{text:"Balance Transfer by Admin",value:"Rider Balance Adjust"}],n=e.filter((function(e){return e.value===t}));return n.length>0?n[0].text:t},showRefundPopup:function(t){this.$acl.canNotUpdate("transaction")?this.$notify(this.$acl.notAbleToToast({action:"update",permission:"transaction"})):!t.is_refunded&&t.is_source_refundable&&(s["a"].$emit(r["a"].events.refundPopup,t),this.$modal.show(r["a"].events.refundPopup))},onRefunded:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("fsTable/fetchData");case 2:t.$notify({group:"generic",type:"success",title:"Refunded",text:"Successfully refunded to the rider."},3e3);case 3:case"end":return e.stop()}}),e)})))()}}},v=y,b=(n("6093"),n("2877")),h=Object(b["a"])(v,a,o,!1,null,"109a221a",null);e["a"]=h.exports}}]);
//# sourceMappingURL=fleet-details-payments.ae433b68.js.map