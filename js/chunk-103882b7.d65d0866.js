(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-103882b7"],{8614:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("t-modal",{attrs:{name:"rental-accept",variant:"confirmation",hideCloseButton:!0,disableBodyScroll:!0,escToClose:!e.isLoading,clickToClose:!e.isLoading},on:{closed:e.onClose}},[a("section",{staticClass:"overflow-auto h-96"},[a("section",{staticClass:"px-4 pt-4 text-2xl font-extrabold text-center"},[e._v(" Accept Rent Request "),a("p",{staticClass:"text-sm text-gray-400 font-bold"},[e._v(" "+e._s(e.currentVehicleModel)+" ")])]),a("div",{staticClass:"px-5 pt-5"},[a("ValidationObserver",{ref:"observer",scopedSlots:e._u([{key:"default",fn:function(t){var s=t.handleSubmit;return[a("form",{attrs:{enctype:"multipart/form-data"},on:{submit:function(t){t.preventDefault(),s(e.onConfirm())}}},[e.should_start_rent_after_accepting?e._e():a("AppInput",{attrs:{type:"richselect",name:"deliveryman",label:"Deliveryman",rules:"required",placeholder:"Select a deliveryman","text-attribute":"text","value-attribute":"value","fetch-options":e.onFetchDeliverymen},on:{click:e.OnOthers},model:{value:e.form.deliveryman,callback:function(t){e.$set(e.form,"deliveryman",t)},expression:"form.deliveryman"}}),a("div",{staticClass:"relative mb-1 "},[a("AppInput",{staticClass:"px-2 py-1 search-area",attrs:{type:"text",placeholder:"Search vehicles by Name / QRCode",isSearch:!0},on:{focus:e.focusUpdate,blur:e.blurUpdate},model:{value:e.globalSearch,callback:function(t){e.globalSearch=t},expression:"globalSearch"}}),a("div",{staticClass:"absolute right-0 left-0 top-auto z-10 py-1 bg-white rounded rounded-t-none border border-t-0 "},[e.isLoadingVehicles&&e.isShow?[a("p",{staticClass:"mx-1"},[e._v("Loading...")])]:e._e(),!e.isLoadingVehicles&&0===e.globalSearchResults.length&&e.isShow?[a("div",{staticClass:"flex justify-between items-center py-2 px-2 text-sm font-medium"},[a("div",[e._v("No vehicle found for this model")]),a("i",{staticClass:"block text-red-500 fas fa-exclamation-circle"})])]:e._e(),!e.isLoadingVehicles&&e.globalSearchResults.length>0&&e.isShow?a("div",{staticClass:"list-container"},e._l(e.globalSearchResults,(function(t){return a("div",{key:t.id,staticClass:"flex justify-between items-center py-2 px-2 text-sm cursor-pointer hover:bg-gray-100 ",on:{click:function(a){return e.onSet(t)}}},[a("div",{staticClass:"w-6/12"},[a("span",{staticClass:"text-gray-700"},[e._v(e._s(t.name))]),a("br"),a("span",{staticClass:"text-xs text-gray-500"},[e._v(e._s(t.qr_code))])]),a("div",{staticClass:"w-4/12"},[a("span",{staticClass:"text-gray-400 text-sm"},[e._v(e._s(t.organization_vehicle_model.title||"--"))])]),a("div",{staticClass:"w-2/12 flex items-center justify-end"},[a("HeartbeatStatus",{attrs:{status:t.lock.is_operational,"text-class":"ml-2 text-xs","is-available":t.is_available}})],1)])})),0):e._e()],2)],1),e.should_start_rent_after_accepting?e._e():a("AppInput",{attrs:{type:"number",name:"eta",label:"Delivery ETA (min)",rules:"required",placeholder:"Enter an estimated time(between 1 to 60 mins) of delivery"},on:{click:e.OnOthers},model:{value:e.form.eta,callback:function(t){e.$set(e.form,"eta",t)},expression:"form.eta"}}),a("button",{ref:"submitButtonRef",staticClass:"hidden",attrs:{type:"submit"}},[e._v(" Confirm ")])],1)]}}])})],1),a("div",{staticClass:"absolute bottom-0 w-full"},[a("section",{staticClass:"flex items-center justify-end px-4 py-4 mt-6 space-x-5 bg-gray-50 "},[a("AppButton",{class:"w-1/2",attrs:{disabled:e.isLoading,variant:"secondary"},on:{click:e.onClose}},[e._v(" Cancel ")]),a("AppButton",{class:"w-1/2",attrs:{variant:"primary",isLoading:e.isLoading,disabled:e.isLoading},on:{click:function(t){return e.$refs.submitButtonRef.click()}}},[e._v(" Accept ")])],1)])])])},i=[],n=a("1da1"),r=(a("96cf"),a("d81d"),a("d3b7"),a("ed08")),o=a("c820"),l=a("4328"),c=a.n(l),u=a("1643"),h={props:{rentId:{type:String,required:!0},currentVehicleCategory:{type:String,required:!0},currentVehicleModel:{type:String,required:!1,default:""},should_start_rent_after_accepting:{type:Boolean,required:!0}},components:{HeartbeatStatus:u["default"]},mounted:function(){this.$modal.show("rental-accept")},data:function(){return{isLoading:!1,isLoadingVehicles:!1,globalSearch:"",globalSearchResults:[],isShow:!1,form:{deliveryman:null,vehicle:{qr_code:null,id:null},eta:null},deliveryETAOptions:[{text:"30 min",value:30},{text:"1 hour",value:60},{text:"1 hour 30 min",value:90},{text:"2 hours",value:120},{text:"2 hours 30 min",value:150},{text:"3 hours",value:180}]}},watch:{globalSearch:function(e){""==e?this.globalSearch=" ":e.length>0?this.onFetchVehicles(e):this.globalSearchResults=[]}},methods:{onFetchDeliverymen:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http.get("/dashboard/rentals/deliverymen/",{params:{search:e}}).then((function(e){var a=e.data;t.deliverymen=null===a||void 0===a?void 0:a.data.map((function(e){return{text:e.full_name,value:e.id}}))})).catch((function(e){console.log("onFetchDeliverymen",e,e.response)}));case 2:return a.abrupt("return",{results:t.deliverymen});case 3:case"end":return a.stop()}}),a)})))()},onFetchVehicles:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.isLoadingVehicles=!0,console.log("que",e),a.next=4,t.$http.get(o["c"].vehicleRental.getRentableVehicles(t.rentId),{params:{search:e},paramsSerializer:function(e){return c.a.stringify(e,{arrayFormat:"repeat"})}}).then((function(e){var a=e.data;t.globalSearchResults=null===a||void 0===a?void 0:a.data})).catch((function(e){console.log("onFetchUsersErr",e,e.response)})).finally((function(){return t.isLoadingVehicles=!1}));case 4:return a.abrupt("return",{results:t.vehicles});case 5:case"end":return a.stop()}}),a)})))()},onSearch:function(){var e;(this.isShow=!this.isShow,this.isShow)&&(this.globalSearch=null!==(e=this.form.vehicle.qr_code)&&void 0!==e?e:" ")},OnOthers:function(){this.isShow=!1},onSet:function(e){this.isShow=!1,this.globalSearch=e.qr_code,this.form.vehicle.qr_code=e.qr_code,this.form.vehicle.id=e.id},onClose:function(e){this.$emit("close",e)},focusUpdate:function(e){console.log("update-focus",e.target.value),this.isShow=!0,this.onFetchVehicles(e.target.value||"")},onConfirm:function(){var e,t=this,a=this,s=this.form;this.isShow=!1,this.isLoading=!0,this.should_start_rent_after_accepting&&s.vehicle?e={status:"ACCEPTED",vehicle:s.vehicle.id}:s.deliveryman&&s.vehicle&&s.eta&&s.eta>=1&&s.eta<=60&&(e={status:"ACCEPTED",vehicle:s.vehicle.id,deliveryman:s.deliveryman,estimated_delivery_time:s.eta});var i=new r["x"](e).toFormData();this.$http.patch(o["c"].vehicleRental.update(this.rentId),i).then((function(e){console.log(e),t.$emit("refresh"),a.$notify({group:"bottomRight",type:"success",title:"Rental Request Accepted",text:"The rental request has been accepted successfully"},5e3),a.$store.dispatch("fsTable/fetchData")})).catch((function(e){console.log("onConfirm",e,e.response),a.$notify({group:"bottomRight",type:"error",title:"Rental Request Update Error",text:"Rental request could not be accepted"},5e3)})).finally((function(){a.isLoading=!1,a.onClose(!0)}))}}},d=h,f=(a("95a2"),a("2877")),p=Object(f["a"])(d,s,i,!1,null,"1f34eacb",null);t["default"]=p.exports},"95a2":function(e,t,a){"use strict";a("e02c")},e02c:function(e,t,a){}}]);
//# sourceMappingURL=chunk-103882b7.d65d0866.js.map