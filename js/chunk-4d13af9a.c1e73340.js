(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d13af9a"],{"067d":function(t,e,s){"use strict";s("42a3")},"42a3":function(t,e,s){},"5c1d":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("t-modal",{attrs:{name:"sunpod-accept",variant:"confirmation",hideCloseButton:!0,disableBodyScroll:!0,escToClose:!t.isLoading,clickToClose:!t.isLoading},on:{closed:t.onClose}},[s("section",{staticClass:"overflow-auto h-96"},[s("section",{staticClass:"px-4 pt-4 text-2xl font-extrabold text-center"},[t._v(" "+t._s(t.$t("components.pods.sunpods.details.steps.vehicles.assignVehicle.headline"))+" ")]),s("div",{staticClass:"px-5 pt-5"},[s("ValidationObserver",{ref:"observer",scopedSlots:t._u([{key:"default",fn:function(e){var o=e.handleSubmit;return[s("form",{attrs:{enctype:"multipart/form-data"},on:{submit:function(e){e.preventDefault(),o(t.onConfirm())}}},[s("div",{staticClass:"relative mb-1 "},[s("AppInput",{staticClass:"px-2 py-1 search-area",attrs:{type:"text",placeholder:t.$t("components.pods.sunpods.details.steps.vehicles.assignVehicle.placeHolder"),isSearch:!0},on:{focus:t.focusUpdate,blur:t.blurUpdate},model:{value:t.globalSearch,callback:function(e){t.globalSearch=e},expression:"globalSearch"}}),s("div",{staticClass:"absolute right-0 left-0 top-auto z-10 py-1 bg-white rounded rounded-t-none border border-t-0 "},[t.isLoadingVehicles&&t.isShow?[s("p",{staticClass:"mx-1"},[t._v("Loading...")])]:t._e(),!t.isLoadingVehicles&&0===t.globalSearchResults.length&&t.isShow?[s("div",{staticClass:"flex justify-between items-center py-2 px-2 text-sm font-medium"},[s("div",[t._v(" "+t._s(t.$t("components.pods.sunpods.details.steps.vehicles.assignVehicle.message")))]),s("i",{staticClass:"block text-red-500 fas fa-exclamation-circle"})])]:t._e(),!t.isLoadingVehicles&&t.globalSearchResults.length>0&&t.isShow?s("div",{staticClass:"list-container"},t._l(t.globalSearchResults,(function(e){return s("div",{key:e.id,staticClass:"flex justify-between items-center py-2 px-2 text-sm cursor-pointer hover:bg-gray-100 ",on:{click:function(s){return t.onSet(e)}}},[s("div",{staticClass:"w-6/12"},[s("span",{staticClass:"text-gray-700"},[t._v(t._s(e.name))]),s("br"),s("span",{staticClass:"text-xs text-gray-500"},[t._v(t._s(e.qr_code))])]),s("div",{staticClass:"w-4/12"},[s("span",{staticClass:"text-gray-400 text-sm"},[t._v(t._s(e.organization_vehicle_model.title||"--"))])]),s("div",{staticClass:"w-2/12 flex items-center justify-end"},[s("HeartbeatStatus",{attrs:{status:e.lock.is_operational,"text-class":"ml-2 text-xs","is-available":e.is_available}})],1)])})),0):t._e()],2)],1),s("button",{ref:"submitButtonRef",staticClass:"hidden",attrs:{type:"submit"}},[t._v(" "+t._s(t.$t("components.stepNavigation.confirm"))+" ")])])]}}])})],1),s("div",{staticClass:"absolute bottom-0 w-full"},[s("section",{staticClass:"flex items-center justify-end px-4 py-4 mt-6 space-x-5 bg-gray-50 "},[s("AppButton",{class:"w-1/2",attrs:{disabled:t.isLoading,variant:"secondary"},on:{click:t.onClose}},[t._v(" "+t._s(t.$t("components.stepNavigation.cancel"))+" ")]),s("AppButton",{class:"w-1/2",attrs:{variant:"primary",isLoading:t.isLoading,disabled:t.isLoading},on:{click:function(e){return t.$refs.submitButtonRef.click()}}},[t._v(" "+t._s(t.$t("components.stepNavigation.assign"))+" ")])],1)])])])},a=[],n=s("1da1"),i=(s("96cf"),s("d3b7"),s("ed08")),r=s("ab33"),c=s("4328"),l=s.n(c),d=s("1643"),u={props:{sunpodId:{type:String,required:!0}},components:{HeartbeatStatus:d["default"]},mounted:function(){this.$modal.show("sunpod-accept")},data:function(){return{isLoading:!1,isLoadingVehicles:!1,globalSearch:"",globalSearchResults:[],isShow:!1,form:{vehicle:{qr_code:null,id:null}}}},watch:{globalSearch:function(t){""==t?this.globalSearch=" ":t.length>0?this.onFetchVehicles(t):this.globalSearchResults=[]}},methods:{onFetchVehicles:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return e.isLoadingVehicles=!0,console.log("que",t),s.next=4,e.$http.get(r["a"].api.assignableVehicles(e.sunpodId),{params:{search:t},paramsSerializer:function(t){return l.a.stringify(t,{arrayFormat:"repeat"})}}).then((function(t){var s=t.data;e.globalSearchResults=null===s||void 0===s?void 0:s.data})).catch((function(t){console.log("onFetchUsersErr",t,t.response)})).finally((function(){return e.isLoadingVehicles=!1}));case 4:return s.abrupt("return",{results:e.vehicles});case 5:case"end":return s.stop()}}),s)})))()},onSearch:function(){var t;(this.isShow=!this.isShow,this.isShow)&&(this.globalSearch=null!==(t=this.form.vehicle.qr_code)&&void 0!==t?t:" ")},onSet:function(t){this.isShow=!1,this.globalSearch=t.qr_code,this.form.vehicle.qr_code=t.qr_code,this.form.vehicle.id=t.id},onClose:function(t){this.$emit("close",t)},focusUpdate:function(t){console.log("update-focus",t.target.value),this.isShow=!0,this.onFetchVehicles(t.target.value||"")},onConfirm:function(){var t=this,e=this,s=this.form;this.isShow=!1,this.isLoading=!0;var o={vehicle_id:s.vehicle.id},a=new i["x"](o).toFormData();this.$http.post(r["a"].api.addVehicle(this.sunpodId),a).then((function(s){console.log(s),t.$emit("refresh"),e.$notify({group:"bottomRight",type:"success",title:"Success",text:"Vehicle has been assigned successfully"},5e3),e.$store.dispatch("fsTable/fetchData")})).catch((function(t){var s;console.log("onConfirm",t,t.response.data.detail),e.$notify({group:"bottomRight",type:"error",title:"Error",text:null!==(s=t.response.data.detail)&&void 0!==s?s:"Failed to assign vehicles"},5e3)})).finally((function(){e.isLoading=!1,e.onClose(!0)}))}}},h=u,p=(s("067d"),s("2877")),f=Object(p["a"])(h,o,a,!1,null,"0a7e9b16",null);e["default"]=f.exports},ab33:function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var o={api:{index:"/dashboard/sunpods/",create:"/dashboard/sunpods/",update:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/")},detail:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/")},assignedEdgebox:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/add-edgebox/")},addVehicle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/add-vehicle/")},doorStatus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/door-status/")},openDoor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/open/")},closeDoor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/close/")},logs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/request-logs/sun-pods/".concat(t,"/")},assignableVehicles:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/sunpods/".concat(t,"/assignable-vehicles/")}},events:{name:"sunpods",refresh:"rid-sunpods",sorId:"sunpods",sorOpen:"sor-open-sunpods",sorClose:"sor-close-sunpods",sorToggle:"sor-toggle-sunpods",editingData:"edit-sunpods-data",viewingData:"view-sunpods-data"}}}}]);
//# sourceMappingURL=chunk-4d13af9a.c1e73340.js.map