(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2dc95998"],{b9a3:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("t-modal",{ref:"popup",attrs:{name:t.popName,variant:"transaction",hideCloseButton:!0,disableBodyScroll:!0}},[a("section",{staticClass:"px-8 pt-10"},[a("div",{staticClass:"font-medium text-28px text-oCharcoal"},[t._v(" "+t._s(t.popTitle)+" ")]),a("div",{staticClass:"p-8"},[a("label",{staticClass:"mt-8"},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.adjustmentBalance,expression:"adjustmentBalance",modifiers:{number:!0}}],ref:"adjustBalanceInput",staticClass:"w-full h-16 px-3 text-2xl font-bold text-center text-orange-400 border rounded focus:outline-none",attrs:{type:"number",placeholder:t.getAmountPlaceholder,disabled:!!t.selectedTopupOffer.id},domProps:{value:t.adjustmentBalance},on:{input:function(e){e.target.composing||(t.adjustmentBalance=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),t.selectedTopupOffer.id?a("div",{staticClass:"text-center text-sm font-bold text-gray-500"},[a("p",[t._v(" You have applied "),a("span",{staticClass:" text-green-600"},[t._v(t._s(""+t.selectedTopupOffer.currencySymbol+t.selectedTopupOffer.price))]),t._v(" offer."),a("span",{staticClass:"text-red-500 cursor-pointer ml-1",on:{click:t.handleSelectedTopupOfferInit}},[t._v("Reset?")])])]):t._e(),a("AppInput",{staticClass:"mt-8",attrs:{type:"richselect",name:"target",label:t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.targetAccount"),options:t.wallets,"hide-search-box":""},model:{value:t.targetAccount,callback:function(e){t.targetAccount=e},expression:"targetAccount"}}),t.getRidingUnitCostViewStatus?a("AppInput",{ref:"ridingTimeUnitCostInput",staticClass:"mt-2",attrs:{type:"richselect",name:"ridingTimeUnitCost",label:t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.selectUnitCostPerUnit.title"),placeholder:t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.selectUnitCostPerUnit.placeholder"),options:t.ridingTimeUnitCostOptions,required:!0,"hide-search-box":""},model:{value:t.ridingTimeUnitCost,callback:function(e){t.ridingTimeUnitCost=t._n(e)},expression:"ridingTimeUnitCost"}}):t._e(),"add"===t.data.type&&t.topupOfferData.length>0?a("div",[a("label",{staticClass:"block w-full text-sm font-bold text-gray-800"},[t._v(" "+t._s(t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.selectTopupOffers"))+" ")]),t._l(t.topupOfferData,(function(e,n){return a("section",{key:"topup-offer-"+n},[a("div",{staticClass:"flex items-center justify-between rounded-lg px-3 py-2  my-2 cursor-pointer shadow-sm border border-gray-300 hover:shadow-md ",class:t.selectedTopupOffer.index===n?"border-2 border-gray-800":"",on:{click:function(a){return t.handleTopupOfferItemSelected(e,n)}}},[a("div",[a("p",{staticClass:"text-sm font-bold text-gray-500"},[t._v(" "+t._s(e.riding_time_seconds/60)+" mins ride ")]),a("p",{staticClass:"text-xs font-bold text-gray-500"},[t._v(" "+t._s(e.validity_duration)+" "+t._s(e.validity_duration_unit_display_text+(e.validity_duration>1?"s":""))+" ")])]),a("div",[a("p",{staticClass:"text-xl font-bold text-green-600"},[t._v(" "+t._s(e.currency.symbol)+t._s(e.price)+" ")])])])])}))],2):t._e(),a("label",{staticClass:"block w-full mt-6 text-sm font-bold text-gray-800"},[t._v(" "+t._s(t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.adjustedBalance"))+" ("+t._s(t.getCurrencySymbol)+") "),a("input",{staticClass:"w-full px-2 py-2 text-gray-500 bg-gray-200 border-gray-300 rounded focus:outline-none",attrs:{type:"text",readonly:""},domProps:{value:t.getCurrentBalance}})]),a("div",{staticClass:"mt-8 single-input"},[a("label",{staticClass:"w-full text-sm font-bold text-gray-800"},[t._v(" "+t._s(t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.adjustedBalanceOf"))+" "),a("input",{staticClass:"w-full px-2 py-2 text-gray-500 bg-gray-200 border-gray-300 rounded focus:outline-none",attrs:{type:"text",readonly:""},domProps:{value:t.data.fullName+" ("+t.data.phoneNumber+")"}})])]),a("section",{staticClass:"mt-6"},[a("t-checkbox",{attrs:{wrapped:"",label:t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.addRemarks.title"),name:"adminRemarksUi"},model:{value:t.remarksUi,callback:function(e){t.remarksUi=e},expression:"remarksUi"}}),a("div",{staticClass:"-mt-2 text-14px",staticStyle:{"margin-left":"28px"}},[a("span",{staticClass:"text-gray-500"},[t._v(" "+t._s(t.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.addRemarks.info"))+" ")])])],1),a("section",{directives:[{name:"show",rawName:"v-show",value:t.remarksUi,expression:"remarksUi"}],staticClass:"mt-6"},[a("t-textarea",{model:{value:t.remarks,callback:function(e){t.remarks=e},expression:"remarks"}})],1),a("div",{staticClass:"flex items-center justify-end mt-12 mb-4 space-x-4"},[a("AppButton",{attrs:{variant:"secondary",text:t.$t("components.stepNavigation.cancel")},on:{click:function(e){return t.$refs.popup.hide()}}}),a("AppButton",{attrs:{variant:t.getSubmitButtonVariant,text:t.getSubmitButtonText,isLoading:t.isLoading},on:{click:t.submitForm}})],1)],1)])])},i=[],s=a("1da1"),o=(a("96cf"),a("99af"),a("7db0"),a("a9e3"),a("b680"),a("ac1f"),a("5319"),a("d3b7"),a("25f0"),a("4de4"),a("d81d"),a("b0c0"),a("4a9d")),r=a("df0b"),d=a("5da7"),c={name:"AdjustBalancePopup",components:{},props:{data:{type:Object,required:!0},wallets:{type:Array,required:!0},isSubscribedRidingTimeBalance:{type:Boolean,required:!0},currencySymbol:{type:String,required:!0}},data:function(){return{popName:"AdjustBalancePopup",isLoading:!1,adjustmentBalance:null,targetAccount:null,ridingTimeUnitCost:null,remarks:"",remarksUi:!1,topupOfferData:[],ridingTimeUnitCostOptions:[],selectedTopupOffer:{id:null,index:null,price:null,currencySymbol:null}}},computed:{popTitle:function(){return"add"===this.data.type?this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.addBalance"):"deduct"===this.data.type?this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.deductBalance"):this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.adjustBalance")},getSubmitButtonText:function(){return"add"===this.data.type?this.isSubscribedRidingTimeBalance?this.selectedTopupOffer.id?this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.addBalance"):"".concat(this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.add")," ").concat(this.getCurrencySymbol).concat(this.getAdjustAmountForSubmission):this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.addBalance"):"deduct"===this.data.type?this.isSubscribedRidingTimeBalance?this.selectedTopupOffer.id?this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.deductBalance"):"".concat(this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.deduct")," ").concat(this.getCurrencySymbol).concat(this.getAdjustAmountForSubmission):this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.deductBalance"):this.$t("components.riderDetailsManagement.diveIntoTab.paymentMethod.modals.adjustBalance")},getSubmitButtonVariant:function(){return"add"===this.data.type?"success":"deduct"===this.data.type?"warning":"primary"},getSelectedWallet:function(){var t=this;return this.wallets.find((function(e){return e.id===t.targetAccount}))},getCurrencySymbol:function(){var t,e;return(null===(t=this.getSelectedWallet)||void 0===t||null===(e=t.currency)||void 0===e?void 0:e.symbol)||this.currencySymbol||""},getCurrentBalance:function(){var t,e,a=Number(null===(t=this.getSelectedWallet)||void 0===t?void 0:t.balance);return"add"===this.data.type&&(e=a+parseFloat(this.getAdjustAmountForSubmission)),"deduct"===this.data.type&&(e=a+parseFloat(this.getAdjustAmountForSubmission)),e?e.toFixed(2):a},getRidingUnitCostViewStatus:function(){return!0===this.isSubscribedRidingTimeBalance&&!this.selectedTopupOffer.id||(!0===this.isSubscribedRidingTimeBalance&&this.selectedTopupOffer.id,!1)},getAdjustAmountForSubmission:function(){return this.isSubscribedRidingTimeBalance&&!this.selectedTopupOffer.id?"deduct"===this.data.type&&this.adjustmentBalance>0?"-".concat(parseFloat(this.adjustmentBalance*this.ridingTimeUnitCost).toFixed(2)):parseFloat(this.adjustmentBalance*this.ridingTimeUnitCost).toFixed(2):"deduct"===this.data.type&&this.adjustmentBalance>0?"-".concat(this.adjustmentBalance):this.adjustmentBalance},getAdjustAmountForToast:function(){if(this.isSubscribedRidingTimeBalance&&!this.selectedTopupOffer.id)return"".concat(this.adjustmentBalance," minutes");var t="deduct"===this.data.type&&this.adjustmentBalance>0?"-":"",e=this.adjustmentBalance.toString().replace(/^-/g,"");return"".concat(t).concat(this.getCurrencySymbol).concat(e)},getAmountPlaceholder:function(){var t=this;if(this.isSubscribedRidingTimeBalance)return"0 min";var e=this.wallets.find((function(e){return e.id===t.targetAccount}));return e?"".concat(e.currency.symbol," 0.00"):this.currencySymbol+" 0.00"},getFleetId:function(){var t,e,a;return null===(t=this.$store.getters["riderdetails/getData"])||void 0===t||null===(e=t.profile)||void 0===e||null===(a=e.nearby_fleet)||void 0===a?void 0:a.id}},watch:{getFleetId:{immediate:!0,deep:!1,handler:function(t){var e=this;t&&this.$http.get("".concat(r["a"].api.index,"?dropdown&fleet=").concat(this.getFleetId,"&is_active=true")).then((function(t){e.topupOfferData=t.data.data}))}},targetAccount:{immediate:!0,deep:!1,handler:function(t){var e=this;if(t){this.ridingTimeUnitCost=null,this.ridingTimeUnitCostOptions=[];var a=this.wallets.find((function(t){return t.id===e.targetAccount})),n=a.fleets.filter((function(t){return!!t.amount_per_riding_time_unit}));this.ridingTimeUnitCostOptions=n.map((function(t){return{text:"".concat(a.currency.symbol).concat(Object(d["b"])(1===t.riding_time_unit?t.amount_per_riding_time_unit:60*t.amount_per_riding_time_unit,4),"/min (Fleet: ").concat(t.name,")"),value:Object(d["b"])(1===t.riding_time_unit?t.amount_per_riding_time_unit:60*t.amount_per_riding_time_unit,4)}}))}}}},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o["a"].$on(t.$config.riderUser.events.adjustBalancePop,Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.adjustmentBalance=null,t.handleSelectedTopupOfferInit(),setTimeout((function(){if(t.$refs.adjustBalanceInput){t.$refs.adjustBalanceInput.focus();var e=t.wallets.find((function(t){return!0===t.default}));e&&(t.targetAccount=e.id)}}),500);case 3:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e)})))()},methods:{formatNumberWithMaxDecimals:d["b"],handleSelectedTopupOfferInit:function(){this.selectedTopupOffer={id:null,index:null,price:null,currencySymbol:null}},handleTopupOfferItemSelected:function(t,e){this.selectedTopupOffer.id=t.id,this.selectedTopupOffer.index=e,this.selectedTopupOffer.price=t.price,this.selectedTopupOffer.currencySymbol=t.currency.symbol,this.adjustmentBalance=parseInt(t.price)},submitForm:function(){var t,e,a=this;if(this.isSubscribedRidingTimeBalance){if(!this.adjustmentBalance&&this.$refs.adjustBalanceInput)return void this.$refs.adjustBalanceInput.focus();if(this.getRidingUnitCostViewStatus&&!this.ridingTimeUnitCost)return this.$notify({group:"generic",type:"default",title:"Info",text:"Please select an amount from Riding Time unit cost."},3e3),void(this.$refs.ridingTimeUnitCostInput&&this.$refs.ridingTimeUnitCostInput.focus())}else if(!this.adjustmentBalance&&this.$refs.adjustBalanceInput)return void this.$refs.adjustBalanceInput.focus();this.selectedTopupOffer.id?(t="Topup Offer",e="".concat(this.getAdjustAmountForToast," Topup Offer has purchased")):(t="add"===this.data.type?"Balance Added":"Balance Deducted",e="add"===this.data.type?"".concat(this.getAdjustAmountForToast," is added to ").concat(this.data.fullName,"'s account"):"".concat(this.getAdjustAmountForToast," is deducted from ").concat(this.data.fullName,"'s account"));var n=new FormData;n.append("balance_adjustment",this.getAdjustAmountForSubmission),n.append("target_account",this.targetAccount),n.append("remarks",this.remarks),this.selectedTopupOffer.id&&n.append("topup_offer",this.selectedTopupOffer.id);var i=this.$config.riderUser.api.balanceAdjustment(this.data.userId);this.isLoading=!0,this.$http.post(i,n).then((function(n){var i=n.data.data.balance_after;a.$emit("adjustedBalance",i),a.adjustmentBalance=null,a.remarksUi=!1,a.remarks="",a.$refs.popup.hide(),a.$notify({group:"generic",type:"success",title:t,text:e})})).catch((function(t){return console.log(t)})).finally((function(){a.isLoading=!1}))}}},u=c,l=a("2877"),p=Object(l["a"])(u,n,i,!1,null,"53af2f56",null);e["default"]=p.exports},df0b:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var n={api:{index:"/dashboard/top-up-offers/",create:"/dashboard/top-up-offers/",update:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/top-up-offers/".concat(t,"/")},detail:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/top-up-offers/".concat(t,"/")},delete:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid";return"/dashboard/top-up-offers/".concat(t,"/")}},events:{name:"topup-offer",refresh:"rid-topup-offer",sorId:"topup-offer",sorOpen:"sor-open-topup-offer",sorClose:"sor-close-topup-offer",sorToggle:"sor-toggle-topup-offer",editingData:"edit-topup-offer-data",viewingData:"view-topup-offer-data"}}}}]);
//# sourceMappingURL=chunk-2dc95998.304faf77.js.map